[
	{
		"desc": "parserTests"
	},
	{
		"desc": "Simple paragraph",
		"wikitext": "This is a simple paragraph.",
		"parsed": "This is a simple paragraph."
	},
	{
		"desc": "Paragraphs with extra newline spacing",
		"wikitext": "a\n\nb (+2 nls)\n\n\nc (+3 nls)\n\n\n\nd (+4 nls)\n\n\n\n\ne (+5 nls)",
		"parsed": "a\\n\\nb (+2 nls)\\n\\n\\nc (+3 nls)\\n\\n\\n\\nd (+4 nls)\\n\\n\\n\\n\\ne (+5 nls)"
	},
	{
		"desc": "Paragraphs with newline spacing with comment lines in between",
		"wikitext": "----\na\n<!--foo-->\nb\n----\na\n<!--foo--><!--More than 1 comment, still stripped-->\nb\n----\na\n <!--foo--> <!----> <!-- bar --> \nb\n----\na\n<!--foo-->\n\nb\n----\na\n\n<!--foo-->\nb\n----\na\n<!--foo-->\n\n\nb\n----\na\n\n\n<!--foo-->\nb\n----",
		"parsed": "<markup.changed>----\\n</>a\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</>foo<punctuation.definition.comment.html>--&gt\\n</></>b\\n<markup.changed>----\\n</>a\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</>foo<punctuation.definition.comment.html>--&gt&lt;!--</>More than 1 comment, still stripped<punctuation.definition.comment.html>--&gt\\n</></>b\\n<markup.changed>----\\n</>a\\n <comment.block.html><punctuation.definition.comment.html>&lt;!--</>foo<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!----&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</> bar <punctuation.definition.comment.html>--&gt</></> \\nb\\n<markup.changed>----\\n</>a\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</>foo<punctuation.definition.comment.html>--&gt\\n\\n</></>b\\n<markup.changed>----\\n</>a\\n\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</>foo<punctuation.definition.comment.html>--&gt\\n</></>b\\n<markup.changed>----\\n</>a\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</>foo<punctuation.definition.comment.html>--&gt\\n\\n\\n</></>b\\n<markup.changed>----\\n</>a\\n\\n\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</>foo<punctuation.definition.comment.html>--&gt\\n</></>b\\n<markup.changed>----</>"
	},
	{
		"desc": "Paragraphs with newline spacing with non-empty white-space lines in between",
		"wikitext": "----\na\n \nb\n----\na\n \n \nb\n----",
		"parsed": "<markup.changed>----\\n</>a\\n \\nb\\n<markup.changed>----\\n</>a\\n \\n \\nb\\n<markup.changed>----</>"
	},
	{
		"desc": "Paragraphs with newline spacing with non-empty mixed comment and white-space lines in between",
		"wikitext": "----\na\n <!--foo-->\nb\n----\na\n <!--foo--><!--More than 1 comment doesn't disable stripping of this line!-->\nb\n----\na\n \n<!--foo-->\n <!--bar-->\nb\n----\na\n \n <!--foo-->\n <!--bar-->\n \nb\n----",
		"parsed": "<markup.changed>----\\n</>a\\n <comment.block.html><punctuation.definition.comment.html>&lt;!--</>foo<punctuation.definition.comment.html>--&gt\\n</></>b\\n<markup.changed>----\\n</>a\\n <comment.block.html><punctuation.definition.comment.html>&lt;!--</>foo<punctuation.definition.comment.html>--&gt&lt;!--</>More than 1 comment doesn't disable stripping of this line!<punctuation.definition.comment.html>--&gt\\n</></>b\\n<markup.changed>----\\n</>a\\n \\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</>foo<punctuation.definition.comment.html>--&gt\\n</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>bar<punctuation.definition.comment.html>--&gt\\n</></>b\\n<markup.changed>----\\n</>a\\n \\n <comment.block.html><punctuation.definition.comment.html>&lt;!--</>foo<punctuation.definition.comment.html>--&gt\\n</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>bar<punctuation.definition.comment.html>--&gt\\n</></> \\nb\\n<markup.changed>----</>"
	},
	{
		"desc": "Extra newlines: More paragraphs with indented comment",
		"wikitext": "a\n\n   <!--boo-->\n\nb",
		"parsed": "a\\n\\n   <comment.block.html><punctuation.definition.comment.html>&lt;!--</>boo<punctuation.definition.comment.html>--&gt\\n\\n</></>b"
	},
	{
		"desc": "Extra new lines before and after lists are preserved",
		"wikitext": "a\n\n\n*b\n\n\nc",
		"parsed": "a\\n\\n\\n<punctuation.definition.list.begin.markdown>*</>b\\n\\n\\nc"
	},
	{
		"desc": "Multiple newlines after tables are converted to p-br-p tags",
		"wikitext": "{|\n|x\n|}\n\n\n\n\n=b=",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>x\\n</></><keyword.operator>|}\\n\\n\\n\\n\\n</></><markup.heading>=<string.quoted.other.heading>b</>=</>"
	},
	{
		"desc": "Parsing an URL",
		"wikitext": "http://fr.wikipedia.org/wiki/ğŸº\n<!-- EasterEgg we love beer, better be able be able to link to it -->",
		"parsed": "http://fr.wikipedia.org/wiki/ğŸº\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</> EasterEgg we love beer, better be able be able to link to it <punctuation.definition.comment.html>--&gt</></>"
	},
	{
		"desc": "Simple list",
		"wikitext": "*Item 1\n*Item 2",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>Item 1\\n<punctuation.definition.list.begin.markdown>*</>Item 2"
	},
	{
		"desc": "Non-html5 tags should be accepted",
		"wikitext": "<center>''foo''</center>\n<big>''foo''</big>\n<font style=\"123\">''foo''</font>\n<strike>''foo''</strike>\n<tt>''foo''</tt>",
		"parsed": "<meta.tag.structure.center.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.deprecated.html>center</></><punctuation.definition.tag.end.html>&gt</></><markup.italic>''</>foo<markup.italic>''</><meta.tag.structure.center.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.deprecated.html>center</></><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.big.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.deprecated.html>big</></><punctuation.definition.tag.end.html>&gt</></><markup.italic>''</>foo<markup.italic>''</><meta.tag.inline.big.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.deprecated.html>big</></><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.font.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.deprecated.html>font</></> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>123</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></><markup.italic>''</>foo<markup.italic>''</><meta.tag.inline.font.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.deprecated.html>font</></><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.strike.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.deprecated.html>strike</></><punctuation.definition.tag.end.html>&gt</></><markup.italic>''</>foo<markup.italic>''</><meta.tag.inline.strike.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.deprecated.html>strike</></><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.tt.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.deprecated.html>tt</></><punctuation.definition.tag.end.html>&gt</></><markup.italic>''</>foo<markup.italic>''</><meta.tag.inline.tt.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.deprecated.html>tt</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "<wbr> is valid wikitext (T54468)",
		"wikitext": "<wbr>",
		"parsed": "<meta.tag.inline.wbr.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>wbr</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "<s> or <strike> for strikethrough",
		"wikitext": "<strike>strike</strike>\n\n<s>s</s>",
		"parsed": "<meta.tag.inline.strike.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.deprecated.html>strike</></><punctuation.definition.tag.end.html>&gt</></>strike<meta.tag.inline.strike.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.deprecated.html>strike</></><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.inline.s.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>s</><punctuation.definition.tag.end.html>&gt</></>s<meta.tag.inline.s.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>s</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Text-level semantic html elements in wikitext",
		"wikitext": "<em>text</em>\n<strong>text</strong>\n<small>text</small>\n<s>text</s>\n<cite>text</cite>\n<q>text</q>\n<dfn>text</dfn>\n<abbr>text</abbr>\n<data>text</data>\n<time>text</time>\n<code>text</code>\n<var>text</var>\n<samp>text</samp>\n<kbd>text</kbd>\n<sub>text</sub>\n<u>text</u>\n<mark>text</mark>\n<ruby><rb>æ˜æ—¥</rb><rp>(</rp><rt>Ashita</rt><rp> </rp><rtc>ã‚ã—ãŸ</rtc><rp>)</rp></ruby>\n<bdi>text</bdi>\n<bdo>text</bdo>\n<span>text</span>\n<wbr />",
		"parsed": "<meta.tag.inline.em.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>em</><punctuation.definition.tag.end.html>&gt</></>text<meta.tag.inline.em.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>em</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.strong.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>strong</><punctuation.definition.tag.end.html>&gt</></>text<meta.tag.inline.strong.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>strong</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.small.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt</></>text<meta.tag.inline.small.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.s.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>s</><punctuation.definition.tag.end.html>&gt</></>text<meta.tag.inline.s.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>s</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.cite.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>cite</><punctuation.definition.tag.end.html>&gt</></>text<meta.tag.inline.cite.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>cite</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.q.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>q</><punctuation.definition.tag.end.html>&gt</></>text<meta.tag.inline.q.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>q</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.dfn.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>dfn</><punctuation.definition.tag.end.html>&gt</></>text<meta.tag.inline.dfn.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>dfn</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.abbr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>abbr</><punctuation.definition.tag.end.html>&gt</></>text<meta.tag.inline.abbr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>abbr</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.data.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>data</><punctuation.definition.tag.end.html>&gt</></>text<meta.tag.inline.data.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>data</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.time.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>time</><punctuation.definition.tag.end.html>&gt</></>text<meta.tag.inline.time.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>time</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.code.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>code</><punctuation.definition.tag.end.html>&gt</></>text<meta.tag.inline.code.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>code</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.var.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>var</><punctuation.definition.tag.end.html>&gt</></>text<meta.tag.inline.var.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>var</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.samp.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>samp</><punctuation.definition.tag.end.html>&gt</></>text<meta.tag.inline.samp.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>samp</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.kbd.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>kbd</><punctuation.definition.tag.end.html>&gt</></>text<meta.tag.inline.kbd.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>kbd</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.sub.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>sub</><punctuation.definition.tag.end.html>&gt</></>text<meta.tag.inline.sub.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>sub</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.u.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>u</><punctuation.definition.tag.end.html>&gt</></>text<meta.tag.inline.u.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>u</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.mark.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>mark</><punctuation.definition.tag.end.html>&gt</></>text<meta.tag.inline.mark.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>mark</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.ruby.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ruby</><punctuation.definition.tag.end.html>&gt</></><meta.tag.other.rb.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rb</></><punctuation.definition.tag.end.html>&gt</></>æ˜æ—¥<meta.tag.other.rb.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rb</></><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.rp.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>rp</><punctuation.definition.tag.end.html>&gt</></>(<meta.tag.inline.rp.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>rp</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.rt.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></>Ashita<meta.tag.inline.rt.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.rp.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>rp</><punctuation.definition.tag.end.html>&gt</></> <meta.tag.inline.rp.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>rp</><punctuation.definition.tag.end.html>&gt</></><meta.tag.other.rtc.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rtc</></><punctuation.definition.tag.end.html>&gt</></>ã‚ã—ãŸ<meta.tag.other.rtc.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rtc</></><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.rp.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>rp</><punctuation.definition.tag.end.html>&gt</></>)<meta.tag.inline.rp.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>rp</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.ruby.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ruby</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.bdi.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>bdi</><punctuation.definition.tag.end.html>&gt</></>text<meta.tag.inline.bdi.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>bdi</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.bdo.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>bdo</><punctuation.definition.tag.end.html>&gt</></>text<meta.tag.inline.bdo.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>bdo</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>text<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.wbr.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>wbr</> <punctuation.definition.tag.end.html>/&gt</></>"
	},
	{
		"desc": "Ruby markup (W3C-style)",
		"wikitext": ";Mono-ruby for individual base characters\n:<ruby>æ—¥<rt>ã«</rt>æœ¬<rt>ã»ã‚“</rt>èª<rt>ã”</rt></ruby>\n;Group ruby\n:<ruby>ä»Šæ—¥<rt>ãã‚‡ã†</rt></ruby>\n;Jukugo ruby\n:<ruby>æ³•<rb>è¯</rb><rb>çµŒ</rb><rt>ã»</rt><rt>ã‘</rt><rt>ãã‚‡ã†</rt></ruby>\n;Inline ruby\n:<ruby>æ±<rb>äº¬</rb><rp>(</rp><rt>ã¨ã†</rt><rt>ãã‚‡ã†</rt><rp>)</rp></ruby>\n;Double-sided ruby\n:<ruby><rb>æ—§</rb><rb>é‡‘</rb><rb>å±±</rb><rt>jiÃ¹</rt><rt>jÄ«n</rt><rt>shÄn</rt><rtc>San Francisco</rtc></ruby>\n\n<ruby>\n<rb>â™¥</rb><rtc><rt>Heart</rt></rtc><rtc lang=\"fr\"><rt>CÅ“ur</rt></rtc>\n<rb>â˜˜</rb><rtc><rt>Shamrock</rt></rtc><rtc lang=\"fr\"><rt>TrÃ¨fle</rt></rtc>\n<rb>âœ¶</rb><rtc><rt>Star</rt></rtc><rtc lang=\"fr\"><rt>Ã‰toile</rt></rtc>\n</ruby>",
		"parsed": "<punctuation.definition.list.begin.markdown>;</>Mono-ruby for individual base characters\\n<punctuation.definition.list.begin.markdown>:</><meta.tag.inline.ruby.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ruby</><punctuation.definition.tag.end.html>&gt</></>æ—¥<meta.tag.inline.rt.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></>ã«<meta.tag.inline.rt.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></>æœ¬<meta.tag.inline.rt.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></>ã»ã‚“<meta.tag.inline.rt.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></>èª<meta.tag.inline.rt.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></>ã”<meta.tag.inline.rt.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.ruby.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ruby</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.list.begin.markdown>;</>Group ruby\\n<punctuation.definition.list.begin.markdown>:</><meta.tag.inline.ruby.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ruby</><punctuation.definition.tag.end.html>&gt</></>ä»Šæ—¥<meta.tag.inline.rt.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></>ãã‚‡ã†<meta.tag.inline.rt.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.ruby.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ruby</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.list.begin.markdown>;</>Jukugo ruby\\n<punctuation.definition.list.begin.markdown>:</><meta.tag.inline.ruby.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ruby</><punctuation.definition.tag.end.html>&gt</></>æ³•<meta.tag.other.rb.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rb</></><punctuation.definition.tag.end.html>&gt</></>è¯<meta.tag.other.rb.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rb</></><punctuation.definition.tag.end.html>&gt</><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rb</></><punctuation.definition.tag.end.html>&gt</></>çµŒ<meta.tag.other.rb.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rb</></><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.rt.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></>ã»<meta.tag.inline.rt.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.rt.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></>ã‘<meta.tag.inline.rt.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.rt.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></>ãã‚‡ã†<meta.tag.inline.rt.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.ruby.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ruby</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.list.begin.markdown>;</>Inline ruby\\n<punctuation.definition.list.begin.markdown>:</><meta.tag.inline.ruby.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ruby</><punctuation.definition.tag.end.html>&gt</></>æ±<meta.tag.other.rb.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rb</></><punctuation.definition.tag.end.html>&gt</></>äº¬<meta.tag.other.rb.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rb</></><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.rp.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>rp</><punctuation.definition.tag.end.html>&gt</></>(<meta.tag.inline.rp.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>rp</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.rt.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></>ã¨ã†<meta.tag.inline.rt.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.rt.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></>ãã‚‡ã†<meta.tag.inline.rt.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.rp.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>rp</><punctuation.definition.tag.end.html>&gt</></>)<meta.tag.inline.rp.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>rp</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.ruby.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ruby</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.list.begin.markdown>;</>Double-sided ruby\\n<punctuation.definition.list.begin.markdown>:</><meta.tag.inline.ruby.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ruby</><punctuation.definition.tag.end.html>&gt</></><meta.tag.other.rb.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rb</></><punctuation.definition.tag.end.html>&gt</></>æ—§<meta.tag.other.rb.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rb</></><punctuation.definition.tag.end.html>&gt</><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rb</></><punctuation.definition.tag.end.html>&gt</></>é‡‘<meta.tag.other.rb.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rb</></><punctuation.definition.tag.end.html>&gt</><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rb</></><punctuation.definition.tag.end.html>&gt</></>å±±<meta.tag.other.rb.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rb</></><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.rt.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></>jiÃ¹<meta.tag.inline.rt.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.rt.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></>jÄ«n<meta.tag.inline.rt.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.rt.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></>shÄn<meta.tag.inline.rt.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></><meta.tag.other.rtc.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rtc</></><punctuation.definition.tag.end.html>&gt</></>San Francisco<meta.tag.other.rtc.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rtc</></><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.ruby.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ruby</><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.inline.ruby.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ruby</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.other.rb.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rb</></><punctuation.definition.tag.end.html>&gt</></>â™¥<meta.tag.other.rb.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rb</></><punctuation.definition.tag.end.html>&gt</></><meta.tag.other.rtc.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rtc</></><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.rt.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></>Heart<meta.tag.inline.rt.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></><meta.tag.other.rtc.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rtc</></><punctuation.definition.tag.end.html>&gt</><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rtc</></> <meta.attribute.unrecognized.lang.html><entity.other.attribute-name.html>lang</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>fr<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.rt.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></>CÅ“ur<meta.tag.inline.rt.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></><meta.tag.other.rtc.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rtc</></><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.other.rb.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rb</></><punctuation.definition.tag.end.html>&gt</></>â˜˜<meta.tag.other.rb.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rb</></><punctuation.definition.tag.end.html>&gt</></><meta.tag.other.rtc.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rtc</></><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.rt.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></>Shamrock<meta.tag.inline.rt.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></><meta.tag.other.rtc.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rtc</></><punctuation.definition.tag.end.html>&gt</><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rtc</></> <meta.attribute.unrecognized.lang.html><entity.other.attribute-name.html>lang</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>fr<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.rt.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></>TrÃ¨fle<meta.tag.inline.rt.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></><meta.tag.other.rtc.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rtc</></><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.other.rb.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rb</></><punctuation.definition.tag.end.html>&gt</></>âœ¶<meta.tag.other.rb.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rb</></><punctuation.definition.tag.end.html>&gt</></><meta.tag.other.rtc.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rtc</></><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.rt.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></>Star<meta.tag.inline.rt.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></><meta.tag.other.rtc.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rtc</></><punctuation.definition.tag.end.html>&gt</><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rtc</></> <meta.attribute.unrecognized.lang.html><entity.other.attribute-name.html>lang</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>fr<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.rt.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></>Ã‰toile<meta.tag.inline.rt.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>rt</><punctuation.definition.tag.end.html>&gt</></><meta.tag.other.rtc.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>rtc</></><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.ruby.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ruby</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Non-word characters don't terminate tag names (T19663, T42670, T54022)",
		"wikitext": "<blockquote|>a</blockquote>\n\n<bâ†’> doesn't terminate </bâ†’>\n\n<bÃ¤> doesn't terminate </bÃ¤>\n\n<boo> doesn't terminate </boo>\n\n<s.foo> doesn't terminate </s.foo>\n\n<sub-ID#1>",
		"parsed": "<meta.tag.other.blockquote|.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>blockquote|</></><punctuation.definition.tag.end.html>&gt</></>a<meta.tag.structure.blockquote.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.other.bâ†’.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>bâ†’</></><punctuation.definition.tag.end.html>&gt</></> doesn't terminate <meta.tag.other.bâ†’.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>bâ†’</></><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.other.bÃ¤.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>bÃ¤</></><punctuation.definition.tag.end.html>&gt</></> doesn't terminate <meta.tag.other.bÃ¤.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>bÃ¤</></><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.other.boo.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>boo</></><punctuation.definition.tag.end.html>&gt</></> doesn't terminate <meta.tag.other.boo.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>boo</></><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.other.s.foo.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>s.foo</></><punctuation.definition.tag.end.html>&gt</></> doesn't terminate <meta.tag.other.s.foo.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>s.foo</></><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.other.sub-ID#1.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>sub-ID#1</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Isolated close tags should be treated as literal text (T54760)",
		"wikitext": "</b>\n\n<s.foo>s</s>",
		"parsed": "<meta.tag.inline.b.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.other.s.foo.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>s.foo</></><punctuation.definition.tag.end.html>&gt</></>s<meta.tag.inline.s.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>s</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Self-closed tag hooks",
		"wikitext": "<pre />\n<gallery />\n<indicator name=\"something\" />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</> <punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</> <punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>something<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Bare pipe character (T54363)",
		"wikitext": "|",
		"parsed": "|"
	},
	{
		"desc": "Bare pipe character from a template (T54363)",
		"wikitext": "{{pipe}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>pipe</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Implicit newline insertion/sol when expanding templates (T241150/T14974/T2529)",
		"wikitext": "{{1x|#foo}}{{1x|#foo}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>#foo<punctuation.definition.tag.template>}}{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>#foo<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "<nowiki> unordered list",
		"wikitext": "<nowiki>* This is not an unordered list item.</nowiki>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>* This is not an unordered list item.</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "<nowiki> spacing",
		"wikitext": "<nowiki>Lorem ipsum dolor\n\nsed abit.\n  sed nullum.\n\n:and a colon\n</nowiki>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>Lorem ipsum dolor\\n\\nsed abit.\\n  sed nullum.\\n\\n:and a colon\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Don't parse <nowiki><span class=\"error\"></nowiki> (T149622)",
		"wikitext": "<nowiki><span class=\"error\"></nowiki>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>&lt;span class=\"error\"&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "nowiki 3",
		"wikitext": ":There is not nowiki.\n:There is <nowiki>nowiki</nowiki>.\n\n#There is not nowiki.\n#There is <nowiki>nowiki</nowiki>.\n\n*There is not nowiki.\n*There is <nowiki>nowiki</nowiki>.",
		"parsed": "<punctuation.definition.list.begin.markdown>:</>There is not nowiki.\\n<punctuation.definition.list.begin.markdown>:</>There is <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>nowiki</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>.\\n\\n<punctuation.definition.list.begin.markdown>#</>There is not nowiki.\\n<punctuation.definition.list.begin.markdown>#</>There is <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>nowiki</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>.\\n\\n<punctuation.definition.list.begin.markdown>*</>There is not nowiki.\\n<punctuation.definition.list.begin.markdown>*</>There is <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>nowiki</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>."
	},
	{
		"desc": "Entities inside <nowiki>",
		"wikitext": "<nowiki>&lt;</nowiki>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext><constant.character.entity.named.lt.html><punctuation.definition.entity.html>&amp;</>lt<punctuation.definition.entity.html>;</></></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Entities inside template parameters",
		"wikitext": "{{1x|&ndash;}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><constant.character.entity.named.ndash.html><punctuation.definition.entity.html>&amp;</>ndash<punctuation.definition.entity.html>;</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Properly escape nowiki when combined with other wiki markup",
		"wikitext": "<nowiki>*</nowiki> <nowiki>&lt;/nowiki&gt;</nowiki> tag",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>*</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</> <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext><constant.character.entity.named.lt.html><punctuation.definition.entity.html>&amp;</>lt<punctuation.definition.entity.html>;</></>/nowiki<constant.character.entity.named.gt.html><punctuation.definition.entity.html>&amp;</>gt<punctuation.definition.entity.html>;</></></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</> tag"
	},
	{
		"desc": "T93824: Put escaped HTML tags inside nowiki",
		"wikitext": "<nowiki><h2>foo</h2></nowiki>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>&lt;h2&gtfoo&lt;/h2&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T71950: 1. Put nowiki as close to cause as possible, even with non-quote escapable chars",
		"wikitext": "This text: L'[[Foo]]\nThis text: L<nowiki>''</nowiki>[[Foo]]\nThis text: L<nowiki>'''</nowiki>[[Foo]]<nowiki>''</nowiki>",
		"parsed": "This text: L'<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]\\n</></>This text: L<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>''</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]\\n</></>This text: L<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>'''</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>''</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T71950: 2. Put nowiki as close to cause as possible, after ' :'",
		"wikitext": "This text : L<nowiki>''</nowiki>[[Foo]]",
		"parsed": "This text : L<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>''</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T71482: Use {{!}} instead of nowiki for single pipe in template argument",
		"wikitext": "{{1x|foo{{!}}bar}}\n{{1x|<nowiki>foo|bar |[[</nowiki>}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo<constant.language.variables.metadata>{{!}}</>bar<punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>foo|bar |[[</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "T53961: Output correct nowikis in template arguments",
		"wikitext": "{{1x|a [ b}}\n{{1x|<nowiki>a }} b</nowiki>}}\n{{1x|<nowiki>a [[ b</nowiki>}}\n{{1x|<nowiki>a | {{ ]]</nowiki>}}\n{{1x|a <nowiki>}</nowiki>}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>a [ b<punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>a }} b</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>a [[ b</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>a | {{ ]]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>a <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>}</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Cases where \"!!\" needs nowiki protection",
		"wikitext": "{|\n!<nowiki>this needs protection !! here</nowiki>\n|}\n\n{|\n!this does not need\nprotection !! here\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</><markup.style><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>this needs protection </></><keyword.operator>!!</><markup.style> here<meta.tag.other.nowiki.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>nowiki</></><punctuation.definition.tag.end.html>&gt\\n</></></></><keyword.operator>|}\\n\\n{|\\n</><meta.tag.block.th><keyword.operator>!</><markup.style>this does not need\\n</></>protection !! here\\n<keyword.operator>|}</></>"
	},
	{
		"desc": "Nowiki with newlines in list",
		"wikitext": ":<nowiki>test\n123</nowiki>",
		"parsed": "<punctuation.definition.list.begin.markdown>:</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>test\\n123</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Nowiki and french spacing",
		"wikitext": "<nowiki>test : 123</nowiki>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>test : 123</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T255007: French spacing in raw text elements",
		"wikitext": "<html>\n<script>test ; 123</script>\n<style>test : 123</style>\n</html>",
		"parsed": "<meta.tag.structure.html.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>html</><punctuation.definition.tag.end.html>&gt\\n</></><meta.embedded.block.html><meta.tag.metadata.script.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>script</><punctuation.definition.tag.end.html>&gt</></><source.js><variable.other.readwrite.js>test</> <punctuation.terminator.statement.js>;</> <constant.numeric.decimal.js>123</></><meta.tag.metadata.script.end.html><punctuation.definition.tag.begin.html><source.js-ignored-vscode>&lt;</>/</><entity.name.tag.html>script</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.metadata.style.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt</></><source.css><meta.selector.css>test : 123&lt;</>/<meta.selector.css><entity.name.tag.css>style</><keyword.operator.combinator.css>&gt\\n</>&lt;</>/<meta.selector.css><entity.name.tag.css>html</><keyword.operator.combinator.css>&gt</></></></>"
	},
	{
		"desc": "French spacing and spans",
		"wikitext": "[[Test]] : <span>123</span>\nÂ« Test Â»<span>123</span>",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Test</><punctuation.definition.tag.link.internal>]]</></> : <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>123<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n</></>Â« Test Â»<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>123<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "post-expand include size being exceeded",
		"wikitext": "{{3x_on_newline|1234567890}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>3x_on_newline</><keyword.operator>|</>1234567890<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "max template depth being reached",
		"wikitext": "{{1x with depth|too deep!}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x with depth</><keyword.operator>|</>too deep!<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "multiple templates that are redirects",
		"wikitext": "{{redirect to foo}}\n{{redirect to foo}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>redirect to foo</><punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>redirect to foo</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "T53086: Double newlines in blockquotes should be turned into paragraphs",
		"wikitext": "<blockquote>\nFoo\n\nBar\n</blockquote>",
		"parsed": "<meta.tag.structure.blockquote.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt\\n</></>Foo\\n\\nBar\\n<meta.tag.structure.blockquote.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T17491: <ins>/<del> in blockquote",
		"wikitext": "<blockquote>\nFoo <del>bar</del> <ins>baz</ins> quux\n</blockquote>",
		"parsed": "<meta.tag.structure.blockquote.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt\\n</></>Foo <meta.tag.inline.del.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>del</><punctuation.definition.tag.end.html>&gt</></>bar<meta.tag.inline.del.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>del</><punctuation.definition.tag.end.html>&gt</></> <meta.tag.inline.ins.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ins</><punctuation.definition.tag.end.html>&gt</></>baz<meta.tag.inline.ins.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ins</><punctuation.definition.tag.end.html>&gt</></> quux\\n<meta.tag.structure.blockquote.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T17491: <ins>/<del> in blockquote (2)",
		"wikitext": "<blockquote>Foo <del>bar</del> <ins>baz</ins> quux\n</blockquote>",
		"parsed": "<meta.tag.structure.blockquote.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></>Foo <meta.tag.inline.del.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>del</><punctuation.definition.tag.end.html>&gt</></>bar<meta.tag.inline.del.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>del</><punctuation.definition.tag.end.html>&gt</></> <meta.tag.inline.ins.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ins</><punctuation.definition.tag.end.html>&gt</></>baz<meta.tag.inline.ins.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ins</><punctuation.definition.tag.end.html>&gt</></> quux\\n<meta.tag.structure.blockquote.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Don't paragraph-wrap empty newlines between HTML list items",
		"wikitext": "<ol>\n<li>foo</li>\n\n\n\n<li>foo</li>\n</ol>",
		"parsed": "<meta.tag.structure.ol.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ol</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n\\n\\n\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.ol.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ol</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Templates: Strip leading and trailing whitespace from named-param values",
		"wikitext": "{{1x|1= a }}\n\n{{1x|1= {{1x|b}} }}\n\n{{1x| 1 =\n c }}\n\n{{1x| 1 =\n* d\n}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><entity.other.attribute-name.local-name>1</><keyword.operator.equal>=</> a <punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><entity.other.attribute-name.local-name>1</><keyword.operator.equal>=</> <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>b<punctuation.definition.tag.template>}}</> <punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><entity.other.attribute-name.local-name> 1 </><keyword.operator.equal>=\\n</> c <punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><entity.other.attribute-name.local-name> 1 </><keyword.operator.equal>=\\n</><punctuation.definition.list.begin.markdown>*</> d\\n<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Don't strip whitespace from positional-param values",
		"wikitext": "{{1x|a }}\n\n{{1x|{{1x|b}} }}\n\n{{1x| c \n}}\n\n{{1x| {{1x|d}}\n}}\n\n{{1x|\n e}}\n\n{{1x|\n*f}}\n\n{{1x|\n }}g",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>a <punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>b<punctuation.definition.tag.template>}}</> <punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</> c \\n<punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</> <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>d<punctuation.definition.tag.template>}}\\n}}\\n\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|\\n</> e<punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|\\n</><punctuation.definition.list.begin.markdown>*</>f<punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|\\n</> <punctuation.definition.tag.template>}}</>g"
	},
	{
		"desc": "Templates: Don't recognize targets split by newlines",
		"wikitext": "{{ech\no|foo}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>ech\\n</>o<keyword.operator>|</>foo<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Recognize targets when newlines and comments don't split the target",
		"wikitext": "{{  \n <!--X--> 1<!--X-->x<!--X-->  \n   <!--X-->   <!--X-->\n\n |foo}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>  \\n</> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>X<punctuation.definition.comment.html>--&gt</></> 1<comment.block.html><punctuation.definition.comment.html>&lt;!--</>X<punctuation.definition.comment.html>--&gt</></>x<comment.block.html><punctuation.definition.comment.html>&lt;!--</>X<punctuation.definition.comment.html>--&gt</></>  \\n   <comment.block.html><punctuation.definition.comment.html>&lt;!--</>X<punctuation.definition.comment.html>--&gt</></>   <comment.block.html><punctuation.definition.comment.html>&lt;!--</>X<punctuation.definition.comment.html>--&gt\\n\\n</></> <keyword.operator>|</>foo<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Target with an extension tag",
		"wikitext": "{{{{1x|1x}}<nowiki>hi</nowiki>|ho}}",
		"parsed": "{{<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>1x<punctuation.definition.tag.template>}}</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>hi</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>|ho}}"
	},
	{
		"desc": "Templates: Handle empty comment-and-ws-only lines correctly",
		"wikitext": "{{1x|foo\n<!--should be ignored-->\n <!--should be ignored as well-->\nbar}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</>should be ignored<punctuation.definition.comment.html>--&gt\\n</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>should be ignored as well<punctuation.definition.comment.html>--&gt\\n</></>bar<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Handle comments in the target",
		"wikitext": "{{1x\n<!-- should be ignored -->\n|foo}}\n\n{{1x\n<!-- should be ignored and spaces on next line should not trip us up (T147742) -->\n  |foo}}\n\n{{1x<!-- should be ignored -->\n|foo}}\n\n{{1x<!-- should be ignored -->|foo}}\n\n{{<!-- should be ignored -->1x|foo}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x\\n</><comment.block.html><punctuation.definition.comment.html>&lt;!--</> should be ignored <punctuation.definition.comment.html>--&gt\\n</></><keyword.operator>|</>foo<punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>1x\\n</><comment.block.html><punctuation.definition.comment.html>&lt;!--</> should be ignored and spaces on next line should not trip us up (T147742) <punctuation.definition.comment.html>--&gt\\n</></>  <keyword.operator>|</>foo<punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>1x</><comment.block.html><punctuation.definition.comment.html>&lt;!--</> should be ignored <punctuation.definition.comment.html>--&gt\\n</></><keyword.operator>|</>foo<punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>1x</><comment.block.html><punctuation.definition.comment.html>&lt;!--</> should be ignored <punctuation.definition.comment.html>--&gt</></><keyword.operator>|</>foo<punctuation.definition.tag.template>}}\\n\\n</>{{<comment.block.html><punctuation.definition.comment.html>&lt;!--</> should be ignored <punctuation.definition.comment.html>--&gt</></>1x|foo}}"
	},
	{
		"desc": "Templates: Handle comments in parameter names (T69657)",
		"wikitext": "{{1x|1\n<!-- should be ignored -->\n=foo}}\n\n{{1x|\n<!-- should be ignored -->\n1 = foo}}\n\n{{1x|1<!-- should be ignored -->=foo}}\n\n{{1x|<!-- should be ignored -->1=foo}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>1\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</> should be ignored <punctuation.definition.comment.html>--&gt\\n</></>=foo<punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|\\n</><comment.block.html><punctuation.definition.comment.html>&lt;!--</> should be ignored <punctuation.definition.comment.html>--&gt\\n</></>1 = foo<punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>1<comment.block.html><punctuation.definition.comment.html>&lt;!--</> should be ignored <punctuation.definition.comment.html>--&gt</></>=foo<punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><comment.block.html><punctuation.definition.comment.html>&lt;!--</> should be ignored <punctuation.definition.comment.html>--&gt</></>1=foo<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Other wikitext in parameter names (T69657)",
		"wikitext": "{{1x|''1''=foo}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><entity.other.attribute-name.local-name>''1''</><keyword.operator.equal>=</>foo<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: With colons",
		"wikitext": "{{With: Colon}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>With: Colon</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Parsoid parameter escaping test 1",
		"wikitext": "{{1x|[foo]|{{1x|[bar]}}}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>[foo]<keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>[bar]<punctuation.definition.tag.template>}}}}</>"
	},
	{
		"desc": "Parsoid: Pipes in external links in template parameter",
		"wikitext": "{{1x|[{{1x|http://example.com}} link]}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>[<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>http://example.com<punctuation.definition.tag.template>}}</> link]<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Parsoid: pipe in transclusion parameter",
		"wikitext": "{{1x|http://foo.com/a&#124;b}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>http://foo.com/a<constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#124;</>b<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Parsoid: Pipe in external link target and content in template parameter",
		"wikitext": "{{1x|[http://foo.com/a&#124;b a&#124;b]}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://foo.com/a&amp;#124;b</><string.other.link.external.title> a<constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#124;</>b</><punctuation.definition.tag.link.external>]</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Parsoid: Pipe in template with nested template in external link target in template parameter (seriously)",
		"wikitext": "{{1x|[{{fullurl:{{FULLPAGENAME}}|action=edit}} bar]}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>[<punctuation.definition.tag.function>{{</><constant.language.variables.query>fullurl</><keyword.operator.function>:</><constant.language.variables.metadata>{{FULLPAGENAME}}</><keyword.operator>|</>action=edit<punctuation.definition.tag.function>}}</> bar]<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Don't escape already nowiki-escaped text in template parameters",
		"wikitext": "{{1x|foo<nowiki>|</nowiki>bar}}\n{{1x|<nowiki>&lt;div&gt;</nowiki>}}\n{{1x|<nowiki></nowiki>}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>|</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>bar<punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext><constant.character.entity.named.lt.html><punctuation.definition.entity.html>&amp;</>lt<punctuation.definition.entity.html>;</></>div<constant.character.entity.named.gt.html><punctuation.definition.entity.html>&amp;</>gt<punctuation.definition.entity.html>;</></></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: '=' char in nested transclusions should not trigger nowiki escapes or conversion to named param",
		"wikitext": "{{1x|{{1x|1=bar}}}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><entity.other.attribute-name.local-name>1</><keyword.operator.equal>=</>bar<punctuation.definition.tag.template>}}}}</>"
	},
	{
		"desc": "Templates parameters with special tokenizing behavior dont get modified because of arg escaping",
		"wikitext": "{{1x|a : b}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>a : b<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Preserve blank parameter names",
		"wikitext": "{{1x|=foo}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><keyword.operator.equal>=</>foo<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Preserve blank parameter names in other positions",
		"wikitext": "{{blank_param|bar|=foo}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>blank_param</><keyword.operator>|</>bar<keyword.operator>|</><keyword.operator.equal>=</>foo<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Broken wikilinks (but not external links) prevent templates from closing",
		"wikitext": "[http://example.com x\n\n{{1x|[http://example.com x}}\n\n[[Foo\n\n{{1x|[[Foo}}",
		"parsed": "[http://example.com x\\n\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>[http://example.com x<punctuation.definition.tag.template>}}\\n\\n</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo\\n\\n</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><invalid.deprecated.ineffective>}}</></></>"
	},
	{
		"desc": "Wikilinks with embedded newlines are not broken",
		"wikitext": "{{1x|[[ Foo\nB\nC]]}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name> Foo\\n</>B\\nC<punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Broken templates",
		"wikitext": "{{1x|[[Foo|}}]]\n\n[[Foo|{{1x|]]}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</>}}<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.other.attribute-name>Foo</><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>]]<punctuation.definition.tag.template>}}</></>"
	},
	{
		"desc": "Template returning pipe used in wikilink target",
		"wikitext": "[[{{pipe page}}]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>pipe page</><punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T4702: Mismatched <i>, <b> and <a> tags are invalid",
		"wikitext": "''[http://example.com text'']\n[http://example.com '''text]'''\n''Something [http://example.com in italic'']\n''Something [http://example.com mixed''''', even bold]'''\n'''''Now [http://example.com both''''']",
		"parsed": "<markup.italic>''</><punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com</><string.other.link.external.title> text<markup.italic>''</></><punctuation.definition.tag.link.external>]\\n[</><entity.name.tag.url>http://example.com</><string.other.link.external.title> <markup.bold>'''</>text</><punctuation.definition.tag.link.external>]</><markup.bold>'''\\n</><markup.italic>''</>Something <punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com</><string.other.link.external.title> in italic<markup.italic>''</></><punctuation.definition.tag.link.external>]\\n</><markup.italic>''</>Something <punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com</><string.other.link.external.title> mixed<markup.bold.italic>'''''</>, even bold</><punctuation.definition.tag.link.external>]</><markup.bold>'''\\n</><markup.bold.italic>'''''</>Now <punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com</><string.other.link.external.title> both<markup.bold.italic>'''''</></><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "Serialize <a> tags with invalid link targets as plain text",
		"wikitext": "text\n<nowiki>*</nowiki>text\n<nowiki>[[foo]]</nowiki>\n<nowiki>*</nowiki>a <nowiki>[[foo]]</nowiki>",
		"parsed": "text\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>*</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>text\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>[[foo]]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>*</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>a <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>[[foo]]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "mw:ExtLink -vs- mw:WikiLink (T94723)",
		"wikitext": "[[Foo|Bar]]\n[[Foo|Bar]]\n[[:en:Foo|Bar]]\n[[:en:Foo|Bar]]\n\n[[:en:European_Robin|European Robin]]\n[[:en:European_Robin|European Robin]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</>Bar<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Foo</><keyword.operator>|</>Bar<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>:en:Foo</><keyword.operator>|</>Bar<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>:en:Foo</><keyword.operator>|</>Bar<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.other.attribute-name>:en:European_Robin</><keyword.operator>|</>European Robin<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>:en:European_Robin</><keyword.operator>|</>European Robin<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Break on | in element attribute in template",
		"wikitext": "{{1x|1=<div class=\"hi|ho\">ha</div>}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><entity.other.attribute-name.local-name>1</><keyword.operator.equal>=</><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>hi|ho<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>ha<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Break on | in element attribute name in template",
		"wikitext": "{{1x|<div cla|ss=\"hiho\">ha</div>}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.unrecognized.cla|ss.html><entity.other.attribute-name.html>cla|ss</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>hiho<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>ha<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Plain link, capitalized",
		"wikitext": "[[Main Page]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Plain link, uncapitalized",
		"wikitext": "[[main Page]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>main Page</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Piped link",
		"wikitext": "[[Main Page|The Main Page]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</>The Main Page<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Piped link with comment in link text",
		"wikitext": "[[Main Page|The Main<!--front--> Page]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</>The Main<comment.block.html><punctuation.definition.comment.html>&lt;!--</>front<punctuation.definition.comment.html>--&gt</></> Page<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Piped link with multiple pipe characters in link text",
		"wikitext": "[[Main Page||The|Main|Page|]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</>|The|Main|Page|<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Piped link with no link text",
		"wikitext": "[[Thomas Bek (bishop of St David's)|]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Thomas Bek (bishop of St David's)</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Piped link with empty link text",
		"wikitext": "[[Main Page|<nowiki/>]] - empty nowiki\n[[Main Page|&nbsp;]] - empty non breaking space",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</><punctuation.definition.tag.link.internal>]]</></> - empty nowiki\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</><constant.character.entity.named.nbsp.html><punctuation.definition.entity.html>&amp;</>nbsp<punctuation.definition.entity.html>;</></><punctuation.definition.tag.link.internal>]]</></> - empty non breaking space"
	},
	{
		"desc": "Piped link with empty link text - 2",
		"wikitext": "[[Main Page| ]] - empty space",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</> <punctuation.definition.tag.link.internal>]]</></> - empty space"
	},
	{
		"desc": "Broken link",
		"wikitext": "[[Zigzagzogzagzig]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Zigzagzogzagzig</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Broken link with fragment",
		"wikitext": "[[Zigzagzogzagzig#zug]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Zigzagzogzagzig#zug</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Special page link with fragment",
		"wikitext": "[[Special:Version#anchor]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Special:</><entity.other.attribute-name>Version#anchor</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Nonexistent special page link with fragment",
		"wikitext": "[[Special:ThisNameWillHopefullyNeverBeUsed#anchor]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Special:</><entity.other.attribute-name>ThisNameWillHopefullyNeverBeUsed#anchor</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Link with prefix",
		"wikitext": "xxx[[main Page]], xxx[[Main Page]], Xxx[[main Page]] XXX[[main Page]], XXX[[Main Page]]",
		"parsed": "xxx<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>main Page</><punctuation.definition.tag.link.internal>]]</></>, xxx<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</></>, Xxx<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>main Page</><punctuation.definition.tag.link.internal>]]</></> XXX<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>main Page</><punctuation.definition.tag.link.internal>]]</></>, XXX<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Link with suffix",
		"wikitext": "[[Main Page]]xxx, [[Main Page]]XXX, [[Main Page]]!!!",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</></>xxx, <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</></>XXX, <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</></>!!!"
	},
	{
		"desc": "T45661: Piped links with identical prefixes",
		"wikitext": "[[prefixed article|prefixed articles with spaces]]\n\n[[prefixed article|prefixed articlesaoeu]]\n\n[[Main Page|Main Page test]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>prefixed article</><keyword.operator>|</>prefixed articles with spaces<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.other.attribute-name>prefixed article</><keyword.operator>|</>prefixed articlesaoeu<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</>Main Page test<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Link with HTML entity in suffix / tail",
		"wikitext": "[[Main Page]]&quot;, [[Main Page]]&#97;",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</></><constant.character.entity.named.quot.html><punctuation.definition.entity.html>&amp;</>quot<punctuation.definition.entity.html>;</></>, <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</></><constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#97;</>"
	},
	{
		"desc": "Link with 3 brackets",
		"wikitext": "[[[Main Page]]]\nFoo [[[Main Page]]]",
		"parsed": "[<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</></>]\\nFoo [<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</></>]"
	},
	{
		"desc": "Link with 4 brackets",
		"wikitext": "[[[[Main Page]]]]",
		"parsed": "[[<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</></>]]"
	},
	{
		"desc": "Piped link with 3 brackets",
		"wikitext": "[[[main page|the main page]]]",
		"parsed": "[<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>main page</><keyword.operator>|</>the main page<punctuation.definition.tag.link.internal>]]</></>]"
	},
	{
		"desc": "Piped link with extlink-like text",
		"wikitext": "[[Main Page|[bar]]]\n[[Main Page|This is a [bar]]]\n[[Main Page|[bar]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</>[bar<punctuation.definition.tag.link.internal>]]</></>]\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</>This is a [bar<punctuation.definition.tag.link.internal>]]</></>]\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</>[bar<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Link with multiple pipes",
		"wikitext": "[[Main Page|The|Main|Page]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</>The|Main|Page<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Anchor containing a #. (T65430)",
		"wikitext": "[[Main Page#And#Link]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page#And#Link</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Link to namespaces",
		"wikitext": "[[Talk:Parser testing]], [[Meta:Disclaimers]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Talk:</><entity.other.attribute-name>Parser testing</><punctuation.definition.tag.link.internal>]]</></>, <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Meta:Disclaimers</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Link with space in namespace",
		"wikitext": "[[User talk:Foo bar]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>User talk:</><entity.other.attribute-name>Foo bar</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Namespace takes precedence over interwiki link (T53680)",
		"wikitext": "[[MemoryAlpha:AlphaTest]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>MemoryAlpha:AlphaTest</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Link to namespace preferred over interwiki with correct rel attribute",
		"wikitext": "[[MemoryAlpha:AlphaTest]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>MemoryAlpha:AlphaTest</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Piped link to namespace",
		"wikitext": "[[Meta:Disclaimers|The disclaimers]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Meta:Disclaimers</><keyword.operator>|</>The disclaimers<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Link containing }",
		"wikitext": "[[Usually caused by a typo (oops}]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Usually caused by a typo (oops</><invalid.deprecated.ineffective>}</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Link containing % (not as a hex sequence)",
		"wikitext": "[[7% Solution]]\n[[7% Solution|7%25 Solution]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>7% Solution</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>7% Solution</><keyword.operator>|</>7%25 Solution<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Link containing % as a single hex sequence interpreted to char",
		"wikitext": "[[7%25 Solution]]\n[[7%25 Solution|7%25 Solution]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>7%25 Solution</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>7%25 Solution</><keyword.operator>|</>7%25 Solution<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Link containing % as a double hex sequence interpreted to hex sequence",
		"wikitext": "[[7%2525 Solution]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>7%2525 Solution</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Link containing \"#<\" and \"#>\" % as a hex sequences- these are valid section anchors",
		"wikitext": "[[%23%3c]][[%23%3e]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>%23<invalid.deprecated.ineffective>%3c</></><punctuation.definition.tag.link.internal>]][[</><entity.other.attribute-name>%23<invalid.deprecated.ineffective>%3e</></><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Link containing \"#<\" and \"#>\" % as a hex sequences- these are valid section anchors (legacy)",
		"wikitext": "[[%23%3c]][[%23%3e]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>%23<invalid.deprecated.ineffective>%3c</></><punctuation.definition.tag.link.internal>]][[</><entity.other.attribute-name>%23<invalid.deprecated.ineffective>%3e</></><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Link containing \"<#\" and \">#\" as a hex sequences",
		"wikitext": "[[%3c%23]][[%3e%23]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name><invalid.deprecated.ineffective>%3c</>%23</><punctuation.definition.tag.link.internal>]][[</><entity.other.attribute-name><invalid.deprecated.ineffective>%3e</>%23</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Link containing an equals sign",
		"wikitext": "[[Special:BookSources/isbn=4-00-026157-6]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Special:</><entity.other.attribute-name>BookSources/isbn=4-00-026157-6</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Link containing an ampersand",
		"wikitext": "[[Foo & bar]]\n\n[[Foo &amp; bar]]\n\n[[Foo &amp;amp; bar]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo &amp; bar</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.other.attribute-name>Foo &amp;amp; bar</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.other.attribute-name>Foo &amp;amp;amp; bar</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Link containing a tilde",
		"wikitext": "[[Foo~bar]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo~bar</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Link containing double-single-quotes '' (T6598)",
		"wikitext": "[[Lista d''e paise d''o munno]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Lista d''e paise d''o munno</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Link containing double quotes and spaces",
		"wikitext": "[[Cool \"Gator\"]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Cool \"Gator\"</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Link containing double-single-quotes '' in text (T6598 check)",
		"wikitext": "Some [[Link|pretty ''italics'' and stuff]]!",
		"parsed": "Some <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Link</><keyword.operator>|</>pretty <markup.italic>''</>italics<markup.italic>''</> and stuff<punctuation.definition.tag.link.internal>]]</></>!"
	},
	{
		"desc": "Link containing double-single-quotes '' in text embedded in italics (T6598 check)",
		"wikitext": "''Some [[Link|pretty ''italics'' and stuff]]!''",
		"parsed": "<markup.italic>''</>Some <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Link</><keyword.operator>|</>pretty <markup.italic>''</>italics<markup.italic>''</> and stuff<punctuation.definition.tag.link.internal>]]</></>!<markup.italic>''</>"
	},
	{
		"desc": "Link with double quotes in title part (literal) and alternate part (interpreted)",
		"wikitext": "[[File:Denys_Savchenko_''Pentecoste''.jpg]]\n\n[[''Pentecoste'']]\n\n[[''Pentecoste''|Pentecoste]]\n\n[[''Pentecoste''|''Pentecoste'']]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Denys_Savchenko_''Pentecoste''.jpg</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.other.attribute-name>''Pentecoste''</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.other.attribute-name>''Pentecoste''</><keyword.operator>|</>Pentecoste<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.other.attribute-name>''Pentecoste''</><keyword.operator>|</><markup.italic>''</>Pentecoste<markup.italic>''</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Plain link to URL",
		"wikitext": "[[http://www.example.com]]",
		"parsed": "[<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.com</><punctuation.definition.tag.link.external>]</>]"
	},
	{
		"desc": "Plain link to URL with link text",
		"wikitext": "[[http://www.example.com Link text]]",
		"parsed": "[<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.com</><string.other.link.external.title> Link text</><punctuation.definition.tag.link.external>]</>]"
	},
	{
		"desc": "Plain link to URL containing special characters, with link text (see T213950).",
		"wikitext": "[[http://www.example.com/?q=%7Babc%7D Link text]]",
		"parsed": "[<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.com/?q=%7Babc%7D</><string.other.link.external.title> Link text</><punctuation.definition.tag.link.external>]</>]"
	},
	{
		"desc": "Plain link to protocol-relative URL",
		"wikitext": "[[//www.example.com]]",
		"parsed": "[<punctuation.definition.tag.link.external>[</><entity.name.tag.url>//www.example.com</><punctuation.definition.tag.link.external>]</>]"
	},
	{
		"desc": "Plain link to protocol-relative URL with link text",
		"wikitext": "[[//www.example.com Link text]]",
		"parsed": "[<punctuation.definition.tag.link.external>[</><entity.name.tag.url>//www.example.com</><string.other.link.external.title> Link text</><punctuation.definition.tag.link.external>]</>]"
	},
	{
		"desc": "Plain link to page with question mark in title",
		"wikitext": "[[A?b]]\n\n[[A?b|Baz]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>A?b</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.other.attribute-name>A?b</><keyword.operator>|</>Baz<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Piped link to URL",
		"wikitext": "Piped link to URL: [[http://www.example.com|an example URL]]",
		"parsed": "Piped link to URL: [<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.com|an</><string.other.link.external.title> example URL</><punctuation.definition.tag.link.external>]</>]"
	},
	{
		"desc": "Nested wikilink syntax in wikilink syntax that parses as wikilink in extlink",
		"wikitext": "[[http://example.com|[[Example]]]]",
		"parsed": "[<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com|</><string.other.link.external.title><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Example</></></><punctuation.definition.tag.link.external>]</>]]]"
	},
	{
		"desc": "Plain link in template argument",
		"wikitext": "{{1x|[http://www.example.com |123]}}\n\n{{1x|[[http://www.example.com |123]]}}\n\n{{1x|[[http://www.example.com |123]}}\n\n{{1x|[http://www.example.com |123]]}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.com</><string.other.link.external.title> |123</><punctuation.definition.tag.link.external>]</><punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>[<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.com</><string.other.link.external.title> |123</><punctuation.definition.tag.link.external>]</>]<punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>[<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.com</><string.other.link.external.title> |123</><punctuation.definition.tag.link.external>]</><punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.com</><string.other.link.external.title> |123</><punctuation.definition.tag.link.external>]</>]<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "T2002: [[page|http://url/]] should link to page, not http://url/",
		"wikitext": "[[Main Page|http://url/]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</>http://url/<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T2337: Escaped self-links should be bold",
		"wikitext": "[[Bu&#103;462]] [[Bug462]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Bu&amp;#103;462</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Bug462</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Self-link to section should not be bold",
		"wikitext": "[[Main Page#section]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page#section</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Self-link hash fragment should be escaped",
		"wikitext": "[[Main Page#section with spaces]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page#section with spaces</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Self-link to numeric title",
		"wikitext": "[[0]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>0</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Link to numeric-equivalent title",
		"wikitext": "[[00]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>00</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "<nowiki> inside a link",
		"wikitext": "[[Main<nowiki> Page</nowiki>]] [[Main Page|the main page <nowiki>[it's not very good]</nowiki>]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext> Page</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</>the main page <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>[it's not very good]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "<pre> inside a link",
		"wikitext": "[[Main<pre> Page</pre>]] [[Main Page|the main page <pre>[it's not very good]</pre>]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext> Page</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</>the main page <punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>[it's not very good]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Non-breaking spaces in title",
		"wikitext": "[[&nbsp; Main &nbsp; Page &nbsp;]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>&amp;nbsp; Main &amp;nbsp; Page &amp;nbsp;</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Multiple spaces in titles should normalize to a single underscore",
		"wikitext": "[[Foo bar baz|x]]\n[[Foo  bar baz|x]]\n[[Foo  bar   baz|x]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo bar baz</><keyword.operator>|</>x<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Foo  bar baz</><keyword.operator>|</>x<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Foo  bar   baz</><keyword.operator>|</>x<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Internal link with en linktrail: no apostrophes (T29473)",
		"wikitext": "[[Something]]'nice",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Something</><punctuation.definition.tag.link.internal>]]</></>'nice"
	},
	{
		"desc": "Link with multiple \":\" in a subpage-supporting namespace (T65636)",
		"wikitext": "[[User:Foo/Test/63636:Bar|Test]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>User:</><entity.other.attribute-name>Foo/Test/63636:Bar</><keyword.operator>|</>Test<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Handle title parsing for subpages",
		"wikitext": "123",
		"parsed": "123"
	},
	{
		"desc": "Link to a subpage from a namespace other than main",
		"wikitext": "[[/123]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>/123</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Ensure that transclusion titles are not url-decoded",
		"wikitext": "{{Bar%C3%A9}} {{/Bar%C3%A9}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Bar<invalid.deprecated.ineffective>%C3%A9</></><punctuation.definition.tag.template>}}</> <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>/Bar<invalid.deprecated.ineffective>%C3%A9</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Purely hash wikilink",
		"wikitext": "[[#a|b]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#a</><keyword.operator>|</>b<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Serialization of purely hash wikilink",
		"wikitext": "[[#a|<nowiki>[[</nowiki>]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#a</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>[[</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "1. Interaction of linktrail and template encapsulation",
		"wikitext": "{{1x|[[Foo]]}}l\n\n{{1x|[[Foo]]l}}\n\n{{1x|[[Foo]]l}}s\n\n{{1x|[[Foo]]<span>ls</span>}}\n\n[[{{1x|Foo}}]]l",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.template>}}</>l\\n\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></>l<punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></>l<punctuation.definition.tag.template>}}</>s\\n\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>ls<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}\\n\\n</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>Foo<punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]</></>l"
	},
	{
		"desc": "2. Interaction of linktrail and template encapsulation",
		"wikitext": "{{1x|Some [[Fool]]}}s",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>Some <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Fool</><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.template>}}</>s"
	},
	{
		"desc": "3. Interaction of linktrail and template encapsulation",
		"wikitext": "{{1x|Some [[Fool]]s are '''bold and foolish'''}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>Some <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Fool</><punctuation.definition.tag.link.internal>]]</></>s are <markup.bold>'''</>bold and foolish<markup.bold>'''</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Parsoid link trail escaping",
		"wikitext": "[[apple]]<nowiki/>s",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>apple</><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>s"
	},
	{
		"desc": "Parsoid link bracket escaping",
		"wikitext": "[[Test]]\n\n[<nowiki/>[[Test]]]\n\n[[[[Test]]]]\n\n[[[<nowiki/>[[Test]]]]]\n\n[[[[[[Test]]]]]]\n\n[[[[[<nowiki/>[[Test]]]]]]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Test</><punctuation.definition.tag.link.internal>]]\\n\\n</></>[<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Test</><punctuation.definition.tag.link.internal>]]</></>]\\n\\n[[<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Test</><punctuation.definition.tag.link.internal>]]</></>]]\\n\\n[<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</><invalid.deprecated.ineffective>[[</>Test<punctuation.definition.tag.link.internal>]]</></>]]]\\n\\n[[[[<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Test</><punctuation.definition.tag.link.internal>]]</></>]]]]\\n\\n[[[<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</><invalid.deprecated.ineffective>[[</>Test<punctuation.definition.tag.link.internal>]]</></>]]]]]"
	},
	{
		"desc": "Parsoid-centric test: Whitespace in ext- and wiki-links should be preserved",
		"wikitext": "[[Foo|  bar]]\n\n[[Foo|  ''bar'']]\n\n[http://wp.org   foo]\n\n[http://wp.org   ''foo'']",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</>  bar<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.other.attribute-name>Foo</><keyword.operator>|</>  <markup.italic>''</>bar<markup.italic>''</><punctuation.definition.tag.link.internal>]]\\n\\n</></><punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://wp.org</><string.other.link.external.title>   foo</><punctuation.definition.tag.link.external>]\\n\\n[</><entity.name.tag.url>http://wp.org</><string.other.link.external.title>   <markup.italic>''</>foo<markup.italic>''</></><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "Parsoid: Scoped parsing should handle mixed transclusions and plain text",
		"wikitext": "[[Foo|{{1x|a}} b {{1x|c}}]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>a<punctuation.definition.tag.template>}}</> b <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>c<punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Link with angle bracket after anchor",
		"wikitext": "[[Foo#<bar>]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo#&lt;bar&gt</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Link with angle bracket after anchor (legacy)",
		"wikitext": "[[Foo#<bar>]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo#&lt;bar&gt</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Wikilink in wikilink",
		"wikitext": "[[Hi|[[Ho]]]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Hi</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Ho</><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid T55221: Wikilinks should be properly entity-escaped",
		"wikitext": "He&amp;nbsp;llo [[Foo|He&amp;nbsp;llo]]\n\nHe&amp;nbsp;llo He&amp;nbsp;llo",
		"parsed": "He<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>nbsp;llo <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</>He<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>nbsp;llo<punctuation.definition.tag.link.internal>]]\\n\\n</></>He<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>nbsp;llo He<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>nbsp;llo"
	},
	{
		"desc": "Wikilinks with : should roundtrip correctly, with and without redlinks",
		"wikitext": "[[16:30]]\n[[18:30]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>16:30</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>18:30</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid: handle constructor well",
		"wikitext": "[[constructor]]\n\n[[constructor:foo]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>constructor</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.other.attribute-name>constructor:foo</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Template parameter named \"constructor\"",
		"wikitext": "{{1x|  constructor =  |hi}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><entity.other.attribute-name.local-name>  constructor </><keyword.operator.equal>=</>  <keyword.operator>|</>hi<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "<br> to <br />",
		"wikitext": "1<br>2<br />3",
		"parsed": "1<meta.tag.inline.br.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>br</><punctuation.definition.tag.end.html>&gt</></>2<meta.tag.inline.br.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>br</> <punctuation.definition.tag.end.html>/&gt</></>3"
	},
	{
		"desc": "Broken br tag sanitization",
		"wikitext": "</br>",
		"parsed": "<meta.tag.other.br.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>br</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Parsoid: Broken br tag recognition",
		"wikitext": "</br>\n\n<br/ >",
		"parsed": "<meta.tag.other.br.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>br</></><punctuation.definition.tag.end.html>&gt\\n\\n</><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>br</></><invalid.illegal.character-not-allowed-here.html>/</> <punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Incorrecly removing closing slashes from correctly formed XHTML",
		"wikitext": "<br style=\"clear:both;\" />",
		"parsed": "<meta.tag.inline.br.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>br</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>clear:both;</><punctuation.definition.string.end.html><source.css>\"</></></></></> <punctuation.definition.tag.end.html>/&gt</></>"
	},
	{
		"desc": "Failing to transform badly formed HTML into correct XHTML",
		"wikitext": "<br style=\"clear: left;\">\n<br style=\"clear: right;\">\n<br style=\"clear: both;\">",
		"parsed": "<meta.tag.inline.br.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>br</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>clear: left;</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt\\n</><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>br</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>clear: right;</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt\\n</><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>br</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>clear: both;</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Handling html with a div self-closing tag",
		"wikitext": "<div title />\n<div title/>\n<div title/ >\n<div title=bar />\n<div title=bar/>\n<div title=bar/ >",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.title.html><entity.other.attribute-name.html>title</></> <invalid.illegal.character-not-allowed-here.html>/</><punctuation.definition.tag.end.html>&gt\\n</><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.title.html><entity.other.attribute-name.html>title</></><invalid.illegal.character-not-allowed-here.html>/</><punctuation.definition.tag.end.html>&gt\\n</><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.title.html><entity.other.attribute-name.html>title</></><invalid.illegal.character-not-allowed-here.html>/</> <punctuation.definition.tag.end.html>&gt\\n</><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.unquoted.html>bar</></> <invalid.illegal.character-not-allowed-here.html>/</><punctuation.definition.tag.end.html>&gt\\n</><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.unquoted.html>bar</></><invalid.illegal.character-not-allowed-here.html>/</><punctuation.definition.tag.end.html>&gt\\n</><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.unquoted.html>bar/</></> <punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Elements with solidus in various attribute positions",
		"wikitext": "<div cla/ss=\"123\">ha</div>\n\n<div / class=\"123\">ha</div>\n\n<div class= / \"123\">ha</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.unrecognized.cla.html><entity.other.attribute-name.html>cla</></><invalid.illegal.character-not-allowed-here.html>/ss=\"123\"</><punctuation.definition.tag.end.html>&gt</></>ha<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <invalid.illegal.character-not-allowed-here.html>/</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>123<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>ha<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</> <string.unquoted.html>/</></> <invalid.illegal.character-not-allowed-here.html>\"123\"</><punctuation.definition.tag.end.html>&gt</></>ha<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Handling html with a br self-closing tag",
		"wikitext": "<br title />\n<br title/>\n<br title/ >\n<br title=bar />\n<br title=bar/>\n<br title=bar/ >",
		"parsed": "<meta.tag.inline.br.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>br</> <meta.attribute.title.html><entity.other.attribute-name.html>title</></> <punctuation.definition.tag.end.html>/&gt\\n</><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>br</> <meta.attribute.title.html><entity.other.attribute-name.html>title</></><punctuation.definition.tag.end.html>/&gt\\n</><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>br</> <meta.attribute.title.html><entity.other.attribute-name.html>title</></><invalid.illegal.character-not-allowed-here.html>/</> <punctuation.definition.tag.end.html>&gt\\n</><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>br</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.unquoted.html>bar</></> <punctuation.definition.tag.end.html>/&gt\\n</><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>br</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.unquoted.html>bar</></><punctuation.definition.tag.end.html>/&gt\\n</><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>br</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.unquoted.html>bar/</></> <punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Quoted attributes without spaces",
		"wikitext": "<div class=\"foo\"style=\"color:red\">red</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></><meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>color:red</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>red<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Horizontal ruler (should it add that extra space?)",
		"wikitext": "<hr>\n<hr >\nfoo <hr\n> bar",
		"parsed": "<meta.tag.structure.hr.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>hr</><punctuation.definition.tag.end.html>&gt\\n</><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>hr</> <punctuation.definition.tag.end.html>&gt\\n</></>foo <meta.tag.structure.hr.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>hr\\n</><punctuation.definition.tag.end.html>&gt</></> bar"
	},
	{
		"desc": "Horizontal ruler -- 4+ dashes render hr",
		"wikitext": "----",
		"parsed": "<markup.changed>----</>"
	},
	{
		"desc": "Horizontal ruler -- eats additional dashes on the same line",
		"wikitext": "---------",
		"parsed": "<markup.changed>---------</>"
	},
	{
		"desc": "Horizontal ruler -- does not collapse dashes on consecutive lines",
		"wikitext": "----\n----",
		"parsed": "<markup.changed>----\\n----</>"
	},
	{
		"desc": "Horizontal ruler -- <4 dashes render as plain text",
		"wikitext": "---",
		"parsed": "---"
	},
	{
		"desc": "Horizontal ruler -- Supports content following dashes on same line",
		"wikitext": "---- Foo",
		"parsed": "<markup.changed>----</> Foo"
	},
	{
		"desc": "Common list",
		"wikitext": "*Common list\n*item 2\n*item 3",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>Common list\\n<punctuation.definition.list.begin.markdown>*</>item 2\\n<punctuation.definition.list.begin.markdown>*</>item 3"
	},
	{
		"desc": "Numbered list",
		"wikitext": "#Numbered list\n#item 2\n#item 3",
		"parsed": "<punctuation.definition.list.begin.markdown>#</>Numbered list\\n<punctuation.definition.list.begin.markdown>#</>item 2\\n<punctuation.definition.list.begin.markdown>#</>item 3"
	},
	{
		"desc": "Mixed list",
		"wikitext": "*Mixed list\n*#with numbers\n**and bullets\n*#and numbers\n*bullets again\n**bullet level 2\n***bullet level 3\n***#Number on level 4\n**bullet level 2\n**#Number on level 3\n**#Number on level 3\n*#number level 2\n*Level 1\n***Level 3\n#**Level 3, but ordered",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>Mixed list\\n<punctuation.definition.list.begin.markdown>*#</>with numbers\\n<punctuation.definition.list.begin.markdown>**</>and bullets\\n<punctuation.definition.list.begin.markdown>*#</>and numbers\\n<punctuation.definition.list.begin.markdown>*</>bullets again\\n<punctuation.definition.list.begin.markdown>**</>bullet level 2\\n<punctuation.definition.list.begin.markdown>***</>bullet level 3\\n<punctuation.definition.list.begin.markdown>***#</>Number on level 4\\n<punctuation.definition.list.begin.markdown>**</>bullet level 2\\n<punctuation.definition.list.begin.markdown>**#</>Number on level 3\\n<punctuation.definition.list.begin.markdown>**#</>Number on level 3\\n<punctuation.definition.list.begin.markdown>*#</>number level 2\\n<punctuation.definition.list.begin.markdown>*</>Level 1\\n<punctuation.definition.list.begin.markdown>***</>Level 3\\n<punctuation.definition.list.begin.markdown>#**</>Level 3, but ordered"
	},
	{
		"desc": "1. Nested mixed wikitext and html list",
		"wikitext": "*hi\n*<ul><li>ho</li></ul>\n*hi\n**ho",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>hi\\n<punctuation.definition.list.begin.markdown>*</><meta.tag.structure.ul.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>ho<meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.ul.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.list.begin.markdown>*</>hi\\n<punctuation.definition.list.begin.markdown>**</>ho"
	},
	{
		"desc": "2. Nested mixed wikitext and html list (incompatible)",
		"wikitext": ";hi\n:{{1x|<li>ho</li>}}",
		"parsed": "<punctuation.definition.list.begin.markdown>;</>hi\\n<punctuation.definition.list.begin.markdown>:</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>ho<meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Nested lists 1",
		"wikitext": "*foo\n**bar",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>foo\\n<punctuation.definition.list.begin.markdown>**</>bar"
	},
	{
		"desc": "Nested lists 2",
		"wikitext": "**foo\n*bar",
		"parsed": "<punctuation.definition.list.begin.markdown>**</>foo\\n<punctuation.definition.list.begin.markdown>*</>bar"
	},
	{
		"desc": "Nested lists 3 (first element empty)",
		"wikitext": "*\n**bar",
		"parsed": "<punctuation.definition.list.begin.markdown>*\\n**</>bar"
	},
	{
		"desc": "Nested lists 4 (first element empty)",
		"wikitext": "**\n*bar",
		"parsed": "<punctuation.definition.list.begin.markdown>**\\n*</>bar"
	},
	{
		"desc": "Nested lists 5 (both elements empty)",
		"wikitext": "**\n*",
		"parsed": "<punctuation.definition.list.begin.markdown>**\\n*</>"
	},
	{
		"desc": "Nested lists 6 (both elements empty)",
		"wikitext": "*\n**",
		"parsed": "<punctuation.definition.list.begin.markdown>*\\n**</>"
	},
	{
		"desc": "Nested lists 7 (skip initial nesting levels)",
		"wikitext": "***foo",
		"parsed": "<punctuation.definition.list.begin.markdown>***</>foo"
	},
	{
		"desc": "Nested lists 8 (multiple nesting transitions)",
		"wikitext": "*foo\n***bar\n**baz\n*boo",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>foo\\n<punctuation.definition.list.begin.markdown>***</>bar\\n<punctuation.definition.list.begin.markdown>**</>baz\\n<punctuation.definition.list.begin.markdown>*</>boo"
	},
	{
		"desc": "Nested lists 10 (list and span siblings: wt2wt regression)",
		"wikitext": "*a <span>x</span>\n**b <span>y</span>",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>a <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>x<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.list.begin.markdown>**</>b <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>y<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Nested lists 11 (T262409: trailing whitespace & selser)",
		"wikitext": "**a\n***b",
		"parsed": "<punctuation.definition.list.begin.markdown>**</>a\\n<punctuation.definition.list.begin.markdown>***</>b"
	},
	{
		"desc": "1. Lists and block-element interaction",
		"wikitext": "*<div>a\n*b\n</div>à²•",
		"parsed": "<punctuation.definition.list.begin.markdown>*</><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>a\\n<punctuation.definition.list.begin.markdown>*</>b\\n<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>à²•"
	},
	{
		"desc": "2. Lists and block-element interaction",
		"wikitext": "*{{1x|<div>a\n*b\n}}</div>à²•",
		"parsed": "<punctuation.definition.list.begin.markdown>*</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>a\\n<punctuation.definition.list.begin.markdown>*</>b\\n<punctuation.definition.tag.template>}}</><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>à²•"
	},
	{
		"desc": "1. Lists with start-of-line-transparent tokens before bullets: Comments",
		"wikitext": "*foo\n*<!--cmt-->bar\n<!--cmt-->*baz",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>foo\\n<punctuation.definition.list.begin.markdown>*</><comment.block.html><punctuation.definition.comment.html>&lt;!--</>cmt<punctuation.definition.comment.html>--&gt</></>bar\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</>cmt<punctuation.definition.comment.html>--&gt</></>*baz"
	},
	{
		"desc": "2. Lists with start-of-line-transparent tokens before bullets: Template close",
		"wikitext": "*foo {{1x|bar\n}}*baz",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>foo <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>bar\\n<punctuation.definition.tag.template>}}</>*baz"
	},
	{
		"desc": "List items are not parsed correctly following a <pre> block (T2785)",
		"wikitext": "*<pre>foo</pre>\n*<pre>bar</pre>\n*zar",
		"parsed": "<punctuation.definition.list.begin.markdown>*</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.list.begin.markdown>*</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>bar</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.list.begin.markdown>*</>zar"
	},
	{
		"desc": "List items from template",
		"wikitext": "{{inner list}}\n*item 2\n\n*item 0\n{{inner list}}\n*item 2\n\n*item 0\n*notSOL{{inner list}}\n*item 2",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>inner list</><punctuation.definition.tag.template>}}\\n</><punctuation.definition.list.begin.markdown>*</>item 2\\n\\n<punctuation.definition.list.begin.markdown>*</>item 0\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>inner list</><punctuation.definition.tag.template>}}\\n</><punctuation.definition.list.begin.markdown>*</>item 2\\n\\n<punctuation.definition.list.begin.markdown>*</>item 0\\n<punctuation.definition.list.begin.markdown>*</>notSOL<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>inner list</><punctuation.definition.tag.template>}}\\n</><punctuation.definition.list.begin.markdown>*</>item 2"
	},
	{
		"desc": "List interrupted by empty line or heading",
		"wikitext": "*foo\n\n**bar\n==A heading==\n*Another list item",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>foo\\n\\n<punctuation.definition.list.begin.markdown>**</>bar\\n<markup.heading>==<string.quoted.other.heading>A heading</>==\\n</><punctuation.definition.list.begin.markdown>*</>Another list item"
	},
	{
		"desc": "Multiple list tags generated by templates",
		"wikitext": "{{1x|<li>}}a\n{{1x|<li>}}b\n{{1x|<li>}}c",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</>a\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</>b\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</>c"
	},
	{
		"desc": "Multiple newlines in between HTML list items don't induce paragraph wrapping",
		"wikitext": "<ul>\n<li>hi</li>\n\n\n\n\n<li>ho</li>\n</ul>\n\n<dl>\n<dt>hi</dt>\n<dd>ho<div>123</div>\n</dd>\n\n\n</dl>",
		"parsed": "<meta.tag.structure.ul.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>hi<meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n\\n\\n\\n\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>ho<meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.ul.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.structure.dl.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>dl</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.dt.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>dt</><punctuation.definition.tag.end.html>&gt</></>hi<meta.tag.structure.dt.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>dt</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.dd.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>dd</><punctuation.definition.tag.end.html>&gt</></>ho<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>123<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.dd.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>dd</><punctuation.definition.tag.end.html>&gt\\n\\n\\n</></><meta.tag.structure.dl.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>dl</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Single-comment whitespace lines dont break lists, and neither do multi-comment whitespace lines",
		"wikitext": "*a\n<!--This line will NOT split the list-->\n*b\n <!--This line will NOT split the list either-->\n*c\n <!--foo--> <!----> <!--This line NOT split the list either--> \n*d",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>a\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</>This line will NOT split the list<punctuation.definition.comment.html>--&gt\\n</></><punctuation.definition.list.begin.markdown>*</>b\\n <comment.block.html><punctuation.definition.comment.html>&lt;!--</>This line will NOT split the list either<punctuation.definition.comment.html>--&gt\\n</></><punctuation.definition.list.begin.markdown>*</>c\\n <comment.block.html><punctuation.definition.comment.html>&lt;!--</>foo<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!----&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>This line NOT split the list either<punctuation.definition.comment.html>--&gt</></> \\n<punctuation.definition.list.begin.markdown>*</>d"
	},
	{
		"desc": "Replacing whitespace with tabs still doesn't break the list (gerrit 78327)",
		"wikitext": "*a\n<!--This line will NOT split the list-->\t\n*b\n\t<!--This line will NOT split the list either--> \t\n*c\n\t<!--foo--> <!---->\t<!--This line NOT split the list\n        either-->\t \n*d",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>a\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</>This line will NOT split the list<punctuation.definition.comment.html>--&gt</></>\t\\n<punctuation.definition.list.begin.markdown>*</>b\\n\t<comment.block.html><punctuation.definition.comment.html>&lt;!--</>This line will NOT split the list either<punctuation.definition.comment.html>--&gt</></> \t\\n<punctuation.definition.list.begin.markdown>*</>c\\n\t<comment.block.html><punctuation.definition.comment.html>&lt;!--</>foo<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!----&gt</></>\t<comment.block.html><punctuation.definition.comment.html>&lt;!--</>This line NOT split the list\\n        either<punctuation.definition.comment.html>--&gt</></>\t \\n<punctuation.definition.list.begin.markdown>*</>d"
	},
	{
		"desc": "Test the li-hack (a hack from Tidy days, but doesn't work as advertised with Remex)",
		"wikitext": "*foo\n*<li>li-hack\n**bar1\n*{{1x|<li>templated li-hack}}\n**bar2\n*<!--foo--><li> unsupported li-hack with preceding comments\n\n<ul>\n<li><li>not a li-hack\n</li>\n</ul>",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>foo\\n<punctuation.definition.list.begin.markdown>*</><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>li-hack\\n<punctuation.definition.list.begin.markdown>**</>bar1\\n<punctuation.definition.list.begin.markdown>*</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>templated li-hack<punctuation.definition.tag.template>}}\\n</><punctuation.definition.list.begin.markdown>**</>bar2\\n<punctuation.definition.list.begin.markdown>*</><comment.block.html><punctuation.definition.comment.html>&lt;!--</>foo<punctuation.definition.comment.html>--&gt</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></> unsupported li-hack with preceding comments\\n\\n<meta.tag.structure.ul.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>not a li-hack\\n<meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.ul.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Parsoid: Make sure nested lists are serialized on their own line even if HTML contains no newlines",
		"wikitext": "#foo\n##bar\n\n*foo\n**bar\n\n:foo\n::bar",
		"parsed": "<punctuation.definition.list.begin.markdown>#</>foo\\n<punctuation.definition.list.begin.markdown>##</>bar\\n\\n<punctuation.definition.list.begin.markdown>*</>foo\\n<punctuation.definition.list.begin.markdown>**</>bar\\n\\n<punctuation.definition.list.begin.markdown>:</>foo\\n<punctuation.definition.list.begin.markdown>::</>bar"
	},
	{
		"desc": "Parsoid: Test of whitespace serialization with Templated bullets",
		"wikitext": "* {{bullet}}",
		"parsed": "<punctuation.definition.list.begin.markdown>*</> <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>bullet</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Unbalanced closing block tags break a list",
		"wikitext": "<div>\n*a</div><div>\n*b</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.list.begin.markdown>*</>a<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.list.begin.markdown>*</>b<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Unbalanced closing wikitext block tags break a list",
		"wikitext": "<p>\n*a</p><p>\n*b</p>",
		"parsed": "<meta.tag.structure.p.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.list.begin.markdown>*</>a<meta.tag.structure.p.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.p.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.list.begin.markdown>*</>b<meta.tag.structure.p.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Unbalanced closing non-block tags don't break a list",
		"wikitext": "<span>\n*a</span><span>\n*b</span>",
		"parsed": "<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.list.begin.markdown>*</>a<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.list.begin.markdown>*</>b<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Unclosed formatting tags that straddle lists are closed and reopened",
		"wikitext": "#<s> a\n#b </s>",
		"parsed": "<punctuation.definition.list.begin.markdown>#</><meta.tag.inline.s.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>s</><punctuation.definition.tag.end.html>&gt</></> a\\n<punctuation.definition.list.begin.markdown>#</>b <meta.tag.inline.s.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>s</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "1. List embedded in a formatting tag",
		"wikitext": "<small>\n*foo\n</small>",
		"parsed": "<meta.tag.inline.small.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.list.begin.markdown>*</>foo\\n<meta.tag.inline.small.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "2. List embedded in a formatting tag in a misnested way",
		"wikitext": "<small>\n*a\n*b</small>",
		"parsed": "<meta.tag.inline.small.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.list.begin.markdown>*</>a\\n<punctuation.definition.list.begin.markdown>*</>b<meta.tag.inline.small.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "3. List embedded in a formatting tag in a misnested way",
		"wikitext": "<small>\n\n** 123</small>",
		"parsed": "<meta.tag.inline.small.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt\\n\\n</></><punctuation.definition.list.begin.markdown>**</> 123<meta.tag.inline.small.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Parsoid: unknown parser function (T314524)",
		"wikitext": "{{#tag:b|This is a known parser function}}\n\nNow show the unknown parser functions for comparison.\n\n{{#foo}}\n\n{{#foo:bar|bat}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#tag</><keyword.operator.function>:</>b<keyword.operator>|</>This is a known parser function<punctuation.definition.tag.function>}}\\n\\n</>Now show the unknown parser functions for comparison.\\n\\n{{#foo}}\\n\\n<punctuation.definition.tag.function>{{</><constant.language.variables.query>#foo</><keyword.operator.function>:</>bar<keyword.operator>|</>bat<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Parsoid: Page property magic word with magic word contents",
		"wikitext": "{{DISPLAYTITLE:''{{PAGENAME}}''}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>DISPLAYTITLE</><keyword.operator.function>:</><markup.italic>''</><constant.language.variables.metadata>{{PAGENAME}}</><markup.italic>''</><punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Parsoid: Template-generated DISPLAYTITLE",
		"wikitext": "{{{{1x|DISPLAYTITLE}}:Foo}}",
		"parsed": "{{<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>DISPLAYTITLE<punctuation.definition.tag.template>}}</>:Foo}}"
	},
	{
		"desc": "Parsoid html2wt b/c check: Cached Parsoid HTML for DISPLAYTITLE should be handled properly",
		"wikitext": "{{DISPLAYTITLE:foo}}\n{{DISPLAYTITLE:''{{PAGENAME}}''}}\n{{{{1x|DISPLAYTITLE}}:Foo}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>DISPLAYTITLE</><keyword.operator.function>:</>foo<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>DISPLAYTITLE</><keyword.operator.function>:</><markup.italic>''</><constant.language.variables.metadata>{{PAGENAME}}</><markup.italic>''</><punctuation.definition.tag.function>}}\\n</>{{<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>DISPLAYTITLE<punctuation.definition.tag.template>}}</>:Foo}}"
	},
	{
		"desc": "Namespace 1 {{ns:1}}",
		"wikitext": "{{ns:1}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>ns</><keyword.operator.function>:</>1<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Namespace 1 {{ns:01}}",
		"wikitext": "{{ns:01}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>ns</><keyword.operator.function>:</>01<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Namespace 0 {{ns:0}} (T6783)",
		"wikitext": "{{ns:0}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>ns</><keyword.operator.function>:</>0<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Namespace 0 {{ns:00}} (T6783)",
		"wikitext": "{{ns:00}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>ns</><keyword.operator.function>:</>00<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Namespace -1 {{ns:-1}}",
		"wikitext": "{{ns:-1}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>ns</><keyword.operator.function>:</>-1<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Namespace User {{ns:User}}",
		"wikitext": "{{ns:User}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>ns</><keyword.operator.function>:</>User<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Namespace User talk {{ns:User_talk}}",
		"wikitext": "{{ns:User_talk}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>ns</><keyword.operator.function>:</>User_talk<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Namespace User talk {{ns:uSeR tAlK}}",
		"wikitext": "{{ns:uSeR tAlK}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>ns</><keyword.operator.function>:</>uSeR tAlK<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Namespace File {{ns:File}}",
		"wikitext": "{{ns:File}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>ns</><keyword.operator.function>:</>File<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Namespace File {{ns:Image}}",
		"wikitext": "{{ns:Image}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>ns</><keyword.operator.function>:</>Image<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Urlencode",
		"wikitext": "{{urlencode:hi world?!}}\n{{urlencode:hi world?!|WIKI}}\n{{urlencode:hi world?!|PATH}}\n{{urlencode:hi world?!|QUERY}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>urlencode</><keyword.operator.function>:</>hi world?!<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>urlencode</><keyword.operator.function>:</>hi world?!<keyword.operator>|</>WIKI<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>urlencode</><keyword.operator.function>:</>hi world?!<keyword.operator>|</>PATH<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>urlencode</><keyword.operator.function>:</>hi world?!<keyword.operator>|</>QUERY<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "__proto__ is treated as normal wikitext (T105997)",
		"wikitext": "__proto__",
		"parsed": "__proto__"
	},
	{
		"desc": "Template titles with entities in them",
		"wikitext": "*{{Fooâ€“bar}}\n*{{Foo&ndash;bar}}",
		"parsed": "<punctuation.definition.list.begin.markdown>*</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Fooâ€“bar</><punctuation.definition.tag.template>}}\\n</><punctuation.definition.list.begin.markdown>*</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Foo&amp;ndash;bar</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Nonexistent template",
		"wikitext": "{{thistemplatedoesnotexist}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>thistemplatedoesnotexist</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Template with invalid target containing tags",
		"wikitext": "{{a<b>b</b>|{{1x|foo}}|{{1x|a}}={{1x|b}}|a = b}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>a</><meta.tag.inline.b.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></>b<meta.tag.inline.b.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo<punctuation.definition.tag.template>}}</><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>a<punctuation.definition.tag.template>}}</>=<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>b<punctuation.definition.tag.template>}}</><keyword.operator>|</><entity.other.attribute-name.local-name>a </><keyword.operator.equal>=</> b<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Template with invalid target containing unclosed tag",
		"wikitext": "{{a<b>|{{1x|foo}}|{{1x|a}}={{1x|b}}|a = b}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>a</><meta.tag.inline.b.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo<punctuation.definition.tag.template>}}</><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>a<punctuation.definition.tag.template>}}</>=<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>b<punctuation.definition.tag.template>}}</><keyword.operator>|</><entity.other.attribute-name.local-name>a </><keyword.operator.equal>=</> b<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Template with invalid target containing wikilink",
		"wikitext": "{{[[Main Page]]}}",
		"parsed": "{{<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</></>}}"
	},
	{
		"desc": "Template with just whitespace in it, T70421",
		"wikitext": "{{1x|{{ }}}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name> </><punctuation.definition.tag.template>}}}}</>"
	},
	{
		"desc": "Template with just whitespace (bad template brace matching)",
		"wikitext": "{{1x|{{ }<nowiki>}</nowiki>}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name> </>}<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>}</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Simple template",
		"wikitext": "{{test}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>test</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Template with explicit namespace",
		"wikitext": "{{Template:test}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Template:test</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Template parameter",
		"wikitext": "{{paramtest|param=foo}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>paramtest</><keyword.operator>|</><entity.other.attribute-name.local-name>param</><keyword.operator.equal>=</>foo<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Template unnamed parameter",
		"wikitext": "{{paramtestnum|Main Page|the main page}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>paramtestnum</><keyword.operator>|</>Main Page<keyword.operator>|</>the main page<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Template with template name as unnamed argument",
		"wikitext": "{{templateasargtestnum|templatesimple}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>templateasargtestnum</><keyword.operator>|</>templatesimple<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Template with template name as argument",
		"wikitext": "{{templateasargtest|templ=simple}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>templateasargtest</><keyword.operator>|</><entity.other.attribute-name.local-name>templ</><keyword.operator.equal>=</>simple<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Template with template name as argument (2)",
		"wikitext": "{{templateasargtest2|templ=templatesimple}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>templateasargtest2</><keyword.operator>|</><entity.other.attribute-name.local-name>templ</><keyword.operator.equal>=</>templatesimple<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Template with default value",
		"wikitext": "{{templateasargtestdefault}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>templateasargtestdefault</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Template with default value (value set)",
		"wikitext": "{{templateasargtestdefault|templ=templa}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>templateasargtestdefault</><keyword.operator>|</><entity.other.attribute-name.local-name>templ</><keyword.operator.equal>=</>templa<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Template redirect",
		"wikitext": "{{templateredirect}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>templateredirect</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Template with argument in separate line",
		"wikitext": "{{ templateasargtest  |\n templ = simple }}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name> templateasargtest  </><keyword.operator>|\\n</> templ = simple <punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Template with complex template as argument",
		"wikitext": "{{paramtest|\n  param ={{ templateasargtest  |\n templ = simple }}}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>paramtest</><keyword.operator>|\\n</>  param =<punctuation.definition.tag.template>{{</><entity.name.tag.local-name> templateasargtest  </><keyword.operator>|\\n</> templ = simple <punctuation.definition.tag.template>}}}}</>"
	},
	{
		"desc": "Templates with templated name",
		"wikitext": "{{{{1x|1x}}|foo}}\n{{{{1x|inner list}} }}",
		"parsed": "{{<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>1x<punctuation.definition.tag.template>}}</>|foo}}\\n{{<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>inner list<punctuation.definition.tag.template>}}</> }}"
	},
	{
		"desc": "Templates with templated name and top level template args",
		"wikitext": "{{1{{2{{{3}}}|4=5}}}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>2</><punctuation.definition.tag.variable>{{{</><variable.other>3</><punctuation.definition.tag.variable>}}}</><keyword.operator>|</><entity.other.attribute-name.local-name>4</><keyword.operator.equal>=</>5<punctuation.definition.tag.template>}}}}</>"
	},
	{
		"desc": "Templates with invalid templated targets",
		"wikitext": "{{1x\n{{1x|foo}}\n}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x\\n</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo<punctuation.definition.tag.template>}}\\n}}</>"
	},
	{
		"desc": "Template with complex arguments",
		"wikitext": "{{complextemplate|\n  param ={{ templateasargtest  |\n templ = simple }}|[[Template:complextemplate|link]]}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>complextemplate</><keyword.operator>|\\n</>  param =<punctuation.definition.tag.template>{{</><entity.name.tag.local-name> templateasargtest  </><keyword.operator>|\\n</> templ = simple <punctuation.definition.tag.template>}}</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Template:</><entity.other.attribute-name>complextemplate</><keyword.operator>|</>link<punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "T2553: link with two variables in a piped link",
		"wikitext": "{|\n|[[{{{1}}}|{{{2}}}]]\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><punctuation.definition.tag.variable>{{{</><variable.other>1</><punctuation.definition.tag.variable>}}}</><keyword.operator>|</><punctuation.definition.tag.variable>{{{</><variable.other>2</><punctuation.definition.tag.variable>}}}</><punctuation.definition.tag.link.internal>]]\\n</></></></><keyword.operator>|}</></>"
	},
	{
		"desc": "Bail on table cell attribute parsing on wikilink",
		"wikitext": "{|\n|testing [[one|two]] |three||four\n|testing one two |three||four\n|testing=\"[[one|two]]\" |three||four\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>testing <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>one</><keyword.operator>|</>two<punctuation.definition.tag.link.internal>]]</></> |three</><keyword.operator>||</><markup.style>four\\n</><keyword.operator>|</><meta.attribute.unrecognized.testing.html><entity.other.attribute-name.html>testing</></> <meta.attribute.unrecognized.one.html><entity.other.attribute-name.html>one</></> <meta.attribute.unrecognized.two.html><entity.other.attribute-name.html>two</> </><keyword.operator>|</><markup.style>three</><keyword.operator>||</><markup.style>four\\n</><keyword.operator>|</><markup.style>testing=\"<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>one</><keyword.operator>|</>two<punctuation.definition.tag.link.internal>]]</></>\" |three</><keyword.operator>||</><markup.style>four\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Don't bail on table cell attribute parsing if wikilink is found in template arg",
		"wikitext": "{|\n|Test {{#tag:spantag|One two \"[[three]]\" four}}\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>Test <punctuation.definition.tag.function>{{</><constant.language.variables.query>#tag</><keyword.operator.function>:</>spantag<keyword.operator>|</>One two \"<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>three</><punctuation.definition.tag.link.internal>]]</></>\" four<punctuation.definition.tag.function>}}\\n</></></><keyword.operator>|}</></>"
	},
	{
		"desc": "Magic variable as template parameter",
		"wikitext": "{{paramtest|param={{SITENAME}}}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>paramtest</><keyword.operator>|</><entity.other.attribute-name.local-name>param</><keyword.operator.equal>=</><constant.language.variables.metadata>{{SITENAME}}</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Template parameter as link source",
		"wikitext": "{{linktest|param=Main Page}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>linktest</><keyword.operator>|</><entity.other.attribute-name.local-name>param</><keyword.operator.equal>=</>Main Page<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Template passing argument to another template",
		"wikitext": "{{paramtest2|arg='hmm'}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>paramtest2</><keyword.operator>|</><entity.other.attribute-name.local-name>arg</><keyword.operator.equal>=</>'hmm'<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Template as link source",
		"wikitext": "[[{{linktest2}}]]\n\n[[{{linktest2}}|Main Page]]\n\n[[{{linktest2}}]]Page",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>linktest2</><punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>linktest2</><punctuation.definition.tag.template>}}</><keyword.operator>|</>Main Page<punctuation.definition.tag.link.internal>]]\\n\\n[[</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>linktest2</><punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]</></>Page"
	},
	{
		"desc": "Template infinite loop",
		"wikitext": "{{loop1}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>loop1</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Template from main namespace",
		"wikitext": "{{:Main Page}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>:Main Page</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Template from non-includable namespace",
		"wikitext": "{{1x|uh oh!}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>uh oh!<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "T2529: Template with table, not included at beginning of line",
		"wikitext": "foo {{table}}",
		"parsed": "foo <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "T2523: Template shouldn't eat newline (or add an extra one before table)",
		"wikitext": "foo\n{{table}}",
		"parsed": "foo\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "T2041: Template parameters shown as broken links",
		"wikitext": "{{{parameter}}}",
		"parsed": "<punctuation.definition.tag.variable>{{{</><variable.other>parameter</><punctuation.definition.tag.variable>}}}</>"
	},
	{
		"desc": "Template with targets containing wikilinks",
		"wikitext": "{{[[foo]]}}\n\n{{[[{{1x|foo}}]]}}\n\n{{{{1x|[[foo}}]]}}",
		"parsed": "{{<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>foo</><punctuation.definition.tag.link.internal>]]</></>}}\\n\\n{{<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo<punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]</></>}}\\n\\n{{<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>foo</><invalid.deprecated.ineffective>}}</><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Double quotes as template target",
		"wikitext": "foo {{''}} baz",
		"parsed": "foo <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>''</><punctuation.definition.tag.template>}}</> baz"
	},
	{
		"desc": "Templates with intersecting and overlapping ranges",
		"wikitext": "{|{{1x|1=class=\"foo\"\n<p>ha</p>}}\n{|{{1x|1=class=\"bar\"\n<p>ho</p>}}\n{{1x|{{!}}hi}}\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><entity.other.attribute-name.local-name>1</><keyword.operator.equal>=</>class=\"foo\"\\n<meta.tag.structure.p.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></>ha<meta.tag.structure.p.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></>}}\\n<meta.tag.block.table><keyword.operator>{|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><entity.other.attribute-name.local-name>1</><keyword.operator.equal>=</>class=\"bar\"\\n<meta.tag.structure.p.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></>ho<meta.tag.structure.p.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></>}}\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><constant.language.variables.metadata>{{!}}</>hi<punctuation.definition.tag.template>}}\\n</><keyword.operator>|}</></></>"
	},
	{
		"desc": "msgnw keyword",
		"wikitext": "{{msgnw:MSGNW test}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>msgnw</><keyword.operator.function>:</>MSGNW test<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "int keyword",
		"wikitext": "{{int:new-messages|lots of money|not!}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>int</><keyword.operator.function>:</>new-messages<keyword.operator>|</>lots of money<keyword.operator>|</>not!<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "int keyword - non-existing message",
		"wikitext": "{{int:var}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>int</><keyword.operator.function>:</>var<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "<includeonly> and <noinclude> being included",
		"wikitext": "{{Includes}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Includes</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "<onlyinclude> being included",
		"wikitext": "{{Includes2}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Includes2</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "<onlyinclude> and <includeonly> being included",
		"wikitext": "{{Includes3}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Includes3</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "<includeonly> and <noinclude> on a page",
		"wikitext": "Foo<noinclude>zar</noinclude><includeonly>bar</includeonly>",
		"parsed": "Foo<punctuation.definition.tag.begin>&lt;</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</>zar<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</>bar<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Un-closed <noinclude>",
		"wikitext": "<noinclude>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Empty <noinclude>",
		"wikitext": "Hello<noinclude></noinclude>!",
		"parsed": "Hello<punctuation.definition.tag.begin>&lt;</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</>!"
	},
	{
		"desc": "Nested <noinclude>s",
		"wikitext": "<noinclude>\nx\n<noinclude>y</noinclude>\nz\n</noinclude>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt\\n</>x\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</>y<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt\\n</>z\\n<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "<onlyinclude> on a page",
		"wikitext": "<onlyinclude>Foo</onlyinclude>bar",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>onlyinclude</><punctuation.definition.tag.end>&gt</><meta.block.onlyinclude>Foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>onlyinclude</><punctuation.definition.tag.end>&gt</>bar"
	},
	{
		"desc": "Un-closed <onlyinclude>",
		"wikitext": "<onlyinclude>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>onlyinclude</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T236868: Un-closed <noinclude> caused bad SourceRange length",
		"wikitext": "{| <noinclude>\n|- <noinclude>\n| A\n|-</noinclude>\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|</> <punctuation.definition.tag.begin>&lt;</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt\\n</><meta.tag.block.table-row><keyword.operator>|-</> <punctuation.definition.tag.begin>&lt;</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style> A\\n</></><meta.tag.block.table-row><keyword.operator>|-</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Self-closed noinclude, includeonly, onlyinclude tags",
		"wikitext": "<noinclude />\n<includeonly />\n<onlyinclude />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>noinclude</> <invalid.illegal.character-not-allowed-here.html>/</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>includeonly</> <invalid.illegal.character-not-allowed-here.html>/</><punctuation.definition.tag.end>&gt\\n</><meta.tag.other.onlyinclude.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>onlyinclude</></><punctuation.definition.tag.end.html> /&gt</></>"
	},
	{
		"desc": "Unbalanced includeonly and noinclude tags",
		"wikitext": "{|\n|a</noinclude>\n|b</noinclude></noinclude>\n|c</noinclude></includeonly>\n|d</includeonly></includeonly>\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>a<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt\\n</></><keyword.operator>|</><markup.style>b<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt\\n</></><keyword.operator>|</><markup.style>c<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt\\n</></><keyword.operator>|</><markup.style>d<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt\\n</></></><keyword.operator>|}</></>"
	},
	{
		"desc": "includeonly / noinclude / onlyinclude and headers",
		"wikitext": "<includeonly><!--hello1 --></includeonly>== test 1 == <includeonly><!--hello2 --></includeonly>\n<noinclude><!--hello3 --></noinclude>== test 2 == <noinclude><!--hello4 --></noinclude>\n<onlyinclude><!--hello5 --></onlyinclude>== test 3 == <onlyinclude><!--hello6 --></onlyinclude>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</><comment.block.html><punctuation.definition.comment.html>&lt;!--</>hello1 <punctuation.definition.comment.html>--&gt</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</>== test 1 == <punctuation.definition.tag.begin>&lt;</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</><comment.block.html><punctuation.definition.comment.html>&lt;!--</>hello2 <punctuation.definition.comment.html>--&gt</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</><comment.block.html><punctuation.definition.comment.html>&lt;!--</>hello3 <punctuation.definition.comment.html>--&gt</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</>== test 2 == <punctuation.definition.tag.begin>&lt;</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</><comment.block.html><punctuation.definition.comment.html>&lt;!--</>hello4 <punctuation.definition.comment.html>--&gt</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>onlyinclude</><punctuation.definition.tag.end>&gt</><meta.block.onlyinclude><comment.block.html><punctuation.definition.comment.html>&lt;!--</>hello5 <punctuation.definition.comment.html>--&gt</></></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>onlyinclude</><punctuation.definition.tag.end>&gt</>== test 3 == <punctuation.definition.tag.begin>&lt;</><entity.name.tag>onlyinclude</><punctuation.definition.tag.end>&gt</><meta.block.onlyinclude><comment.block.html><punctuation.definition.comment.html>&lt;!--</>hello6 <punctuation.definition.comment.html>--&gt</></></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>onlyinclude</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T8563: Section extraction for section shown by <includeonly>",
		"wikitext": "<includeonly>\n==Includeonly section==\n</includeonly>\n==Section T-2==",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt\\n</><markup.heading>==<string.quoted.other.heading>Includeonly section</>==\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt\\n</><markup.heading>==<string.quoted.other.heading>Section T-2</>==</>"
	},
	{
		"desc": "T8563: Section extraction for section suppressed by <includeonly>",
		"wikitext": "<includeonly>\n==Includeonly section==\n</includeonly>\n==Section 1==",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt\\n</><markup.heading>==<string.quoted.other.heading>Includeonly section</>==\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt\\n</><markup.heading>==<string.quoted.other.heading>Section 1</>==</>"
	},
	{
		"desc": "Un-closed <includeonly>",
		"wikitext": "<includeonly>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Includes and comments at SOL",
		"wikitext": "<!-- comment --><noinclude><!-- comment --></noinclude><!-- comment -->==hu==\n\n<noinclude>\nsome\n</noinclude>*stuff\n*here\n\n<noinclude>\nsome</noinclude>* stuff\n* here\n\n<includeonly>can have stuff</includeonly>===here===\n\n__INDEX__== hi ==",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</> comment <punctuation.definition.comment.html>--&gt</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</><comment.block.html><punctuation.definition.comment.html>&lt;!--</> comment <punctuation.definition.comment.html>--&gt</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</><comment.block.html><punctuation.definition.comment.html>&lt;!--</> comment <punctuation.definition.comment.html>--&gt</></>==hu==\\n\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt\\n</>some\\n<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</>*stuff\\n<punctuation.definition.list.begin.markdown>*</>here\\n\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt\\n</>some<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</>* stuff\\n<punctuation.definition.list.begin.markdown>*</> here\\n\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</>can have stuff<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</>===here===\\n\\n<constant.language.switcher>__INDEX__</>== hi =="
	},
	{
		"desc": "Parsoid: DOM fragment reuse",
		"wikitext": "a{{1x|b<table></table>c}}d\n\na{{1x|b\n<table></table>\nc}}d\n\n{{1x|a\n\n<table></table>\n\nb}}",
		"parsed": "a<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>b<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>c<punctuation.definition.tag.template>}}</>d\\n\\na<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>b\\n<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt\\n</></>c<punctuation.definition.tag.template>}}</>d\\n\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>a\\n\\n<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt\\n\\n</></>b<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Parsoid: Merge double tds (T52603)",
		"wikitext": "{|\n|{{1x|{{!}} foo}}\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</></><keyword.operator>|{{!}}</><markup.style> foo}}\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Parsoid: Merge double tds in nested transclusion content (T52603)",
		"wikitext": "{{1x|<div>}}\n{|\n|{{1x|{{!}} foo}}\n|}\n{{1x|</div>}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}\\n</><meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</></><keyword.operator>|{{!}}</><markup.style> foo}}\\n</></><keyword.operator>|}\\n</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Template name with question mark",
		"wikitext": "{{temp?|123}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>temp?</><keyword.operator>|</>123<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "0. includeonly around the entire attribute",
		"wikitext": "<span <includeonly>id=\"v1\"</includeonly><noinclude>id=\"v2\"</noinclude>>bar</span>",
		"parsed": "<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <invalid.illegal.character-not-allowed-here.html>&lt;includeonly</><punctuation.definition.tag.end.html>&gt</></>id=\"v1\"<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</>id=\"v2\"<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</>&gtbar<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "1. includeonly in html attr key",
		"wikitext": "<span <noinclude>id</noinclude><includeonly>about</includeonly>=\"foo\">bar</span>",
		"parsed": "<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <invalid.illegal.character-not-allowed-here.html>&lt;noinclude</><punctuation.definition.tag.end.html>&gt</></>id<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</>about<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</>=\"foo\"&gtbar<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "2. includeonly in html attr value",
		"wikitext": "<span id=\"<noinclude>v1</noinclude><includeonly>v2</includeonly>\">bar</span>\n<span id=<noinclude>\"v1\"</noinclude><includeonly>\"v2\"</includeonly>>bar</span>",
		"parsed": "<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>&lt;noinclude&gtv1&lt;/noinclude&gt&lt;includeonly&gtv2&lt;/includeonly&gt<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>bar<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</>&lt;</><meta.attribute.unrecognized.noinclude.html><entity.other.attribute-name.html>noinclude</></><punctuation.definition.tag.end.html>&gt</></>\"v1\"<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</>\"v2\"<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</>&gtbar<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "3. includeonly in part of an attr value",
		"wikitext": "<span style=\"color:<noinclude>red</noinclude><includeonly>blue</includeonly>;\">bar</span>",
		"parsed": "<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>color:&lt;noinclude&gtred&lt;/noinclude&gt&lt;includeonly&gtblue&lt;/includeonly&gt;</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>bar<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "4. includeonly in table attributes",
		"wikitext": "{|\n|- <noinclude>\n|-\n|a\n</noinclude>\n|- <includeonly>\n|-\n|b\n</includeonly>\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.table-row><keyword.operator>|-</> <punctuation.definition.tag.begin>&lt;</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt\\n</><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>a\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt\\n</><meta.tag.block.table-row><keyword.operator>|-</> <punctuation.definition.tag.begin>&lt;</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt\\n</><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>b\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt\\n</><keyword.operator>|}</></>"
	},
	{
		"desc": "1. Table tag in SOL posn. should get reparsed correctly with valid TSR",
		"wikitext": "{{1x|}}{| width = '100%'\n|foo\n|}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.template>}}</>{| width = '100%'\\n|foo\\n|}"
	},
	{
		"desc": "2. Table tag in SOL posn. should get reparsed correctly with valid TSR",
		"wikitext": "<includeonly>a</includeonly>{| {{{b}}}\n|c\n|}",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</>a<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</>{| <punctuation.definition.tag.variable>{{{</><variable.other>b</><punctuation.definition.tag.variable>}}}\\n</>|c\\n|}"
	},
	{
		"desc": "Table wikitext syntax outside wiki-tables",
		"wikitext": "a\n|+ not a caption\n! not a table heading\n|- not a table row\n| not a table cell\n| class=\"foo bar\" | baz\nb\n|}\n|-\nc",
		"parsed": "a\\n|+ not a caption\\n! not a table heading\\n|- not a table row\\n| not a table cell\\n| class=\"foo bar\" | baz\\nb\\n|}\\n|-\\nc"
	},
	{
		"desc": "Content after <tr> like wikitext should get fully processed",
		"wikitext": "x\n|- [[Foo]] and {{1x|bar}}\ny",
		"parsed": "x\\n|- <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></> and <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>bar<punctuation.definition.tag.template>}}\\n</>y"
	},
	{
		"desc": "P-wrapping should not break after <td>s separated by newlines are converted back to pipes",
		"wikitext": "a\n|b\n\n|c\nd",
		"parsed": "a\\n|b\\n\\n|c\\nd"
	},
	{
		"desc": "Orphaned table row wikitext with templated table for an attribute should not duplicate table",
		"wikitext": "|-{{1x|\n{{{!}}\n{{!}}foo\n{{!}}}\n}}",
		"parsed": "|-<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|\\n</><meta.tag.block.table><keyword.operator>{{{!}}\\n</><meta.tag.block.td><keyword.operator>{{!}}</><markup.style>foo\\n</></><keyword.operator>{{!}}}\\n</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Template Name/Arg clash: 1. Use of positional param",
		"wikitext": "{{quote|foo}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>quote</><keyword.operator>|</>foo<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Template Name/Arg clash: 2. Use of named param",
		"wikitext": "{{quote|quote=foo}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>quote</><keyword.operator>|</><entity.other.attribute-name.local-name>quote</><keyword.operator.equal>=</>foo<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: 1. Simple use",
		"wikitext": "{{1x|Foo}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>Foo<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: 2. Inside a block tag",
		"wikitext": "<div>{{1x|Foo}}</div>\n<blockquote>{{1x|Foo}}</blockquote>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>Foo<punctuation.definition.tag.template>}}</><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.blockquote.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>Foo<punctuation.definition.tag.template>}}</><meta.tag.structure.blockquote.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Templates: P-wrapping: 1a. Templates on consecutive lines",
		"wikitext": "{{1x|Foo}}\n{{1x|bar}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>Foo<punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>bar<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: P-wrapping: 1b. Templates on consecutive lines",
		"wikitext": "Foo\n\n{{1x|bar}}\n{{1x|baz}}",
		"parsed": "Foo\\n\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>bar<punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>baz<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: P-wrapping: 1c. Templates on consecutive lines",
		"wikitext": "{{1x|Foo}}\n{{1x|bar}} <div>baz</div>",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>Foo<punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>bar<punctuation.definition.tag.template>}}</> <meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>baz<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Templates: P-wrapping: 1d. Template preceded by comment-only line",
		"wikitext": "<!-- foo -->\n{{1x|Bar}}",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</> foo <punctuation.definition.comment.html>--&gt\\n</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>Bar<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Scopes should not be expanded unnecessarily",
		"wikitext": "{{1x|<div>a</div>}}b{{1x|\n<div>c</div>}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>a<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</>b<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|\\n</><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>c<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Inline Text: 1. Multiple template uses",
		"wikitext": "{{1x|Foo}}bar{{1x|baz}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>Foo<punctuation.definition.tag.template>}}</>bar<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>baz<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Inline Text: 2. Back-to-back template uses",
		"wikitext": "{{1x|Foo}}{{1x|bar}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>Foo<punctuation.definition.tag.template>}}{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>bar<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Block Tags: 1. Multiple template uses",
		"wikitext": "{{1x|<div>Foo</div>}}<div>bar</div>{{1x|<div>baz</div>}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>Foo<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>bar<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>baz<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Block Tags: 2. Back-to-back template uses",
		"wikitext": "{{1x|<div>Foo</div>}}{{1x|<div>bar</div>}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>Foo<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>bar<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Correctly encapsulate templates producing </p> tag without a corresponding <p> tag",
		"wikitext": "{{1x|a\nb</p>}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>a\\nb<meta.tag.structure.p.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Drop stripped tag markers, unless they have encapsulation info",
		"wikitext": "{{1x|<tr></tr>}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Links: 1. Simple example",
		"wikitext": "{{1x|[[Foo|bar]]}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</>bar<punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Links: 2. Generation of link href",
		"wikitext": "[[{{1x|Foo}}|bar]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>Foo<punctuation.definition.tag.template>}}</><keyword.operator>|</>bar<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Templates: Links: 3. Generation of part of a link href",
		"wikitext": "[[Fo{{1x|o}}|bar]]\n\n[[Foo{{1x|bar}}]]\n\n[[Foo{{1x|bar}}baz]]\n\n[[Foo{{1x|bar}}|bar]]\n\n[[:Foo{{1x|bar}}]]\n\n[[:Foo{{1x|bar}}|bar]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Fo</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>o<punctuation.definition.tag.template>}}</><keyword.operator>|</>bar<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>bar<punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>bar<punctuation.definition.tag.template>}}</>baz<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>bar<punctuation.definition.tag.template>}}</><keyword.operator>|</>bar<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.other.attribute-name>:Foo</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>bar<punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.other.attribute-name>:Foo</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>bar<punctuation.definition.tag.template>}}</><keyword.operator>|</>bar<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Templates: Links: 4. Multiple templates generating link href",
		"wikitext": "[[{{1x|F}}{{1x|o}}ob{{1x|ar}}]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>F<punctuation.definition.tag.template>}}{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>o<punctuation.definition.tag.template>}}</>ob<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>ar<punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Templates: Links: 5. Generation of link text",
		"wikitext": "[[Foo|{{1x|bar}}]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>bar<punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Templates: Links: 5. Nested templates (only outermost template should be marked)",
		"wikitext": "{{1x|[[{{1x|Foo}}|bar]]}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>Foo<punctuation.definition.tag.template>}}</><keyword.operator>|</>bar<punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "File with template filename",
		"wikitext": "[[File:{{1x|Foobar.jpg}}]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>Foobar.jpg<punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Templates: HTML Tag: 1. Generation of HTML attr. key",
		"wikitext": "<div {{1x|style}}=\"color:red;\">foo</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.unrecognized.{{1x|style}}.html><entity.other.attribute-name.html>{{1x|style}}</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>color:red;<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Templates: HTML Tag: 2. Generation of HTML attr. value",
		"wikitext": "<div style={{1x|'color:red;'}}>foo</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.unquoted.html><source.css>{{1x|</></></></><invalid.illegal.character-not-allowed-here.html>'color:red;'}}</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Templates: HTML Tag: 3. Generation of HTML attr key and value",
		"wikitext": "<div {{1x|style}}={{1x|'color:red;'}}>foo</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.unrecognized.{{1x|style}}.html><entity.other.attribute-name.html>{{1x|style}}</><punctuation.separator.key-value.html>=</><string.unquoted.html>{{1x|</></><invalid.illegal.character-not-allowed-here.html>'color:red;'}}</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Templates: HTML Tag: 4. Generation of starting piece of HTML attr value",
		"wikitext": "<div title=\"{{1x|This is a long title}} with just one piece templated\">foo</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>{{1x|This is a long title}} with just one piece templated<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Templates: HTML Tag: 5. Generation of middle piece of HTML attr value",
		"wikitext": "<div title=\"This is a long title with just {{1x|one piece}} templated\">foo</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>This is a long title with just {{1x|one piece}} templated<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Templates: HTML Tag: 6. Generation of end piece of HTML attr value",
		"wikitext": "<div title=\"This is a long title with just one piece {{1x|templated}}\">foo</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>This is a long title with just one piece {{1x|templated}}<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Templates: HTML Tag: 7. Generation of partial attribute key string",
		"wikitext": "<div st{{1x|yle}}=\"color:red;\">foo</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.unrecognized.st{{1x|yle}}.html><entity.other.attribute-name.html>st{{1x|yle}}</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>color:red;<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Templates: HTML Tag: 8. Template-generated attribute (k=v)",
		"wikitext": "<div {{1x|1=id=\"v1\"}}>bar</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.unrecognized.{{1x|1.html><entity.other.attribute-name.html>{{1x|1</><punctuation.separator.key-value.html>=</><string.unquoted.html>id</><invalid.illegal.unexpected-equals-sign.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>v1<punctuation.definition.string.end.html>\"</></></><meta.attribute.unrecognized.}}.html><entity.other.attribute-name.html>}}</></><punctuation.definition.tag.end.html>&gt</></>bar<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Templates: HTML Tag: 9. Multiple template-generated attributes",
		"wikitext": "<div {{1x|1=id=\"v1\" title=\"foo\"}}>bar</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.unrecognized.{{1x|1.html><entity.other.attribute-name.html>{{1x|1</><punctuation.separator.key-value.html>=</><string.unquoted.html>id</><invalid.illegal.unexpected-equals-sign.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>v1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></><meta.attribute.unrecognized.}}.html><entity.other.attribute-name.html>}}</></><punctuation.definition.tag.end.html>&gt</></>bar<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Templates: Support for templates generating attributes and content",
		"wikitext": "{| {{mixed_attr_content_template}}\n|-\n|bar\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|</> <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>mixed_attr_content_template</><punctuation.definition.tag.template>}}\\n</><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>bar\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Templates: Support for templates generating table attributes and content (with fostered categories)",
		"wikitext": "{| {{mixed_attr_content_template_2}}\n|-\n|bar\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|</> <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>mixed_attr_content_template_2</><punctuation.definition.tag.template>}}\\n</><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>bar\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Table cell with attribute before expanded attribute",
		"wikitext": "{|\n| align=\"center\" {{attribute_from_template}} |456\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style> align=\"center\" <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>attribute_from_template</><punctuation.definition.tag.template>}}</> |456\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "1. Entities and nowikis inside templated attributes should be handled correctly",
		"wikitext": "<div {{1x|style{{=}}\"background:&#35;f9f9f9;\"}}>foo</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.unrecognized.{{1x|style{{.html><entity.other.attribute-name.html>{{1x|style{{</><punctuation.separator.key-value.html>=</><string.unquoted.html>}}</></><invalid.illegal.character-not-allowed-here.html>\"background:&amp;#35;f9f9f9;\"}}</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "2. Entities and nowikis inside templated attributes should be handled correctly",
		"wikitext": "{|\n|{{table_attribs_3}}\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table_attribs_3</><punctuation.definition.tag.template>}}\\n</></></><keyword.operator>|}</></>"
	},
	{
		"desc": "3. Entities and nowikis inside templated attributes should be handled correctly inside templated tables",
		"wikitext": "{{tbl-start}}\n|{{table_attribs_3}}\n{{tbl-end}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>tbl-start</><punctuation.definition.tag.template>}}\\n</>|<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table_attribs_3</><punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>tbl-end</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "4. Entities and nowikis inside templated attributes should be handled correctly inside templated tables",
		"wikitext": "{|\n|{{table_attribs_6}} hi\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table_attribs_6</><punctuation.definition.tag.template>}}</> hi\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Extension tag in templated tag attribute",
		"wikitext": "{{1x|1=\n{{{!}} class=\"123\" <nowiki />\n{{!}} hi\n{{!}}}\n}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><entity.other.attribute-name.local-name>1</><keyword.operator.equal>=\\n</><meta.tag.block.table><keyword.operator>{{{!}}</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>123<punctuation.definition.string.end.html>\"</></></> <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</> <punctuation.definition.tag.end>/&gt\\n</><meta.tag.block.td><keyword.operator>{{!}}</><markup.style> hi\\n</></><keyword.operator>{{!}}}\\n</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: HTML Tables: 1. Generating start of a HTML table",
		"wikitext": "{{1x|<table><tr><td>foo</td>}}</tr></table>",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Templates: HTML Tables: 2a. Generating middle of a HTML table",
		"wikitext": "<table><tr>{{1x|<td>foo</td>}}</tr></table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Templates: HTML Tables: 2b. Generating middle of a HTML table",
		"wikitext": "<table>{{1x|<tr><td>foo</td></tr>}}</table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Templates: HTML Tables: 3. Generating end of a HTML table",
		"wikitext": "<table><tr>{{1x|<td>foo</td></tr></table>}}",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: HTML Tables: 4a. Generating a single tag of a HTML table",
		"wikitext": "{{1x|<table>}}<tr><td>foo</td></tr></table>",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Templates: HTML Tables: 4b. Generating a single tag of a HTML table",
		"wikitext": "<table>{{1x|<tr>}}<td>foo</td></tr></table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Templates: HTML Tables: 4c. Generating a single tag of a HTML table",
		"wikitext": "<table><tr>{{1x|<td>}}foo</td></tr></table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</>foo<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Templates: HTML Tables: 4d. Generating a single tag of a HTML table",
		"wikitext": "<table><tr><td>foo{{1x|</td>}}</tr></table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>foo<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Templates: HTML Tables: 4e. Generating a single tag of a HTML table",
		"wikitext": "<table><tr><td>foo</td>{{1x|</tr>}}</table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Templates: HTML Tables: 4f. Generating a single tag of a HTML table",
		"wikitext": "<table><tr><td>foo</td></tr>{{1x|</table>}}",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: HTML Tables: 5. Proper fostering of categories from inside",
		"wikitext": "<table>[[Category:foo1]]<tr><td>foo</td></tr></table>\n<!--Two categories (T52330)-->\n<table>[[Category:bar1]][[Category:bar2]]<tr><td>foo</td></tr></table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>foo1</><punctuation.definition.tag.link.internal>]]</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt\\n</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</>Two categories (T52330)<punctuation.definition.comment.html>--&gt\\n</></><meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>bar1</><punctuation.definition.tag.link.internal>]][[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>bar2</><punctuation.definition.tag.link.internal>]]</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Templates: Wiki Tables: 1a. Fostering of entire template content",
		"wikitext": "{|\n{{1x|a}}\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>a<punctuation.definition.tag.template>}}\\n</><keyword.operator>|}</></>"
	},
	{
		"desc": "Templates: Wiki Tables: 1b. Fostering of entire template content",
		"wikitext": "{|\n{{1x|<div>}}\nfoo\n{{1x|</div>}}\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}\\n</>foo\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}\\n</><keyword.operator>|}</></>"
	},
	{
		"desc": "Templates: Wiki Tables: 2. Fostering of partial template content",
		"wikitext": "{|\n{{1x|a\n<div>b</div>}}\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>a\\n<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>b<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}\\n</><keyword.operator>|}</></>"
	},
	{
		"desc": "Templates: Wiki Tables: 3. td-content via multiple templates",
		"wikitext": "{|\n{{1x|{{pipe}}a}}{{1x|b}}\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>pipe</><punctuation.definition.tag.template>}}</>a<punctuation.definition.tag.template>}}{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>b<punctuation.definition.tag.template>}}\\n</><keyword.operator>|}</></>"
	},
	{
		"desc": "Templates: Wiki Tables: 4. Templated tags, no content",
		"wikitext": "{{tbl-start}}\n{{tbl-end}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>tbl-start</><punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>tbl-end</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Wiki Tables: 5. Templated tags, regular td-tags",
		"wikitext": "{{tbl-start}}\n|foo\n{{tbl-end}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>tbl-start</><punctuation.definition.tag.template>}}\\n</>|foo\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>tbl-end</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Wiki Tables: 6. Templated tags, templated td-tags",
		"wikitext": "{{tbl-start}}\n{{!}}foo\n{{tbl-end}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>tbl-start</><punctuation.definition.tag.template>}}\\n</><constant.language.variables.metadata>{{!}}</>foo\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>tbl-end</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Wiki Tables: 8. Fosterable meta-tags should get fostered",
		"wikitext": "{{UnclosedTableEndsWithTR}}\n<onlyinclude>\n|foo\n</onlyinclude>\n|}\n\n<noinclude>\n{{UnclosedTableEndsWithTR}}\n</noinclude>\n|foo\n|}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>UnclosedTableEndsWithTR</><punctuation.definition.tag.template>}}\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>onlyinclude</><punctuation.definition.tag.end>&gt\\n</><meta.block.onlyinclude>|foo\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>onlyinclude</><punctuation.definition.tag.end>&gt\\n</>|}\\n\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>UnclosedTableEndsWithTR</><punctuation.definition.tag.template>}}\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt\\n</>|foo\\n|}"
	},
	{
		"desc": "Templates: Lists: Multi-line list-items via templates",
		"wikitext": "*{{1x|a {{nonexistent|\nunused}}}}\n*{{1x|b {{nonexistent|\nunused}}}}",
		"parsed": "<punctuation.definition.list.begin.markdown>*</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>a <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>nonexistent</><keyword.operator>|\\n</>unused<punctuation.definition.tag.template>}}}}\\n</><punctuation.definition.list.begin.markdown>*</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>b <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>nonexistent</><keyword.operator>|\\n</>unused<punctuation.definition.tag.template>}}}}</>"
	},
	{
		"desc": "Templates: Ugly nesting: 1. Quotes opened/closed across templates (1x)",
		"wikitext": "{{1x|''a}}{{1x|b''c''d}}{{1x|''e}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><markup.italic>''</>a<punctuation.definition.tag.template>}}{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>b<markup.italic>''</>c<markup.italic>''</>d<punctuation.definition.tag.template>}}{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><markup.italic>''</>e<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Ugly nesting: 2. Quotes opened/closed across templates (1x_with_span)",
		"wikitext": "{{1x_with_span|''a}}{{1x_with_span|b''c''d}}{{1x_with_span|''e}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x_with_span</><keyword.operator>|</><markup.italic>''</>a<punctuation.definition.tag.template>}}{{</><entity.name.tag.local-name>1x_with_span</><keyword.operator>|</>b<markup.italic>''</>c<markup.italic>''</>d<punctuation.definition.tag.template>}}{{</><entity.name.tag.local-name>1x_with_span</><keyword.operator>|</><markup.italic>''</>e<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Ugly nesting: 3. Quotes opened/closed across templates (1x_with_div)",
		"wikitext": "{{1x_with_div|''a}}{{1x_with_div|b''c''d}}{{1x_with_div|''e}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x_with_div</><keyword.operator>|</><markup.italic>''</>a<punctuation.definition.tag.template>}}{{</><entity.name.tag.local-name>1x_with_div</><keyword.operator>|</>b<markup.italic>''</>c<markup.italic>''</>d<punctuation.definition.tag.template>}}{{</><entity.name.tag.local-name>1x_with_div</><keyword.operator>|</><markup.italic>''</>e<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Ugly nesting: 4. Divs opened/closed across templates",
		"wikitext": "a<div>b{{1x|c</div>d}}e",
		"parsed": "a<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>b<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>c<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>d<punctuation.definition.tag.template>}}</>e"
	},
	{
		"desc": "Templates: Ugly templates: 3. newline-only template parameter",
		"wikitext": "foo {{1x|\n}}",
		"parsed": "foo <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|\\n</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Ugly templates: 4. newline-only template parameter inconsistency",
		"wikitext": "{{1x|\n}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|\\n</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Ugly templates: 5. Template encapsulation test: Non-trivial overlap of template ranges is properly handled",
		"wikitext": "{{1x|<table>}}\n{{1x|<div>foo}}\n{{1x|</table>}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>foo<punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Ugly templates: 6. Template encapsulation test: Cyclical nesting of template ranges is properly handled",
		"wikitext": "{{1x|<table><tr><td><table>}}\n{{1x|<div>}}\n{{1x|</div>}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Parameters substituted at the top-level",
		"wikitext": "{{{foo|''who'' {{1x|me}}? '''never!'''}}}\n\n{{{foo|bar|baz}}}",
		"parsed": "<punctuation.definition.tag.variable>{{{</><variable.other>foo</><variable.parameter><keyword.operator>|</><markup.italic>''</>who<markup.italic>''</> <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>me<punctuation.definition.tag.template>}}</>? <markup.bold>'''</>never!<markup.bold>'''</></><punctuation.definition.tag.variable>}}}\\n\\n{{{</><variable.other>foo</><variable.parameter><keyword.operator>|</>bar<invalid.deprecated.ineffective>|baz</></><punctuation.definition.tag.variable>}}}</>"
	},
	{
		"desc": "Templates: Param with empty arg in the final position",
		"wikitext": "{{{hi|}}}",
		"parsed": "<punctuation.definition.tag.variable>{{{</><variable.other>hi</><variable.parameter><keyword.operator>|</></><punctuation.definition.tag.variable>}}}</>"
	},
	{
		"desc": "Compound transclusion with template and top level templatearg",
		"wikitext": "{{1x|<table>}}\n{{{top|<td>123</td>}}}\n</table>",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}\\n</><punctuation.definition.tag.variable>{{{</><variable.other>top</><variable.parameter><keyword.operator>|</><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>123<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></></><punctuation.definition.tag.variable>}}}\\n</><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Parser Functions: 1. Simple example",
		"wikitext": "{{uc:foo}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>uc</><keyword.operator.function>:</>foo<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Parser Functions: 2. Nested use (only outermost should be marked up)",
		"wikitext": "{{uc:{{lc:FOO}}}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>uc</><keyword.operator.function>:</><punctuation.definition.tag.function>{{</><constant.language.variables.query>lc</><keyword.operator.function>:</>FOO<punctuation.definition.tag.function>}}}}</>"
	},
	{
		"desc": "Parsoid: Recognize nowiki with odd capitalization",
		"wikitext": "<noWikI ><div>[[foo]]</Nowiki >",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>noWikI</> <punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>&lt;div&gt[[foo]]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>Nowiki</> <punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Parsoid: Escape nowiki with trailing space in tags",
		"wikitext": "&lt;nowiki &gt; foo &lt;/nowiki &gt;\n\na&lt;nowiki /&gt;b\n\nc&lt;nowiki/ &gt;d",
		"parsed": "<constant.character.entity.named.lt.html><punctuation.definition.entity.html>&amp;</>lt<punctuation.definition.entity.html>;</></>nowiki <constant.character.entity.named.gt.html><punctuation.definition.entity.html>&amp;</>gt<punctuation.definition.entity.html>;</></> foo <constant.character.entity.named.lt.html><punctuation.definition.entity.html>&amp;</>lt<punctuation.definition.entity.html>;</></>/nowiki <constant.character.entity.named.gt.html><punctuation.definition.entity.html>&amp;</>gt<punctuation.definition.entity.html>;\\n\\n</></>a<constant.character.entity.named.lt.html><punctuation.definition.entity.html>&amp;</>lt<punctuation.definition.entity.html>;</></>nowiki /<constant.character.entity.named.gt.html><punctuation.definition.entity.html>&amp;</>gt<punctuation.definition.entity.html>;</></>b\\n\\nc<constant.character.entity.named.lt.html><punctuation.definition.entity.html>&amp;</>lt<punctuation.definition.entity.html>;</></>nowiki/ <constant.character.entity.named.gt.html><punctuation.definition.entity.html>&amp;</>gt<punctuation.definition.entity.html>;</></>d"
	},
	{
		"desc": "Parsoid: Escape weird noWikI capitalizations",
		"wikitext": "&lt;noWikI &gt; foo &lt;/NoWikI &gt;",
		"parsed": "<constant.character.entity.named.lt.html><punctuation.definition.entity.html>&amp;</>lt<punctuation.definition.entity.html>;</></>noWikI <constant.character.entity.named.gt.html><punctuation.definition.entity.html>&amp;</>gt<punctuation.definition.entity.html>;</></> foo <constant.character.entity.named.lt.html><punctuation.definition.entity.html>&amp;</>lt<punctuation.definition.entity.html>;</></>/NoWikI <constant.character.entity.named.gt.html><punctuation.definition.entity.html>&amp;</>gt<punctuation.definition.entity.html>;</></>"
	},
	{
		"desc": "message transform: magic variables",
		"wikitext": "{{SITENAME}}",
		"parsed": "<constant.language.variables.metadata>{{SITENAME}}</>"
	},
	{
		"desc": "message transform: should not transform wiki markup",
		"wikitext": "''test''",
		"parsed": "<markup.italic>''</>test<markup.italic>''</>"
	},
	{
		"desc": "message transform: <noinclude> in transcluded template (T6926)",
		"wikitext": "{{Includes}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Includes</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "message transform: <onlyinclude> in transcluded template (T6926)",
		"wikitext": "{{Includes2}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Includes2</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "{{#special:}} page name, known",
		"wikitext": "{{#special:Recentchanges}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#special</><keyword.operator.function>:</>Recentchanges<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "{{#special:}} page name with subpage, known",
		"wikitext": "{{#special:Recentchanges/param}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#special</><keyword.operator.function>:</>Recentchanges/param<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "{{#special:}} page name, unknown",
		"wikitext": "{{#special:foobar nonexistent}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#special</><keyword.operator.function>:</>foobar nonexistent<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "{{#speciale:}} page name, known",
		"wikitext": "{{#speciale:Recentchanges}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#speciale</><keyword.operator.function>:</>Recentchanges<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "{{#speciale:}} page name with subpage, known",
		"wikitext": "{{#speciale:Recentchanges/param}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#speciale</><keyword.operator.function>:</>Recentchanges/param<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "{{#speciale:}} page name, unknown",
		"wikitext": "{{#speciale:foobar nonexistent}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#speciale</><keyword.operator.function>:</>foobar nonexistent<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Subpage link",
		"wikitext": "[[/subpage]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>/subpage</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Subpage noslash link",
		"wikitext": "[[/subpage/]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>/subpage/</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Relative subpage noslash link",
		"wikitext": "[[../../subpage/]]\n\n[[../../subpage]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>../../subpage/</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.other.attribute-name>../../subpage</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid: dot-slash prefixed wikilinks",
		"wikitext": "[[./foo]]\n\n[[././bar]]\n\n[[././baz/]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>./foo</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.other.attribute-name>././bar</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.other.attribute-name>././baz/</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Render invalid page names as plain text (T53090)",
		"wikitext": "[[./../foo|bar]]\n[[fooï¿½|bar]]\n[[foo/.|bar]]\n[[foo/..|bar]]\n[[foo~~~bar]]\n[[foo>bar]]\n[[foo[bar]]\n[[.]]\n[[..]]\n[[foo././bar]]\n[[foo[http://example.com]xyz]]\n\n[[{{1x|./../foo}}|bar]]\n[[{{1x|foo/.}}|bar]]\n[[{{1x|foo/..}}|bar]]\n[[{{1x|foo~~~~bar}}]]\n[[{{1x|foo>bar}}]]\n[[{{1x|foo././bar}}]]\n[[{{1x|foo{bar}}]]\n[[{{1x|foo}bar}}]]\n[[{{1x|foo[bar}}]]\n[[{{1x|foo]bar}}]]\n[[{{1x|foo<bar}}]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>./../foo</><keyword.operator>|</>bar<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>fooï¿½</><keyword.operator>|</>bar<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>foo/.</><keyword.operator>|</>bar<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>foo/..</><keyword.operator>|</>bar<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>foo~~~bar</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>foo</><invalid.deprecated.ineffective>&gt</>bar<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>foo</><invalid.deprecated.ineffective>[</>bar<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>.</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>..</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>foo././bar</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>foo</><invalid.deprecated.ineffective>[</>http://example.com<invalid.deprecated.ineffective>]</>xyz<punctuation.definition.tag.link.internal>]]\\n\\n[[</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>./../foo<punctuation.definition.tag.template>}}</><keyword.operator>|</>bar<punctuation.definition.tag.link.internal>]]\\n[[</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo/.<punctuation.definition.tag.template>}}</><keyword.operator>|</>bar<punctuation.definition.tag.link.internal>]]\\n[[</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo/..<punctuation.definition.tag.template>}}</><keyword.operator>|</>bar<punctuation.definition.tag.link.internal>]]\\n[[</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo<keyword.other.signature>~~~~</>bar<punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]\\n[[</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo&gtbar<punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]\\n[[</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo././bar<punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]\\n[[</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo{bar<punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]\\n[[</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo}bar<punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]\\n[[</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo[bar<punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]\\n[[</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo]bar<punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]\\n[[</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo<meta.tag.other.bar}}]].html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>bar}}]]</></></></>"
	},
	{
		"desc": "Disabled subpages",
		"wikitext": "[[/subpage]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>/subpage</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T2561: {{/Subpage}}",
		"wikitext": "{{/Subpage}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>/Subpage</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Subpage with namespaces",
		"wikitext": "[[User:../subpage]]\n[[meatball:../subpage]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>User:</><entity.other.attribute-name>../subpage</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>meatball:../subpage</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T335847: Resolve forward slash title",
		"wikitext": "===123===",
		"parsed": "<markup.heading>===<string.quoted.other.heading>123</>===</>"
	},
	{
		"desc": "T335847: Resolve subpage of control title",
		"wikitext": "[[../Hi]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>../Hi</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T335847: Resolve subpage of forward slash title",
		"wikitext": "[[../Hi]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>../Hi</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Link to category",
		"wikitext": "[[:Category:MediaWiki User's Guide]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>:Category:</><entity.other.attribute-name>MediaWiki User's Guide</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Simple category",
		"wikitext": "[[Category:MediaWiki User's Guide]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>MediaWiki User's Guide</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Simple category with whitespace as sort key",
		"wikitext": "[[Category:Foo| ]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><keyword.operator>|</> <punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "PAGESINCATEGORY invalid title fatal (r33546 fix)",
		"wikitext": "{{PAGESINCATEGORY:<bogus>}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>PAGESINCATEGORY</><keyword.operator.function>:</><meta.tag.other.bogus.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>bogus</></><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Category with different sort key",
		"wikitext": "[[Category:MediaWiki User's Guide|Foo]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>MediaWiki User's Guide</><keyword.operator>|</>Foo<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Category with identical sort key",
		"wikitext": "[[Category:MediaWiki User's Guide|MediaWiki User's Guide]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>MediaWiki User's Guide</><keyword.operator>|</>MediaWiki User's Guide<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Category with identical sort key, except underscores",
		"wikitext": "[[Category:MediaWiki User's Guide|MediaWiki_User's_Guide]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>MediaWiki User's Guide</><keyword.operator>|</>MediaWiki_User's_Guide<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Category with newline in sort key",
		"wikitext": "[[Category:Wikidata:Tools|\n*]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Wikidata:Tools</><keyword.operator>|\\n</><punctuation.definition.list.begin.markdown>*</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Category with template-generated sort key",
		"wikitext": "[[Category:MediaWiki User's Guide|MediaWiki {{1x|Foo}} Guide]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>MediaWiki User's Guide</><keyword.operator>|</>MediaWiki <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>Foo<punctuation.definition.tag.template>}}</> Guide<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Category / paragraph interactions",
		"wikitext": "Foo [[Category:Baz]] Bar\n\nFoo [[Category:Baz]]\nBar\n\nFoo\n[[Category:Baz]]\nBar\n\nFoo\n[[Category:Baz]] Bar\n\nFoo\n[[Category:Baz]]\n [[Category:Baz]]\n[[Category:Baz]]\nBar\n\n[[Category:Baz]]\n [[Category:Baz]]\n[[Category:Baz]]\n\n[[Category:Baz]]\n {{1x|[[Category:Baz]]}}\n[[Category:Baz]]",
		"parsed": "Foo <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Baz</><punctuation.definition.tag.link.internal>]]</></> Bar\\n\\nFoo <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Baz</><punctuation.definition.tag.link.internal>]]\\n</></>Bar\\n\\nFoo\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Baz</><punctuation.definition.tag.link.internal>]]\\n</></>Bar\\n\\nFoo\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Baz</><punctuation.definition.tag.link.internal>]]</></> Bar\\n\\nFoo\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Baz</><punctuation.definition.tag.link.internal>]]\\n</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Baz</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Baz</><punctuation.definition.tag.link.internal>]]\\n</></>Bar\\n\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Baz</><punctuation.definition.tag.link.internal>]]\\n</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Baz</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Baz</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Baz</><punctuation.definition.tag.link.internal>]]\\n</></> <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Baz</><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.template>}}\\n</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Baz</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Category / non-newline whitespace interactions (T359886)",
		"wikitext": "* Foo[[Category:Foo]]Bar\n* Foo[[Category:Foo]] Bar\n* Foo [[Category:Foo]]Bar\n* Foo [[Category:Foo]] Bar\n\n* Foo[[Category:Foo]][[Category:Bar]]Bar\n* Foo[[Category:Foo]][[Category:Bar]] Bar\n* Foo[[Category:Foo]] [[Category:Bar]]Bar\n* Foo[[Category:Foo]] [[Category:Bar]] Bar\n* Foo [[Category:Foo]][[Category:Bar]]Bar\n* Foo [[Category:Foo]][[Category:Bar]] Bar\n* Foo [[Category:Foo]] [[Category:Bar]]Bar\n* Foo [[Category:Foo]] [[Category:Bar]] Bar",
		"parsed": "<punctuation.definition.list.begin.markdown>*</> Foo<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></>Bar\\n<punctuation.definition.list.begin.markdown>*</> Foo<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></> Bar\\n<punctuation.definition.list.begin.markdown>*</> Foo <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></>Bar\\n<punctuation.definition.list.begin.markdown>*</> Foo <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></> Bar\\n\\n<punctuation.definition.list.begin.markdown>*</> Foo<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]][[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Bar</><punctuation.definition.tag.link.internal>]]</></>Bar\\n<punctuation.definition.list.begin.markdown>*</> Foo<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]][[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Bar</><punctuation.definition.tag.link.internal>]]</></> Bar\\n<punctuation.definition.list.begin.markdown>*</> Foo<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Bar</><punctuation.definition.tag.link.internal>]]</></>Bar\\n<punctuation.definition.list.begin.markdown>*</> Foo<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Bar</><punctuation.definition.tag.link.internal>]]</></> Bar\\n<punctuation.definition.list.begin.markdown>*</> Foo <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]][[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Bar</><punctuation.definition.tag.link.internal>]]</></>Bar\\n<punctuation.definition.list.begin.markdown>*</> Foo <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]][[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Bar</><punctuation.definition.tag.link.internal>]]</></> Bar\\n<punctuation.definition.list.begin.markdown>*</> Foo <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Bar</><punctuation.definition.tag.link.internal>]]</></>Bar\\n<punctuation.definition.list.begin.markdown>*</> Foo <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Bar</><punctuation.definition.tag.link.internal>]]</></> Bar"
	},
	{
		"desc": "Language link / non-newline whitespace interactions (T359886)",
		"wikitext": "* Foo[[es:Foo]]Bar\n* Foo[[es:Foo]] Bar\n* Foo [[es:Foo]]Bar\n* Foo [[es:Foo]] Bar\n\n* Foo[[es:Foo]][[es:Bar]]Bar\n* Foo[[es:Foo]][[es:Bar]] Bar\n* Foo[[es:Foo]] [[es:Bar]]Bar\n* Foo[[es:Foo]] [[es:Bar]] Bar\n* Foo [[es:Foo]][[es:Bar]]Bar\n* Foo [[es:Foo]][[es:Bar]] Bar\n* Foo [[es:Foo]] [[es:Bar]]Bar\n* Foo [[es:Foo]] [[es:Bar]] Bar",
		"parsed": "<punctuation.definition.list.begin.markdown>*</> Foo<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>es:Foo</><punctuation.definition.tag.link.internal>]]</></>Bar\\n<punctuation.definition.list.begin.markdown>*</> Foo<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>es:Foo</><punctuation.definition.tag.link.internal>]]</></> Bar\\n<punctuation.definition.list.begin.markdown>*</> Foo <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>es:Foo</><punctuation.definition.tag.link.internal>]]</></>Bar\\n<punctuation.definition.list.begin.markdown>*</> Foo <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>es:Foo</><punctuation.definition.tag.link.internal>]]</></> Bar\\n\\n<punctuation.definition.list.begin.markdown>*</> Foo<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>es:Foo</><punctuation.definition.tag.link.internal>]][[</><entity.other.attribute-name>es:Bar</><punctuation.definition.tag.link.internal>]]</></>Bar\\n<punctuation.definition.list.begin.markdown>*</> Foo<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>es:Foo</><punctuation.definition.tag.link.internal>]][[</><entity.other.attribute-name>es:Bar</><punctuation.definition.tag.link.internal>]]</></> Bar\\n<punctuation.definition.list.begin.markdown>*</> Foo<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>es:Foo</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>es:Bar</><punctuation.definition.tag.link.internal>]]</></>Bar\\n<punctuation.definition.list.begin.markdown>*</> Foo<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>es:Foo</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>es:Bar</><punctuation.definition.tag.link.internal>]]</></> Bar\\n<punctuation.definition.list.begin.markdown>*</> Foo <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>es:Foo</><punctuation.definition.tag.link.internal>]][[</><entity.other.attribute-name>es:Bar</><punctuation.definition.tag.link.internal>]]</></>Bar\\n<punctuation.definition.list.begin.markdown>*</> Foo <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>es:Foo</><punctuation.definition.tag.link.internal>]][[</><entity.other.attribute-name>es:Bar</><punctuation.definition.tag.link.internal>]]</></> Bar\\n<punctuation.definition.list.begin.markdown>*</> Foo <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>es:Foo</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>es:Bar</><punctuation.definition.tag.link.internal>]]</></>Bar\\n<punctuation.definition.list.begin.markdown>*</> Foo <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>es:Foo</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>es:Bar</><punctuation.definition.tag.link.internal>]]</></> Bar"
	},
	{
		"desc": "1. Categories and newlines: All preceding newlines should be suppressed (courtesy T2087)",
		"wikitext": "This\n   \n[[Category:Foo]] and this should be part of same paragraph (not an indent-pre)\n   \n{{1x|[[Category:Foo]] and so should this!}}",
		"parsed": "This\\n   \\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></> and this should be part of same paragraph (not an indent-pre)\\n   \\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></> and so should this!<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "2. Categories and newlines: All preceding newlines should be suppressed (courtesy T2087)",
		"wikitext": "* This\n   \n[[Category:Foo]] and this should be part of the same list item\n* So should this\n\n{{1x|[[Category:Foo]] and this should be part of the same list item}}",
		"parsed": "<punctuation.definition.list.begin.markdown>*</> This\\n   \\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></> and this should be part of the same list item\\n<punctuation.definition.list.begin.markdown>*</> So should this\\n\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></> and this should be part of the same list item<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "3. Categories and newlines: newline suppression for last list item should RT properly",
		"wikitext": "*a\n*b\n   \n[[Category:Foo]]\n   \n[[Category:Bar]]\n[[Category:Baz]]\n\n:c\n\n[[Category:C]]\n\n;d\n\n[[Category:D]]",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>a\\n<punctuation.definition.list.begin.markdown>*</>b\\n   \\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]\\n</></>   \\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Bar</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Baz</><punctuation.definition.tag.link.internal>]]\\n\\n</></><punctuation.definition.list.begin.markdown>:</>c\\n\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>C</><punctuation.definition.tag.link.internal>]]\\n\\n</></><punctuation.definition.list.begin.markdown>;</>d\\n\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>D</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "4. Categories and newlines: newline suppression for last list item should RT properly",
		"wikitext": "*a\n****b\n\n[[Category:Foo]]",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>a\\n<punctuation.definition.list.begin.markdown>****</>b\\n\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "5. Categories and newlines: migrateTrailingCategories dom pass should only run on the rightmost path of nested lists",
		"wikitext": "*a\n**b\n[[Category:Foo]]\n*c\n**d\n[[Category:Foo]]",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>a\\n<punctuation.definition.list.begin.markdown>**</>b\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]\\n</></><punctuation.definition.list.begin.markdown>*</>c\\n<punctuation.definition.list.begin.markdown>**</>d\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "6. Categories and newlines: migrateTrailingCategories dom pass should not migrate categories not preceded by newlines",
		"wikitext": "*a [[Category:Foo]]",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>a <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "7. Categories and newlines: migrateTrailingCategories dom pass should leave template content alone",
		"wikitext": "*{{1x|a\n[[Category:Foo]]}}",
		"parsed": "<punctuation.definition.list.begin.markdown>*</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>a\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "8. Categories and newlines: migrateTrailingCategories dom pass should not get tripped by intervening templates",
		"wikitext": "*a\n\n{{1x|[[Category:Foo]]\n[[Category:Bar]]}}\n[[Category:Baz]]",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>a\\n\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Bar</><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.template>}}\\n</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Baz</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Categories and newlines: migrateTrailingCategories dom pass should not get tripped by comments and whitespace",
		"wikitext": "*a\n\n[[Category:Bar]]<!--boo1--> <!--boo2-->\n[[Category:Baz]]<!--boo3--> <!--boo4-->",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>a\\n\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Bar</><punctuation.definition.tag.link.internal>]]</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</>boo1<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>boo2<punctuation.definition.comment.html>--&gt\\n</></><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Baz</><punctuation.definition.tag.link.internal>]]</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</>boo3<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>boo4<punctuation.definition.comment.html>--&gt</></>"
	},
	{
		"desc": "No regressions on internal links following category (T174639)",
		"wikitext": "[[Category:Foo]]<div>a\n\n[[Foo]]</div>",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>a\\n\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "11. Special case where only newlines separate links (T175416)",
		"wikitext": "[[Category:Foo]]\n\n[[Foo]][[es:Alimento]]\n\n[[Foo]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]][[</><entity.other.attribute-name>es:Alimento</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Category links with multiple namespaces",
		"wikitext": "[[Category:Project:Foo]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Project:Foo</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid: Serialize link to category page with colon escape",
		"wikitext": "[[:Category:Foo]]\n[[:Category:Foo|Bar]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>:Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>:Category:</><entity.other.attribute-name>Foo</><keyword.operator>|</>Bar<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid: Serialize link to file page with colon escape",
		"wikitext": "[[:File:Foo.png]]\n[[:File:Foo.png|Bar]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>:File:</><entity.other.attribute-name>Foo.png</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>:File:</><entity.other.attribute-name>Foo.png</><keyword.operator>|</>Bar<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid: Serialize a genuine category link without colon escape",
		"wikitext": "[[Category:Foo]]\n[[Category:Foo|Bar]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><keyword.operator>|</>Bar<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Normalize hrefs properly before testing for invalid link targets (T72894)",
		"wikitext": "[[Category:Toxine bactÃ©rienne]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Toxine bactÃ©rienne</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Empty templates should be handled properly without being redlinked",
		"wikitext": "{{emptytemplate}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>emptytemplate</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Parsoid: Defaultsort",
		"wikitext": "{{DEFAULTSORT:Foo}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>DEFAULTSORT</><keyword.operator.function>:</>Foo<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Parsoid: Defaultsort variations (T236846)",
		"wikitext": "{{DEFAULTSORT}}\n\n{{DEFAULTSORT:}}\n{{DEFAULTSORT:DOGGIE}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>DEFAULTSORT</><punctuation.definition.tag.template>}}\\n\\n</><punctuation.definition.tag.function>{{</><constant.language.variables.query>DEFAULTSORT</><keyword.operator.function>:</><punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>DEFAULTSORT</><keyword.operator.function>:</>DOGGIE<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Parsoid html2wt b/c check: Defaultsort with key content being added (T236846)",
		"wikitext": "{{DEFAULTSORT:BIRD}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>DEFAULTSORT</><keyword.operator.function>:</>BIRD<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Parsoid: Defaultsort (template-generated)",
		"wikitext": "{{{{1x|DEFAULTSORT}}:Foo}}",
		"parsed": "{{<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>DEFAULTSORT<punctuation.definition.tag.template>}}</>:Foo}}"
	},
	{
		"desc": "{{defaultsort}} should be location-independent (T353530)",
		"wikitext": "[[Category:Foo]]\n{{DEFAULTSORT:Bar}}\n[[Category:Bat]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]\\n</></><punctuation.definition.tag.function>{{</><constant.language.variables.query>DEFAULTSORT</><keyword.operator.function>:</>Bar<punctuation.definition.tag.function>}}\\n</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Bat</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Interlanguage links",
		"wikitext": "[[es:Alimento]]\n[[fr:Nourriture]]\n[[zh:é£Ÿå“]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>es:Alimento</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>fr:Nourriture</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>zh:é£Ÿå“</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Duplicate interlanguage links (T26502)",
		"wikitext": "[[es:1]]\n[[es:2]]\n[[fr:1]]\n[[fr:2]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>es:1</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>es:2</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>fr:1</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>fr:2</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Single-line or multiline-comments can follow headings",
		"wikitext": "==foo==<!---->\n==bar==<!--c1-->\n==baz==<!--\nc2\nc3-->",
		"parsed": "==foo==<comment.block.html><punctuation.definition.comment.html>&lt;!----&gt\\n</></>==bar==<comment.block.html><punctuation.definition.comment.html>&lt;!--</>c1<punctuation.definition.comment.html>--&gt\\n</></>==baz==<comment.block.html><punctuation.definition.comment.html>&lt;!--\\n</>c2\\nc3<punctuation.definition.comment.html>--&gt</></>"
	},
	{
		"desc": "T3186 news: in the middle of text",
		"wikitext": "http://en.wikinews.org/wiki/Wikinews:Workplace",
		"parsed": "http://en.wikinews.org/wiki/Wikinews:Workplace"
	},
	{
		"desc": "Namespaced link must have a title",
		"wikitext": "[[Project:]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Project:</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Namespaced link must have a title (bad fragment version)",
		"wikitext": "[[Project:#fragment]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Project:</><entity.other.attribute-name>#fragment</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "div with no attributes",
		"wikitext": "<div>HTML rocks</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>HTML rocks<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "div with double-quoted attribute",
		"wikitext": "<div id=\"rock\">HTML rocks</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>rock<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>HTML rocks<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "div with single-quoted attribute",
		"wikitext": "<div id='rock'>HTML rocks</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.single.html><punctuation.definition.string.begin.html>'</>rock<punctuation.definition.string.end.html>'</></></><punctuation.definition.tag.end.html>&gt</></>HTML rocks<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "div with unquoted attribute",
		"wikitext": "<div id=rock>HTML rocks</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.unquoted.html>rock</></><punctuation.definition.tag.end.html>&gt</></>HTML rocks<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "div with illegal double attributes",
		"wikitext": "<div id=\"a\" id=\"b\">HTML rocks</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>HTML rocks<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "div with empty attribute value, space before equals",
		"wikitext": "<div class =>HTML rocks</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.class.html><entity.other.attribute-name.html>class</> <punctuation.separator.key-value.html>=</></><punctuation.definition.tag.end.html>&gt</></>HTML rocks<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "div with multiple empty attribute values",
		"wikitext": "<div id= title=>HTML rocks</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</> <string.unquoted.html>title</><invalid.illegal.unexpected-equals-sign.html>=</></><punctuation.definition.tag.end.html>&gt</></>HTML rocks<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Extension tag in attribute value",
		"wikitext": "<span title=\"<html><div>123</div></html>\">ok</span>",
		"parsed": "<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>&lt;html&gt&lt;div&gt123&lt;/div&gt&lt;/html&gt<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>ok<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "table with multiple empty attribute values",
		"wikitext": "{| title= id=\n|hi\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</> <string.unquoted.html>id</><invalid.illegal.unexpected-equals-sign.html>=\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>hi\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "div with braces in attribute value",
		"wikitext": "<div title=\"{}\">Foo</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>{}<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>Foo<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "div with empty attribute value, no space before equals",
		"wikitext": "<div class=>HTML rocks</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</></><punctuation.definition.tag.end.html>&gt</></>HTML rocks<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "HTML multiple attributes correction",
		"wikitext": "<p class=\"error\" class=\"awesome\">Awesome!</p>",
		"parsed": "<meta.tag.structure.p.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>p</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>error<punctuation.definition.string.end.html>\"</></></> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>awesome<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>Awesome!<meta.tag.structure.p.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Table multiple attributes correction",
		"wikitext": "{|\n!+ class=\"error\" class=\"awesome\"|status\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</><meta.attribute.unrecognized.+.html><entity.other.attribute-name.html>+</></> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>error<punctuation.definition.string.end.html>\"</></></> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>awesome<punctuation.definition.string.end.html>\"</></></><keyword.operator>|</><markup.style>status\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "DIV IN UPPERCASE",
		"wikitext": "<DIV ID=\"x\">HTML ROCKS</DIV>",
		"parsed": "<meta.tag.structure.DIV.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>DIV</> <meta.attribute.unrecognized.ID.html><entity.other.attribute-name.html>ID</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>HTML ROCKS<meta.tag.structure.DIV.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>DIV</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Non-ASCII pseudo-tags are rendered as text",
		"wikitext": "<khyÃ´>",
		"parsed": "<meta.tag.other.khyÃ´.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>khyÃ´</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Pseudo-tag with URL 'name' renders as url link",
		"wikitext": "<http://example.com/>",
		"parsed": "<meta.tag.other.http://example.com.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>http://example.com</></><punctuation.definition.tag.end.html>/&gt</></>"
	},
	{
		"desc": "text with amp in the middle of nowhere",
		"wikitext": "Remember AT&T?",
		"parsed": "Remember AT&amp;T?"
	},
	{
		"desc": "text with character entity: eacute",
		"wikitext": "I always thought &eacute; was a cute letter.",
		"parsed": "I always thought <constant.character.entity.named.eacute.html><punctuation.definition.entity.html>&amp;</>eacute<punctuation.definition.entity.html>;</></> was a cute letter."
	},
	{
		"desc": "text with entity-escaped character entity-like string: eacute",
		"wikitext": "I always thought &amp;eacute; was a cute letter.",
		"parsed": "I always thought <constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>eacute; was a cute letter."
	},
	{
		"desc": "text with undefined character entity: xacute",
		"wikitext": "I always thought &xacute; was a cute letter.",
		"parsed": "I always thought <invalid.illegal.ambiguous-ampersand.html>&amp;</>xacute; was a cute letter."
	},
	{
		"desc": "Text with HTML5 semicolon-less entity (should not decode)",
		"wikitext": "&ampamp;",
		"parsed": "<invalid.illegal.ambiguous-ampersand.html>&amp;</>ampamp;"
	},
	{
		"desc": "HTML5 tags",
		"wikitext": "<data value=\"5\">five</data>\n<time datetime=\"2000-01-01T00:00Z\">The new millenium started</time>\n<mark>This highlighted text</mark>",
		"parsed": "<meta.tag.inline.data.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>data</> <meta.attribute.value.html><entity.other.attribute-name.html>value</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>5<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>five<meta.tag.inline.data.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>data</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.time.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>time</> <meta.attribute.datetime.html><entity.other.attribute-name.html>datetime</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>2000-01-01T00:00Z<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>The new millenium started<meta.tag.inline.time.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>time</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.mark.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>mark</><punctuation.definition.tag.end.html>&gt</></>This highlighted text<meta.tag.inline.mark.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>mark</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "HTML tag with leading space is parsed as text",
		"wikitext": "< div>foo< /div>",
		"parsed": "&lt; div&gtfoo&lt; /div&gt"
	},
	{
		"desc": "Element with broken attribute syntax",
		"wikitext": "<div style=\" style=\"123\">hi</div>\n<div =>ho</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css> style=</><punctuation.definition.string.end.html><source.css>\"</></></></></><meta.attribute.unrecognized.123.html><entity.other.attribute-name.html>123</></><invalid.illegal.character-not-allowed-here.html>\"</><punctuation.definition.tag.end.html>&gt</></>hi<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <invalid.illegal.character-not-allowed-here.html>=</><punctuation.definition.tag.end.html>&gt</></>ho<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Ensure that HTML adoption agency algorithm is properly implemented.",
		"wikitext": "<small>X<small>Y</small>Z</small>",
		"parsed": "<meta.tag.inline.small.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt</></>X<meta.tag.inline.small.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt</></>Y<meta.tag.inline.small.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt</></>Z<meta.tag.inline.small.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Nesting of <kbd>",
		"wikitext": "<kbd>X<kbd>Y</kbd>Z</kbd>",
		"parsed": "<meta.tag.inline.kbd.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>kbd</><punctuation.definition.tag.end.html>&gt</></>X<meta.tag.inline.kbd.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>kbd</><punctuation.definition.tag.end.html>&gt</></>Y<meta.tag.inline.kbd.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>kbd</><punctuation.definition.tag.end.html>&gt</></>Z<meta.tag.inline.kbd.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>kbd</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Nesting of <em>",
		"wikitext": "<em>X<em>Y</em>Z</em>",
		"parsed": "<meta.tag.inline.em.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>em</><punctuation.definition.tag.end.html>&gt</></>X<meta.tag.inline.em.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>em</><punctuation.definition.tag.end.html>&gt</></>Y<meta.tag.inline.em.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>em</><punctuation.definition.tag.end.html>&gt</></>Z<meta.tag.inline.em.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>em</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Nesting of <strong>",
		"wikitext": "<strong>X<strong>Y</strong>Z</strong>",
		"parsed": "<meta.tag.inline.strong.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>strong</><punctuation.definition.tag.end.html>&gt</></>X<meta.tag.inline.strong.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>strong</><punctuation.definition.tag.end.html>&gt</></>Y<meta.tag.inline.strong.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>strong</><punctuation.definition.tag.end.html>&gt</></>Z<meta.tag.inline.strong.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>strong</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Nesting of <q>",
		"wikitext": "<q>X<q>Y</q>Z</q>",
		"parsed": "<meta.tag.inline.q.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>q</><punctuation.definition.tag.end.html>&gt</></>X<meta.tag.inline.q.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>q</><punctuation.definition.tag.end.html>&gt</></>Y<meta.tag.inline.q.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>q</><punctuation.definition.tag.end.html>&gt</></>Z<meta.tag.inline.q.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>q</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Nesting of <ruby>",
		"wikitext": "<ruby>X<ruby>Y</ruby>Z</ruby>",
		"parsed": "<meta.tag.inline.ruby.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ruby</><punctuation.definition.tag.end.html>&gt</></>X<meta.tag.inline.ruby.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ruby</><punctuation.definition.tag.end.html>&gt</></>Y<meta.tag.inline.ruby.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ruby</><punctuation.definition.tag.end.html>&gt</></>Z<meta.tag.inline.ruby.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ruby</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Nesting of <bdo>",
		"wikitext": "<bdo>X<bdo>Y</bdo>Z</bdo>",
		"parsed": "<meta.tag.inline.bdo.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>bdo</><punctuation.definition.tag.end.html>&gt</></>X<meta.tag.inline.bdo.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>bdo</><punctuation.definition.tag.end.html>&gt</></>Y<meta.tag.inline.bdo.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>bdo</><punctuation.definition.tag.end.html>&gt</></>Z<meta.tag.inline.bdo.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>bdo</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Media link",
		"wikitext": "[[Media:Foobar.jpg]]\n[[Media:Video.ogv]]\n[[:Media:Video.ogv]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Media:</><entity.other.attribute-name>Foobar.jpg</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>Media:</><entity.other.attribute-name>Video.ogv</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>:Media:</><entity.other.attribute-name>Video.ogv</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Media link with text",
		"wikitext": "[[Media:Foobar.jpg|A neat file to look at]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Media:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>A neat file to look at<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Media link redirect",
		"wikitext": "[[Media:Redirect to foobar.jpg]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Media:</><entity.other.attribute-name>Redirect to foobar.jpg</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Media link with nasty text",
		"wikitext": "[[Media:Foobar.jpg|Safe Link<div style=display:none>\" onmouseover=\"alert(document.cookie)\" onfoo=\"</div>]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Media:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>Safe Link<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.unquoted.html><source.css>display:none</></></></><punctuation.definition.tag.end.html>&gt</></>\" onmouseover=\"alert(document.cookie)\" onfoo=\"<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Media link from missing resource (parsoid-only)",
		"wikitext": "[[Media:Foobar.jpg|Bat!]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Media:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>Bat!<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Media link from old 1.7.0 DOM spec (crash test, parsoid-only) T198511",
		"wikitext": "This is what Parsoid would emit (and we still handle this HTML fine):\n\n[[Media:Foobar.jpg|A neat file to look at]]\n\nBut VisualEditor would mangle the rel attribute, and give us back this:\n\n[http://example.com/images/3/3a/Foobar.jpg A neat file to look at]\n\nBut at least we don't crash when trying to handle the mangled HTML!",
		"parsed": "This is what Parsoid would emit (and we still handle this HTML fine):\\n\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Media:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>A neat file to look at<punctuation.definition.tag.link.internal>]]\\n\\n</></>But VisualEditor would mangle the rel attribute, and give us back this:\\n\\n<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com/images/3/3a/Foobar.jpg</><string.other.link.external.title> A neat file to look at</><punctuation.definition.tag.link.external>]\\n\\n</>But at least we don't crash when trying to handle the mangled HTML!"
	},
	{
		"desc": "Media link to nonexistent file (T3702)",
		"wikitext": "[[Media:No such.jpg]]\n[[Media:No_such file.jpg]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Media:</><entity.other.attribute-name>No such.jpg</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>Media:</><entity.other.attribute-name>No_such file.jpg</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Media link with nested wikilinks",
		"wikitext": "[[Media:Foobar.jpg|[[Test]]]]\n[[Media:Foobar.jpg|[[File:Foobar.jpg]]]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Media:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Test</><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>Media:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Media link with multiple options",
		"wikitext": "[[Media:Foobar.jpg|123|345]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Media:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>123|345<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Character reference normalization in link text (T3938)",
		"wikitext": "[[Main Page|this&that]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</>this&amp;that<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "(T21451) Links should refer to the normalized form.",
		"wikitext": "[[&#xFB2E;]]\n[[&#x5d0;&#x5b7;]]\n[[&#x5d0;Ö·]]\n[[×&#x5b7;]]\n[[×Ö·]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>&amp;#xFB2E;</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>&amp;#x5d0;&amp;#x5b7;</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>&amp;#x5d0;Ö·</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>×&amp;#x5b7;</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>×Ö·</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Empty attribute crash test (T4067)",
		"wikitext": "<font color=\"\">foo</font>",
		"parsed": "<meta.tag.inline.font.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.deprecated.html>font</></> <meta.attribute.color.html><entity.other.attribute-name.html>color</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.inline.font.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.deprecated.html>font</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Empty attribute crash test single-quotes (T4067)",
		"wikitext": "<font color=''>foo</font>",
		"parsed": "<meta.tag.inline.font.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.deprecated.html>font</></> <meta.attribute.color.html><entity.other.attribute-name.html>color</><punctuation.separator.key-value.html>=</><string.quoted.single.html><punctuation.definition.string.begin.html>'</><punctuation.definition.string.end.html>'</></></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.inline.font.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.deprecated.html>font</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Attribute test: equals, then nothing",
		"wikitext": "<font color=>foo</font>",
		"parsed": "<meta.tag.inline.font.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.deprecated.html>font</></> <meta.attribute.color.html><entity.other.attribute-name.html>color</><punctuation.separator.key-value.html>=</></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.inline.font.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.deprecated.html>font</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Attribute test: unquoted value",
		"wikitext": "<font color=x>foo</font>",
		"parsed": "<meta.tag.inline.font.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.deprecated.html>font</></> <meta.attribute.color.html><entity.other.attribute-name.html>color</><punctuation.separator.key-value.html>=</><string.unquoted.html>x</></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.inline.font.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.deprecated.html>font</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Attribute test: unquoted but illegal value (hash)",
		"wikitext": "<font color=#x>foo</font>",
		"parsed": "<meta.tag.inline.font.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.deprecated.html>font</></> <meta.attribute.color.html><entity.other.attribute-name.html>color</><punctuation.separator.key-value.html>=</><string.unquoted.html>#x</></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.inline.font.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.deprecated.html>font</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Attribute test: no value (T54330)",
		"wikitext": "<font color>foo</font>",
		"parsed": "<meta.tag.inline.font.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.deprecated.html>font</></> <meta.attribute.color.html><entity.other.attribute-name.html>color</></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.inline.font.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.deprecated.html>font</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T4095: link with three closing brackets",
		"wikitext": "[[Main Page]]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</></>]"
	},
	{
		"desc": "T4095: link with pipe and three closing brackets",
		"wikitext": "[[Main Page|link]]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</>link<punctuation.definition.tag.link.internal>]]</></>]"
	},
	{
		"desc": "T4095: link with pipe and three closing brackets, version 2",
		"wikitext": "[[Main Page|[http://example.com/]]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</><punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com/</><punctuation.definition.tag.link.external>]</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T4304: HTML attribute safety (safe template; regression T4309)",
		"wikitext": "<div title=\"{{test}}\"></div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>{{test}}<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T4304: HTML attribute safety (dangerous template; 2309)",
		"wikitext": "<div title=\"{{dangerous attribute}}\"></div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>{{dangerous attribute}}<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T4304: HTML attribute safety (dangerous style template; 2309)",
		"wikitext": "<div style=\"{{dangerous style attribute}}\"></div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>{{dangerous style attribute}}</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T4304: HTML attribute safety (safe parameter; 2309)",
		"wikitext": "{{div style|width: 200px}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>div style</><keyword.operator>|</>width: 200px<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "T4304: HTML attribute safety (unsafe parameter; 2309)",
		"wikitext": "{{div style|width: expression(alert(document.cookie))}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>div style</><keyword.operator>|</>width: expression(alert(document.cookie))<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "T4304: HTML attribute safety (unsafe breakout parameter; 2309)",
		"wikitext": "{{div style|\"><script>alert(document.cookie)</script>}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>div style</><keyword.operator>|</>\"&gt<meta.embedded.block.html><meta.tag.metadata.script.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>script</><punctuation.definition.tag.end.html>&gt</></><source.js><meta.function-call.js><entity.name.function.js>alert</></><meta.brace.round.js>(</><variable.other.object.js>document</><punctuation.accessor.js>.</><variable.other.property.js>cookie</><meta.brace.round.js>)</></><meta.tag.metadata.script.end.html><punctuation.definition.tag.begin.html><source.js-ignored-vscode>&lt;</>/</><entity.name.tag.html>script</><punctuation.definition.tag.end.html>&gt</></></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "T4304: HTML attribute safety (unsafe breakout parameter 2; 2309)",
		"wikitext": "{{div style|\" ><script>alert(document.cookie)</script>}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>div style</><keyword.operator>|</>\" &gt<meta.embedded.block.html><meta.tag.metadata.script.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>script</><punctuation.definition.tag.end.html>&gt</></><source.js><meta.function-call.js><entity.name.function.js>alert</></><meta.brace.round.js>(</><variable.other.object.js>document</><punctuation.accessor.js>.</><variable.other.property.js>cookie</><meta.brace.round.js>)</></><meta.tag.metadata.script.end.html><punctuation.definition.tag.begin.html><source.js-ignored-vscode>&lt;</>/</><entity.name.tag.html>script</><punctuation.definition.tag.end.html>&gt</></></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "T4304: HTML attribute safety (link)",
		"wikitext": "<div title=\"[[Main Page]]\"></div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>[[Main Page]]<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T4304: HTML attribute safety (italics)",
		"wikitext": "<div title=\"''foobar''\"></div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>''foobar''<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T4304: HTML attribute safety (bold)",
		"wikitext": "<div title=\"'''foobar'''\"></div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>'''foobar'''<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T4304: HTML attribute safety (ISBN)",
		"wikitext": "<div title=\"ISBN 1234567890\"></div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>ISBN 1234567890<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T4304: HTML attribute safety (RFC)",
		"wikitext": "<div title=\"RFC 1234\"></div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>RFC 1234<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T4304: HTML attribute safety (PMID)",
		"wikitext": "<div title=\"PMID 1234567890\"></div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>PMID 1234567890<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T4304: HTML attribute safety (web link)",
		"wikitext": "<div title=\"http://example.com/\"></div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>http://example.com/<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T4304: HTML attribute safety (named web link)",
		"wikitext": "<div title=\"[http://example.com/ link]\"></div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>[http://example.com/ link]<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T5244: HTML attribute safety (extension; safe)",
		"wikitext": "<div style=\"<nowiki>background:blue</nowiki>\"></div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>&lt;nowiki&gtbackground:blue&lt;/nowiki&gt</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T5244: HTML attribute safety (extension; unsafe)",
		"wikitext": "<div style=\"<nowiki>border-left:expression(alert(document.cookie))</nowiki>\"></div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>&lt;nowiki&gtborder-left:expression(alert(document.cookie))&lt;/nowiki&gt</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "MSIE CSS safety test: spurious slash",
		"wikitext": "<div style=\"background-image:u\\rl(javascript:alert('boo'))\">evil</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>background-image:u\\rl(javascript:alert('boo'))</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>evil<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "MSIE CSS safety test: hex code",
		"wikitext": "<div style=\"background-image:u\\72l(javascript:alert('boo'))\">evil</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>background-image:u\\72l(javascript:alert('boo'))</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>evil<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "MSIE CSS safety test: comment in url",
		"wikitext": "<div style=\"background-image:u/**/rl(javascript:alert('boo'))\">evil</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>background-image:u/**/rl(javascript:alert('boo'))</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>evil<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "MSIE CSS safety test: comment in expression",
		"wikitext": "<div style=\"background-image:expres/**/sion(alert('boo4'))\">evil4</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>background-image:expres/**/sion(alert('boo4'))</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>evil4<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "CSS safety test (all browsers): vertical tab (T57332 / CVE-2013-4567)",
		"wikitext": "<p style=\"font-size: 100px; background-image:url\\b(https://www.google.com/images/srpr/logo6w.png)\">A</p>",
		"parsed": "<meta.tag.structure.p.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>p</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>font-size: 100px; background-image:url\\b(https://www.google.com/images/srpr/logo6w.png)</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>A<meta.tag.structure.p.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Opera -o-link CSS",
		"wikitext": "<div\ntitle=\"&#100;&#97;&#116;&#97;&#58;&#116;&#101;&#120;&#116;&#47;&#104;&#116;&#109;&#108;&#44;&#60;&#105;&#109;&#103;&#32;&#115;&#114;&#99;&#61;&#49;&#32;&#111;&#110;&#101;&#114;&#114;&#111;&#114;&#61;&#97;&#108;&#101;&#114;&#116;&#40;&#49;&#41;&#62;\"\nstyle=\"-o-link:attr(title);-o-link-source:current\">X</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div\\n</><meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#100;<punctuation.definition.entity.html>&amp;</>#97;<punctuation.definition.entity.html>&amp;</>#116;<punctuation.definition.entity.html>&amp;</>#97;<punctuation.definition.entity.html>&amp;</>#58;<punctuation.definition.entity.html>&amp;</>#116;<punctuation.definition.entity.html>&amp;</>#101;<punctuation.definition.entity.html>&amp;</>#120;<punctuation.definition.entity.html>&amp;</>#116;<punctuation.definition.entity.html>&amp;</>#47;<punctuation.definition.entity.html>&amp;</>#104;<punctuation.definition.entity.html>&amp;</>#116;<punctuation.definition.entity.html>&amp;</>#109;<punctuation.definition.entity.html>&amp;</>#108;<punctuation.definition.entity.html>&amp;</>#44;<punctuation.definition.entity.html>&amp;</>#60;<punctuation.definition.entity.html>&amp;</>#105;<punctuation.definition.entity.html>&amp;</>#109;<punctuation.definition.entity.html>&amp;</>#103;<punctuation.definition.entity.html>&amp;</>#32;<punctuation.definition.entity.html>&amp;</>#115;<punctuation.definition.entity.html>&amp;</>#114;<punctuation.definition.entity.html>&amp;</>#99;<punctuation.definition.entity.html>&amp;</>#61;<punctuation.definition.entity.html>&amp;</>#49;<punctuation.definition.entity.html>&amp;</>#32;<punctuation.definition.entity.html>&amp;</>#111;<punctuation.definition.entity.html>&amp;</>#110;<punctuation.definition.entity.html>&amp;</>#101;<punctuation.definition.entity.html>&amp;</>#114;<punctuation.definition.entity.html>&amp;</>#114;<punctuation.definition.entity.html>&amp;</>#111;<punctuation.definition.entity.html>&amp;</>#114;<punctuation.definition.entity.html>&amp;</>#61;<punctuation.definition.entity.html>&amp;</>#97;<punctuation.definition.entity.html>&amp;</>#108;<punctuation.definition.entity.html>&amp;</>#101;<punctuation.definition.entity.html>&amp;</>#114;<punctuation.definition.entity.html>&amp;</>#116;<punctuation.definition.entity.html>&amp;</>#40;<punctuation.definition.entity.html>&amp;</>#49;<punctuation.definition.entity.html>&amp;</>#41;<punctuation.definition.entity.html>&amp;</>#62;</><punctuation.definition.string.end.html>\"\\n</></></><meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>-o-link:attr(title);-o-link-source:current</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>X<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Table attribute legitimate extension",
		"wikitext": "{|\n!+ style=\"<nowiki>color:blue</nowiki>\"|status\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</><meta.attribute.unrecognized.+.html><entity.other.attribute-name.html>+</></> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>&lt;nowiki&gtcolor:blue&lt;/nowiki&gt</><punctuation.definition.string.end.html><source.css>\"</></></></></><keyword.operator>|</><markup.style>status\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Table attribute safety",
		"wikitext": "{|\n!+ style=\"<nowiki>border-width:expression(0+alert(document.cookie))</nowiki>\"|status\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</><meta.attribute.unrecognized.+.html><entity.other.attribute-name.html>+</></> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>&lt;nowiki&gtborder-width:expression(0+alert(document.cookie))&lt;/nowiki&gt</><punctuation.definition.string.end.html><source.css>\"</></></></></><keyword.operator>|</><markup.style>status\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "CSS line continuation 1",
		"wikitext": "<div style=\"background-image: u\\&#10;rl(test.jpg);\"></div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>background-image: u\\<constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#10;</>rl(test.jpg);</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "CSS line continuation 2",
		"wikitext": "<div style=\"background-image: u\\&#13;rl(test.jpg); \"></div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>background-image: u\\<constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#13;</>rl(test.jpg); </><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Allow aria attributes",
		"wikitext": "<span aria-describedby=\"id1\" aria-flowto=\"id2\" aria-hidden=\"true\" aria-label=\"id3\" aria-labelledby=\"id4\" aria-level=\"3\" aria-owns=\"id5\">foo</span>\n<span aria-bogus=\"stripped\">bar</span>",
		"parsed": "<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.unrecognized.aria-describedby.html><entity.other.attribute-name.html>aria-describedby</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>id1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.aria-flowto.html><entity.other.attribute-name.html>aria-flowto</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>id2<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.aria-hidden.html><entity.other.attribute-name.html>aria-hidden</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>true<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.aria-label.html><entity.other.attribute-name.html>aria-label</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>id3<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.aria-labelledby.html><entity.other.attribute-name.html>aria-labelledby</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>id4<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.aria-level.html><entity.other.attribute-name.html>aria-level</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>3<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.aria-owns.html><entity.other.attribute-name.html>aria-owns</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>id5<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.unrecognized.aria-bogus.html><entity.other.attribute-name.html>aria-bogus</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>stripped<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>bar<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Expansion of multi-line templates in attribute values (T8255)",
		"wikitext": "<div style=\"background: {{1x|#00FF00}}\">-</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>background: {{1x|#00FF00}}</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>-<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Expansion of multi-line parser-functions in attribute values (T8255)",
		"wikitext": "<div style=\"background: {{#if:1|#00FF00|#FF00FF}}\">-</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>background: {{#if:1|#00FF00|#FF00FF}}</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>-<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Expansion of multi-line templates in attribute values (T8255 check)",
		"wikitext": "<div style=\"background:\n#00FF00\">-</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>background:\\n#00FF00</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>-<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Expansion of multi-line templates in attribute values (T8255 check 2)",
		"wikitext": "<div style=\"background: &#10;#00FF00\">-</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>background: <constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#10;</>#00FF00</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>-<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Tags which are hidden from tidiers cannot pass through the Sanitizer",
		"wikitext": "<mw:editsection><script>alert();</script></mw:editsection>\n\n<meta property=\"mw:PageProp/toc\" />",
		"parsed": "<meta.tag.other.mw:editsection.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>mw:editsection</></><punctuation.definition.tag.end.html>&gt</></><meta.embedded.block.html><meta.tag.metadata.script.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>script</><punctuation.definition.tag.end.html>&gt</></><source.js><meta.function-call.js><entity.name.function.js>alert</></><meta.brace.round.js>()</><punctuation.terminator.statement.js>;</></><meta.tag.metadata.script.end.html><punctuation.definition.tag.begin.html><source.js-ignored-vscode>&lt;</>/</><entity.name.tag.html>script</><punctuation.definition.tag.end.html>&gt</></></><meta.tag.other.mw:editsection.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>mw:editsection</></><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.metadata.meta.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>meta</> <meta.attribute.unrecognized.property.html><entity.other.attribute-name.html>property</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>mw:PageProp/toc<punctuation.definition.string.end.html>\"</></></> <punctuation.definition.tag.end.html>/&gt</></>"
	},
	{
		"desc": "Nested template calls",
		"wikitext": "{{Map-one-parameter|One-parameter|param}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Map-one-parameter</><keyword.operator>|</>One-parameter<keyword.operator>|</>param<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Sanitizer: Closing of open tags",
		"wikitext": "<s></s><table></table>",
		"parsed": "<meta.tag.inline.s.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>s</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.s.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>s</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Sanitizer: Closing of open but not closed tags",
		"wikitext": "<s>foo",
		"parsed": "<meta.tag.inline.s.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>s</><punctuation.definition.tag.end.html>&gt</></>foo"
	},
	{
		"desc": "Sanitizer: Closing of closed but not open tags",
		"wikitext": "</s>",
		"parsed": "<meta.tag.inline.s.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>s</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Sanitizer: Closing of closed but not open table tags",
		"wikitext": "Table not started</td></tr></table>",
		"parsed": "Table not started<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Sanitizer: Escaping of spaces, multibyte characters, colons & other stuff in id=\"\"",
		"wikitext": "<span id=\"Ã¦: v\">byte</span>[[#Ã¦: v|backlink]]",
		"parsed": "<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>Ã¦: v<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>byte<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#Ã¦: v</><keyword.operator>|</>backlink<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Sanitizer: Escaping of spaces, multibyte characters, colons & other stuff in id=\"\" (legacy)",
		"wikitext": "<span id=\"Ã¦: v\">byte</span>[[#Ã¦: v|backlink]]",
		"parsed": "<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>Ã¦: v<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>byte<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#Ã¦: v</><keyword.operator>|</>backlink<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Sanitizer: Validating the contents of the id attribute (T6515)",
		"wikitext": "<br id=\"\" /><br id=\"a space\" />",
		"parsed": "<meta.tag.inline.br.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>br</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><punctuation.definition.string.end.html>\"</></></> <punctuation.definition.tag.end.html>/&gt</><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>br</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a space<punctuation.definition.string.end.html>\"</></></> <punctuation.definition.tag.end.html>/&gt</></>"
	},
	{
		"desc": "Sanitizer: Validating id attribute uniqueness (T6515, T8301)",
		"wikitext": "<br id=\"foo\" /><br id=\"foo\" />",
		"parsed": "<meta.tag.inline.br.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>br</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></> <punctuation.definition.tag.end.html>/&gt</><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>br</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></> <punctuation.definition.tag.end.html>/&gt</></>"
	},
	{
		"desc": "Sanitizer: Validating that <meta> and <link> work, but only for Microdata",
		"wikitext": "<div itemscope>\n\t<meta itemprop=\"hello\" content=\"world\">\n\t<meta http-equiv=\"refresh\" content=\"5\">\n\t<meta itemprop=\"hello\" http-equiv=\"refresh\" content=\"5\">\n\t<link itemprop=\"hello\" href=\"{{SERVER}}\">\n\t<link rel=\"stylesheet\" href=\"{{SERVER}}\">\n\t<link rel=\"stylesheet\" itemprop=\"hello\" href=\"{{SERVER}}\">\n</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.itemscope.html><entity.other.attribute-name.html>itemscope</></><punctuation.definition.tag.end.html>&gt\\n</></>\t<meta.tag.metadata.meta.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>meta</> <meta.attribute.itemprop.html><entity.other.attribute-name.html>itemprop</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>hello<punctuation.definition.string.end.html>\"</></></> <meta.attribute.content.html><entity.other.attribute-name.html>content</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>world<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt\\n</></>\t<meta.tag.metadata.meta.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>meta</> <meta.attribute.http-equiv.html><entity.other.attribute-name.html>http-equiv</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>refresh<punctuation.definition.string.end.html>\"</></></> <meta.attribute.content.html><entity.other.attribute-name.html>content</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>5<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt\\n</></>\t<meta.tag.metadata.meta.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>meta</> <meta.attribute.itemprop.html><entity.other.attribute-name.html>itemprop</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>hello<punctuation.definition.string.end.html>\"</></></> <meta.attribute.http-equiv.html><entity.other.attribute-name.html>http-equiv</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>refresh<punctuation.definition.string.end.html>\"</></></> <meta.attribute.content.html><entity.other.attribute-name.html>content</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>5<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt\\n</></>\t<meta.tag.metadata.link.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>link</> <meta.attribute.itemprop.html><entity.other.attribute-name.html>itemprop</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>hello<punctuation.definition.string.end.html>\"</></></> <meta.attribute.href.html><entity.other.attribute-name.html>href</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>{{SERVER}}<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt\\n</></>\t<meta.tag.metadata.link.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>link</> <meta.attribute.rel.html><entity.other.attribute-name.html>rel</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>stylesheet<punctuation.definition.string.end.html>\"</></></> <meta.attribute.href.html><entity.other.attribute-name.html>href</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>{{SERVER}}<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt\\n</></>\t<meta.tag.metadata.link.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>link</> <meta.attribute.rel.html><entity.other.attribute-name.html>rel</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>stylesheet<punctuation.definition.string.end.html>\"</></></> <meta.attribute.itemprop.html><entity.other.attribute-name.html>itemprop</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>hello<punctuation.definition.string.end.html>\"</></></> <meta.attribute.href.html><entity.other.attribute-name.html>href</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>{{SERVER}}<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Sanitizer: Strip comments from CSS attributes",
		"wikitext": "<span style=\"margin:/*negate mbox-text padding */-0.125em -0.45em; /*rainbow*/rgba(255, 0, 0, 0.3)\">2013</span>",
		"parsed": "<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>margin:/*negate mbox-text padding */-0.125em -0.45em; /*rainbow*/rgba(255, 0, 0, 0.3)</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>2013<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Sanitizer: Avoid unnecessary percent encoded characters in interwiki links",
		"wikitext": "[[meatball:Soft\"Security]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>meatball:Soft\"Security</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Sanitizer: angle brackets are invalid, even in interwiki links (T182338)",
		"wikitext": "[[meatball:Foo<Bar]]\n[[meatball:Foo>Bar]]\n[[meatball:Foo&lt;bar]]\n[[meatball:Foo&gt;bar]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>meatball:Foo</>&lt;Bar<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>meatball:Foo</><invalid.deprecated.ineffective>&gt</>Bar<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>meatball:Foo&amp;lt;bar</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>meatball:Foo&amp;gt;bar</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Self closed html pairs (T7487)",
		"wikitext": "<center><font id=\"bug\" />Centered text</center>\n<div><font id=\"bug2\" />In div text</div>",
		"parsed": "<meta.tag.structure.center.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.deprecated.html>center</></><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.font.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.deprecated.html>font</></> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>bug<punctuation.definition.string.end.html>\"</></></> <invalid.illegal.character-not-allowed-here.html>/</><punctuation.definition.tag.end.html>&gt</></>Centered text<meta.tag.structure.center.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.deprecated.html>center</></><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.font.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.deprecated.html>font</></> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>bug2<punctuation.definition.string.end.html>\"</></></> <invalid.illegal.character-not-allowed-here.html>/</><punctuation.definition.tag.end.html>&gt</></>In div text<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Punctuation: nbsp before exclamation",
		"wikitext": "C'est grave !",
		"parsed": "C'est grave !"
	},
	{
		"desc": "Punctuation: CSS !important (T13874)",
		"wikitext": "<div style=\"width:50% !important\">important</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>width:50% !important</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>important<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Punctuation: CSS ! important (T13874; with space after)",
		"wikitext": "<div style=\"width:50% ! important\">important</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>width:50% ! important</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>important<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "HTML bullet list, closed tags (T7497)",
		"wikitext": "<ul>\n<li>One</li>\n<li>Two</li>\n</ul>",
		"parsed": "<meta.tag.structure.ul.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>One<meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>Two<meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.ul.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "HTML bullet list, unclosed tags (T7497)",
		"wikitext": "<ul>\n<li>One\n<li>Two\n</ul>",
		"parsed": "<meta.tag.structure.ul.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>One\\n<meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>Two\\n<meta.tag.structure.ul.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "HTML ordered list, closed tags (T7497)",
		"wikitext": "<ol>\n<li>One</li>\n<li>Two</li>\n</ol>",
		"parsed": "<meta.tag.structure.ol.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ol</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>One<meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>Two<meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.ol.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ol</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "HTML ordered list, unclosed tags (T7497)",
		"wikitext": "<ol>\n<li>One\n<li>Two\n</ol>",
		"parsed": "<meta.tag.structure.ol.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ol</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>One\\n<meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>Two\\n<meta.tag.structure.ol.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ol</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "HTML nested bullet list, closed tags (T7497)",
		"wikitext": "<ul>\n<li>One</li>\n<li>Two:\n<ul>\n<li>Sub-one</li>\n<li>Sub-two</li>\n</ul>\n</li>\n</ul>",
		"parsed": "<meta.tag.structure.ul.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>One<meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>Two:\\n<meta.tag.structure.ul.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>Sub-one<meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>Sub-two<meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.ul.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.ul.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "HTML nested bullet list, open tags (T7497)",
		"wikitext": "<ul>\n<li>One\n<li>Two:\n<ul>\n<li>Sub-one\n<li>Sub-two\n</ul>\n</ul>",
		"parsed": "<meta.tag.structure.ul.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>One\\n<meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>Two:\\n<meta.tag.structure.ul.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>Sub-one\\n<meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>Sub-two\\n<meta.tag.structure.ul.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt\\n</><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "HTML nested ordered list, closed tags (T7497)",
		"wikitext": "<ol>\n<li>One</li>\n<li>Two:\n<ol>\n<li>Sub-one</li>\n<li>Sub-two</li>\n</ol>\n</li>\n</ol>",
		"parsed": "<meta.tag.structure.ol.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ol</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>One<meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>Two:\\n<meta.tag.structure.ol.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ol</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>Sub-one<meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>Sub-two<meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.ol.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ol</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.ol.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ol</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "HTML nested ordered list, open tags (T7497)",
		"wikitext": "<ol>\n<li>One\n<li>Two:\n<ol>\n<li>Sub-one\n<li>Sub-two\n</ol>\n</ol>",
		"parsed": "<meta.tag.structure.ol.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ol</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>One\\n<meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>Two:\\n<meta.tag.structure.ol.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ol</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>Sub-one\\n<meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>Sub-two\\n<meta.tag.structure.ol.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ol</><punctuation.definition.tag.end.html>&gt\\n</><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ol</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "HTML ordered list item with parameters oddity",
		"wikitext": "<ol><li id=\"fragment\">One</li>\n</ol>",
		"parsed": "<meta.tag.structure.ol.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ol</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>fragment<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>One<meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.ol.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ol</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T7918: autonumbering",
		"wikitext": "[http://first/] [http://second] [ftp://ftp]\n\nftp://inlineftp\n\n[mailto:enclosed@mail.tld With target]\n\n[mailto:enclosed@mail.tld]\n\nmailto:inline@mail.tld",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://first/</><punctuation.definition.tag.link.external>]</> <punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://second</><punctuation.definition.tag.link.external>]</> <punctuation.definition.tag.link.external>[</><entity.name.tag.url>ftp://ftp</><punctuation.definition.tag.link.external>]\\n\\n</>ftp://inlineftp\\n\\n<punctuation.definition.tag.link.external>[</><entity.name.tag.url>mailto:enclosed@mail.tld</><string.other.link.external.title> With target</><punctuation.definition.tag.link.external>]\\n\\n[</><entity.name.tag.url>mailto:enclosed@mail.tld</><punctuation.definition.tag.link.external>]\\n\\n</>mailto:inline@mail.tld"
	},
	{
		"desc": "Fuzz testing: Parser13",
		"wikitext": "{| \n| http://a|",
		"parsed": "<meta.tag.block.table><keyword.operator>{|</> \\n<meta.tag.block.td><keyword.operator>|</> <meta.attribute.unrecognized.http:.html><entity.other.attribute-name.html>http:</></><invalid.illegal.character-not-allowed-here.html>//a</><keyword.operator>|</></></>"
	},
	{
		"desc": "Fuzz testing: Parser16",
		"wikitext": "{|\n!https://||||||",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</><markup.style>https://</><keyword.operator>||||||</></></>"
	},
	{
		"desc": "Fuzz testing: Parser21",
		"wikitext": "{|\n!irc://{{ftp://a\" onmouseover=\"alert('hello world');\"\n|",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</><markup.style>irc://<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>ftp://a\" onmouseover=\"alert('hello world');\"\\n</></></><meta.tag.block.td><keyword.operator>|</></></>"
	},
	{
		"desc": "Fuzz testing: Parser22",
		"wikitext": "http://===r:::https://b\n\n{|",
		"parsed": "http://===r:::https://b\\n\\n<meta.tag.block.table><keyword.operator>{|</></>"
	},
	{
		"desc": "Fuzz testing: Parser24 (minimized)",
		"wikitext": "{{<u {{{{[[Sx-->}}",
		"parsed": "{{<meta.tag.inline.u.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>u</> <meta.attribute.unrecognized.{{{{[[Sx--.html><entity.other.attribute-name.html>{{{{[[Sx--</></><punctuation.definition.tag.end.html>&gt</></>}}"
	},
	{
		"desc": "Fuzz testing: Parser24",
		"wikitext": "{|\n{{{|\n<u CLASS=\n| {{{{SSSll!!!!!!!VVVV)]]][[Special:*xxxxxxx--><noinclude>}}}} >\n<br style=\"onmouseover='alert(document.cookie);' \" />\n\nMOVE YOUR MOUSE CURSOR OVER THIS TEXT\n|",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><punctuation.definition.tag.variable>{{{</><variable.parameter><keyword.operator>|\\n</><meta.tag.inline.u.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>u</> <meta.attribute.unrecognized.CLASS.html><entity.other.attribute-name.html>CLASS</><punctuation.separator.key-value.html>=\\n</><string.unquoted.html>|</></> <meta.attribute.unrecognized.{{{{SSSll!!!!!!!VVVV)]]][[Special:*xxxxxxx--.html><entity.other.attribute-name.html>{{{{SSSll!!!!!!!VVVV)]]][[Special:*xxxxxxx--</></><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</></><punctuation.definition.tag.variable>}}}</>} &gt\\n<meta.tag.inline.br.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>br</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>onmouseover='alert(document.cookie);' </><punctuation.definition.string.end.html><source.css>\"</></></></></> <punctuation.definition.tag.end.html>/&gt\\n\\n</></>MOVE YOUR MOUSE CURSOR OVER THIS TEXT\\n<meta.tag.block.td><keyword.operator>|</></></>"
	},
	{
		"desc": "Fuzz testing: Parser25 (T8055)",
		"wikitext": "{{{\n| \n<LI CLASS=||\n >\n}}}blah\" onmouseover=\"alert('hello world');\" align=\"left\"'''MOVE MOUSE CURSOR OVER HERE",
		"parsed": "<punctuation.definition.tag.variable>{{{\\n</><variable.parameter><keyword.operator>|</> \\n<meta.tag.structure.LI.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>LI</> <meta.attribute.unrecognized.CLASS.html><entity.other.attribute-name.html>CLASS</><punctuation.separator.key-value.html>=</><string.unquoted.html>||\\n</></> <punctuation.definition.tag.end.html>&gt\\n</></></><punctuation.definition.tag.variable>}}}</>blah\" onmouseover=\"alert('hello world');\" align=\"left\"<markup.bold>'''</>MOVE MOUSE CURSOR OVER HERE"
	},
	{
		"desc": "Fuzz testing: URL adjacent extension (with space, clean)",
		"wikitext": "http://example.com <nowiki>junk</nowiki>",
		"parsed": "http://example.com <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>junk</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Fuzz testing: URL adjacent extension (no space, dirty; nowiki)",
		"wikitext": "http://example.com<nowiki>junk</nowiki>",
		"parsed": "http://example.com<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>junk</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Fuzz testing: URL adjacent extension (no space, dirty; pre)",
		"wikitext": "http://example.com<pre>junk</pre>",
		"parsed": "http://example.com<punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>junk</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Fuzz testing: encoded newline in generated HTML replacements (T8577)",
		"wikitext": "<pre dir=\"&#10;\"></pre>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#10;</><punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Fuzz testing: encoded newline in generated HTML replacements, html2wt (T8577)",
		"wikitext": "<pre dir=\"\n\"></pre>",
		"parsed": "<meta.tag.structure.pre.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>pre</> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"\\n</><punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.pre.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>pre</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Templates in extension attributes are not expanded",
		"wikitext": "<pre dir=\"{{1x|ltr}}\"></pre>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>{{1x|ltr}}<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Parsing optional HTML elements (T8171)",
		"wikitext": "<table>\n  <tr>\n    <td> Some tabular data</td>\n    <td> More tabular data ...\n    <td> And yet som tabular data</td>\n  </tr>\n</table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt\\n</></>  <meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt\\n</></>    <meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></> Some tabular data<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt\\n</></>    <meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></> More tabular data ...\\n    <meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></> And yet som tabular data<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt\\n</></>  <meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Correct handling of <td>, <tr> (T8171)",
		"wikitext": "<table>\n  <tr>\n    <td> Some tabular data</td>\n    <td> More tabular data ...</td>\n    <td> And yet som tabular data</td>\n  </tr>\n</table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt\\n</></>  <meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt\\n</></>    <meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></> Some tabular data<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt\\n</></>    <meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></> More tabular data ...<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt\\n</></>    <meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></> And yet som tabular data<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt\\n</></>  <meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Parsing crashing regression (fr:JavaScript)",
		"wikitext": "</body></x>",
		"parsed": "<meta.tag.structure.body.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>body</><punctuation.definition.tag.end.html>&gt</></><meta.tag.other.x.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>x</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Inline wiki vs wiki block nesting",
		"wikitext": "'''Bold paragraph\n\nNew wiki paragraph",
		"parsed": "<markup.bold>'''</>Bold paragraph\\n\\nNew wiki paragraph"
	},
	{
		"desc": "Inline HTML vs wiki block nesting",
		"wikitext": "<b>Bold paragraph\n\nNew wiki paragraph",
		"parsed": "<meta.tag.inline.b.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></>Bold paragraph\\n\\nNew wiki paragraph"
	},
	{
		"desc": "Mixing markup for italics and bold",
		"wikitext": "'''bold''''''bold''bolditalics'''''",
		"parsed": "<markup.bold>'''</>bold'<markup.bold.italic>'''''</>bold<markup.italic>''</>bolditalics<markup.bold.italic>'''''</>"
	},
	{
		"desc": "Special page transclusion",
		"wikitext": "{{Special:Prefixindex/Xyzzyx}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Special:Prefixindex/Xyzzyx</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Special page transclusion twice (T7021)",
		"wikitext": "{{Special:Prefixindex/Xyzzyx}}\n{{Special:Prefixindex/Xyzzyx}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Special:Prefixindex/Xyzzyx</><punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>Special:Prefixindex/Xyzzyx</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Transclusion of default MediaWiki message",
		"wikitext": "{{MediaWiki:Mainpage}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>MediaWiki:Mainpage</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Transclusion of nonexistent MediaWiki message",
		"wikitext": "{{MediaWiki:Mainpagexxx}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>MediaWiki:Mainpagexxx</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Transclusion of MediaWiki message with underscore",
		"wikitext": "{{MediaWiki:history_short}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>MediaWiki:history_short</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Transclusion of MediaWiki message with space",
		"wikitext": "{{MediaWiki:history short}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>MediaWiki:history short</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Invalid header with following text",
		"wikitext": "= x = y",
		"parsed": "= x = y"
	},
	{
		"desc": "Section extraction test (section 0)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start\\n<markup.heading>==<string.quoted.other.heading>a</>==\\n===<string.quoted.other.heading>aa</>===\\n====<string.quoted.other.heading>aaa</>====\\n==<string.quoted.other.heading>b</>==\\n===<string.quoted.other.heading>ba</>===\\n===<string.quoted.other.heading>bb</>===\\n====<string.quoted.other.heading>bba</>====\\n===<string.quoted.other.heading>bc</>===\\n==<string.quoted.other.heading>c</>==\\n===<string.quoted.other.heading>ca</>===</>"
	},
	{
		"desc": "Section extraction test (section 1)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start\\n<markup.heading>==<string.quoted.other.heading>a</>==\\n===<string.quoted.other.heading>aa</>===\\n====<string.quoted.other.heading>aaa</>====\\n==<string.quoted.other.heading>b</>==\\n===<string.quoted.other.heading>ba</>===\\n===<string.quoted.other.heading>bb</>===\\n====<string.quoted.other.heading>bba</>====\\n===<string.quoted.other.heading>bc</>===\\n==<string.quoted.other.heading>c</>==\\n===<string.quoted.other.heading>ca</>===</>"
	},
	{
		"desc": "Section extraction test (section 2)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start\\n<markup.heading>==<string.quoted.other.heading>a</>==\\n===<string.quoted.other.heading>aa</>===\\n====<string.quoted.other.heading>aaa</>====\\n==<string.quoted.other.heading>b</>==\\n===<string.quoted.other.heading>ba</>===\\n===<string.quoted.other.heading>bb</>===\\n====<string.quoted.other.heading>bba</>====\\n===<string.quoted.other.heading>bc</>===\\n==<string.quoted.other.heading>c</>==\\n===<string.quoted.other.heading>ca</>===</>"
	},
	{
		"desc": "Section extraction test (section 3)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start\\n<markup.heading>==<string.quoted.other.heading>a</>==\\n===<string.quoted.other.heading>aa</>===\\n====<string.quoted.other.heading>aaa</>====\\n==<string.quoted.other.heading>b</>==\\n===<string.quoted.other.heading>ba</>===\\n===<string.quoted.other.heading>bb</>===\\n====<string.quoted.other.heading>bba</>====\\n===<string.quoted.other.heading>bc</>===\\n==<string.quoted.other.heading>c</>==\\n===<string.quoted.other.heading>ca</>===</>"
	},
	{
		"desc": "Section extraction test (section 4)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start\\n<markup.heading>==<string.quoted.other.heading>a</>==\\n===<string.quoted.other.heading>aa</>===\\n====<string.quoted.other.heading>aaa</>====\\n==<string.quoted.other.heading>b</>==\\n===<string.quoted.other.heading>ba</>===\\n===<string.quoted.other.heading>bb</>===\\n====<string.quoted.other.heading>bba</>====\\n===<string.quoted.other.heading>bc</>===\\n==<string.quoted.other.heading>c</>==\\n===<string.quoted.other.heading>ca</>===</>"
	},
	{
		"desc": "Section extraction test (section 5)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start\\n<markup.heading>==<string.quoted.other.heading>a</>==\\n===<string.quoted.other.heading>aa</>===\\n====<string.quoted.other.heading>aaa</>====\\n==<string.quoted.other.heading>b</>==\\n===<string.quoted.other.heading>ba</>===\\n===<string.quoted.other.heading>bb</>===\\n====<string.quoted.other.heading>bba</>====\\n===<string.quoted.other.heading>bc</>===\\n==<string.quoted.other.heading>c</>==\\n===<string.quoted.other.heading>ca</>===</>"
	},
	{
		"desc": "Section extraction test (section 6)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start\\n<markup.heading>==<string.quoted.other.heading>a</>==\\n===<string.quoted.other.heading>aa</>===\\n====<string.quoted.other.heading>aaa</>====\\n==<string.quoted.other.heading>b</>==\\n===<string.quoted.other.heading>ba</>===\\n===<string.quoted.other.heading>bb</>===\\n====<string.quoted.other.heading>bba</>====\\n===<string.quoted.other.heading>bc</>===\\n==<string.quoted.other.heading>c</>==\\n===<string.quoted.other.heading>ca</>===</>"
	},
	{
		"desc": "Section extraction test (section 7)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start\\n<markup.heading>==<string.quoted.other.heading>a</>==\\n===<string.quoted.other.heading>aa</>===\\n====<string.quoted.other.heading>aaa</>====\\n==<string.quoted.other.heading>b</>==\\n===<string.quoted.other.heading>ba</>===\\n===<string.quoted.other.heading>bb</>===\\n====<string.quoted.other.heading>bba</>====\\n===<string.quoted.other.heading>bc</>===\\n==<string.quoted.other.heading>c</>==\\n===<string.quoted.other.heading>ca</>===</>"
	},
	{
		"desc": "Section extraction test (section 8)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start\\n<markup.heading>==<string.quoted.other.heading>a</>==\\n===<string.quoted.other.heading>aa</>===\\n====<string.quoted.other.heading>aaa</>====\\n==<string.quoted.other.heading>b</>==\\n===<string.quoted.other.heading>ba</>===\\n===<string.quoted.other.heading>bb</>===\\n====<string.quoted.other.heading>bba</>====\\n===<string.quoted.other.heading>bc</>===\\n==<string.quoted.other.heading>c</>==\\n===<string.quoted.other.heading>ca</>===</>"
	},
	{
		"desc": "Section extraction test (section 9)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start\\n<markup.heading>==<string.quoted.other.heading>a</>==\\n===<string.quoted.other.heading>aa</>===\\n====<string.quoted.other.heading>aaa</>====\\n==<string.quoted.other.heading>b</>==\\n===<string.quoted.other.heading>ba</>===\\n===<string.quoted.other.heading>bb</>===\\n====<string.quoted.other.heading>bba</>====\\n===<string.quoted.other.heading>bc</>===\\n==<string.quoted.other.heading>c</>==\\n===<string.quoted.other.heading>ca</>===</>"
	},
	{
		"desc": "Section extraction test (section 10)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start\\n<markup.heading>==<string.quoted.other.heading>a</>==\\n===<string.quoted.other.heading>aa</>===\\n====<string.quoted.other.heading>aaa</>====\\n==<string.quoted.other.heading>b</>==\\n===<string.quoted.other.heading>ba</>===\\n===<string.quoted.other.heading>bb</>===\\n====<string.quoted.other.heading>bba</>====\\n===<string.quoted.other.heading>bc</>===\\n==<string.quoted.other.heading>c</>==\\n===<string.quoted.other.heading>ca</>===</>"
	},
	{
		"desc": "Section extraction test (nonexistent section 11)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start\\n<markup.heading>==<string.quoted.other.heading>a</>==\\n===<string.quoted.other.heading>aa</>===\\n====<string.quoted.other.heading>aaa</>====\\n==<string.quoted.other.heading>b</>==\\n===<string.quoted.other.heading>ba</>===\\n===<string.quoted.other.heading>bb</>===\\n====<string.quoted.other.heading>bba</>====\\n===<string.quoted.other.heading>bc</>===\\n==<string.quoted.other.heading>c</>==\\n===<string.quoted.other.heading>ca</>===</>"
	},
	{
		"desc": "Section extraction test with bogus heading (section 1)",
		"wikitext": "==a==\n==bogus== not a legal section\n==b==",
		"parsed": "<markup.heading>==<string.quoted.other.heading>a</>==\\n</>==bogus== not a legal section\\n<markup.heading>==<string.quoted.other.heading>b</>==</>"
	},
	{
		"desc": "Section extraction test with bogus heading (section 2)",
		"wikitext": "==a==\n==bogus== not a legal section\n==b==",
		"parsed": "<markup.heading>==<string.quoted.other.heading>a</>==\\n</>==bogus== not a legal section\\n<markup.heading>==<string.quoted.other.heading>b</>==</>"
	},
	{
		"desc": "Section extraction test with comment after heading (section 1)",
		"wikitext": "==a==\n==b== <!-- -->\n==c==",
		"parsed": "<markup.heading>==<string.quoted.other.heading>a</>==\\n</>==b== <comment.block.html><punctuation.definition.comment.html>&lt;!--</> <punctuation.definition.comment.html>--&gt\\n</></><markup.heading>==<string.quoted.other.heading>c</>==</>"
	},
	{
		"desc": "Section extraction test with comment after heading (section 2)",
		"wikitext": "==a==\n==b== <!-- -->\n==c==",
		"parsed": "<markup.heading>==<string.quoted.other.heading>a</>==\\n</>==b== <comment.block.html><punctuation.definition.comment.html>&lt;!--</> <punctuation.definition.comment.html>--&gt\\n</></><markup.heading>==<string.quoted.other.heading>c</>==</>"
	},
	{
		"desc": "Section extraction test with bogus <nowiki> heading (section 1)",
		"wikitext": "==a==\n==bogus== <nowiki>not a legal section</nowiki>\n==b==",
		"parsed": "<markup.heading>==<string.quoted.other.heading>a</>==\\n</>==bogus== <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>not a legal section</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n</><markup.heading>==<string.quoted.other.heading>b</>==</>"
	},
	{
		"desc": "Section extraction test with bogus <nowiki> heading (section 2)",
		"wikitext": "==a==\n==bogus== <nowiki>not a legal section</nowiki>\n==b==",
		"parsed": "<markup.heading>==<string.quoted.other.heading>a</>==\\n</>==bogus== <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>not a legal section</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n</><markup.heading>==<string.quoted.other.heading>b</>==</>"
	},
	{
		"desc": "Section extraction prefixed by comment (section 1)",
		"wikitext": "<!-- -->==sec1==\n==sec2==",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</> <punctuation.definition.comment.html>--&gt</></>==sec1==\\n<markup.heading>==<string.quoted.other.heading>sec2</>==</>"
	},
	{
		"desc": "Section extraction prefixed by comment (section 2)",
		"wikitext": "<!-- -->==sec1==\n==sec2==",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</> <punctuation.definition.comment.html>--&gt</></>==sec1==\\n<markup.heading>==<string.quoted.other.heading>sec2</>==</>"
	},
	{
		"desc": "Section extraction, mixed wiki and html (section 1)",
		"wikitext": "<h2>unmarked</h2>\nunmarked\n==1==\none\n==2==\ntwo",
		"parsed": "<meta.tag.structure.h2.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>h2</><punctuation.definition.tag.end.html>&gt</></>unmarked<meta.tag.structure.h2.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>h2</><punctuation.definition.tag.end.html>&gt\\n</></>unmarked\\n<markup.heading>==<string.quoted.other.heading>1</>==\\n</>one\\n<markup.heading>==<string.quoted.other.heading>2</>==\\n</>two"
	},
	{
		"desc": "Section extraction, mixed wiki and html (section 2)",
		"wikitext": "<h2>unmarked</h2>\nunmarked\n==1==\none\n==2==\ntwo",
		"parsed": "<meta.tag.structure.h2.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>h2</><punctuation.definition.tag.end.html>&gt</></>unmarked<meta.tag.structure.h2.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>h2</><punctuation.definition.tag.end.html>&gt\\n</></>unmarked\\n<markup.heading>==<string.quoted.other.heading>1</>==\\n</>one\\n<markup.heading>==<string.quoted.other.heading>2</>==\\n</>two"
	},
	{
		"desc": "Section extraction, heading surrounded by <noinclude>",
		"wikitext": "<noinclude>==unmarked==</noinclude>\n==marked==",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</>==unmarked==<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt\\n</><markup.heading>==<string.quoted.other.heading>marked</>==</>"
	},
	{
		"desc": "Sectiion with all-equals",
		"wikitext": "=== \nThe line above must have a trailing space\n=== <!--\n--> <!-- -->\nBut just in case it doesn't...",
		"parsed": "<markup.heading>=<string.quoted.other.heading>=</>= \\n</>The line above must have a trailing space\\n=== <comment.block.html><punctuation.definition.comment.html>&lt;!--\\n--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</> <punctuation.definition.comment.html>--&gt\\n</></>But just in case it doesn't..."
	},
	{
		"desc": "Section replacement test (section 0)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start\\n<markup.heading>==<string.quoted.other.heading>a</>==\\n===<string.quoted.other.heading>aa</>===\\n====<string.quoted.other.heading>aaa</>====\\n==<string.quoted.other.heading>b</>==\\n===<string.quoted.other.heading>ba</>===\\n===<string.quoted.other.heading>bb</>===\\n====<string.quoted.other.heading>bba</>====\\n===<string.quoted.other.heading>bc</>===\\n==<string.quoted.other.heading>c</>==\\n===<string.quoted.other.heading>ca</>===</>"
	},
	{
		"desc": "Section replacement test (section 1)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start\\n<markup.heading>==<string.quoted.other.heading>a</>==\\n===<string.quoted.other.heading>aa</>===\\n====<string.quoted.other.heading>aaa</>====\\n==<string.quoted.other.heading>b</>==\\n===<string.quoted.other.heading>ba</>===\\n===<string.quoted.other.heading>bb</>===\\n====<string.quoted.other.heading>bba</>====\\n===<string.quoted.other.heading>bc</>===\\n==<string.quoted.other.heading>c</>==\\n===<string.quoted.other.heading>ca</>===</>"
	},
	{
		"desc": "Section replacement test (section 2)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start\\n<markup.heading>==<string.quoted.other.heading>a</>==\\n===<string.quoted.other.heading>aa</>===\\n====<string.quoted.other.heading>aaa</>====\\n==<string.quoted.other.heading>b</>==\\n===<string.quoted.other.heading>ba</>===\\n===<string.quoted.other.heading>bb</>===\\n====<string.quoted.other.heading>bba</>====\\n===<string.quoted.other.heading>bc</>===\\n==<string.quoted.other.heading>c</>==\\n===<string.quoted.other.heading>ca</>===</>"
	},
	{
		"desc": "Section replacement test (section 3)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start\\n<markup.heading>==<string.quoted.other.heading>a</>==\\n===<string.quoted.other.heading>aa</>===\\n====<string.quoted.other.heading>aaa</>====\\n==<string.quoted.other.heading>b</>==\\n===<string.quoted.other.heading>ba</>===\\n===<string.quoted.other.heading>bb</>===\\n====<string.quoted.other.heading>bba</>====\\n===<string.quoted.other.heading>bc</>===\\n==<string.quoted.other.heading>c</>==\\n===<string.quoted.other.heading>ca</>===</>"
	},
	{
		"desc": "Section replacement test (section 4)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start\\n<markup.heading>==<string.quoted.other.heading>a</>==\\n===<string.quoted.other.heading>aa</>===\\n====<string.quoted.other.heading>aaa</>====\\n==<string.quoted.other.heading>b</>==\\n===<string.quoted.other.heading>ba</>===\\n===<string.quoted.other.heading>bb</>===\\n====<string.quoted.other.heading>bba</>====\\n===<string.quoted.other.heading>bc</>===\\n==<string.quoted.other.heading>c</>==\\n===<string.quoted.other.heading>ca</>===</>"
	},
	{
		"desc": "Section replacement test (section 5)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start\\n<markup.heading>==<string.quoted.other.heading>a</>==\\n===<string.quoted.other.heading>aa</>===\\n====<string.quoted.other.heading>aaa</>====\\n==<string.quoted.other.heading>b</>==\\n===<string.quoted.other.heading>ba</>===\\n===<string.quoted.other.heading>bb</>===\\n====<string.quoted.other.heading>bba</>====\\n===<string.quoted.other.heading>bc</>===\\n==<string.quoted.other.heading>c</>==\\n===<string.quoted.other.heading>ca</>===</>"
	},
	{
		"desc": "Section replacement test (section 6)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start\\n<markup.heading>==<string.quoted.other.heading>a</>==\\n===<string.quoted.other.heading>aa</>===\\n====<string.quoted.other.heading>aaa</>====\\n==<string.quoted.other.heading>b</>==\\n===<string.quoted.other.heading>ba</>===\\n===<string.quoted.other.heading>bb</>===\\n====<string.quoted.other.heading>bba</>====\\n===<string.quoted.other.heading>bc</>===\\n==<string.quoted.other.heading>c</>==\\n===<string.quoted.other.heading>ca</>===</>"
	},
	{
		"desc": "Section replacement test (section 7)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start\\n<markup.heading>==<string.quoted.other.heading>a</>==\\n===<string.quoted.other.heading>aa</>===\\n====<string.quoted.other.heading>aaa</>====\\n==<string.quoted.other.heading>b</>==\\n===<string.quoted.other.heading>ba</>===\\n===<string.quoted.other.heading>bb</>===\\n====<string.quoted.other.heading>bba</>====\\n===<string.quoted.other.heading>bc</>===\\n==<string.quoted.other.heading>c</>==\\n===<string.quoted.other.heading>ca</>===</>"
	},
	{
		"desc": "Section replacement test (section 8)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start\\n<markup.heading>==<string.quoted.other.heading>a</>==\\n===<string.quoted.other.heading>aa</>===\\n====<string.quoted.other.heading>aaa</>====\\n==<string.quoted.other.heading>b</>==\\n===<string.quoted.other.heading>ba</>===\\n===<string.quoted.other.heading>bb</>===\\n====<string.quoted.other.heading>bba</>====\\n===<string.quoted.other.heading>bc</>===\\n==<string.quoted.other.heading>c</>==\\n===<string.quoted.other.heading>ca</>===</>"
	},
	{
		"desc": "Section replacement test (section 9)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start\\n<markup.heading>==<string.quoted.other.heading>a</>==\\n===<string.quoted.other.heading>aa</>===\\n====<string.quoted.other.heading>aaa</>====\\n==<string.quoted.other.heading>b</>==\\n===<string.quoted.other.heading>ba</>===\\n===<string.quoted.other.heading>bb</>===\\n====<string.quoted.other.heading>bba</>====\\n===<string.quoted.other.heading>bc</>===\\n==<string.quoted.other.heading>c</>==\\n===<string.quoted.other.heading>ca</>===</>"
	},
	{
		"desc": "Section replacement test (section 10)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start\\n<markup.heading>==<string.quoted.other.heading>a</>==\\n===<string.quoted.other.heading>aa</>===\\n====<string.quoted.other.heading>aaa</>====\\n==<string.quoted.other.heading>b</>==\\n===<string.quoted.other.heading>ba</>===\\n===<string.quoted.other.heading>bb</>===\\n====<string.quoted.other.heading>bba</>====\\n===<string.quoted.other.heading>bc</>===\\n==<string.quoted.other.heading>c</>==\\n===<string.quoted.other.heading>ca</>===</>"
	},
	{
		"desc": "Section replacement test with initial whitespace (T15728)",
		"wikitext": " Preformatted initial line\n==a==\n===a===",
		"parsed": " Preformatted initial line\\n<markup.heading>==<string.quoted.other.heading>a</>==\\n===<string.quoted.other.heading>a</>===</>"
	},
	{
		"desc": "Section extraction, heading followed by pre with 20 spaces (T8398)",
		"wikitext": "==a==\n                    a",
		"parsed": "<markup.heading>==<string.quoted.other.heading>a</>==\\n</>                    a"
	},
	{
		"desc": "Section extraction, heading followed by pre with 19 spaces (T8398 check)",
		"wikitext": "==a==\n                   a",
		"parsed": "<markup.heading>==<string.quoted.other.heading>a</>==\\n</>                   a"
	},
	{
		"desc": "Section extraction, <pre> around bogus header (T12309)",
		"wikitext": "== Section One ==\n<pre>\n=======\n</pre>\n\n== Section Two ==\nstuff",
		"parsed": "<markup.heading>==<string.quoted.other.heading> Section One </>==\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n</><meta.embedded.block.plaintext>=======\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n\\n</><markup.heading>==<string.quoted.other.heading> Section Two </>==\\n</>stuff"
	},
	{
		"desc": "Section replacement, <pre> around bogus header (T12309)",
		"wikitext": "== Section One ==\n<pre>\n=======\n</pre>\n\n== Section Two ==\nstuff",
		"parsed": "<markup.heading>==<string.quoted.other.heading> Section One </>==\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n</><meta.embedded.block.plaintext>=======\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n\\n</><markup.heading>==<string.quoted.other.heading> Section Two </>==\\n</>stuff"
	},
	{
		"desc": "Handling of &#x0A; in URLs",
		"wikitext": "*irc://&#x0A;a",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>irc://<constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#x0A;</>a"
	},
	{
		"desc": "Handling of %0A in URLs",
		"wikitext": "*irc://%0Aa",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>irc://%0Aa"
	},
	{
		"desc": "5 quotes, code coverage +1 line",
		"wikitext": "'''''",
		"parsed": "<markup.bold.italic>'''''</>"
	},
	{
		"desc": "Special:Search page linking.",
		"wikitext": "{{Special:search}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Special:search</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "{{!}} is a magic word",
		"wikitext": "{{!}} is a magic word there and {{!}} is still a magic word here\n| is not a magic word here but {{!}} is still a magic word here",
		"parsed": "<constant.language.variables.metadata>{{!}}</> is a magic word there and <constant.language.variables.metadata>{{!}}</> is still a magic word here\\n| is not a magic word here but <constant.language.variables.metadata>{{!}}</> is still a magic word here"
	},
	{
		"desc": "Single {{!}} in table cell",
		"wikitext": "{|\n| colspan=\"1\" |foo {{!}} bar\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</> <meta.attribute.colspan.html><entity.other.attribute-name.html>colspan</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>1<punctuation.definition.string.end.html>\"</></> </><keyword.operator>|</><markup.style>foo <constant.language.variables.metadata>{{!}}</> bar\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Using {{!}} in wikilinks (T290526)",
		"wikitext": "[[Main Page{{!}}Something else]]\n\n[[{{T290526}}]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><constant.language.variables.metadata>{{!}}</>Something else<punctuation.definition.tag.link.internal>]]\\n\\n[[</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>T290526</><punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Using {{!}} in template arguments (T290526)",
		"wikitext": "{{1x|Main Page{{!}}Something else}}\n\n{{1x|{{T290526}}}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>Main Page<constant.language.variables.metadata>{{!}}</>Something else<punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>T290526</><punctuation.definition.tag.template>}}}}</>"
	},
	{
		"desc": "Using {{!}} in template arguments, part 2 (T290526)",
		"wikitext": "{{ Main Page|Something else }}\n\n{{ {{T290526}} }}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name> Main Page</><keyword.operator>|</>Something else <punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name> </><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>T290526</><punctuation.definition.tag.template>}}</> <punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Say the magic word",
		"wikitext": "*{{PAGENAME}}\n*{{PAGENAMEE}}\n*{{FULLPAGENAME}}\n*{{FULLPAGENAMEE}}\n*{{BASEPAGENAME}}\n*{{BASEPAGENAMEE}}\n*{{SUBPAGENAME}}\n*{{SUBPAGENAMEE}}\n*{{ROOTPAGENAME}}\n*{{ROOTPAGENAMEE}}\n*{{TALKPAGENAME}}\n*{{TALKPAGENAMEE}}\n*{{SUBJECTPAGENAME}}\n*{{SUBJECTPAGENAMEE}}\n*{{NAMESPACEE}}\n*{{NAMESPACE}}\n*{{NAMESPACENUMBER}}\n*{{TALKSPACE}}\n*{{TALKSPACEE}}\n*{{SUBJECTSPACE}}\n*{{SUBJECTSPACEE}}\n*{{Dynamic|{{NUMBEROFUSERS}}|{{NUMBEROFPAGES}}|{{CURRENTVERSION}}|{{CONTENTLANGUAGE}}|{{DIRECTIONMARK}}|{{CURRENTTIMESTAMP}}|{{NUMBEROFARTICLES}}}}",
		"parsed": "<punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{PAGENAME}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{PAGENAMEE}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{FULLPAGENAME}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{FULLPAGENAMEE}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{BASEPAGENAME}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{BASEPAGENAMEE}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{SUBPAGENAME}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{SUBPAGENAMEE}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{ROOTPAGENAME}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{ROOTPAGENAMEE}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{TALKPAGENAME}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{TALKPAGENAMEE}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{SUBJECTPAGENAME}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{SUBJECTPAGENAMEE}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{NAMESPACEE}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{NAMESPACE}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{NAMESPACENUMBER}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{TALKSPACE}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{TALKSPACEE}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{SUBJECTSPACE}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{SUBJECTSPACEE}}\\n</><punctuation.definition.list.begin.markdown>*</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Dynamic</><keyword.operator>|</><constant.language.variables.metadata>{{NUMBEROFUSERS}}</><keyword.operator>|</><constant.language.variables.metadata>{{NUMBEROFPAGES}}</><keyword.operator>|</><constant.language.variables.metadata>{{CURRENTVERSION}}</><keyword.operator>|</><constant.language.variables.metadata>{{CONTENTLANGUAGE}}</><keyword.operator>|</><constant.language.variables.metadata>{{DIRECTIONMARK}}</><keyword.operator>|</><constant.language.variables.metadata>{{CURRENTTIMESTAMP}}</><keyword.operator>|</><constant.language.variables.metadata>{{NUMBEROFARTICLES}}</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "HTML Hex character encoding (spells the word \"JavaScript\")",
		"wikitext": "&#x4A;&#x061;&#x0076;&#x00061;&#x000053;&#x0000063;&#114;&#x0000069;&#00000112;&#x0000000074;",
		"parsed": "<constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#x4A;<punctuation.definition.entity.html>&amp;</>#x061;<punctuation.definition.entity.html>&amp;</>#x0076;<punctuation.definition.entity.html>&amp;</>#x00061;<punctuation.definition.entity.html>&amp;</>#x000053;<punctuation.definition.entity.html>&amp;</>#x0000063;</><constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#114;</><constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#x0000069;</><constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#00000112;</><constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#x0000000074;</>"
	},
	{
		"desc": "HTML Hex character encoding bogus encoding (T28437 regression check)",
		"wikitext": "&#xsee;&#XSEE;",
		"parsed": "&amp;#xsee;&amp;#XSEE;"
	},
	{
		"desc": "HTML Hex character encoding mixed case",
		"wikitext": "&#xEE;&#Xee;",
		"parsed": "<constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#xEE;<punctuation.definition.entity.html>&amp;</>#Xee;</>"
	},
	{
		"desc": "Illegal character references (T106578, T113194)",
		"wikitext": "; Null: &#00;\n; FF: &#xC;\n; CR: &#xD;\n; Control (low): &#8;\n; Control (high): &#x7F; &#x9F;\n; Unsupported legacy: &#128; &#130; &#131; &#150; &#159;\n; Surrogate: &#xD83D;&#xDCA9;\n; Invalid characters: &#xfffe; &#xffff;\n; This is an okay astral character: &#x1F4A9;\n; This is an okay multi-codepoint HTML5 entity: &acE;\n; This are valid wikitext-specific entities: &×¨×œ×; &Ø±Ù„Ù…;\n; Highest valid characters: &#x10fffd; &#x10fffe; &#x10ffff;",
		"parsed": "<punctuation.definition.list.begin.markdown>;</> Null: <constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#00;\\n</><punctuation.definition.list.begin.markdown>;</> FF: <constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#xC;\\n</><punctuation.definition.list.begin.markdown>;</> CR: <constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#xD;\\n</><punctuation.definition.list.begin.markdown>;</> Control (low): <constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#8;\\n</><punctuation.definition.list.begin.markdown>;</> Control (high): <constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#x7F;</> <constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#x9F;\\n</><punctuation.definition.list.begin.markdown>;</> Unsupported legacy: <constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#128;</> <constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#130;</> <constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#131;</> <constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#150;</> <constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#159;\\n</><punctuation.definition.list.begin.markdown>;</> Surrogate: <constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#xD83D;<punctuation.definition.entity.html>&amp;</>#xDCA9;\\n</><punctuation.definition.list.begin.markdown>;</> Invalid characters: <constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#xfffe;</> <constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#xffff;\\n</><punctuation.definition.list.begin.markdown>;</> This is an okay astral character: <constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#x1F4A9;\\n</><punctuation.definition.list.begin.markdown>;</> This is an okay multi-codepoint HTML5 entity: <constant.character.entity.named.acE.html><punctuation.definition.entity.html>&amp;</>acE<punctuation.definition.entity.html>;\\n</></><punctuation.definition.list.begin.markdown>;</> This are valid wikitext-specific entities: &amp;×¨×œ×; &amp;Ø±Ù„Ù…;\\n<punctuation.definition.list.begin.markdown>;</> Highest valid characters: <constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#x10fffd;</> <constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#x10fffe;</> <constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#x10ffff;</>"
	},
	{
		"desc": "ISBN code coverage",
		"wikitext": "ISBN  978-0-1234-56&#x20;789",
		"parsed": "<constant.language.variables.isbn>ISBN  978-0-1234-56</><constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#x20;</>789"
	},
	{
		"desc": "ISBN followed by 5 spaces",
		"wikitext": "ISBN",
		"parsed": "ISBN"
	},
	{
		"desc": "Double ISBN",
		"wikitext": "ISBN ISBN 1234567890",
		"parsed": "ISBN <constant.language.variables.isbn>ISBN 1234567890</>"
	},
	{
		"desc": "ISBN with an X",
		"wikitext": "ISBN 3-462-04561-X\nISBN 3-462-04561-x\nISBN 080442957X\nISBN 080442957x\nISBN 978080442957X\nISBN 978080442957x",
		"parsed": "<constant.language.variables.isbn>ISBN 3-462-04561-X\\nISBN 3-462-04561-x\\nISBN 080442957X\\nISBN 080442957x\\nISBN 978080442957X\\nISBN 978080442957x</>"
	},
	{
		"desc": "ISBN with empty prefix (parsoid test)",
		"wikitext": "ISBN 1234567890",
		"parsed": "<constant.language.variables.isbn>ISBN 1234567890</>"
	},
	{
		"desc": "T24905: <abbr> followed by ISBN followed by </a>",
		"wikitext": "<abbr>(fr)</abbr> ISBN 2753300917 [http://www.example.com example.com]",
		"parsed": "<meta.tag.inline.abbr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>abbr</><punctuation.definition.tag.end.html>&gt</></>(fr)<meta.tag.inline.abbr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>abbr</><punctuation.definition.tag.end.html>&gt</></> <constant.language.variables.isbn>ISBN 2753300917</> <punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.com</><string.other.link.external.title> example.com</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "Double RFC",
		"wikitext": "RFC RFC 1234",
		"parsed": "RFC <constant.language.variables.rfc>RFC 1234</>"
	},
	{
		"desc": "Double RFC with a wiki link",
		"wikitext": "RFC [[RFC 1234]]",
		"parsed": "RFC <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>RFC 1234</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "RFC code coverage",
		"wikitext": "RFC   983&#x20;987",
		"parsed": "<constant.language.variables.rfc>RFC   983</><constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#x20;</>987"
	},
	{
		"desc": "Another italics / bold test",
		"wikitext": " ''' ''x'",
		"parsed": " <markup.bold>'''</> <markup.italic>''</>x'"
	},
	{
		"desc": "dt/dd/dl test",
		"wikitext": ":;;;::",
		"parsed": "<punctuation.definition.list.begin.markdown>:;;;::</>"
	},
	{
		"desc": "[Before] HTML without raw HTML enabled ($wgRawHtml==false)",
		"wikitext": "<html><script>alert(1);</script></html>",
		"parsed": "<meta.tag.structure.html.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>html</><punctuation.definition.tag.end.html>&gt</></><meta.embedded.block.html><meta.tag.metadata.script.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>script</><punctuation.definition.tag.end.html>&gt</></><source.js><meta.function-call.js><entity.name.function.js>alert</></><meta.brace.round.js>(</><constant.numeric.decimal.js>1</><meta.brace.round.js>)</><punctuation.terminator.statement.js>;</></><meta.tag.metadata.script.end.html><punctuation.definition.tag.begin.html><source.js-ignored-vscode>&lt;</>/</><entity.name.tag.html>script</><punctuation.definition.tag.end.html>&gt</></></><meta.tag.structure.html.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>html</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "HTML with raw HTML ($wgRawHtml==true)",
		"wikitext": "<html><script>alert(1);</script></html>",
		"parsed": "<meta.tag.structure.html.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>html</><punctuation.definition.tag.end.html>&gt</></><meta.embedded.block.html><meta.tag.metadata.script.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>script</><punctuation.definition.tag.end.html>&gt</></><source.js><meta.function-call.js><entity.name.function.js>alert</></><meta.brace.round.js>(</><constant.numeric.decimal.js>1</><meta.brace.round.js>)</><punctuation.terminator.statement.js>;</></><meta.tag.metadata.script.end.html><punctuation.definition.tag.begin.html><source.js-ignored-vscode>&lt;</>/</><entity.name.tag.html>script</><punctuation.definition.tag.end.html>&gt</></></><meta.tag.structure.html.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>html</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Empty tag w/ raw HTML ($wgRawHtml==true)",
		"wikitext": "<html />",
		"parsed": "<meta.tag.structure.html.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>html</> <invalid.illegal.character-not-allowed-here.html>/</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Parents of subpages, one level up",
		"wikitext": "[[../|L2]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>../</><keyword.operator>|</>L2<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parents of subpages, one level up, not named",
		"wikitext": "[[../]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>../</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parents of subpages, two levels up",
		"wikitext": "[[../../|L1]]2\n\n[[../../|L1]]l",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>../../</><keyword.operator>|</>L1<punctuation.definition.tag.link.internal>]]</></>2\\n\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>../../</><keyword.operator>|</>L1<punctuation.definition.tag.link.internal>]]</></>l"
	},
	{
		"desc": "Parents of subpages, two levels up, without trailing slash or name.",
		"wikitext": "[[../..]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>../..</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parents of subpages, two levels up, with lots of extra trailing slashes.",
		"wikitext": "[[../../////]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>../../////</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Transclusion of a sibling page (one level up)",
		"wikitext": "{{../L3Sibling}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>../L3Sibling</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Transclusion of a child page",
		"wikitext": "{{/L3Sibling}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>/L3Sibling</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Non-transclusion because of too many up levels",
		"wikitext": "{{../../../../More than parent}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>../../../../More than parent</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Definition list code coverage",
		"wikitext": ";title   :def\n;title :def\n;title:def",
		"parsed": "<punctuation.definition.list.begin.markdown>;</>title   :def\\n<punctuation.definition.list.begin.markdown>;</>title :def\\n<punctuation.definition.list.begin.markdown>;</>title:def"
	},
	{
		"desc": "Don't fall for the self-closing div",
		"wikitext": "<div>hello world</div/>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>hello world<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><invalid.illegal.character-not-allowed-here.html>/</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "MSGNW magic word",
		"wikitext": "{{MSGNW:msg}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>MSGNW</><keyword.operator.function>:</>msg<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "RAW magic word",
		"wikitext": "{{RAW:QUERTY}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>RAW</><keyword.operator.function>:</>QUERTY<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Always escape literal '>' in output, not just after '<'",
		"wikitext": "><>",
		"parsed": "&gt&lt;&gt"
	},
	{
		"desc": "Template caching",
		"wikitext": "{{Test}}\n{{Test}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Test</><punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>Test</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "ISBN with a dummy number",
		"wikitext": "ISBN ---",
		"parsed": "ISBN ---"
	},
	{
		"desc": "ISBN with space-delimited number",
		"wikitext": "ISBN 92 9017 032 8",
		"parsed": "<constant.language.variables.isbn>ISBN 92 9017 032 8</>"
	},
	{
		"desc": "ISBN with multiple spaces, no number",
		"wikitext": "ISBN  foo",
		"parsed": "ISBN  foo"
	},
	{
		"desc": "ISBN length",
		"wikitext": "ISBN 123456789\n\nISBN 1234567890\n\nISBN 12345678901",
		"parsed": "ISBN 123456789\\n\\n<constant.language.variables.isbn>ISBN 1234567890\\n\\nISBN 1234567890</>1"
	},
	{
		"desc": "ISBN with trailing year (T9110)",
		"wikitext": "ISBN 1-234-56789-0 - 2006\n\nISBN 1 234 56789 0 - 2006",
		"parsed": "<constant.language.variables.isbn>ISBN 1-234-56789-0</> - 2006\\n\\n<constant.language.variables.isbn>ISBN 1 234 56789 0</> - 2006"
	},
	{
		"desc": "anchorencode",
		"wikitext": "{{anchorencode:foo barÂ©#%n}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>anchorencode</><keyword.operator.function>:</>foo barÂ©#%n<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "anchorencode (legacy)",
		"wikitext": "{{anchorencode:foo barÂ©#%n}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>anchorencode</><keyword.operator.function>:</>foo barÂ©#%n<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "anchorencode trims spaces",
		"wikitext": "{{anchorencode: __pretty__please__}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>anchorencode</><keyword.operator.function>:</> __pretty__please__<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "anchorencode deals with links",
		"wikitext": "{{anchorencode: [[hello|world]] [[hi]]}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>anchorencode</><keyword.operator.function>:</> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>hello</><keyword.operator>|</>world<punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>hi</><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "anchorencode deals with templates",
		"wikitext": "{{anchorencode: {{Foo}} x}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>anchorencode</><keyword.operator.function>:</> <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Foo</><punctuation.definition.tag.template>}}</> x<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "anchorencode encodes like the TOC generator: (T20431)",
		"wikitext": "===_ +:.3A%3A _ &&amp;]] x===\n{{anchorencode: _ +:.3A%3A _ &&amp;]] x}}\n\n__NOEDITSECTION__",
		"parsed": "<markup.heading>===<string.quoted.other.heading>_ +:.3A%3A _ &amp;<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>]] x</>===\\n</><punctuation.definition.tag.function>{{</><constant.language.variables.query>anchorencode</><keyword.operator.function>:</> _ +:.3A%3A _ &amp;<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>]] x<punctuation.definition.tag.function>}}\\n\\n</><constant.language.behavior>__NOEDITSECTION__</>"
	},
	{
		"desc": "anchorencode encodes like the TOC generator: (T20431) (legacy)",
		"wikitext": "===_ +:.3A%3A&&amp;]]===\n{{anchorencode: _ +:.3A%3A&&amp;]] }}\n__NOEDITSECTION__",
		"parsed": "<markup.heading>===<string.quoted.other.heading>_ +:.3A%3A&amp;<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>]]</>===\\n</><punctuation.definition.tag.function>{{</><constant.language.variables.query>anchorencode</><keyword.operator.function>:</> _ +:.3A%3A&amp;<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>]] <punctuation.definition.tag.function>}}\\n</><constant.language.behavior>__NOEDITSECTION__</>"
	},
	{
		"desc": "T8200: blockquotes and paragraph formatting",
		"wikitext": "<blockquote>\nfoo\n</blockquote>\n\nbar\n\n baz",
		"parsed": "<meta.tag.structure.blockquote.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt\\n</></>foo\\n<meta.tag.structure.blockquote.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt\\n\\n</></>bar\\n\\n baz"
	},
	{
		"desc": "T10293: Use of center tag ruins paragraph formatting",
		"wikitext": "<center>\nfoo\n</center>\n\nbar\n\n baz",
		"parsed": "<meta.tag.structure.center.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.deprecated.html>center</></><punctuation.definition.tag.end.html>&gt\\n</></>foo\\n<meta.tag.structure.center.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.deprecated.html>center</></><punctuation.definition.tag.end.html>&gt\\n\\n</></>bar\\n\\n baz"
	},
	{
		"desc": "Parsing of overlapping (improperly nested) inline html tags",
		"wikitext": "<span><s>x</span></s>",
		"parsed": "<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.s.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>s</><punctuation.definition.tag.end.html>&gt</></>x<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.s.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>s</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T2529: Uncovered bullet",
		"wikitext": "*Foo {{bullet}}",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>Foo <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>bullet</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "T2529: Uncovered bullet in a deeply nested list",
		"wikitext": "*******Foo {{bullet}}",
		"parsed": "<punctuation.definition.list.begin.markdown>*******</>Foo <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>bullet</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "T2529: Uncovered table already at line-start",
		"wikitext": "x\n\n{{table}}\ny",
		"parsed": "x\\n\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table</><punctuation.definition.tag.template>}}\\n</>y"
	},
	{
		"desc": "T2529: Uncovered bullet in parser function result",
		"wikitext": "*Foo{{lc:{{bullet}} }}",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>Foo<punctuation.definition.tag.function>{{</><constant.language.variables.query>lc</><keyword.operator.function>:</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>bullet</><punctuation.definition.tag.template>}}</> <punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "T7678: Double-parsed template argument",
		"wikitext": "{{lc:{{{1}}}|hello}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>lc</><keyword.operator.function>:</><punctuation.definition.tag.variable>{{{</><variable.other>1</><punctuation.definition.tag.variable>}}}</><keyword.operator>|</>hello<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "T7678: Double-parsed template invocation",
		"wikitext": "{{lc:{{paramtest {{!}} param = hello }} }}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>lc</><keyword.operator.function>:</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>paramtest </><constant.language.variables.metadata>{{!}}</> param = hello <punctuation.definition.tag.template>}}</> <punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Paragraphs inside divs (no extra line breaks)",
		"wikitext": "<div>Line one\n\nLine two</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>Line one\\n\\nLine two<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Paragraphs inside divs (extra line break on open)",
		"wikitext": "<div>\nLine one\n\nLine two</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></>Line one\\n\\nLine two<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Paragraphs inside divs (extra line break on close)",
		"wikitext": "<div>Line one\n\nLine two\n</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>Line one\\n\\nLine two\\n<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Paragraphs inside divs (extra line break on open and close)",
		"wikitext": "<div>\nLine one\n\nLine two\n</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></>Line one\\n\\nLine two\\n<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Nesting tags, paragraphs on lines which begin with <div>",
		"wikitext": "<div></div><strong>A\nB</strong>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.strong.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>strong</><punctuation.definition.tag.end.html>&gt</></>A\\nB<meta.tag.inline.strong.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>strong</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T8200: paragraphs inside blockquotes (no extra line breaks)",
		"wikitext": "<blockquote>Line one\n\nLine two</blockquote>",
		"parsed": "<meta.tag.structure.blockquote.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></>Line one\\n\\nLine two<meta.tag.structure.blockquote.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T8200: paragraphs inside blockquotes (extra line break on open)",
		"wikitext": "<blockquote>\nLine one\n\nLine two</blockquote>",
		"parsed": "<meta.tag.structure.blockquote.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt\\n</></>Line one\\n\\nLine two<meta.tag.structure.blockquote.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T8200: paragraphs inside blockquotes (extra line break on close)",
		"wikitext": "<blockquote>Line one\n\nLine two\n</blockquote>",
		"parsed": "<meta.tag.structure.blockquote.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></>Line one\\n\\nLine two\\n<meta.tag.structure.blockquote.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T8200: paragraphs inside blockquotes (extra line break on open and close)",
		"wikitext": "<blockquote>\nLine one\n\nLine two\n</blockquote>",
		"parsed": "<meta.tag.structure.blockquote.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt\\n</></>Line one\\n\\nLine two\\n<meta.tag.structure.blockquote.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Paragraphs inside blockquotes/divs (no extra line breaks)",
		"wikitext": "<blockquote><div>Line one\n\nLine two</div></blockquote>",
		"parsed": "<meta.tag.structure.blockquote.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>Line one\\n\\nLine two<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.blockquote.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Paragraphs inside blockquotes/divs (extra line break on open)",
		"wikitext": "<blockquote><div>\nLine one\n\nLine two</div></blockquote>",
		"parsed": "<meta.tag.structure.blockquote.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></>Line one\\n\\nLine two<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.blockquote.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Paragraphs inside blockquotes/divs (extra line break on close)",
		"wikitext": "<blockquote><div>Line one\n\nLine two\n</div></blockquote>",
		"parsed": "<meta.tag.structure.blockquote.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>Line one\\n\\nLine two\\n<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.blockquote.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Paragraphs inside blockquotes/divs (extra line break on open and close)",
		"wikitext": "<blockquote><div>\nLine one\n\nLine two\n</div></blockquote>",
		"parsed": "<meta.tag.structure.blockquote.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></>Line one\\n\\nLine two\\n<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.blockquote.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Interwiki links trounced by handleExternalLinks after early LinkHolderArray expansion",
		"wikitext": "[[meatball:1]]\n[[meatball:2]]\n[[meatball:3]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>meatball:1</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>meatball:2</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>meatball:3</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Multibyte character in padleft",
		"wikitext": "{{padleft:-Hello|7|Ã†}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>padleft</><keyword.operator.function>:</>-Hello<keyword.operator>|</>7<keyword.operator>|</>Ã†<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Multibyte character in padright",
		"wikitext": "{{padright:Hello-|7|Ã†}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>padright</><keyword.operator.function>:</>Hello-<keyword.operator>|</>7<keyword.operator>|</>Ã†<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "formatdate parser function",
		"wikitext": "{{#formatdate:2009-03-24}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#formatdate</><keyword.operator.function>:</>2009-03-24<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "formatdate parser function, with default format",
		"wikitext": "{{#formatdate:2009-03-24|mdy}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#formatdate</><keyword.operator.function>:</>2009-03-24<keyword.operator>|</>mdy<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Spacing of numbers in formatted dates",
		"wikitext": "{{#formatdate:January 15}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#formatdate</><keyword.operator.function>:</>January 15<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "formatdate with invalid month",
		"wikitext": "{{#formatdate:2019-22-22|dmy}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#formatdate</><keyword.operator.function>:</>2019-22-22<keyword.operator>|</>dmy<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "formatdate uses correct capitalisation in English",
		"wikitext": "{{#formatdate:june 3|dmy}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#formatdate</><keyword.operator.function>:</>june 3<keyword.operator>|</>dmy<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "formatdate formats ISO year 0 as 1 BC",
		"wikitext": "{{#formatdate:-0001-12-31|mdy}}\n{{#formatdate:0000-12-31|mdy}}\n{{#formatdate:0001-12-31|mdy}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#formatdate</><keyword.operator.function>:</>-0001-12-31<keyword.operator>|</>mdy<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#formatdate</><keyword.operator.function>:</>0000-12-31<keyword.operator>|</>mdy<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#formatdate</><keyword.operator.function>:</>0001-12-31<keyword.operator>|</>mdy<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Edit comment with link",
		"wikitext": "I like the [[Main Page]] a lot",
		"parsed": "I like the <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</></> a lot"
	},
	{
		"desc": "Edit comment with link and link text",
		"wikitext": "I like the [[Main Page|best pages]] a lot",
		"parsed": "I like the <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</>best pages<punctuation.definition.tag.link.internal>]]</></> a lot"
	},
	{
		"desc": "Edit comment with link and link text with suffix",
		"wikitext": "I like the [[Main Page|best page]]s a lot",
		"parsed": "I like the <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</>best page<punctuation.definition.tag.link.internal>]]</></>s a lot"
	},
	{
		"desc": "Edit comment with section link (non-local, eg in history list)",
		"wikitext": "/* External links */ removed bogus entries",
		"parsed": "/* External links */ removed bogus entries"
	},
	{
		"desc": "Edit comment with section link and text before it (non-local, eg in history list)",
		"wikitext": "pre-comment text /* External links */ removed bogus entries",
		"parsed": "pre-comment text /* External links */ removed bogus entries"
	},
	{
		"desc": "Edit comment with section link (local, eg in diff view)",
		"wikitext": "/* External links */ removed bogus entries",
		"parsed": "/* External links */ removed bogus entries"
	},
	{
		"desc": "Edit comment with section link that has a link in it",
		"wikitext": "/* [[A link]] */",
		"parsed": "/* <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>A link</><punctuation.definition.tag.link.internal>]]</></> */"
	},
	{
		"desc": "Edit comment with section link that has a template in it",
		"wikitext": "/* {{foobar|param}} */",
		"parsed": "/* <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>foobar</><keyword.operator>|</>param<punctuation.definition.tag.template>}}</> */"
	},
	{
		"desc": "Edit comment with subpage link (T16080)",
		"wikitext": "Poked at a [[/subpage]] here...",
		"parsed": "Poked at a <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>/subpage</><punctuation.definition.tag.link.internal>]]</></> here..."
	},
	{
		"desc": "Edit comment with subpage link and link text (T16080)",
		"wikitext": "Poked at a [[/subpage|neat little page]] here...",
		"parsed": "Poked at a <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>/subpage</><keyword.operator>|</>neat little page<punctuation.definition.tag.link.internal>]]</></> here..."
	},
	{
		"desc": "Edit comment with bogus subpage link in non-subpage NS (T16080)",
		"wikitext": "Poked at a [[/subpage]] here...",
		"parsed": "Poked at a <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>/subpage</><punctuation.definition.tag.link.internal>]]</></> here..."
	},
	{
		"desc": "Edit comment with bare anchor link (local, as on diff)",
		"wikitext": "[[#section]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#section</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Edit comment with bare anchor link (non-local, as on history)",
		"wikitext": "[[#section]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#section</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Anchor starting with underscore",
		"wikitext": "[[#_ref|One]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#_ref</><keyword.operator>|</>One<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Id starting with underscore",
		"wikitext": "<div id=\"_ref\"></div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>_ref<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Edit comment with link with more than one pipe (T99346)",
		"wikitext": "[[Main Page|Many|pipes]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</>Many|pipes<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Complex edit comment with link with more than one pipe (T99346)",
		"wikitext": "Created page with \"<noinclude>[[Category:Requests for permissions/Bot|{{subst:#titleparts:{{subst:PAGENAME}}|1|3}}]]</noinclude> === [[User:MineoBot|]] 8=== {{Request for permissions/links|Mineo...\"",
		"parsed": "Created page with \"<punctuation.definition.tag.begin>&lt;</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Requests for permissions/Bot</><keyword.operator>|</><punctuation.definition.tag.function>{{</><constant.language.variables.query>subst</><keyword.operator.function>:</>#titleparts:<punctuation.definition.tag.function>{{</><constant.language.variables.query>subst</><keyword.operator.function>:</>PAGENAME<punctuation.definition.tag.function>}}</><keyword.operator>|</>1<keyword.operator>|</>3<punctuation.definition.tag.function>}}</><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</> === <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>User:</><entity.other.attribute-name>MineoBot</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]</></> 8=== <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Request for permissions/links</><keyword.operator>|</>Mineo...\""
	},
	{
		"desc": "Space normalisation on autocomment (T24784)",
		"wikitext": "/* __hello__world__ */",
		"parsed": "/* __hello__world__ */"
	},
	{
		"desc": "percent-encoding and + signs in comments (T28410)",
		"wikitext": "[[ABC%33D% ++]] [[ABC%33D% ++|+%20]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>ABC%33D% ++</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>ABC%33D% ++</><keyword.operator>|</>+%20<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Verify that displaytitle works (T24501) no displaytitle",
		"wikitext": "this is not the title",
		"parsed": "this is not the title"
	},
	{
		"desc": "Verify that displaytitle works (T24501) RestrictDisplayTitle=false",
		"wikitext": "this is not the title\n{{DISPLAYTITLE:whatever}}",
		"parsed": "this is not the title\\n<punctuation.definition.tag.function>{{</><constant.language.variables.query>DISPLAYTITLE</><keyword.operator.function>:</>whatever<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Verify that displaytitle works (T24501) RestrictDisplayTitle=true mismatch",
		"wikitext": "this is not the title\n{{DISPLAYTITLE:whatever}}",
		"parsed": "this is not the title\\n<punctuation.definition.tag.function>{{</><constant.language.variables.query>DISPLAYTITLE</><keyword.operator.function>:</>whatever<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Verify that displaytitle works (T24501) RestrictDisplayTitle=true matching",
		"wikitext": "this is not the title\n{{DISPLAYTITLE:screen}}",
		"parsed": "this is not the title\\n<punctuation.definition.tag.function>{{</><constant.language.variables.query>DISPLAYTITLE</><keyword.operator.function>:</>screen<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Verify that displaytitle works (T24501) AllowDisplayTitle=false",
		"wikitext": "this is not the title\n{{DISPLAYTITLE:screen}}",
		"parsed": "this is not the title\\n<punctuation.definition.tag.function>{{</><constant.language.variables.query>DISPLAYTITLE</><keyword.operator.function>:</>screen<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Verify that displaytitle works (T24501) AllowDisplayTitle=false no DISPLAYTITLE",
		"wikitext": "this is not the title",
		"parsed": "this is not the title"
	},
	{
		"desc": "Verify that displaytitle handles inline CSS styles (T28547) - rejected value",
		"wikitext": "this is not the title\n{{DISPLAYTITLE:<span style=\"display: none;\">s</span>creen}}",
		"parsed": "this is not the title\\n<punctuation.definition.tag.function>{{</><constant.language.variables.query>DISPLAYTITLE</><keyword.operator.function>:</><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>display: none;</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>s<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>creen<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Verify that displaytitle handles inline CSS styles (T28547) - accepted value",
		"wikitext": "this is not the title\n{{DISPLAYTITLE:<span style=\"color: red;\">s</span>creen}}",
		"parsed": "this is not the title\\n<punctuation.definition.tag.function>{{</><constant.language.variables.query>DISPLAYTITLE</><keyword.operator.function>:</><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>color: red;</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>s<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>creen<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Verify that displaytitle encodes & to &amp; (T291985)",
		"wikitext": "this is not the title\n{{DISPLAYTITLE:art&copy}}",
		"parsed": "this is not the title\\n<punctuation.definition.tag.function>{{</><constant.language.variables.query>DISPLAYTITLE</><keyword.operator.function>:</>art&amp;copy<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Verify that displaytitle encodes &amp; to &amp; (T291985)",
		"wikitext": "this is not the title\n{{DISPLAYTITLE:art&amp;copy}}",
		"parsed": "this is not the title\\n<punctuation.definition.tag.function>{{</><constant.language.variables.query>DISPLAYTITLE</><keyword.operator.function>:</>art<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>copy<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Verify that without displaytitle the title encodes & to &amp; (T291985)",
		"wikitext": "this is not the title",
		"parsed": "this is not the title"
	},
	{
		"desc": "preload: check <noinclude> and <includeonly>",
		"wikitext": "Hello <noinclude>cruel</noinclude><includeonly>kind</includeonly> world.",
		"parsed": "Hello <punctuation.definition.tag.begin>&lt;</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</>cruel<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</>kind<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</> world."
	},
	{
		"desc": "preload: check <onlyinclude>",
		"wikitext": "Goodbye <onlyinclude>Hello world</onlyinclude>",
		"parsed": "Goodbye <punctuation.definition.tag.begin>&lt;</><entity.name.tag>onlyinclude</><punctuation.definition.tag.end>&gt</><meta.block.onlyinclude>Hello world</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>onlyinclude</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "preload: can pass tags through if we want to",
		"wikitext": "<includeonly><</includeonly>includeonly>Hello world<includeonly><</includeonly>/includeonly>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</>&lt;<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</>includeonly&gtHello world<punctuation.definition.tag.begin>&lt;</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</>&lt;<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</>/includeonly&gt"
	},
	{
		"desc": "preload: check that it doesn't try to do tricks",
		"wikitext": "* <!-- Hello --> ''{{world}}'' {{<includeonly>subst:</includeonly>How are you}}{{ {{{|safesubst:}}} #if:1|2|3}}",
		"parsed": "<punctuation.definition.list.begin.markdown>*</> <comment.block.html><punctuation.definition.comment.html>&lt;!--</> Hello <punctuation.definition.comment.html>--&gt</></> <markup.italic>''</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>world</><punctuation.definition.tag.template>}}</><markup.italic>''</> {{<punctuation.definition.tag.begin>&lt;</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</>subst:<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</>How are you}}<punctuation.definition.tag.template>{{</><entity.name.tag.local-name> </><punctuation.definition.tag.variable>{{{</><variable.parameter><keyword.operator>|</>safesubst:</><punctuation.definition.tag.variable>}}}</> #if:1<keyword.operator>|</>2<keyword.operator>|</>3<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Play a bit with r67090 and T5158",
		"wikitext": "<div style=\"width:50% !important\">&nbsp;</div>\n<div style=\"width:50%&nbsp;!important\">&nbsp;</div>\n<div style=\"width:50%&#160;!important\">&nbsp;</div>\n<div style=\"border : solid;\">&nbsp;</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>width:50% !important</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></><constant.character.entity.named.nbsp.html><punctuation.definition.entity.html>&amp;</>nbsp<punctuation.definition.entity.html>;</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>width:50%<constant.character.entity.named.nbsp.html><punctuation.definition.entity.html>&amp;</>nbsp<punctuation.definition.entity.html>;</></>!important</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></><constant.character.entity.named.nbsp.html><punctuation.definition.entity.html>&amp;</>nbsp<punctuation.definition.entity.html>;</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>width:50%<constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#160;</>!important</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></><constant.character.entity.named.nbsp.html><punctuation.definition.entity.html>&amp;</>nbsp<punctuation.definition.entity.html>;</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>border : solid;</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></><constant.character.entity.named.nbsp.html><punctuation.definition.entity.html>&amp;</>nbsp<punctuation.definition.entity.html>;</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "French spaces in wikitext",
		"wikitext": "foo ! bar ? bat 50 % is less than 75 %.\n\nHello : this ; is Â« something â€¹ else â€º again Â»",
		"parsed": "foo ! bar ? bat 50 % is less than 75 %.\\n\\nHello : this ; is Â« something â€¹ else â€º again Â»"
	},
	{
		"desc": "Corner case: french spaces in definition list",
		"wikitext": ";foo : bar",
		"parsed": "<punctuation.definition.list.begin.markdown>;</>foo : bar"
	},
	{
		"desc": "T5158: Test for French spaces in attributes",
		"wikitext": "<br style=\" clear : both ; \" />",
		"parsed": "<meta.tag.inline.br.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>br</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css> clear : both ; </><punctuation.definition.string.end.html><source.css>\"</></></></></> <punctuation.definition.tag.end.html>/&gt</></>"
	},
	{
		"desc": "HTML5 data attributes",
		"wikitext": "<span data-foo=\"bar\">Baz</span>\n<p data-abc-def_hij=\"\">Quuz</p>",
		"parsed": "<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.data-x.data-foo.html><entity.other.attribute-name.html>data-foo</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>bar<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>Baz<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.p.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>p</> <meta.attribute.unrecognized.data-abc-def_hij.html><entity.other.attribute-name.html>data-abc-def_hij</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>Quuz<meta.tag.structure.p.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Strip reserved data attributes",
		"wikitext": "<div data-mw=\"foo\" data-parsoid=\"bar\" data-mw-someext=\"baz\" data-ok=\"fred\" data-object-id=\"123\" data-ooui=\"xyzzy\" data-bad:ns=\"ns\">d</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.data-x.data-mw.html><entity.other.attribute-name.html>data-mw</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></> <meta.attribute.data-x.data-parsoid.html><entity.other.attribute-name.html>data-parsoid</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>bar<punctuation.definition.string.end.html>\"</></></> <meta.attribute.data-x.data-mw-someext.html><entity.other.attribute-name.html>data-mw-someext</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>baz<punctuation.definition.string.end.html>\"</></></> <meta.attribute.data-x.data-ok.html><entity.other.attribute-name.html>data-ok</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>fred<punctuation.definition.string.end.html>\"</></></> <meta.attribute.data-x.data-object-id.html><entity.other.attribute-name.html>data-object-id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>123<punctuation.definition.string.end.html>\"</></></> <meta.attribute.data-x.data-ooui.html><entity.other.attribute-name.html>data-ooui</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>xyzzy<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.data-bad:ns.html><entity.other.attribute-name.html>data-bad:ns</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>ns<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>d<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "percent-encoding and + signs in internal links (T28410)",
		"wikitext": "[[User:+%]] [[Page+title%]]\n[[%+]] [[%+|%20]] [[%+ ]] [[%+r]]\n[[%]] [[+]] [[File:%+abc%39|foo|[[bar]]]]\n[[%33%45]] [[%33%45+]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>User:</><entity.other.attribute-name>+%</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Page+title%</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>%+</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>%+</><keyword.operator>|</>%20<punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>%+ </><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>%+r</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>%</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>+</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>%+abc%39</><keyword.operator>|</>foo<keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>bar</><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>%33%45</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>%33%45+</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Confirm that 'apos' named character reference doesn't make it to output (not legal in HTML 4)",
		"wikitext": "Text&apos;s been normalized?",
		"parsed": "Text<constant.character.entity.named.apos.html><punctuation.definition.entity.html>&amp;</>apos<punctuation.definition.entity.html>;</></>s been normalized?"
	},
	{
		"desc": "T21052 U+3000 IDEOGRAPHIC SPACE should terminate free external links",
		"wikitext": "http://www.example.org/ã€€<-- U+3000 (vim: ^Vu3000)",
		"parsed": "http://www.example.org/ã€€&lt;-- U+3000 (vim: ^Vu3000)"
	},
	{
		"desc": "T21052 U+3000 IDEOGRAPHIC SPACE should terminate bracketed external links",
		"wikitext": "[http://www.example.org/ã€€ideograms]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.org/</><string.other.link.external.title>ã€€ideograms</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "T21052 U+3000 IDEOGRAPHIC SPACE should terminate external images links",
		"wikitext": "http://www.example.org/pic.pngã€€<-- U+3000 (vim: ^Vu3000)",
		"parsed": "http://www.example.org/pic.pngã€€&lt;-- U+3000 (vim: ^Vu3000)"
	},
	{
		"desc": "T33098 Template which includes system messages which includes the template",
		"wikitext": "{{Identical}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Identical</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "T33490 ucfÄ±rst (with a dotless i) with English language",
		"wikitext": "{{ucfÄ±rst:blah}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>ucfÄ±rst:blah</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "T34057: Title needed when expanding <h> nodes.",
		"wikitext": "{{int:T34057}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>int</><keyword.operator.function>:</>T34057<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Title needed when expanding templates.",
		"wikitext": "{{Template with pagename}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Template with pagename</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Strip marker in urlencode",
		"wikitext": "{{urlencode:x<nowiki/>y}}\n{{urlencode:x<nowiki/>y|wiki}}\n{{urlencode:x<nowiki/>y|path}}\n{{urlencode:x<pre id=\"one\">two</pre>y}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>urlencode</><keyword.operator.function>:</>x<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>y<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>urlencode</><keyword.operator.function>:</>x<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>y<keyword.operator>|</>wiki<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>urlencode</><keyword.operator.function>:</>x<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>y<keyword.operator>|</>path<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>urlencode</><keyword.operator.function>:</>x<punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>one<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>two</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</>y<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Strip marker in lc",
		"wikitext": "{{lc:x<nowiki/>y}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>lc</><keyword.operator.function>:</>x<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>y<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Strip marker in uc",
		"wikitext": "{{uc:x<nowiki/>y}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>uc</><keyword.operator.function>:</>x<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>y<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Strip marker in formatNum",
		"wikitext": "{{formatnum:1<nowiki/>2}}\n{{formatnum:1<nowiki/>2|R}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>formatnum</><keyword.operator.function>:</>1<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>2<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>formatnum</><keyword.operator.function>:</>1<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>2<keyword.operator>|</>R<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Wrong option for formatNum (T58199)",
		"wikitext": "{{formatnum:1,234.56|Random}}\n{{formatnum:1,234.56|EVERYTHING}}\n{{formatnum:1234.56|any argument that has the string 'NOSEP'}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>formatnum</><keyword.operator.function>:</>1,234.56<keyword.operator>|</>Random<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>formatnum</><keyword.operator.function>:</>1,234.56<keyword.operator>|</>EVERYTHING<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>formatnum</><keyword.operator.function>:</>1234.56<keyword.operator>|</>any argument that has the string 'NOSEP'<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Strip marker in padleft",
		"wikitext": "{{padleft:|2|x<nowiki/>y}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>padleft</><keyword.operator.function>:</><keyword.operator>|</>2<keyword.operator>|</>x<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>y<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Strip marker in padright",
		"wikitext": "{{padright:|2|x<nowiki/>y}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>padright</><keyword.operator.function>:</><keyword.operator>|</>2<keyword.operator>|</>x<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>y<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Strip marker in anchorencode",
		"wikitext": "{{anchorencode:x<nowiki/>y}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>anchorencode</><keyword.operator.function>:</>x<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>y<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "new support for bdi element (T33817)",
		"wikitext": "<p dir=\"rtl\" lang=\"he\">×•×œ×“×™××™×¨ ×œ× ×™×Ÿ (×‘×¨×•×¡×™×ª: <bdi lang=\"ru\">Ğ’Ğ»Ğ°Ğ´Ğ¸Ğ¼Ğ¸Ñ€ Ğ›ĞµĞ½Ğ¸Ğ½</bdi>, 24 ×‘××¤×¨×™×œ 1870â€“22 ×‘×™× ×•××¨ 1924) ×”×•× ×× ×”×™×’ ×¤×•×œ×™×˜×™ ×§×•××•× ×™×¡×˜×™ ×¨×•×¡×™.</p>",
		"parsed": "<meta.tag.structure.p.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>p</> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>rtl<punctuation.definition.string.end.html>\"</></></> <meta.attribute.lang.html><entity.other.attribute-name.html>lang</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>he<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>×•×œ×“×™××™×¨ ×œ× ×™×Ÿ (×‘×¨×•×¡×™×ª: <meta.tag.inline.bdi.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>bdi</> <meta.attribute.lang.html><entity.other.attribute-name.html>lang</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>ru<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>Ğ’Ğ»Ğ°Ğ´Ğ¸Ğ¼Ğ¸Ñ€ Ğ›ĞµĞ½Ğ¸Ğ½<meta.tag.inline.bdi.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>bdi</><punctuation.definition.tag.end.html>&gt</></>, 24 ×‘××¤×¨×™×œ 1870â€“22 ×‘×™× ×•××¨ 1924) ×”×•× ×× ×”×™×’ ×¤×•×œ×™×˜×™ ×§×•××•× ×™×¡×˜×™ ×¨×•×¡×™.<meta.tag.structure.p.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Ignore pipe between table row attributes",
		"wikitext": "{|\n|quux\n|- id=foo | style='color: red'\n|bar\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>quux\\n</></><meta.tag.block.table-row><keyword.operator>|-</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.unquoted.html>foo</></> <meta.attribute.unrecognized.|.html><entity.other.attribute-name.html>|</></> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.single.html><punctuation.definition.string.begin.html>'</><source.css>color: red</><punctuation.definition.string.end.html><source.css>'\\n</></></></></></><meta.tag.block.td><keyword.operator>|</><markup.style>bar\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Language parser function",
		"wikitext": "{{#language:ar}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#language</><keyword.operator.function>:</>ar<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Padleft and padright (default 0-padding)",
		"wikitext": "{{padleft:xyz|5}}\n{{padright:xyz|5}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>padleft</><keyword.operator.function>:</>xyz<keyword.operator>|</>5<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>padright</><keyword.operator.function>:</>xyz<keyword.operator>|</>5<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Padleft and padright (partial fill)",
		"wikitext": "{{padleft:xyz|6|ab}}\n{{padright:xyz|6|ab}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>padleft</><keyword.operator.function>:</>xyz<keyword.operator>|</>6<keyword.operator>|</>ab<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>padright</><keyword.operator.function>:</>xyz<keyword.operator>|</>6<keyword.operator>|</>ab<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Padleft and padright as substr",
		"wikitext": "{{padleft:|3|abcde}}\n{{padright:|3|abcde}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>padleft</><keyword.operator.function>:</><keyword.operator>|</>3<keyword.operator>|</>abcde<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>padright</><keyword.operator.function>:</><keyword.operator>|</>3<keyword.operator>|</>abcde<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Padleft and padright with non-numerical length (T180403)",
		"wikitext": "{{padleft:abcdef|junk}}\n{{padright:abcdef|junk}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>padleft</><keyword.operator.function>:</>abcdef<keyword.operator>|</>junk<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>padright</><keyword.operator.function>:</>abcdef<keyword.operator>|</>junk<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Special parser function",
		"wikitext": "{{#special:RandomPage}}\n{{#special:BaDtItLe}}\n{{#special:Foobar}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#special</><keyword.operator.function>:</>RandomPage<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#special</><keyword.operator.function>:</>BaDtItLe<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#special</><keyword.operator.function>:</>Foobar<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Using {{=}} when it expands to \"=\" should not create a tracking category",
		"wikitext": "This uses {{=}} and {{Template:=}}.",
		"parsed": "This uses <constant.language.variables.metadata>{{=}}</> and <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Template:=</><punctuation.definition.tag.template>}}</>."
	},
	{
		"desc": "Using {{=}} when it expands to \"=\" should not create a tracking category (cat)",
		"wikitext": "This uses {{=}} and {{Template:=}}.",
		"parsed": "This uses <constant.language.variables.metadata>{{=}}</> and <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Template:=</><punctuation.definition.tag.template>}}</>."
	},
	{
		"desc": "T36939 - Case insensitive link parsing ([HttP://])",
		"wikitext": "[HttP://MediaWiki.Org/]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>HttP://MediaWiki.Org/</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "T36939 - Case insensitive link parsing ([HttP:// title])",
		"wikitext": "[HttP://MediaWiki.Org/ MediaWiki]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>HttP://MediaWiki.Org/</><string.other.link.external.title> MediaWiki</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "T36939 - Case insensitive link parsing (HttP://)",
		"wikitext": "HttP://MediaWiki.Org/",
		"parsed": "HttP://MediaWiki.Org/"
	},
	{
		"desc": "1. SOL-sensitive wikitext tokens as template-args",
		"wikitext": "{{1x|*a}}\n{{1x|#a}}\n{{1x|:a}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>*a<punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>#a<punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>:a<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Wikilink with only closing tag in target",
		"wikitext": "[[Test|</span>]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Test</><keyword.operator>|</><meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "LST Sections: Backwards compatibility",
		"wikitext": "<section begin=\"2011-05-16\" />\n<section end=\"2014-04-10 (MW 1.23wmf22)\" />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>section</> <meta.attribute.unrecognized.begin.html><entity.other.attribute-name.html>begin</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>2011-05-16<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>section</> <meta.attribute.unrecognized.end.html><entity.other.attribute-name.html>end</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>2014-04-10 (MW 1.23wmf22)<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "LST Sections: Newfangled approach",
		"wikitext": "<section begin=\"2011-05-16\" />\n<section end=\"2014-04-10 (MW 1.23wmf22)\" />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>section</> <meta.attribute.unrecognized.begin.html><entity.other.attribute-name.html>begin</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>2011-05-16<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>section</> <meta.attribute.unrecognized.end.html><entity.other.attribute-name.html>end</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>2014-04-10 (MW 1.23wmf22)<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "LST Sections: Fostering",
		"wikitext": "{|\n<section name=\"testing\"/>\n| 123\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>section</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>testing<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>/&gt\\n</><meta.tag.block.td><keyword.operator>|</><markup.style> 123\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Empty LI and TR nodes should be stripped from template content",
		"wikitext": "{{EmptyLITest}}\n{{EmptyTRTest}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>EmptyLITest</><punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>EmptyTRTest</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Empty LI and TR nodes should not be stripped from top-level content",
		"wikitext": "*a\n*\n*b\n\n{|\n|-\n|-\n|foo\n|}",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>a\\n<punctuation.definition.list.begin.markdown>*\\n*</>b\\n\\n<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.table-row><keyword.operator>|-\\n|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>foo\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Empty TR nodes should not be stripped if they have any attributes set",
		"wikitext": "{{EmptyTRWithHTMLAttrTest}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>EmptyTRWithHTMLAttrTest</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "\nTag-like HTML structures are passed through as text",
		"wikitext": "<x y>\n\n<x.y>\n\n<x-y>\n\n1>2\n\nx<y\n\na>b\n\n1<d e>f",
		"parsed": "<meta.tag.other.x.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>x</></> <meta.attribute.unrecognized.y.html><entity.other.attribute-name.html>y</></><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.other.x.y.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>x.y</></><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.custom.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>x-y</><punctuation.definition.tag.end.html>&gt\\n\\n</></>1&gt2\\n\\nx<meta.tag.other.y.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>y\\n\\n</></><meta.attribute.unrecognized.a.html><entity.other.attribute-name.html>a</></><punctuation.definition.tag.end.html>&gt</></>b\\n\\n1<meta.tag.other.d.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>d</></> <meta.attribute.unrecognized.e.html><entity.other.attribute-name.html>e</></><punctuation.definition.tag.end.html>&gt</></>f"
	},
	{
		"desc": "HTML tag with necessary entities in attributes",
		"wikitext": "<span title=\"&amp;amp;\">foo</span>",
		"parsed": "<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>amp;<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "HTML tag with 'unnecessary' entity encoding in attributes",
		"wikitext": "<span title=\"&amp;\">foo</span>",
		"parsed": "<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></><punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "HTML tag with broken attribute value quoting",
		"wikitext": "<span title=\"Hello world>Foo</span>",
		"parsed": "<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>Hello world&gtFoo&lt;/span&gt</></></>"
	},
	{
		"desc": "Self-closed tag with broken attribute value quoting",
		"wikitext": "<div title=\"Hello world />Foo",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>Hello world /&gtFoo</></></>"
	},
	{
		"desc": "Table with broken attribute value quoting",
		"wikitext": "{|\n| title=\"Hello world|Foo\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>Hello world</></><keyword.operator>|</><markup.style>Foo\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Table with broken attribute value quoting on consecutive lines",
		"wikitext": "{|\n| title=\"Hello world|Foo\n| style=\"color:red|Bar\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>Hello world</></><keyword.operator>|</><markup.style>Foo\\n</><keyword.operator>|</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>color:red</></></></><keyword.operator>|</><markup.style>Bar\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Accept empty td cell attribute",
		"wikitext": "{|\n| align=\"center\" |foo||  |\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</> <meta.attribute.align.html><invalid.deprecated.entity.other.attribute-name.html>align</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>center<punctuation.definition.string.end.html>\"</></> </><keyword.operator>|</><markup.style>foo</><keyword.operator>||</>  <keyword.operator>|\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Non-empty attributes in th-cells",
		"wikitext": "{|\n!Foo!! style=\"color: red\" |Bar\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</><markup.style>Foo</><keyword.operator>!!</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>color: red</><punctuation.definition.string.end.html><source.css>\"</></></></> </><keyword.operator>|</><markup.style>Bar\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Accept empty attributes in th-cells",
		"wikitext": "{|\n!|foo!!|bar\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!|</><markup.style>foo</><keyword.operator>!!|</><markup.style>bar\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Empty table rows go away",
		"wikitext": "{|\n|Hello\n|there\n|- class=\"foo\"\n|-\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>Hello\\n</><keyword.operator>|</><markup.style>there\\n</></><meta.tag.block.table-row><keyword.operator>|-</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"\\n</></></><keyword.operator>|-\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "RT-ed inter-element separators should be valid separators",
		"wikitext": "{|\n|- [[foo]]\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.table-row><keyword.operator>|-</> <meta.attribute.unrecognized.[[foo]].html><entity.other.attribute-name.html>[[foo]]\\n</></></><keyword.operator>|}</></>"
	},
	{
		"desc": "Trailing newlines in a deep dom-subtree that ends a wikitext line should be migrated out",
		"wikitext": "{|\n|<small>foo\nbar\n|}\n\n{|\n|<small>foo<small>\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style><meta.tag.inline.small.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt</></>foo\\n</></>bar\\n<keyword.operator>|}\\n\\n{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style><meta.tag.inline.small.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.inline.small.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt\\n</></></></><keyword.operator>|}</></>"
	},
	{
		"desc": "Empty TD followed by TD with tpl-generated attribute",
		"wikitext": "{|\n|-\n|\n|{{1x|style='color:red'}}|foo\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|\\n|</><markup.style><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><entity.other.attribute-name.local-name>style</><keyword.operator.equal>=</>'color:red'<punctuation.definition.tag.template>}}</>|foo\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Indented table with an empty td",
		"wikitext": " {|\n |-\n |\n |foo\n |}",
		"parsed": "<meta.tag.block.table><punctuation.definition.list.begin.markdown> </><keyword.operator>{|\\n</><meta.tag.block.table-row> <keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator> |\\n |</><markup.style>foo\\n</></><punctuation.definition.list.begin.markdown> </><keyword.operator>|}</></>"
	},
	{
		"desc": "Indented table with blank lines in between (T85627)",
		"wikitext": " {|\n |foo\n \n \n |}",
		"parsed": "<meta.tag.block.table><punctuation.definition.list.begin.markdown> </><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator> |</><markup.style>foo\\n</></> \\n \\n<punctuation.definition.list.begin.markdown> </><keyword.operator>|}</></>"
	},
	{
		"desc": "Indented block & table",
		"wikitext": " <div>foo</div>\n {|\n |foo\n |}",
		"parsed": " <meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.block.table><punctuation.definition.list.begin.markdown> </><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator> |</><markup.style>foo\\n</></><punctuation.definition.list.begin.markdown> </><keyword.operator>|}</></>"
	},
	{
		"desc": "Indent and comment before table row",
		"wikitext": "{|\n <!--hi-->|-\n |there\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>hi<punctuation.definition.comment.html>--&gt</></>|-\\n<meta.tag.block.td><keyword.operator> |</><markup.style>there\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Empty TR followed by a template-generated TR",
		"wikitext": "{|\n|-\n{{1x|<tr><td>foo</td></tr>}}\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.table-row><keyword.operator>|-\\n</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}\\n</><keyword.operator>|}</></>"
	},
	{
		"desc": "Empty TR followed by mixed-ws-comment line should RT correctly",
		"wikitext": "{|\n|-\n <!--c-->\n|-\n<!--c--> <!--d-->\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.table-row><keyword.operator>|-\\n</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c<punctuation.definition.comment.html>--&gt\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</>c<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>d<punctuation.definition.comment.html>--&gt\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Multi-line image caption generated by templates with/without trailing newlines",
		"wikitext": "[[File:Foobar.jpg|thumb|300x300px|foo\\n{{1x|A}}\\n{{1x|B}}\\n{{1x|C}}]]\n[[File:Foobar.jpg|thumb|300x300px|foo\\n{{1x|A}}\\n{{1x|B}}\\n{{1x|C}}\\n\\n]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>300x300<entity.other.attribute-name.localname>px</><keyword.operator>|</>foo\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>A<punctuation.definition.tag.template>}}</>\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>B<punctuation.definition.tag.template>}}</>\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>C<punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>300x300<entity.other.attribute-name.localname>px</><keyword.operator>|</>foo\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>A<punctuation.definition.tag.template>}}</>\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>B<punctuation.definition.tag.template>}}</>\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>C<punctuation.definition.tag.template>}}</>\\n\\n<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "New element inserted (without intervening newlines) after an old sol-transparent node should serialize correctly",
		"wikitext": "<includeonly>foo</includeonly>\nnew para\n\n[[Category:Foo]]\n\n= new heading =",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</>foo<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt\\n</>new para\\n\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]\\n\\n</></><markup.heading>=<string.quoted.other.heading> new heading </>=</>"
	},
	{
		"desc": "Improperly nested inline or quotes tags with whitespace in between",
		"wikitext": "<span> <s>x</s></span><s> </s>\n''' ''x'''''",
		"parsed": "<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></> <meta.tag.inline.s.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>s</><punctuation.definition.tag.end.html>&gt</></>x<meta.tag.inline.s.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>s</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.s.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>s</><punctuation.definition.tag.end.html>&gt</></> <meta.tag.inline.s.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>s</><punctuation.definition.tag.end.html>&gt\\n</></><markup.bold>'''</> <markup.italic>''</>x<markup.bold.italic>'''''</>"
	},
	{
		"desc": "Encapsulate protected attributes from wt",
		"wikitext": "<div typeof=\"mw:placeholder stuff\" data-mw=\"whoo\" data-parsoid=\"weird\" data-parsoid-other=\"no\" about=\"time\" rel=\"mw:true\">foo</div>\n\n{| typeof=\"mw:placeholder stuff\" data-mw=\"whoo\" data-parsoid=\"weird\" data-parsoid-other=\"no\" about=\"time\" rel=\"mw:true\"\n|ok\n|}",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.unrecognized.typeof.html><entity.other.attribute-name.html>typeof</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>mw:placeholder stuff<punctuation.definition.string.end.html>\"</></></> <meta.attribute.data-x.data-mw.html><entity.other.attribute-name.html>data-mw</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>whoo<punctuation.definition.string.end.html>\"</></></> <meta.attribute.data-x.data-parsoid.html><entity.other.attribute-name.html>data-parsoid</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>weird<punctuation.definition.string.end.html>\"</></></> <meta.attribute.data-x.data-parsoid-other.html><entity.other.attribute-name.html>data-parsoid-other</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>no<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.about.html><entity.other.attribute-name.html>about</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>time<punctuation.definition.string.end.html>\"</></></> <meta.attribute.rel.html><entity.other.attribute-name.html>rel</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>mw:true<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.block.table><keyword.operator>{|</> <meta.attribute.unrecognized.typeof.html><entity.other.attribute-name.html>typeof</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>mw:placeholder stuff<punctuation.definition.string.end.html>\"</></></> <meta.attribute.data-x.data-mw.html><entity.other.attribute-name.html>data-mw</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>whoo<punctuation.definition.string.end.html>\"</></></> <meta.attribute.data-x.data-parsoid.html><entity.other.attribute-name.html>data-parsoid</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>weird<punctuation.definition.string.end.html>\"</></></> <meta.attribute.data-x.data-parsoid-other.html><entity.other.attribute-name.html>data-parsoid-other</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>no<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.about.html><entity.other.attribute-name.html>about</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>time<punctuation.definition.string.end.html>\"</></></> <meta.attribute.rel.html><entity.other.attribute-name.html>rel</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>mw:true<punctuation.definition.string.end.html>\"\\n</></></><meta.tag.block.td><keyword.operator>|</><markup.style>ok\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Ensure ParagraphWrapper can deal with stray closing pre tags",
		"wikitext": "plain text</pre>",
		"parsed": "plain text<meta.tag.structure.pre.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>pre</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "1. Ensure fostered text content is wrapped in element nodes",
		"wikitext": "<table>hi</table><table>ho</table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>hi<meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>ho<meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "2. Ensure fostered text content is wrapped in element nodes (traps regressions around fostered marker on the element getting lost)",
		"wikitext": "<table>\n<tr> || ||\n<td> a\n</table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></> || ||\\n<meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></> a\\n<meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Encapsulation properly handles null DSR information from foster box",
		"wikitext": "{{1x|<table>foo<tr><td>bar</td></tr></table>}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>bar<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "1. Encapsulate foster-parented transclusion content",
		"wikitext": "<table>{{1x|foo<tr><td>bar</td></tr>}}</table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo<meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>bar<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "2. Encapsulate foster-parented transclusion content",
		"wikitext": "<table><div>{{1x|foo}}</div><tr><td>bar</td></tr></table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo<punctuation.definition.tag.template>}}</><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>bar<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "3. Encapsulate foster-parented transclusion content",
		"wikitext": "<table><div><p>{{1x|foo</p></div><tr><td>}}bar</td></tr></table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.p.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo<meta.tag.structure.p.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</>bar<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "4. Encapsulate foster-parented transclusion content",
		"wikitext": "<table><div><p>{{1x|foo</p></div><tr><td>}}bar</td></tr></table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.p.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo<meta.tag.structure.p.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</>bar<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "5. Encapsulate foster-parented transclusion content",
		"wikitext": "<table><tr><td><div><p>{{1x|foo</p></div></td>foo}}</tr></table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.p.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo<meta.tag.structure.p.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>foo<punctuation.definition.tag.template>}}</><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "6. Encapsulate foster-parented transclusion content",
		"wikitext": "<table><tr><td><div><p>{{1x|foo</p></div></td>foo</tr></table>}}<p>ok</p>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.p.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo<meta.tag.structure.p.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</><meta.tag.structure.p.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></>ok<meta.tag.structure.p.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "7. Encapsulate foster-parented transclusion content",
		"wikitext": "<table>{{1x|<p>foo</p>}}<td>bar</td></table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.p.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.p.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>bar<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "8. Encapsulate foster-parented transclusion content",
		"wikitext": "{{1x|a\n}}{|{{1x|style='color:red'}}\n|-\n|b\n|}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>a\\n<punctuation.definition.tag.template>}}</>{|<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><entity.other.attribute-name.local-name>style</><keyword.operator.equal>=</>'color:red'<punctuation.definition.tag.template>}}\\n</>|-\\n|b\\n|}"
	},
	{
		"desc": "9. Encapsulate foster-parented transclusion content",
		"wikitext": "<table>{{1x|hi</table>hello}}",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>hi<meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>hello<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Table in fosterable position",
		"wikitext": "{{OpenTable}}\n<div>\n{|\n|}\n</div>\n|}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>OpenTable</><punctuation.definition.tag.template>}}\\n</><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.block.table><keyword.operator>{|\\n|}\\n</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></>|}"
	},
	{
		"desc": "Properly encapsulate empty-content transclusions in fosterable positions",
		"wikitext": "<table>\n{{#if:|\n<td>foo</td>\n}}\n</table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.tag.function>{{</><constant.language.variables.query>#if</><keyword.operator.function>:</><keyword.operator>|\\n</><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.tag.function>}}\\n</><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Always encapsulate foster box when template range is expanded to table",
		"wikitext": "{|\nhello\n{{OpenTable}}\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</>hello\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>OpenTable</><punctuation.definition.tag.template>}}\\n</><keyword.operator>|}</></>"
	},
	{
		"desc": "T115289: Unclosed table",
		"wikitext": "{{1x|<table>}}<!--c-->[[Category:Two]]",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</><comment.block.html><punctuation.definition.comment.html>&lt;!--</>c<punctuation.definition.comment.html>--&gt</></><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Two</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T115289: Don't migrate newlines out of tables with fostered content",
		"wikitext": "<table><td></td>{{1x|<tr>[[Category:One]]}}<!--c-->[[Category:Two]]",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>One</><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.template>}}</><comment.block.html><punctuation.definition.comment.html>&lt;!--</>c<punctuation.definition.comment.html>--&gt</></><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Two</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T73074: More fostering fun",
		"wikitext": "<table><td></td>{{1x|<tr>}}<!--c-->[[Category:Two]]",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</><comment.block.html><punctuation.definition.comment.html>&lt;!--</>c<punctuation.definition.comment.html>--&gt</></><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Two</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Fostered content with a dom fragment token starting with a transclusion",
		"wikitext": "{|\n[[File:Foobar.jpg|right|{{1x|<div>123</div>}}]]\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>right</><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>123<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "1. Template wrapping shouldn't ignore fostered content",
		"wikitext": "{|\n{{tr}}\n{{1x|\n}}\n\nhiho",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>tr</><punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|\\n</><punctuation.definition.tag.template>}}\\n\\n</>hiho</>"
	},
	{
		"desc": "2. Template wrapping shouldn't ignore fostered content",
		"wikitext": "{|\n{{tr}}\n{{1x|\n }}\n\nhiho",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>tr</><punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|\\n</> <punctuation.definition.tag.template>}}\\n\\n</>hiho</>"
	},
	{
		"desc": "Support <object> element with .data attribute",
		"wikitext": "<object data=\"test.swf\"></object>",
		"parsed": "<meta.tag.object.object.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>object</> <meta.attribute.data.html><entity.other.attribute-name.html>data</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>test.swf<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.object.object.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>object</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T72867: Don't block XML namespace declaration",
		"wikitext": "<span xmlns:dct=\"http://purl.org/dc/terms/\" property=\"dct:title\">MediaWiki</span>",
		"parsed": "<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.unrecognized.xmlns:dct.html><entity.other.attribute-name.html>xmlns:dct</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>http://purl.org/dc/terms/<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.property.html><entity.other.attribute-name.html>property</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>dct:title<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>MediaWiki<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Ignore rel attribute in a-tags during serialization to url-links",
		"wikitext": "http://en.wikipedia.org/wiki/Foobar\nhttp://en.wikipedia.org/wiki/Foobar\nhttp://en.wikipedia.org/wiki/Foobar",
		"parsed": "http://en.wikipedia.org/wiki/Foobar\\nhttp://en.wikipedia.org/wiki/Foobar\\nhttp://en.wikipedia.org/wiki/Foobar"
	},
	{
		"desc": "Serialize interwiki links pointing to the current wiki as plain wiki links (T67869)",
		"wikitext": "[[Foo]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid should accept interwiki shortcuts",
		"wikitext": "[[:fr:Foo|Foo]]\n[[:fr:Foo|Foo]]\n[[:fr:Foo|Foo]]\n\n[[:fr:Foo|Foo]]\n[[:fr:Foo|Foo]]\n[[:fr:Foo|Foo]]\n\n[[:fr:Foo|Foo]]\n[[:fr:Foo|Foo]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>:fr:Foo</><keyword.operator>|</>Foo<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>:fr:Foo</><keyword.operator>|</>Foo<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>:fr:Foo</><keyword.operator>|</>Foo<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.other.attribute-name>:fr:Foo</><keyword.operator>|</>Foo<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>:fr:Foo</><keyword.operator>|</>Foo<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>:fr:Foo</><keyword.operator>|</>Foo<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.other.attribute-name>:fr:Foo</><keyword.operator>|</>Foo<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>:fr:Foo</><keyword.operator>|</>Foo<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid should not accept invalid interwiki shortcuts",
		"wikitext": "[news:Foo Foo]\n[news:Foo Foo]\n[news:Foo Foo]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>news:Foo</><string.other.link.external.title> Foo</><punctuation.definition.tag.link.external>]\\n[</><entity.name.tag.url>news:Foo</><string.other.link.external.title> Foo</><punctuation.definition.tag.link.external>]\\n[</><entity.name.tag.url>news:Foo</><string.other.link.external.title> Foo</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "New wikilinks should be serialized properly",
		"wikitext": "[[Foo]]\n[[Foo]]\n[[:en:Foo|//en.wikipedia.org/wiki/Foo]]\nhttp://en.wikipedia.org/wiki/Foo\n[[:en:Foo_bar|//en.wikipedia.org/wiki/Foo bar]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>:en:Foo</><keyword.operator>|</>//en.wikipedia.org/wiki/Foo<punctuation.definition.tag.link.internal>]]\\n</></>http://en.wikipedia.org/wiki/Foo\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>:en:Foo_bar</><keyword.operator>|</>//en.wikipedia.org/wiki/Foo bar<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "New wiki links (href variations)",
		"wikitext": "[[Foo_bar]]\n[[Foo_bar]]\n[[Foo_bar]]\n[[Toxine bactÃ©rienne]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo_bar</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Foo_bar</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Foo_bar</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Toxine bactÃ©rienne</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "New wiki links (content string variations)",
		"wikitext": "[[Foo_bar]]\n[[Foo bar]]\n[[Foo_bar|./Foo_bar]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo_bar</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Foo bar</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Foo_bar</><keyword.operator>|</>./Foo_bar<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "New category links (href variations)",
		"wikitext": "[[Category:Toxine bactÃ©rienne]]\n[[Category:Toxine bactÃ©rienne]]\n[[Category:Toxine bactÃ©rienne]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Toxine bactÃ©rienne</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Toxine bactÃ©rienne</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Toxine bactÃ©rienne</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "New interlanguage links (href variations)",
		"wikitext": "[[es:Toxine bactÃ©rienne]]\n[[es:Toxine_bactÃ©rienne]]\n[[es:Toxine_bactÃ©rienne]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>es:Toxine bactÃ©rienne</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>es:Toxine_bactÃ©rienne</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>es:Toxine_bactÃ©rienne</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Emit simple non-piped link where possible",
		"wikitext": "[[VisualEditor]]\n[[visualEditor]]\n[[VisualEditor link]]\n[[visualEditor link]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>VisualEditor</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>visualEditor</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>VisualEditor link</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>visualEditor link</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Lists: Serialize correctly even when list content is wrapped in p-tags (like VE does)",
		"wikitext": "* foo",
		"parsed": "<punctuation.definition.list.begin.markdown>*</> foo"
	},
	{
		"desc": "Lists: Serialize correctly even when list tags has unneeded whitespace between tags",
		"wikitext": "* foo",
		"parsed": "<punctuation.definition.list.begin.markdown>*</> foo"
	},
	{
		"desc": "Don't strip leading whitespace when handling indent-pre suppressing tags",
		"wikitext": "{|\n  | indented row\n|}\n<blockquote>\n '''This is very bold of you!'''\n\n{|\n|\n indented cell (no pre-wrapping!)\n|}\n</blockquote>\nfoo\n <div>bar</div>",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>  |</><markup.style> indented row\\n</></><keyword.operator>|}\\n</></><meta.tag.structure.blockquote.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt\\n</></> <markup.bold>'''</>This is very bold of you!<markup.bold>'''\\n\\n</><meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|\\n</></> indented cell (no pre-wrapping!)\\n<keyword.operator>|}\\n</></><meta.tag.structure.blockquote.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt\\n</></>foo\\n <meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>bar<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Strip leading whitespace when handling indent-pre inducing tags",
		"wikitext": "foo\n \n<span>bar</span>\n\n<span>foo2\n</span>bar2\n\n<div>foo</div>\n<span>bar</span>\n\n<div>\n<span>foo</span>\n</div>",
		"parsed": "foo\\n \\n<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>bar<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>foo2\\n<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>bar2\\n\\n<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>bar<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Lists: Dont insert newlines in a serialized list item.",
		"wikitext": "* a<br />b\n* c",
		"parsed": "<punctuation.definition.list.begin.markdown>*</> a<meta.tag.inline.br.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>br</> <punctuation.definition.tag.end.html>/&gt</></>b\\n<punctuation.definition.list.begin.markdown>*</> c"
	},
	{
		"desc": "Headings: Force sol-transparent links and behavior switches to serialize before/after",
		"wikitext": "== hello there ==\n[[Category:A1]]\n[[Category:A2]]\n\n== hi pal ==\n\n<!--foo-->  [[Category:A3]]\n\n== how goes it ==\n\n== it goes well ==\n[[Category:A4]]  <!--bar-->\n\n__TOC__\n\n== ok ==",
		"parsed": "<markup.heading>==<string.quoted.other.heading> hello there </>==\\n</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>A1</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>A2</><punctuation.definition.tag.link.internal>]]\\n\\n</></><markup.heading>==<string.quoted.other.heading> hi pal </>==\\n\\n</><comment.block.html><punctuation.definition.comment.html>&lt;!--</>foo<punctuation.definition.comment.html>--&gt</></>  <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>A3</><punctuation.definition.tag.link.internal>]]\\n\\n</></><markup.heading>==<string.quoted.other.heading> how goes it </>==\\n\\n==<string.quoted.other.heading> it goes well </>==\\n</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>A4</><punctuation.definition.tag.link.internal>]]</></>  <comment.block.html><punctuation.definition.comment.html>&lt;!--</>bar<punctuation.definition.comment.html>--&gt\\n\\n</></><constant.language.behavior>__TOC__\\n\\n</><markup.heading>==<string.quoted.other.heading> ok </>==</>"
	},
	{
		"desc": "Headings: Don't hoist metas that come from templates",
		"wikitext": "== {{1x|foo [[Category:Foo]]}} ==",
		"parsed": "<markup.heading>==<string.quoted.other.heading> <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.template>}}</> </>==</>"
	},
	{
		"desc": "Parsoid: Serialize positional parameters with = in them as named parameter",
		"wikitext": "{{1x|1=f=oo}}\n\n{{1x|1=f=oo|2=bar}}\n\n<!--Orig params with data-parsoid has heuristics for handling = chars-->\n<!--FIXME: But maybe the heuristic needs fixing to apply to new params as well-->\n{{1x|<nowiki>f=oo</nowiki>|bar}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><entity.other.attribute-name.local-name>1</><keyword.operator.equal>=</>f=oo<punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><entity.other.attribute-name.local-name>1</><keyword.operator.equal>=</>f=oo<keyword.operator>|</><entity.other.attribute-name.local-name>2</><keyword.operator.equal>=</>bar<punctuation.definition.tag.template>}}\\n\\n</><comment.block.html><punctuation.definition.comment.html>&lt;!--</>Orig params with data-parsoid has heuristics for handling = chars<punctuation.definition.comment.html>--&gt\\n&lt;!--</>FIXME: But maybe the heuristic needs fixing to apply to new params as well<punctuation.definition.comment.html>--&gt\\n</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>f=oo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><keyword.operator>|</>bar<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Parsoid: Serialize positional parameters with = in extlink as named parameter",
		"wikitext": "{{1x|1=http://stuff?is=ok}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><entity.other.attribute-name.local-name>1</><keyword.operator.equal>=</>http://stuff?is=ok<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Parsoid: Correctly serialize block-node children when they are a combination of text and p-nodes",
		"wikitext": "<div>a\nb\n</div>\n<div>a\nb\n</div>\n<div>\na\n\nb\n</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>a\\nb\\n<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>a\\nb\\n<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></>a\\n\\nb\\n<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Substrings resembling wikitext in hrefs should not get nowiki escapes",
		"wikitext": "[[Foo''bar''baz]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo''bar''baz</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Ignore single-line context for wikilinks",
		"wikitext": "* [[Foo|\nbar]]\n\n== [[Foo|\nbar]] ==\n\n* [[Foo|bar\n<span style=\"background-color:green;\ncolor:blue\">x</span>]]",
		"parsed": "<punctuation.definition.list.begin.markdown>*</> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|\\n</>bar<punctuation.definition.tag.link.internal>]]\\n\\n</></>== <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|\\n</>bar<punctuation.definition.tag.link.internal>]]</></> ==\\n\\n<punctuation.definition.list.begin.markdown>*</> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</>bar\\n<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>background-color:green;\\ncolor:blue</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>x<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Selser: Ignore single-line context for wikilinks",
		"wikitext": "* [[Foo|\nbar]]",
		"parsed": "<punctuation.definition.list.begin.markdown>*</> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|\\n</>bar<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "1. I/B quote minimization: wikitext-only tags should be combined",
		"wikitext": "''AB''\n\n'''AB'''\n\n''A'''B'''''\n\n'''A''B'''''\n\n'''A''BC''D'''\n\n'''''AB'''''\n\n'''''AB'''''\n\n'''''AB'''''",
		"parsed": "<markup.italic>''</>AB<markup.italic>''\\n\\n</><markup.bold>'''</>AB<markup.bold>'''\\n\\n</><markup.italic>''</>A<markup.bold>'''</>B<markup.bold.italic>'''''\\n\\n</><markup.bold>'''</>A<markup.italic>''</>B<markup.bold.italic>'''''\\n\\n</><markup.bold>'''</>A<markup.italic>''</>BC<markup.italic>''</>D<markup.bold>'''\\n\\n</><markup.bold.italic>'''''</>AB<markup.bold.italic>'''''\\n\\n'''''</>AB<markup.bold.italic>'''''\\n\\n'''''</>AB<markup.bold.italic>'''''</>"
	},
	{
		"desc": "2. I/B quote minimization: wikitext and html tags should not be combined",
		"wikitext": "''A''<i>B</i>\n\n''A''<nowiki/>'''<i>B</i>'''",
		"parsed": "<markup.italic>''</>A<markup.italic>''</><meta.tag.inline.i.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>i</><punctuation.definition.tag.end.html>&gt</></>B<meta.tag.inline.i.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>i</><punctuation.definition.tag.end.html>&gt\\n\\n</></><markup.italic>''</>A<markup.italic>''</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</><markup.bold>'''</><meta.tag.inline.i.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>i</><punctuation.definition.tag.end.html>&gt</></>B<meta.tag.inline.i.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>i</><punctuation.definition.tag.end.html>&gt</></><markup.bold>'''</>"
	},
	{
		"desc": "3. I/B quote minimization: templated content stops minimization",
		"wikitext": "''A''{{1x|''B''}}\n\n''A''{{1x|'''''B'''''}}",
		"parsed": "<markup.italic>''</>A<markup.italic>''</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><markup.italic>''</>B<markup.italic>''</><punctuation.definition.tag.template>}}\\n\\n</><markup.italic>''</>A<markup.italic>''</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><markup.bold.italic>'''''</>B<markup.bold.italic>'''''</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "4. I/B quote minimization: new content should be mimimized with adjacent old content",
		"wikitext": "''AB''\n\n'''AB'''\n\n''A'''B'''''",
		"parsed": "<markup.italic>''</>AB<markup.italic>''\\n\\n</><markup.bold>'''</>AB<markup.bold>'''\\n\\n</><markup.italic>''</>A<markup.bold>'''</>B<markup.bold.italic>'''''</>"
	},
	{
		"desc": "5a. Merge adjacent quote nodes if they've been edited",
		"wikitext": "''a''b''c''",
		"parsed": "<markup.italic>''</>a<markup.italic>''</>b<markup.italic>''</>c<markup.italic>''</>"
	},
	{
		"desc": "5b. Merge adjacent quote nodes if they've been edited",
		"wikitext": "''a''<span id=\"x\">b</span>''c''",
		"parsed": "<markup.italic>''</>a<markup.italic>''</><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>b<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><markup.italic>''</>c<markup.italic>''</>"
	},
	{
		"desc": "1. Merge adjacent link nodes as long as at least one element is new",
		"wikitext": "[[Football]]\n[[Football]]\n[[Football|Foot]][[Football|ball]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Football</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Football</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Football</><keyword.operator>|</>Foot<punctuation.definition.tag.link.internal>]][[</><entity.other.attribute-name>Football</><keyword.operator>|</>ball<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "2. Merge adjacent link nodes and enable additional normalizations",
		"wikitext": "''[[Football]]''",
		"parsed": "<markup.italic>''</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Football</><punctuation.definition.tag.link.internal>]]</></><markup.italic>''</>"
	},
	{
		"desc": "1. Move format tags outside of WikiLink",
		"wikitext": "''[[Football]]''\n'''''[[Football]]'''''\n<u>'''''[[Football]]'''''</u>",
		"parsed": "<markup.italic>''</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Football</><punctuation.definition.tag.link.internal>]]</></><markup.italic>''\\n</><markup.bold.italic>'''''</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Football</><punctuation.definition.tag.link.internal>]]</></><markup.bold.italic>'''''\\n</><meta.tag.inline.u.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>u</><punctuation.definition.tag.end.html>&gt</></><markup.bold.italic>'''''</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Football</><punctuation.definition.tag.link.internal>]]</></><markup.bold.italic>'''''</><meta.tag.inline.u.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>u</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "2. Move format tags outside of WikiLink with mergable A tags",
		"wikitext": "'''''[[Football]]'''''",
		"parsed": "<markup.bold.italic>'''''</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Football</><punctuation.definition.tag.link.internal>]]</></><markup.bold.italic>'''''</>"
	},
	{
		"desc": "3. Move format tags outside of WikiLink while preserving formats already outside WikiLink",
		"wikitext": "<font color=\"red\"><u>'''[[Foo]]'''</u></font>",
		"parsed": "<meta.tag.inline.font.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.deprecated.html>font</></> <meta.attribute.color.html><entity.other.attribute-name.html>color</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>red<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.u.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>u</><punctuation.definition.tag.end.html>&gt</></><markup.bold>'''</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></><markup.bold>'''</><meta.tag.inline.u.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>u</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.font.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.deprecated.html>font</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "4. Do not move format tags outside of WikiLink which includes attributes color, style and class",
		"wikitext": "[[Foo|<font color=\"red\">Foo</font>]]\n[[Foo|<span style=\"color: blue; font-size: 46px;\">Foo></span>]]\n[[Foo|<span class=\"Bar\">Foo</span>]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</><meta.tag.inline.font.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.deprecated.html>font</></> <meta.attribute.color.html><entity.other.attribute-name.html>color</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>red<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>Foo<meta.tag.inline.font.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.deprecated.html>font</></><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Foo</><keyword.operator>|</><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>color: blue; font-size: 46px;</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>Foo&gt<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Foo</><keyword.operator>|</><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>Bar<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>Foo<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "5. T194083 Regression test: Manual edit test to move format tags outside wikilinks",
		"wikitext": "[[Foo]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "6. Regression test: Manual edit test to ensure diff markers are not lost",
		"wikitext": "''Foo''",
		"parsed": "<markup.italic>''</>Foo<markup.italic>''</>"
	},
	{
		"desc": "7. T194083 Regression test: Manual edit test to ensure nested diff markers aren't inserted",
		"wikitext": "<div>placeholder</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>placeholder<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T192913 Regression test: 1. html2wt of links should not trip on parser functions found in target",
		"wikitext": "[[Category:Bugs-{{#if:blah|Regression|None}}]]\n[[Category:Bugs-{{#if:blah|Regression|None}}|{{#if:blah|2020|None}}-#fragment]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Bugs-</><punctuation.definition.tag.function>{{</><constant.language.variables.query>#if</><keyword.operator.function>:</>blah<keyword.operator>|</>Regression<keyword.operator>|</>None<punctuation.definition.tag.function>}}</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Bugs-</><punctuation.definition.tag.function>{{</><constant.language.variables.query>#if</><keyword.operator.function>:</>blah<keyword.operator>|</>Regression<keyword.operator>|</>None<punctuation.definition.tag.function>}}</><keyword.operator>|</><punctuation.definition.tag.function>{{</><constant.language.variables.query>#if</><keyword.operator.function>:</>blah<keyword.operator>|</>2020<keyword.operator>|</>None<punctuation.definition.tag.function>}}</>-#fragment<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T192913 Regression test: 2. html2wt of links should not trip on parser functions found in target (2)",
		"wikitext": "[[Category:Bugs-{{#if:blah|Regression|None}}|fragment]]\n[[Category:Bugs-{{#if:blah|Regression|None}}-{{#if:blah|2020|None}}|fragment]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Bugs-</><punctuation.definition.tag.function>{{</><constant.language.variables.query>#if</><keyword.operator.function>:</>blah<keyword.operator>|</>Regression<keyword.operator>|</>None<punctuation.definition.tag.function>}}</><keyword.operator>|</>fragment<punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Bugs-</><punctuation.definition.tag.function>{{</><constant.language.variables.query>#if</><keyword.operator.function>:</>blah<keyword.operator>|</>Regression<keyword.operator>|</>None<punctuation.definition.tag.function>}}</>-<punctuation.definition.tag.function>{{</><constant.language.variables.query>#if</><keyword.operator.function>:</>blah<keyword.operator>|</>2020<keyword.operator>|</>None<punctuation.definition.tag.function>}}</><keyword.operator>|</>fragment<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T56262: New entities",
		"wikitext": "&nbsp;",
		"parsed": "<constant.character.entity.named.nbsp.html><punctuation.definition.entity.html>&amp;</>nbsp<punctuation.definition.entity.html>;</></>"
	},
	{
		"desc": "Consecutive <pre>s should not get merged",
		"wikitext": " a\n\n b\n\n c\n\n d\n\n e\n \n\n \n f",
		"parsed": " a\\n\\n b\\n\\n c\\n\\n d\\n\\n e\\n \\n\\n \\n f"
	},
	{
		"desc": "Edited ISBN links not serializable as ISBN links should serialize as wikilinks",
		"wikitext": "[[Special:BookSources/1234567890|ISBN 1234567895]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Special:</><entity.other.attribute-name>BookSources/1234567890</><keyword.operator>|</><constant.language.variables.isbn>ISBN 1234567895</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Edited RFC links not serializable as RFC links should serialize as extlinks",
		"wikitext": "[https://tools.ietf.org/html/rfc123 New RFC]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>https://tools.ietf.org/html/rfc123</><string.other.link.external.title> New RFC</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "Edited PMID links not serializable as PMID links should serialize as extlinks",
		"wikitext": "[//www.ncbi.nlm.nih.gov/pubmed/123?dopt=Abstract New PMID]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>//www.ncbi.nlm.nih.gov/pubmed/123?dopt=Abstract</><string.other.link.external.title> New PMID</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "WTS of autolinks with trailing/surrounding context",
		"wikitext": "http://cscott.net'''foo'''\n\nhttp://cscott.net<b>foo</b>\n\n'''http://cscott.net'''\n\n'''http://cscott.net '''\n\n'''http://cscott.net<nowiki/>x'''\n\nhttp://cscott.net<nowiki/>x",
		"parsed": "http://cscott.net<markup.bold>'''</>foo<markup.bold>'''\\n\\n</>http://cscott.net<meta.tag.inline.b.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.inline.b.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt\\n\\n</></><markup.bold>'''</>http://cscott.net<markup.bold>'''\\n\\n'''</>http://cscott.net <markup.bold>'''\\n\\n'''</>http://cscott.net<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>x<markup.bold>'''\\n\\n</>http://cscott.net<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>x"
	},
	{
		"desc": "WTS of autolinks with nowikis (round-trip)",
		"wikitext": "x<nowiki/>http://cscott.net<nowiki/>x",
		"parsed": "x<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>http://cscott.net<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>x"
	},
	{
		"desc": "WTS of autolinks with escapes (editing)",
		"wikitext": "x<nowiki/>http://cscott.net<nowiki/>x",
		"parsed": "x<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>http://cscott.net<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>x"
	},
	{
		"desc": "WTS of edited autolink-like text (T103364)",
		"wikitext": "Not a link: <nowiki>http://example.com</nowiki>.",
		"parsed": "Not a link: <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>http://example.com</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>."
	},
	{
		"desc": "WTS of newly-authored autolink-like text (T103364)",
		"wikitext": "<nowiki>http://example.com</nowiki> is not a link.",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>http://example.com</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</> is not a link."
	},
	{
		"desc": "WTS of autolink-like text after an autolink (T108563)",
		"wikitext": "http://example.com <nowiki>http://example.com</nowiki> is not a link.",
		"parsed": "http://example.com <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>http://example.com</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</> is not a link."
	},
	{
		"desc": "WTS of an autolink surrounded by square brackets (T220018)",
		"wikitext": "<nowiki>[</nowiki>http://example.com]",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>[</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>http://example.com]"
	},
	{
		"desc": "WTS of edited autolink surrounded by square brackets (T220018)",
		"wikitext": "http://example.com",
		"parsed": "http://example.com"
	},
	{
		"desc": "WTS of an external link surrounded by square brackets (T220018)",
		"wikitext": "<nowiki>[</nowiki>[http://example.com foo]]",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>[</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com</><string.other.link.external.title> foo</><punctuation.definition.tag.link.external>]</>]"
	},
	{
		"desc": "WTS of edited external link surrounded by square brackets (T220018)",
		"wikitext": "[http://example.com foo]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com</><string.other.link.external.title> foo</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "Magic links inside links (not autolinked)",
		"wikitext": "[[Foo|http://example.com]]\n[[Foo|RFC 1234]]\n[[Foo|PMID 1234]]\n[[Foo|ISBN 123456789x]]\n\n[http://foo.com http://example.com]\n[http://foo.com RFC 1234]\n[http://foo.com PMID 1234]\n[http://foo.com ISBN 123456789x]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</>http://example.com<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Foo</><keyword.operator>|</><constant.language.variables.rfc>RFC 1234</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Foo</><keyword.operator>|</><constant.language.variables.pmid>PMID 1234</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Foo</><keyword.operator>|</><constant.language.variables.isbn>ISBN 123456789x</><punctuation.definition.tag.link.internal>]]\\n\\n</></><punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://foo.com</><string.other.link.external.title> http://example.com</><punctuation.definition.tag.link.external>]\\n[</><entity.name.tag.url>http://foo.com</><string.other.link.external.title> <constant.language.variables.rfc>RFC 1234</></><punctuation.definition.tag.link.external>]\\n[</><entity.name.tag.url>http://foo.com</><string.other.link.external.title> <constant.language.variables.pmid>PMID 1234</></><punctuation.definition.tag.link.external>]\\n[</><entity.name.tag.url>http://foo.com</><string.other.link.external.title> <constant.language.variables.isbn>ISBN 123456789x</></><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "WTS of magic word text (T109371)",
		"wikitext": "<nowiki>RFC 1234</nowiki>\n\n[http://foo.com RFC 1234]\n\n[[Foo|RFC 1234]]",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>RFC 1234</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://foo.com</><string.other.link.external.title> <constant.language.variables.rfc>RFC 1234</></><punctuation.definition.tag.link.external>]\\n\\n</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</><constant.language.variables.rfc>RFC 1234</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Edited Redirect link should emit a non-piped wikitext link",
		"wikitext": "#REDIRECT [[Bar]]",
		"parsed": "<keyword.control.redirect>#REDIRECT</> <punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Bar</><punctuation.definition.tag.link.internal>]]</>"
	},
	{
		"desc": "T75121: Infer extension name from typeOf if data-mw is not present",
		"wikitext": "<foo />",
		"parsed": "<meta.tag.other.foo.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>foo</></><punctuation.definition.tag.end.html> /&gt</></>"
	},
	{
		"desc": "T88318: p-wrapped dash in table.",
		"wikitext": "{|\n!-\n!- \n|-\n|<nowiki>-</nowiki>\n|<nowiki>- </nowiki>\n|-\n|<small>-</small>\n|<br />\n-\n|<br />-\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</><markup.style>-\\n</><keyword.operator>!</><markup.style>- \\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>-</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n</></><keyword.operator>|</><markup.style><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>- </><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n</></></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style><meta.tag.inline.small.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt</></>-<meta.tag.inline.small.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt\\n</></></><keyword.operator>|</><markup.style><meta.tag.inline.br.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>br</> <punctuation.definition.tag.end.html>/&gt\\n</></></></>-\\n<meta.tag.block.td><keyword.operator>|</><markup.style><meta.tag.inline.br.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>br</> <punctuation.definition.tag.end.html>/&gt</></>-\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "T149209: WTS: Handle newlines in table cells properly",
		"wikitext": "{|\n|a\nb\n|c\n|-\n|x\n{{!}}y\n|}\n{|\n!a\nb\n!c\n|-\n!x\n!y\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>a\\n</></>b\\n<meta.tag.block.td><keyword.operator>|</><markup.style>c\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>x\\n</><keyword.operator>{{!}}</><markup.style>y\\n</></><keyword.operator>|}\\n{|\\n</><meta.tag.block.th><keyword.operator>!</><markup.style>a\\n</></>b\\n<meta.tag.block.th><keyword.operator>!</><markup.style>c\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.th><keyword.operator>!</><markup.style>x\\n</><keyword.operator>!</><markup.style>y\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "T149209: Selser: Handle newlines in table cells properly",
		"wikitext": "{|\n! id=\"h1\" |edit-me!!1\n|-\n! id=\"h2\" |edit-me||2\n|-\n| id=\"c1\" |edit-me||3\n|-\n| id=\"c2\" |edit-me||4\n|-\n| id=\"c3\" |edit-me||p||q||r\n|-\n| id=\"c4\" |edit-me||p||q||r\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>h1<punctuation.definition.string.end.html>\"</></> </><keyword.operator>|</><markup.style>edit-me</><keyword.operator>!!</><markup.style>1\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.th><keyword.operator>!</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>h2<punctuation.definition.string.end.html>\"</></> </><keyword.operator>|</><markup.style>edit-me</><keyword.operator>||</><markup.style>2\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>c1<punctuation.definition.string.end.html>\"</></> </><keyword.operator>|</><markup.style>edit-me</><keyword.operator>||</><markup.style>3\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>c2<punctuation.definition.string.end.html>\"</></> </><keyword.operator>|</><markup.style>edit-me</><keyword.operator>||</><markup.style>4\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>c3<punctuation.definition.string.end.html>\"</></> </><keyword.operator>|</><markup.style>edit-me</><keyword.operator>||</><markup.style>p</><keyword.operator>||</><markup.style>q</><keyword.operator>||</><markup.style>r\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>c4<punctuation.definition.string.end.html>\"</></> </><keyword.operator>|</><markup.style>edit-me</><keyword.operator>||</><markup.style>p</><keyword.operator>||</><markup.style>q</><keyword.operator>||</><markup.style>r\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "HTML id attribute with Parsoid-like element ids should not be serialized to wikitext",
		"wikitext": "{|\n|foo\n| id=\"serialize-this\" |bar\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>foo\\n</><keyword.operator>|</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>serialize-this<punctuation.definition.string.end.html>\"</></> </><keyword.operator>|</><markup.style>bar\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Parsoid-like element ids should not be serialized to wikitext unless shadowed",
		"wikitext": "<div id=\"hello\">ok</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>hello<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>ok<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Testing serialization after deletion of table cells",
		"wikitext": "{|\n!h1 !!h2 !!h3\n| id=\"x\" |c1 {{!}}{{!}}{{!}}c2 |||c3\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</><markup.style>h1 </><keyword.operator>!!</><markup.style>h2 </><keyword.operator>!!</><markup.style>h3\\n</></><meta.tag.block.td><keyword.operator>|</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></> </><keyword.operator>|</><markup.style>c1 </><keyword.operator>{{!}}{{!}}{{!}}</><markup.style>c2 </><keyword.operator>|||</><markup.style>c3\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Testing selser after addition of new row before first row (T125419)",
		"wikitext": "{|\n|a\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>a\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Serialize new table rows in a HTML table using HTML tags",
		"wikitext": "<table><tr><td>a</td></tr></table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>a<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Serialize new table cells in a HTML row using HTML tags",
		"wikitext": "<table><tr><td>a</td></tr></table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>a<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Serialize wikitext list items as HTML list items when embedded in a HTML list",
		"wikitext": "<ul>\n<li>a</li>\n<li>b</li>\n</ul>",
		"parsed": "<meta.tag.structure.ul.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>a<meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>b<meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.ul.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Wikitext lists can be nested inside HTML lists",
		"wikitext": "<ul>\n<li>a\n* b\n</li>\n</ul>\n\n<ul>\n<li>x\n* y\n</li>\n</ul>",
		"parsed": "<meta.tag.structure.ul.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>a\\n<punctuation.definition.list.begin.markdown>*</> b\\n<meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.ul.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.structure.ul.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>x\\n<punctuation.definition.list.begin.markdown>*</> y\\n<meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.ul.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "WTS change modes",
		"wikitext": "<span id=\"xyz\">hello</span>",
		"parsed": "<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>xyz<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>hello<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Never serialize a-tag as html, regardless of what data-parsoid has to say",
		"wikitext": "[[Foo]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Never serialize a-tag as html, no matter what attributes it has",
		"wikitext": "[http://boo.org http://boohoo.org]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://boo.org</><string.other.link.external.title> http://boohoo.org</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "Strip span tags added to mark misnested links",
		"wikitext": "[http://test.com][[one]] two three",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://test.com</><punctuation.definition.tag.link.external>]</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>one</><punctuation.definition.tag.link.internal>]]</></> two three"
	},
	{
		"desc": "Catch regression when unpacking misnested links",
		"wikitext": "{{1x|hi}}[http://example.com [[ho]]]",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>hi<punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com</><string.other.link.external.title> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>ho</></></><punctuation.definition.tag.link.external>]</>]]"
	},
	{
		"desc": "Use data-parsoid.firstWikitextNode to compute newline constraints for template content",
		"wikitext": "{{1x|a}}\n{|{{1x|c\n{{!}}d\n}}\n|}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>a<punctuation.definition.tag.template>}}\\n</><meta.tag.block.table><keyword.operator>{|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>c\\n<meta.tag.block.td><keyword.operator>{{!}}</><markup.style>d\\n</></>}}\\n<keyword.operator>|}</></>"
	},
	{
		"desc": "data-parsoid.firstWikitextNode should be computed properly in the presence of fostered content",
		"wikitext": "<div id=\"x\">foo</div>\n{|\n{{1x|<div>boo</div>\n{{!}}b}}\n|c\n|}",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.block.table><keyword.operator>{|\\n</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>boo<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></><constant.language.variables.metadata>{{!}}</>b<punctuation.definition.tag.template>}}\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>c\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Serialize multi-line indent-pre starting with wikitext syntax",
		"wikitext": " * 1\n ** 2\n * 3",
		"parsed": " * 1\\n ** 2\\n * 3"
	},
	{
		"desc": "1. Categories should always be serialized on their own line",
		"wikitext": "foo\n[[Category:Foo]]\nbar",
		"parsed": "foo\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]\\n</></>bar"
	},
	{
		"desc": "2. Categories that are part of templates should not introduce a line break",
		"wikitext": "foo {{1x|<span>bar</span> [[Category:baz]]}} bar",
		"parsed": "foo <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>bar<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>baz</><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.template>}}</> bar"
	},
	{
		"desc": "RTL (\\u200f) and LTR (\\u200e) markers around category tags should be stripped",
		"wikitext": "[[×§×˜×’×•×¨×™×”:×˜×§×¡×™×]]\n[[×§×˜×’×•×¨×™×”: ×©×™×˜×•×ª ××©×¤×˜]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>×§×˜×’×•×¨×™×”:×˜×§×¡×™×</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>×§×˜×’×•×¨×™×”: ×©×™×˜×•×ª ××©×¤×˜</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "RTL (\\u200f) and LTR (\\u200e) markers should not be stripped if followed by a text node",
		"wikitext": "[[×§×˜×’×•×¨×™×”:×˜×§×¡×™×]]\nâ€y",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>×§×˜×’×•×¨×™×”:×˜×§×¡×™×</><punctuation.definition.tag.link.internal>]]\\n</></>â€y"
	},
	{
		"desc": "Lists: Add space after bullets",
		"wikitext": "* foo\n* bar\n* <span> baz</span>",
		"parsed": "<punctuation.definition.list.begin.markdown>*</> foo\\n<punctuation.definition.list.begin.markdown>*</> bar\\n<punctuation.definition.list.begin.markdown>*</> <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></> baz<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "1. Headings: Add space before/after == (T53744)",
		"wikitext": "== foo ==\n\n== bar ==\n\n== baz ==\n\n== <span> baz</span> ==",
		"parsed": "<markup.heading>==<string.quoted.other.heading> foo </>==\\n\\n==<string.quoted.other.heading> bar </>==\\n\\n==<string.quoted.other.heading> baz </>==\\n\\n==<string.quoted.other.heading> <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></> baz<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></> </>==</>"
	},
	{
		"desc": "2. Headings: Add space before/after == even after hoisted content",
		"wikitext": "[[Category:A2]]\n\n== ok ==",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>A2</><punctuation.definition.tag.link.internal>]]\\n\\n</></><markup.heading>==<string.quoted.other.heading> ok </>==</>"
	},
	{
		"desc": "2. Headings: suppress empty headings on edits",
		"wikitext": "==<span id=\"x\">foo</span>==",
		"parsed": "<markup.heading>==<string.quoted.other.heading><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></></>==</>"
	},
	{
		"desc": "Headings: Replace <br/> with a single whitespace char",
		"wikitext": "== foo bar ==\n\n== foo <span> bar</span> baz ==",
		"parsed": "<markup.heading>==<string.quoted.other.heading> foo bar </>==\\n\\n==<string.quoted.other.heading> foo <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></> bar<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></> baz </>==</>"
	},
	{
		"desc": "2. WT Quote Tags: suppress empty style tags on edits",
		"wikitext": "'''<span id=\"x\">foo</span>'''",
		"parsed": "<markup.bold>'''</><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><markup.bold>'''</>"
	},
	{
		"desc": "2. Anchors: suppress empty anchors on edits",
		"wikitext": "[[Test|<span id=\"x\">foo</span>]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Test</><keyword.operator>|</><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "3a. Anchors: do not suppress numbered extlinks",
		"wikitext": "[http://foo.com]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://foo.com</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "3b. Anchors: do not suppress numbered extlinks",
		"wikitext": "[http://foo.com <span id=\"x\">foo</span>]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://foo.com</><string.other.link.external.title> <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></></><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "Normalizations should be restricted to edited content",
		"wikitext": "a\n= =\nb",
		"parsed": "a\\n<markup.heading>=<string.quoted.other.heading> </>=\\n</>b"
	},
	{
		"desc": "1. Multiple normalizations (html2wt)",
		"wikitext": "[[foo]]\nx",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>foo</><punctuation.definition.tag.link.internal>]]\\n</></>x"
	},
	{
		"desc": "2. Multiple normalizations (selser)",
		"wikitext": "<div id=\"x\">foo</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "1. Indent Pre Nowiki: suppress whitespace at the start of new paragraph",
		"wikitext": "hi\n\nhello",
		"parsed": "hi\\n\\nhello"
	},
	{
		"desc": "2. Indent Pre Nowiki: suppress whitespace after newlines in new paragraph or table cell",
		"wikitext": "Foo\nbar\nbaz\n\n{|\n|Foo\nbar\nbaz bang\n|}\n\n<!--boo-->foo\nbar\n\nfoo\nbar<span>boo</span>",
		"parsed": "Foo\\nbar\\nbaz\\n\\n<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>Foo\\n</></>bar\\nbaz bang\\n<keyword.operator>|}\\n\\n</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</>boo<punctuation.definition.comment.html>--&gt</></>foo\\nbar\\n\\nfoo\\nbar<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>boo<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "3. Indent Pre Nowiki: suppress leading whitespace in edited paragraphs",
		"wikitext": "xyz",
		"parsed": "xyz"
	},
	{
		"desc": "New links that end in spaces",
		"wikitext": "[[Berlin]] is the capital of Germany.\n\n[[Foo]] '''bar'''\n\n[[Boston]] is a city.",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Berlin</><punctuation.definition.tag.link.internal>]]</></> is the capital of Germany.\\n\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></> <markup.bold>'''</>bar<markup.bold>'''\\n\\n</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Boston</><punctuation.definition.tag.link.internal>]]</></> is a city."
	},
	{
		"desc": "1. Table cells with escapable prefixes",
		"wikitext": "{|\n|a\n|-\n| -\n|-\n| +\n|-\n| }\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>a\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style> -\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style> +\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style> }\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "2a. Table cells with escapable prefixes after edits",
		"wikitext": "{|\n|a||-\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>a</><keyword.operator>||</><markup.style>-\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "2b. Table cells with escapable prefixes after edits",
		"wikitext": "{|\n|pqr\n|<span id=\"x\">foo</span>+\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>pqr\\n</><keyword.operator>|</><markup.style><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>+\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "3a. Table cells without escapable prefixes after edits",
		"wikitext": "{|\n| id=\"x\" |abcd\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></> </><keyword.operator>|</><markup.style>abcd\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "3b. Table cells without escapable prefixes after edits",
		"wikitext": "{|\n|a||b\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>a</><keyword.operator>||</><markup.style>b\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "3c. Table cells without escapable prefixes after edits",
		"wikitext": "{|\n|-\n<!--foo--> |a||-\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.table-row><keyword.operator>|-\\n</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</>foo<punctuation.definition.comment.html>--&gt</></> |a||-\\n<keyword.operator>|}</></>"
	},
	{
		"desc": "3d. Table cells without escapable prefixes after edits",
		"wikitext": "<table>\n<tr><td>a</td></tr>\n</table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>a<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "4. font tags without attributes should be dropped",
		"wikitext": "foo\nbar\n<font class=\"x\">boo</font>",
		"parsed": "foo\\nbar\\n<meta.tag.inline.font.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.deprecated.html>font</></> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>boo<meta.tag.inline.font.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.deprecated.html>font</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Normalize empty paragraphs to HTML form that html2wt expects",
		"wikitext": "<div>1</div>\na\n\n\nb\n<div>2</div>\na\n\n\nb\n<div>3</div>\na\n\n\n\n\n\nb\n<div>4</div>\na\n\n<div>foo</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>1<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></>a\\n\\n\\nb\\n<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>2<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></>a\\n\\n\\nb\\n<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>3<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></>a\\n\\n\\n\\n\\n\\nb\\n<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>4<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></>a\\n\\n<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Templated content should be skipped over by normalization",
		"wikitext": "{{SomeTemplate1|boo}}{{SomeTemplate2|booboo}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>SomeTemplate1</><keyword.operator>|</>boo<punctuation.definition.tag.template>}}{{</><entity.name.tag.local-name>SomeTemplate2</><keyword.operator>|</>booboo<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Escape DOM elements",
		"wikitext": "&lt;nowiki&gt;''foo''&lt;/nowiki&gt;\n&lt;noinclude&gt;''foo''&lt;/noinclude&gt;\n&lt;includeonly&gt;''foo''&lt;/includeonly&gt;",
		"parsed": "<constant.character.entity.named.lt.html><punctuation.definition.entity.html>&amp;</>lt<punctuation.definition.entity.html>;</></>nowiki<constant.character.entity.named.gt.html><punctuation.definition.entity.html>&amp;</>gt<punctuation.definition.entity.html>;</></><markup.italic>''</>foo<markup.italic>''</><constant.character.entity.named.lt.html><punctuation.definition.entity.html>&amp;</>lt<punctuation.definition.entity.html>;</></>/nowiki<constant.character.entity.named.gt.html><punctuation.definition.entity.html>&amp;</>gt<punctuation.definition.entity.html>;\\n</></><constant.character.entity.named.lt.html><punctuation.definition.entity.html>&amp;</>lt<punctuation.definition.entity.html>;</></>noinclude<constant.character.entity.named.gt.html><punctuation.definition.entity.html>&amp;</>gt<punctuation.definition.entity.html>;</></><markup.italic>''</>foo<markup.italic>''</><constant.character.entity.named.lt.html><punctuation.definition.entity.html>&amp;</>lt<punctuation.definition.entity.html>;</></>/noinclude<constant.character.entity.named.gt.html><punctuation.definition.entity.html>&amp;</>gt<punctuation.definition.entity.html>;\\n</></><constant.character.entity.named.lt.html><punctuation.definition.entity.html>&amp;</>lt<punctuation.definition.entity.html>;</></>includeonly<constant.character.entity.named.gt.html><punctuation.definition.entity.html>&amp;</>gt<punctuation.definition.entity.html>;</></><markup.italic>''</>foo<markup.italic>''</><constant.character.entity.named.lt.html><punctuation.definition.entity.html>&amp;</>lt<punctuation.definition.entity.html>;</></>/includeonly<constant.character.entity.named.gt.html><punctuation.definition.entity.html>&amp;</>gt<punctuation.definition.entity.html>;</></>"
	},
	{
		"desc": "Don't escape pre elements that fail to parse as extension tags",
		"wikitext": "<pre>closed is extension tag, so everything is <span>text</span></pre>\n<pre>unclosed is not, so these are <span>tags</span>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>closed is extension tag, so everything is &lt;span&gttext&lt;/span&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>unclosed is not, so these are &lt;span&gttags&lt;/span&gt</>"
	},
	{
		"desc": "New list is serialized on newlines",
		"wikitext": "The quick brown fox jumps over the lazy dog.\n\n* Yesterday\n* Today\n* Tomorrow\n\nThe quick onyx goblin jumps over the lazy dwarf.",
		"parsed": "The quick brown fox jumps over the lazy dog.\\n\\n<punctuation.definition.list.begin.markdown>*</> Yesterday\\n<punctuation.definition.list.begin.markdown>*</> Today\\n<punctuation.definition.list.begin.markdown>*</> Tomorrow\\n\\nThe quick onyx goblin jumps over the lazy dwarf."
	},
	{
		"desc": "New lists in formatting elements serialized w/o newlines",
		"wikitext": "<small>\n* 123\n</small>\n\n<small>\n* hi\n</small>",
		"parsed": "<meta.tag.inline.small.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.list.begin.markdown>*</> 123\\n<meta.tag.inline.small.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.inline.small.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.list.begin.markdown>*</> hi\\n<meta.tag.inline.small.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "New list in table doesn't need newlines",
		"wikitext": "{|\n|\n* test\n* 123\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|\\n</></><punctuation.definition.list.begin.markdown>*</> test\\n<punctuation.definition.list.begin.markdown>*</> 123\\n<keyword.operator>|}</></>"
	},
	{
		"desc": "Newly inserted noinclude tags do not need newlines before/after",
		"wikitext": "a<noinclude>b</noinclude>c",
		"parsed": "a<punctuation.definition.tag.begin>&lt;</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</>b<punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</>c"
	},
	{
		"desc": "Bare inline nodes not wrapped inside p-tags should be treated as p-wrapped",
		"wikitext": "a\n\nb\n\n'''c'''\n\nd\n{|\n|a\nb\n|'''c'''\nd\n|}",
		"parsed": "a\\n\\nb\\n\\n<markup.bold>'''</>c<markup.bold>'''\\n\\n</>d\\n<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>a\\n</></>b\\n<meta.tag.block.td><keyword.operator>|</><markup.style><markup.bold>'''</>c<markup.bold>'''\\n</></></>d\\n<keyword.operator>|}</></>"
	},
	{
		"desc": "Anchor without href scenarios",
		"wikitext": "dice\n<span name=\"foo\"></span>",
		"parsed": "dice\\n<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "New transclusion added after a list should be serialized after the list",
		"wikitext": "* a\n{{1x|foo}}",
		"parsed": "<punctuation.definition.list.begin.markdown>*</> a\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Only html p-tag is strong indent pre suppressing",
		"wikitext": "test2<span>\ntest3\n</span>",
		"parsed": "test2<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n</></>test3\\n<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T238721: New transclusion without the \"i\" property for a template part should be handled properly",
		"wikitext": "{{1x}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Selser: New comments should not be lost",
		"wikitext": "<span id=\"a\">a</span>\n\n<span id=\"b\">b</span>",
		"parsed": "<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>a<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>b<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Selser: Check for validity of DSR before using it",
		"wikitext": "<span id=\"a\">a</span>",
		"parsed": "<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>a<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "DOMDiff: Edits to content nested in elements with templated attributes should not be lost (T139388)",
		"wikitext": "<div style=\"{{1x|color:red;}}%\">foo</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>{{1x|color:red;}}%</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Empty LI (T49673)",
		"wikitext": "*a\n* \n*\n*b",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>a\\n<punctuation.definition.list.begin.markdown>*</> \\n<punctuation.definition.list.begin.markdown>*\\n*</>b"
	},
	{
		"desc": "unclosed internal link XSS (T137264)",
		"wikitext": "[[#%3Cscript%3Ealert(1)%3C/script%3E|",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#<invalid.deprecated.ineffective>%3C</>script<invalid.deprecated.ineffective>%3E</>alert(1)<invalid.deprecated.ineffective>%3C</>/script<invalid.deprecated.ineffective>%3E</></><keyword.operator>|</></>"
	},
	{
		"desc": "Validating that <style> isn't eaten by tidy (T167349)",
		"wikitext": "<div class=\"foo\">\n<style>.foo::before { content: \"<foo>\"; }</style>\n<style data-mw-foobar=\"baz\">.foo::after { content: \"<bar>\"; }</style>\n</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt\\n</></><meta.embedded.block.html><meta.tag.metadata.style.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt</></><source.css><meta.selector.css><entity.other.attribute-name.class.css><punctuation.definition.entity.css>.</>foo</><entity.other.attribute-name.pseudo-element.css><punctuation.definition.entity.css>::</>before</></> <meta.property-list.css><punctuation.section.property-list.begin.bracket.curly.css>{</> <meta.property-name.css><support.type.property-name.css>content</></><punctuation.separator.key-value.css>:</> <meta.property-value.css><string.quoted.double.css><punctuation.definition.string.begin.css>\"</>&lt;foo&gt<punctuation.definition.string.end.css>\"</></></><punctuation.terminator.rule.css>;</> <punctuation.section.property-list.end.bracket.curly.css>}</></></><meta.tag.metadata.style.end.html><punctuation.definition.tag.begin.html><source.css-ignored-vscode>&lt;</>/</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.metadata.style.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>style</> <meta.attribute.data-x.data-mw-foobar.html><entity.other.attribute-name.html>data-mw-foobar</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>baz<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></><source.css><meta.selector.css><entity.other.attribute-name.class.css><punctuation.definition.entity.css>.</>foo</><entity.other.attribute-name.pseudo-element.css><punctuation.definition.entity.css>::</>after</></> <meta.property-list.css><punctuation.section.property-list.begin.bracket.curly.css>{</> <meta.property-name.css><support.type.property-name.css>content</></><punctuation.separator.key-value.css>:</> <meta.property-value.css><string.quoted.double.css><punctuation.definition.string.begin.css>\"</>&lt;bar&gt<punctuation.definition.string.end.css>\"</></></><punctuation.terminator.rule.css>;</> <punctuation.section.property-list.end.bracket.curly.css>}</></></><meta.tag.metadata.style.end.html><punctuation.definition.tag.begin.html><source.css-ignored-vscode>&lt;</>/</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt\\n</></></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Validating that <style> isn't wrapped in a paragraph (T186965)",
		"wikitext": "A style tag, by itself or with other style/link tags, shouldn't be wrapped in a paragraph\n\n<style>.foo::before { content: \"<foo>\"; }</style>\n\n<style>.foo::before { content: \"<foo>\"; }</style> <link rel=\"foo\" href=\"bar\"/><style>.foo::before { content: \"<foo>\"; }</style>\n\nBut if it's on a line with other content, let it be wrapped.\n\n<style>.foo::before { content: \"<foo>\"; }</style> bar\n\nfoo <style>.foo::before { content: \"<foo>\"; }</style>\n\nfoo <style>.foo::before { content: \"<foo>\"; }</style> bar\n\nAnd the same if we have non-paragraph-breaking whitespace\n\nfoo\n<style>.foo::before { content: \"<foo>\"; }</style>\nbar",
		"parsed": "A style tag, by itself or with other style/link tags, shouldn't be wrapped in a paragraph\\n\\n<meta.embedded.block.html><meta.tag.metadata.style.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt</></><source.css><meta.selector.css><entity.other.attribute-name.class.css><punctuation.definition.entity.css>.</>foo</><entity.other.attribute-name.pseudo-element.css><punctuation.definition.entity.css>::</>before</></> <meta.property-list.css><punctuation.section.property-list.begin.bracket.curly.css>{</> <meta.property-name.css><support.type.property-name.css>content</></><punctuation.separator.key-value.css>:</> <meta.property-value.css><string.quoted.double.css><punctuation.definition.string.begin.css>\"</>&lt;foo&gt<punctuation.definition.string.end.css>\"</></></><punctuation.terminator.rule.css>;</> <punctuation.section.property-list.end.bracket.curly.css>}</></></><meta.tag.metadata.style.end.html><punctuation.definition.tag.begin.html><source.css-ignored-vscode>&lt;</>/</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.metadata.style.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt</></><source.css><meta.selector.css><entity.other.attribute-name.class.css><punctuation.definition.entity.css>.</>foo</><entity.other.attribute-name.pseudo-element.css><punctuation.definition.entity.css>::</>before</></> <meta.property-list.css><punctuation.section.property-list.begin.bracket.curly.css>{</> <meta.property-name.css><support.type.property-name.css>content</></><punctuation.separator.key-value.css>:</> <meta.property-value.css><string.quoted.double.css><punctuation.definition.string.begin.css>\"</>&lt;foo&gt<punctuation.definition.string.end.css>\"</></></><punctuation.terminator.rule.css>;</> <punctuation.section.property-list.end.bracket.curly.css>}</></></><meta.tag.metadata.style.end.html><punctuation.definition.tag.begin.html><source.css-ignored-vscode>&lt;</>/</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt</></></> <meta.tag.metadata.link.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>link</> <meta.attribute.rel.html><entity.other.attribute-name.html>rel</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></> <meta.attribute.href.html><entity.other.attribute-name.html>href</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>bar<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>/&gt</></><meta.embedded.block.html><meta.tag.metadata.style.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt</></><source.css><meta.selector.css><entity.other.attribute-name.class.css><punctuation.definition.entity.css>.</>foo</><entity.other.attribute-name.pseudo-element.css><punctuation.definition.entity.css>::</>before</></> <meta.property-list.css><punctuation.section.property-list.begin.bracket.curly.css>{</> <meta.property-name.css><support.type.property-name.css>content</></><punctuation.separator.key-value.css>:</> <meta.property-value.css><string.quoted.double.css><punctuation.definition.string.begin.css>\"</>&lt;foo&gt<punctuation.definition.string.end.css>\"</></></><punctuation.terminator.rule.css>;</> <punctuation.section.property-list.end.bracket.curly.css>}</></></><meta.tag.metadata.style.end.html><punctuation.definition.tag.begin.html><source.css-ignored-vscode>&lt;</>/</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt\\n\\n</></></>But if it's on a line with other content, let it be wrapped.\\n\\n<meta.embedded.block.html><meta.tag.metadata.style.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt</></><source.css><meta.selector.css><entity.other.attribute-name.class.css><punctuation.definition.entity.css>.</>foo</><entity.other.attribute-name.pseudo-element.css><punctuation.definition.entity.css>::</>before</></> <meta.property-list.css><punctuation.section.property-list.begin.bracket.curly.css>{</> <meta.property-name.css><support.type.property-name.css>content</></><punctuation.separator.key-value.css>:</> <meta.property-value.css><string.quoted.double.css><punctuation.definition.string.begin.css>\"</>&lt;foo&gt<punctuation.definition.string.end.css>\"</></></><punctuation.terminator.rule.css>;</> <punctuation.section.property-list.end.bracket.curly.css>}</></></><meta.tag.metadata.style.end.html><punctuation.definition.tag.begin.html><source.css-ignored-vscode>&lt;</>/</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt</></></> bar\\n\\nfoo <meta.embedded.block.html><meta.tag.metadata.style.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt</></><source.css><meta.selector.css><entity.other.attribute-name.class.css><punctuation.definition.entity.css>.</>foo</><entity.other.attribute-name.pseudo-element.css><punctuation.definition.entity.css>::</>before</></> <meta.property-list.css><punctuation.section.property-list.begin.bracket.curly.css>{</> <meta.property-name.css><support.type.property-name.css>content</></><punctuation.separator.key-value.css>:</> <meta.property-value.css><string.quoted.double.css><punctuation.definition.string.begin.css>\"</>&lt;foo&gt<punctuation.definition.string.end.css>\"</></></><punctuation.terminator.rule.css>;</> <punctuation.section.property-list.end.bracket.curly.css>}</></></><meta.tag.metadata.style.end.html><punctuation.definition.tag.begin.html><source.css-ignored-vscode>&lt;</>/</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt\\n\\n</></></>foo <meta.embedded.block.html><meta.tag.metadata.style.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt</></><source.css><meta.selector.css><entity.other.attribute-name.class.css><punctuation.definition.entity.css>.</>foo</><entity.other.attribute-name.pseudo-element.css><punctuation.definition.entity.css>::</>before</></> <meta.property-list.css><punctuation.section.property-list.begin.bracket.curly.css>{</> <meta.property-name.css><support.type.property-name.css>content</></><punctuation.separator.key-value.css>:</> <meta.property-value.css><string.quoted.double.css><punctuation.definition.string.begin.css>\"</>&lt;foo&gt<punctuation.definition.string.end.css>\"</></></><punctuation.terminator.rule.css>;</> <punctuation.section.property-list.end.bracket.curly.css>}</></></><meta.tag.metadata.style.end.html><punctuation.definition.tag.begin.html><source.css-ignored-vscode>&lt;</>/</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt</></></> bar\\n\\nAnd the same if we have non-paragraph-breaking whitespace\\n\\nfoo\\n<meta.embedded.block.html><meta.tag.metadata.style.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt</></><source.css><meta.selector.css><entity.other.attribute-name.class.css><punctuation.definition.entity.css>.</>foo</><entity.other.attribute-name.pseudo-element.css><punctuation.definition.entity.css>::</>before</></> <meta.property-list.css><punctuation.section.property-list.begin.bracket.curly.css>{</> <meta.property-name.css><support.type.property-name.css>content</></><punctuation.separator.key-value.css>:</> <meta.property-value.css><string.quoted.double.css><punctuation.definition.string.begin.css>\"</>&lt;foo&gt<punctuation.definition.string.end.css>\"</></></><punctuation.terminator.rule.css>;</> <punctuation.section.property-list.end.bracket.curly.css>}</></></><meta.tag.metadata.style.end.html><punctuation.definition.tag.begin.html><source.css-ignored-vscode>&lt;</>/</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt\\n</></></>bar"
	},
	{
		"desc": "Validating that <link> isn't wrapped in a paragraph (T186965)",
		"wikitext": "A link tag, by itself or with other style/link tags, shouldn't be wrapped in a paragraph\n\n<link rel=\"foo\" href=\"bar\"/>\n\n<link rel=\"foo\" href=\"bar\"/> <style>.foo::before { content: \"<foo>\"; }</style><link rel=\"foo\" href=\"bar\"/>\n\nBut if it's on a line with other content, let it be wrapped.\n\n<link rel=\"foo\" href=\"bar\"/> bar\n\nfoo <link rel=\"foo\" href=\"bar\"/>\n\nfoo <link rel=\"foo\" href=\"bar\"/> bar\n\nAnd the same if we have non-paragraph-breaking whitespace\n\nfoo\n<link rel=\"foo\" href=\"bar\"/>\nbar",
		"parsed": "A link tag, by itself or with other style/link tags, shouldn't be wrapped in a paragraph\\n\\n<meta.tag.metadata.link.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>link</> <meta.attribute.rel.html><entity.other.attribute-name.html>rel</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></> <meta.attribute.href.html><entity.other.attribute-name.html>href</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>bar<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>/&gt\\n\\n</><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>link</> <meta.attribute.rel.html><entity.other.attribute-name.html>rel</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></> <meta.attribute.href.html><entity.other.attribute-name.html>href</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>bar<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>/&gt</></> <meta.embedded.block.html><meta.tag.metadata.style.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt</></><source.css><meta.selector.css><entity.other.attribute-name.class.css><punctuation.definition.entity.css>.</>foo</><entity.other.attribute-name.pseudo-element.css><punctuation.definition.entity.css>::</>before</></> <meta.property-list.css><punctuation.section.property-list.begin.bracket.curly.css>{</> <meta.property-name.css><support.type.property-name.css>content</></><punctuation.separator.key-value.css>:</> <meta.property-value.css><string.quoted.double.css><punctuation.definition.string.begin.css>\"</>&lt;foo&gt<punctuation.definition.string.end.css>\"</></></><punctuation.terminator.rule.css>;</> <punctuation.section.property-list.end.bracket.curly.css>}</></></><meta.tag.metadata.style.end.html><punctuation.definition.tag.begin.html><source.css-ignored-vscode>&lt;</>/</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt</></></><meta.tag.metadata.link.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>link</> <meta.attribute.rel.html><entity.other.attribute-name.html>rel</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></> <meta.attribute.href.html><entity.other.attribute-name.html>href</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>bar<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>/&gt\\n\\n</></>But if it's on a line with other content, let it be wrapped.\\n\\n<meta.tag.metadata.link.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>link</> <meta.attribute.rel.html><entity.other.attribute-name.html>rel</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></> <meta.attribute.href.html><entity.other.attribute-name.html>href</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>bar<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>/&gt</></> bar\\n\\nfoo <meta.tag.metadata.link.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>link</> <meta.attribute.rel.html><entity.other.attribute-name.html>rel</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></> <meta.attribute.href.html><entity.other.attribute-name.html>href</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>bar<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>/&gt\\n\\n</></>foo <meta.tag.metadata.link.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>link</> <meta.attribute.rel.html><entity.other.attribute-name.html>rel</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></> <meta.attribute.href.html><entity.other.attribute-name.html>href</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>bar<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>/&gt</></> bar\\n\\nAnd the same if we have non-paragraph-breaking whitespace\\n\\nfoo\\n<meta.tag.metadata.link.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>link</> <meta.attribute.rel.html><entity.other.attribute-name.html>rel</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></> <meta.attribute.href.html><entity.other.attribute-name.html>href</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>bar<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>/&gt\\n</></>bar"
	},
	{
		"desc": "Extension returning multiple nodes starting with a style tag roundtrips",
		"wikitext": "<table>\n{{1x|<html><style>.hi { color: red; }</style>\n</html>}}\n<tr><td class=\"hi\">ho</td></tr>\n</table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.html.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>html</><punctuation.definition.tag.end.html>&gt</></><meta.embedded.block.html><meta.tag.metadata.style.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt</></><source.css><meta.selector.css><entity.other.attribute-name.class.css><punctuation.definition.entity.css>.</>hi</></> <meta.property-list.css><punctuation.section.property-list.begin.bracket.curly.css>{</> <meta.property-name.css><support.type.property-name.css>color</></><punctuation.separator.key-value.css>:</> <meta.property-value.css><support.constant.color.w3c-standard-color-name.css>red</></><punctuation.terminator.rule.css>;</> <punctuation.section.property-list.end.bracket.curly.css>}</></></><meta.tag.metadata.style.end.html><punctuation.definition.tag.begin.html><source.css-ignored-vscode>&lt;</>/</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt\\n</></></><meta.tag.structure.html.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>html</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}\\n</><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>hi<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>ho<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Decoding of HTML entities in embedded HTML tags",
		"wikitext": "<table class=\"1&2&amp;3&amp;amp;4&amp;amp;amp;5\"><tr><td>x</td></tr></table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>1&amp;2<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>3<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>amp;4<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>amp;amp;5<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>x<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T51672: Test for brackets in attributes of elements in external link texts",
		"wikitext": "[http://example.com/ link <span title=\"title with [brackets]\">span</span>]\n[http://example.com/ link <span title=\"title with &#91;brackets&#93;\">span</span>]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com/</><string.other.link.external.title> link <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>title with [brackets</></></></><punctuation.definition.tag.link.external>]</>\"&gtspan<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>]\\n<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com/</><string.other.link.external.title> link <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>title with <constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#91;</>brackets<constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#93;</><punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>span<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></></><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "T72875: Test for brackets in attributes of elements in internal link texts",
		"wikitext": "[[Foo|link <span title=\"title with [[double brackets]]\">span</span>]]\n[[Foo|link <span title=\"title with &#91;&#91;double brackets&#93;&#93;\">span</span>]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</>link <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>title with [[double brackets]]<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>span<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Foo</><keyword.operator>|</>link <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>title with <constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#91;<punctuation.definition.entity.html>&amp;</>#91;</>double brackets<constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#93;<punctuation.definition.entity.html>&amp;</>#93;</><punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>span<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T199926: html arrow wt: Parsoid sometimes trips up on verticalbar chars in hrefs",
		"wikitext": "[https://stats.wikimedia.org/v2/#/fr.wikipedia.org/reading/page-views-by-country/normal|map|2-Year~2016060100~2018071100|~total 9]\n[[stats:v2/#/fr.wikipedia.org/reading/page-views-by-country/normal%7Cmap%7C2-Year~2016060100~2018071100%7C~total|10]]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>https://stats.wikimedia.org/v2/#/fr.wikipedia.org/reading/page-views-by-country/normal|map|2-Year~2016060100~2018071100|~total</><string.other.link.external.title> 9</><punctuation.definition.tag.link.external>]\\n</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>stats:v2/#/fr.wikipedia.org/reading/page-views-by-country/normal%7Cmap%7C2-Year~2016060100~2018071100%7C~total</><keyword.operator>|</>10<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T199926: Hash only interwiki link",
		"wikitext": "[[meatball:Test#1/2]]\n[[gerrit:#/q/project:mediawiki/services/parsoid|Gerrit]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>meatball:Test#1/2</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>gerrit:#/q/project:mediawiki/services/parsoid</><keyword.operator>|</>Gerrit<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T179544: {{anchorencode:}} output should be always usable in links",
		"wikitext": "<span id=\"{{anchorencode:[foo]}}\"></span>[[#{{anchorencode:[foo]}}]]",
		"parsed": "<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>{{anchorencode:[foo]}}<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#</><punctuation.definition.tag.function>{{</><constant.language.variables.query>anchorencode</><keyword.operator.function>:</>[foo]<punctuation.definition.tag.function>}}</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Trim whitespace in wikitext headings, list items, table captions, headings, and cells",
		"wikitext": "__NOTOC__\n==    <!--c1-->  <!--c2--> Spaces   <!--c3--> <!--c4-->  ==\n==\t\t<!--c1-->\t<!--c2--> Tabs\t\t<!--c3--><!--c4-->\t==\n== <!--Headings with fallback ids--> Ğ›Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ¶Ğ¸Ğ·Ğ½ÑŒ ==\n*     <!--c1-->   <!--c2-->  List item <!--c3--> <!--c4-->\n; <!--term to define--> term : <!--term's definition--> definition\n{|\n|+ <!--c1--> <!--c2--> Table Caption <!--c3--> <!--c4-->\n|-\n!  <!--c1--> <!--c2--> Table Heading 1 <!--c3--> <!--c4--> !!   Table Heading 2 <!--c5-->\n|-\n| <!--c1--> <!--c2--> Table Cell 1 <!--c3--> <!--c4--> ||   Table Cell 2 <!--c5-->\n|-\n| class=\"foo\" || <!--c1--> <!--c2--> Table Cell 3 <!--c3--> <!--c4-->\n|-\n| <!--c1--> testing [[one|two]] <!--c2--> | <!--c3--> some content\n|}\n: {|\n  |  <!--c1--> <!--c2--> Table Cell 1 <!--c3--> <!--c4--> ||   Table Cell 2 <!--c5-->\n  |} foo   <!--c1-->",
		"parsed": "<constant.language.behavior>__NOTOC__\\n</><markup.heading>==<string.quoted.other.heading>    <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c1<punctuation.definition.comment.html>--&gt</></>  <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c2<punctuation.definition.comment.html>--&gt</></> Spaces   <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c3<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c4<punctuation.definition.comment.html>--&gt</></>  </>==\\n==<string.quoted.other.heading>\t\t<comment.block.html><punctuation.definition.comment.html>&lt;!--</>c1<punctuation.definition.comment.html>--&gt</></>\t<comment.block.html><punctuation.definition.comment.html>&lt;!--</>c2<punctuation.definition.comment.html>--&gt</></> Tabs\t\t<comment.block.html><punctuation.definition.comment.html>&lt;!--</>c3<punctuation.definition.comment.html>--&gt&lt;!--</>c4<punctuation.definition.comment.html>--&gt</></>\t</>==\\n==<string.quoted.other.heading> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>Headings with fallback ids<punctuation.definition.comment.html>--&gt</></> Ğ›Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ¶Ğ¸Ğ·Ğ½ÑŒ </>==\\n</><punctuation.definition.list.begin.markdown>*</>     <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c1<punctuation.definition.comment.html>--&gt</></>   <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c2<punctuation.definition.comment.html>--&gt</></>  List item <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c3<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c4<punctuation.definition.comment.html>--&gt\\n</></><punctuation.definition.list.begin.markdown>;</> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>term to define<punctuation.definition.comment.html>--&gt</></> term : <comment.block.html><punctuation.definition.comment.html>&lt;!--</>term's definition<punctuation.definition.comment.html>--&gt</></> definition\\n<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|+</><markup.style> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c1<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c2<punctuation.definition.comment.html>--&gt</></> Table Caption <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c3<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c4<punctuation.definition.comment.html>--&gt\\n</></></></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.th><keyword.operator>!</><markup.style>  <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c1<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c2<punctuation.definition.comment.html>--&gt</></> Table Heading 1 <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c3<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c4<punctuation.definition.comment.html>--&gt</></> </><keyword.operator>!!</><markup.style>   Table Heading 2 <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c5<punctuation.definition.comment.html>--&gt\\n</></></></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c1<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c2<punctuation.definition.comment.html>--&gt</></> Table Cell 1 <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c3<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c4<punctuation.definition.comment.html>--&gt</></> </><keyword.operator>||</><markup.style>   Table Cell 2 <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c5<punctuation.definition.comment.html>--&gt\\n</></></></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style> class=\"foo\" </><keyword.operator>||</><markup.style> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c1<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c2<punctuation.definition.comment.html>--&gt</></> Table Cell 3 <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c3<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c4<punctuation.definition.comment.html>--&gt\\n</></></></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c1<punctuation.definition.comment.html>--&gt</></> testing <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>one</><keyword.operator>|</>two<punctuation.definition.tag.link.internal>]]</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c2<punctuation.definition.comment.html>--&gt</></> | <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c3<punctuation.definition.comment.html>--&gt</></> some content\\n</></><keyword.operator>|}\\n</><punctuation.definition.list.begin.markdown>: </><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>  |</><markup.style>  <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c1<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c2<punctuation.definition.comment.html>--&gt</></> Table Cell 1 <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c3<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c4<punctuation.definition.comment.html>--&gt</></> </><keyword.operator>||</><markup.style>   Table Cell 2 <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c5<punctuation.definition.comment.html>--&gt\\n</></></></><punctuation.definition.list.begin.markdown>  </><keyword.operator>|}</></> foo   <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c1<punctuation.definition.comment.html>--&gt</></>"
	},
	{
		"desc": "Do not trim whitespace in HTML headings, list items, table captions, headings, and cells",
		"wikitext": "__NOTOC__\n<h2>    <!--c1-->   <!--c2--> Heading    <!--c3--> <!--c4-->  </h2>\n<ul><li>     <!--c1-->   <!--c2-->  List item <!--c3--> <!--c4-->  </li></ul>\n<table>\n<tr><th> <!--c1--> <!--c2--> Table Heading <!--c3--> <!--c4--> <th></tr>\n<tr><td> <!--c1--> <!--c2--> Table Cell <!--c3--> <!--c4--> <th></tr>\n</table>",
		"parsed": "<constant.language.behavior>__NOTOC__\\n</><meta.tag.structure.h2.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>h2</><punctuation.definition.tag.end.html>&gt</></>    <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c1<punctuation.definition.comment.html>--&gt</></>   <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c2<punctuation.definition.comment.html>--&gt</></> Heading    <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c3<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c4<punctuation.definition.comment.html>--&gt</></>  <meta.tag.structure.h2.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>h2</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.ul.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></>     <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c1<punctuation.definition.comment.html>--&gt</></>   <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c2<punctuation.definition.comment.html>--&gt</></>  List item <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c3<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c4<punctuation.definition.comment.html>--&gt</></>  <meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.ul.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.th.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>th</><punctuation.definition.tag.end.html>&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c1<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c2<punctuation.definition.comment.html>--&gt</></> Table Heading <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c3<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c4<punctuation.definition.comment.html>--&gt</></> <meta.tag.structure.th.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>th</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c1<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c2<punctuation.definition.comment.html>--&gt</></> Table Cell <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c3<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c4<punctuation.definition.comment.html>--&gt</></> <meta.tag.structure.th.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>th</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Do not trim whitespace in links and quotes",
		"wikitext": "foo ''  <!--c1--> italic <!--c2-->   '' and '''  <!--c3-->  bold  <!--c4-->  '''\n[[Foo|  some text  ]]",
		"parsed": "foo <markup.italic>''</>  <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c1<punctuation.definition.comment.html>--&gt</></> italic <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c2<punctuation.definition.comment.html>--&gt</></>   <markup.italic>''</> and <markup.bold>'''</>  <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c3<punctuation.definition.comment.html>--&gt</></>  bold  <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c4<punctuation.definition.comment.html>--&gt</></>  <markup.bold>'''\\n</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</>  some text  <punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Remove p tags surrounding a single element in a figcaption",
		"wikitext": "[[File:Foobar.jpg|right|200x200px|Caption]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>right</><keyword.operator>|</>200x200<entity.other.attribute-name.localname>px</><keyword.operator>|</>Caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Selser preserves lack of newline before list and allows newline after the list",
		"wikitext": "header\n*foo\n*bar",
		"parsed": "header\\n<punctuation.definition.list.begin.markdown>*</>foo\\n<punctuation.definition.list.begin.markdown>*</>bar"
	},
	{
		"desc": "Selser does not introduce newlines between unedited paragraph preceding the list",
		"wikitext": "{|\n|\nheader\n*foo\n*bar\nfooter\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|\\n</></>header\\n<punctuation.definition.list.begin.markdown>*</>foo\\n<punctuation.definition.list.begin.markdown>*</>bar\\nfooter\\n<keyword.operator>|}</></>"
	},
	{
		"desc": "Selser does not introduce newlines between unedited paragraph following the list",
		"wikitext": "{|\n|\nheader\n*foo\n*bar\nfooter\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|\\n</></>header\\n<punctuation.definition.list.begin.markdown>*</>foo\\n<punctuation.definition.list.begin.markdown>*</>bar\\nfooter\\n<keyword.operator>|}</></>"
	},
	{
		"desc": "Remove a list item but do not insert newline above list",
		"wikitext": "header\n*foo\n*bar\nfooter",
		"parsed": "header\\n<punctuation.definition.list.begin.markdown>*</>foo\\n<punctuation.definition.list.begin.markdown>*</>bar\\nfooter"
	},
	{
		"desc": "Spaced heading with element",
		"wikitext": "=== hi <span id=\"x\">hi</span> hi ho ===",
		"parsed": "<markup.heading>===<string.quoted.other.heading> hi <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>hi<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></> hi ho </>===</>"
	},
	{
		"desc": "Allow tabindex 0",
		"wikitext": "<div tabindex=\"0\">A</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.tabindex.html><entity.other.attribute-name.html>tabindex</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>0<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>A<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Don't allow tabindex -1",
		"wikitext": "<div tabindex=\"-1\">A</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.tabindex.html><entity.other.attribute-name.html>tabindex</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>-1<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>A<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Don't Allow tabindex > 0",
		"wikitext": "<div tabindex=\"3\">A</div>",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.tabindex.html><entity.other.attribute-name.html>tabindex</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>3<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>A<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "aside tag is not allowed directly in wikitext (T278565)",
		"wikitext": "<aside>This aside tag in wikitext should be escaped</aside>",
		"parsed": "<meta.tag.structure.aside.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>aside</><punctuation.definition.tag.end.html>&gt</></>This aside tag in wikitext should be escaped<meta.tag.structure.aside.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>aside</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Stripped tag in list",
		"wikitext": ":<i>hi</i></b>",
		"parsed": "<punctuation.definition.list.begin.markdown>:</><meta.tag.inline.i.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>i</><punctuation.definition.tag.end.html>&gt</></>hi<meta.tag.inline.i.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>i</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.b.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Misnested link nested in span",
		"wikitext": ": [http://google.com <span>[[Lala]]:</span>ok]-hi",
		"parsed": "<punctuation.definition.list.begin.markdown>:</> <punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://google.com</><string.other.link.external.title> <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Lala</></></><punctuation.definition.tag.link.external>]</>]:<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>ok]-hi"
	},
	{
		"desc": "Preserve the order invalid attributes",
		"wikitext": "<div width=\"95%\" style=\"border: 3px solid darkblue\">hi",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.width.html><entity.other.attribute-name.html>width</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>95%<punctuation.definition.string.end.html>\"</></></> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>border: 3px solid darkblue</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>hi"
	},
	{
		"desc": "additionalTests"
	},
	{
		"desc": "Multiple <onlyinclude> being included",
		"wikitext": "{{Includes4}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Includes4</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "#vardefine at SOL",
		"wikitext": "{{#vardefine:test|heading}}==Heading==\n{{#vardefine:test|hr}}----\n{{#vardefine:test|list}};dt:dd\n{{#vardefine:test|table}}{|\n|-\n! !!\n|}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#vardefine</><keyword.operator.function>:</>test<keyword.operator>|</>heading<punctuation.definition.tag.function>}}</>==Heading==\\n<punctuation.definition.tag.function>{{</><constant.language.variables.query>#vardefine</><keyword.operator.function>:</>test<keyword.operator>|</>hr<punctuation.definition.tag.function>}}</>----\\n<punctuation.definition.tag.function>{{</><constant.language.variables.query>#vardefine</><keyword.operator.function>:</>test<keyword.operator>|</>list<punctuation.definition.tag.function>}}</>;dt:dd\\n<punctuation.definition.tag.function>{{</><constant.language.variables.query>#vardefine</><keyword.operator.function>:</>test<keyword.operator>|</>table<punctuation.definition.tag.function>}}</>{|\\n|-\\n! !!\\n|}"
	},
	{
		"desc": "Case-sensitive behavior switches in lower cases",
		"wikitext": "__index__",
		"parsed": "__index__"
	},
	{
		"desc": "Category / whitespace (newline and non-newline) interactions",
		"wikitext": "x\n[[Category:A]] [[Category:B]]\ny",
		"parsed": "x\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>A</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>B</><punctuation.definition.tag.link.internal>]]\\n</></>y"
	},
	{
		"desc": "Nested file links",
		"wikitext": "[[file:thumb.jpg|[[file:thumb.png|Thumb|thumb]]|thumb]]\n[[file:thumb.jpg|[[file:thumb.png|[[T]]humb|thumb]]|thumb]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>file:</><entity.other.attribute-name>thumb.jpg</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>file:</><entity.other.attribute-name>thumb.png</><keyword.operator>|</>Thumb<keyword.operator>|</><entity.other.attribute-name.localname>thumb</><punctuation.definition.tag.link.internal>]]</></><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>file:</><entity.other.attribute-name>thumb.jpg</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>file:</><entity.other.attribute-name>thumb.png</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>T</><punctuation.definition.tag.link.internal>]]</></>humb<keyword.operator>|</><entity.other.attribute-name.localname>thumb</><punctuation.definition.tag.link.internal>]]</></><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "&lt; in an external link",
		"wikitext": "[https://mediawiki.org/&LT;&lt;text]\n[https://mediawiki.org/&GT;&gt;text]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>https://mediawiki.org/&amp;LT;&amp;lt;text</><punctuation.definition.tag.link.external>]\\n[</><entity.name.tag.url>https://mediawiki.org/&amp;GT;&amp;gt;text</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "Magic links in lower cases",
		"wikitext": "pmid 1 PMID 1\nrfc 1 RFC 1\nisbn 1234567890 ISBN 1234567890",
		"parsed": "pmid 1 <constant.language.variables.pmid>PMID 1\\n</>rfc 1 <constant.language.variables.rfc>RFC 1\\n</>isbn 1234567890 <constant.language.variables.isbn>ISBN 1234567890</>"
	},
	{
		"desc": "Font of text following an external link",
		"wikitext": "[//a ''b]c",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>//a</><string.other.link.external.title> <markup.italic>''</>b</><punctuation.definition.tag.link.external>]</>c"
	},
	{
		"desc": "Interaction between apostrophes and <b> tags",
		"wikitext": "'''a</b>b<b>c'''d",
		"parsed": "<markup.bold>'''</>a<meta.tag.inline.b.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></>b<meta.tag.inline.b.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></>c<markup.bold>'''</>d"
	},
	{
		"desc": "Function hook and variable",
		"wikitext": "{{uc}}{{server:}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>uc</><punctuation.definition.tag.template>}}{{</><entity.name.tag.local-name>server:</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "badCharacters"
	},
	{
		"desc": "External links: invalid character NUL (stripped)",
		"wikitext": "[http://www.example.com\u0000 test]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.com\u0000</><string.other.link.external.title> test</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External links: invalid character backspace (preserved)",
		"wikitext": "[http://www.example.com\b test]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.com\b</><string.other.link.external.title> test</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "Magic link: invalid character NUL (stripped)",
		"wikitext": "http://www.example.com\u0000 test",
		"parsed": "http://www.example.com\u0000 test"
	},
	{
		"desc": "Magic link: invalid character backspace (preserved)",
		"wikitext": "http://www.example.com\b test",
		"parsed": "http://www.example.com\b test"
	},
	{
		"desc": "External links: tab character",
		"wikitext": "[http://www.example.com Alice in\tWonderland]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.com</><string.other.link.external.title> Alice in\tWonderland</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "Stray carriage return in text",
		"wikitext": "hiho",
		"parsed": "hiho"
	},
	{
		"desc": "bookReferencing"
	},
	{
		"desc": "Book Referencing attribute rejected by default",
		"wikitext": "<ref name=\"parent\">[foo]</ref>\n<ref extends=\"parent\">[bar]</ref>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>parent<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>[foo]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>parent<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>[bar]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Book Referencing attribute allowed with feature flag set",
		"wikitext": "<ref name=\"parent\">[foo]</ref>\n<ref extends=\"parent\">[bar]</ref>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>parent<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>[foo]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>parent<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>[bar]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T240424 - Subreference reused as normal ref before its full definition",
		"wikitext": "<ref name=\"b\" />\n<ref name=\"b\" extends=\"a\">page 2</ref>\n<ref name=\"a\">book</ref>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page 2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>book</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T240424 - Extended reference reused before defined in the <references> section",
		"wikitext": "<ref name=\"a\" />\n<ref name=\"b\" />\n<references>\n<ref name=\"b\" extends=\"a\">page 2</ref>\n<ref name=\"a\">book</ref>\n</references>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page 2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>book</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T367749 - Turning a top-level ref into a subref is forbidden, even if the content is the same",
		"wikitext": "<ref name=p20>page 20</ref>\n<ref extends=book name=p20>page 20</ref>\n<references>\n<ref name=book>book</ref>\n</references>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.unquoted.html>p20</></><punctuation.definition.tag.end>&gt</><meta.block.ref>page 20</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.unquoted.html>book</></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.unquoted.html>p20</></><punctuation.definition.tag.end>&gt</><meta.block.ref>page 20</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.unquoted.html>book</></><punctuation.definition.tag.end>&gt</><meta.block.ref>book</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T367749 - Turning a top-level ref into a subref is forbidden, especially when the content conflicts",
		"wikitext": "<ref name=p20>page 20</ref>\n<ref extends=book name=p20>different content</ref>\n<references>\n<ref name=book>book</ref>\n</references>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.unquoted.html>p20</></><punctuation.definition.tag.end>&gt</><meta.block.ref>page 20</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.unquoted.html>book</></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.unquoted.html>p20</></><punctuation.definition.tag.end>&gt</><meta.block.ref>different content</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.unquoted.html>book</></><punctuation.definition.tag.end>&gt</><meta.block.ref>book</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T367749 - Turning a top-level ref into a subref is fine when the content is an empty string",
		"wikitext": "<ref name=p20></ref>\n<ref extends=book name=p20>page 20</ref>\n<references>\n<ref name=book>book</ref>\n</references>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.unquoted.html>p20</></><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.unquoted.html>book</></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.unquoted.html>p20</></><punctuation.definition.tag.end>&gt</><meta.block.ref>page 20</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.unquoted.html>book</></><punctuation.definition.tag.end>&gt</><meta.block.ref>book</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T236256 - Naming book references is fine",
		"wikitext": "<ref name=\"a\">book</ref>\n<ref extends=\"a\" name=\"b\">page 2</ref>\n<ref extends=\"a\" name=\"c\">page 3</ref>\n<ref name=\"b\" />\n<ref name=\"c\" />\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>book</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page 2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>c<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page 3</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>c<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T236256 - Extending a reference that doesn't exist #1",
		"wikitext": "<ref extends=\"a\">page 1</ref>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page 1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T236256 - Extending a reference that doesn't exist #2",
		"wikitext": "<ref>book</ref>\n<ref extends=\"a\">page 1</ref>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>book</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page 1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T236256 - Reference with the same name defined twice",
		"wikitext": "<ref name=\"a\">book</ref>\n<ref name=\"a\">magazine</ref>\n<ref extends=\"a\">page 1</ref>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>book</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>magazine</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page 1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T236256 - Can't reuse a name for two book references",
		"wikitext": "<ref name=\"a\">book</ref>\n<ref extends=\"a\" name=\"b\">page 2</ref>\n<ref extends=\"a\" name=\"b\">page 3</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>book</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page 2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page 3</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T236256 - Can't extend a book reference (no nesting)",
		"wikitext": "<ref name=\"a\">book</ref>\n<ref extends=\"a\" name=\"b\">page 2</ref>\n<ref extends=\"b\">section 3</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>book</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page 2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>section 3</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T236256 - Can't extend a book reference (no nesting), specified in reverse order",
		"wikitext": "<ref extends=\"b\">section 3</ref>\n<ref extends=\"a\" name=\"b\">page 2</ref>\n<ref name=\"a\">book</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>section 3</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page 2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>book</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T236256 - Named reference without text",
		"wikitext": "<ref name=\"a\" />\n<ref extends=\"a\">page 1</ref>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page 1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T236256 - No text for a book reference",
		"wikitext": "<ref name=\"foo\">book</ref>\n<ref extends=\"foo\" />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>book</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T236256 - Empty text for a book reference",
		"wikitext": "<ref name=\"foo\">book</ref>\n<ref extends=\"foo\"></ref>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>book</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T236256 - De-facto empty text for a book reference",
		"wikitext": "<ref name=\"foo\">book</ref>\n<ref extends=\"foo\"> </ref>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>book</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref> </><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T236256 - Everything in the same group",
		"wikitext": "<ref group=\"g1\" name=\"a\">book</ref>\n<ref group=\"g1\" extends=\"a\" name=\"b\">page</ref>\n<ref group=\"g1\" name=\"b\" />\n<references group=\"g1\"/>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>book</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g1<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T236256 - Base and book reference in different groups don't collide",
		"wikitext": "<ref group=\"g1\" name=\"a\">book</ref>\n<ref group=\"g2\" extends=\"a\">page</ref>\n<references group=\"g1\"/>\n<references group=\"g2\"/>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>book</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g2<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g1<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g2<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T236256 - Extending in the unnamed default group doesn't collide with refs from other groups",
		"wikitext": "<ref group=\"g1\" name=\"a\">book</ref>\n<ref extends=\"a\">page</ref>\n<references group=\"g1\"/>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>book</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g1<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T236256 - Extends in named group doesn't conflict with default group",
		"wikitext": "<ref name=\"a\">book</ref>\n<ref group=\"g1\" extends=\"a\">page</ref>\n<references group=\"g1\"/>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>book</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g1<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T236256 - Extending a multi-part ref should be fine",
		"wikitext": "<ref name=\"a\">part 1</ref>\n<ref follow=\"a\">part 2</ref>\n<ref extends=\"a\">ok</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>part 1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.follow.html><entity.other.attribute-name.html>follow</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>part 2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>ok</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T236256 - Dont allow splitting a book reference for now",
		"wikitext": "<ref name=\"a\">book</ref>\n<ref extends=\"a\" name=\"b\">page 2</ref>\n<ref follow=\"b\">and page 3 the same time?</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>book</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page 2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.follow.html><entity.other.attribute-name.html>follow</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>and page 3 the same time?</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T236256 - Can't be a follow up and a book reference the same time",
		"wikitext": "<ref name=\"a\">book 1</ref>\n<ref follow=\"a\" extends=\"a\">huh?</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>book 1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.follow.html><entity.other.attribute-name.html>follow</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>huh?</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T236256 - Can't be a follow up and a book reference the same time, even when referencing 2 different bases",
		"wikitext": "<ref name=\"a\">book 1</ref>\n<ref name=\"b\">book 2</ref>\n<ref follow=\"a\" extends=\"b\">huh?</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>book 1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>book 2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.follow.html><entity.other.attribute-name.html>follow</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>huh?</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Extending a <ref> that doesn't appear in the text, but in <references>",
		"wikitext": "<ref extends=\"a\">Page 2</ref>\n<references>\n<ref name=\"a\">Book</ref>\n</references>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>Page 2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>Book</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T239810: Extending a <ref> that doesn't appear in the text, but in {{#tag:references}}",
		"wikitext": "<ref extends=\"a\">Page 2</ref>\n{{#tag:references|\n<ref name=\"a\">Book</ref>\n}}",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>Page 2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.function>{{</><constant.language.variables.query>#tag</><keyword.operator.function>:</>references<keyword.operator>|\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>Book</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Extends <ref> defined in <references> called with #tag",
		"wikitext": "<ref name=\"foo\">BAR</ref>\n<ref name=\"footwo\" />\n{{#tag:references|\n<ref name=\"footwo\" extends=\"foo\">p. 10</ref>\n}}",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>BAR</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>footwo<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.function>{{</><constant.language.variables.query>#tag</><keyword.operator.function>:</>references<keyword.operator>|\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>footwo<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>p. 10</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Extends parent <ref> defined in <references> called with #tag",
		"wikitext": "<ref>BAR</ref>\n<ref name=\"footwo\" extends=\"foo\">page 7</ref>\n<ref name=\"foo\" />\n{{#tag:references|\n<ref name=\"foo\">book name</ref>\n}}",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>BAR</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>footwo<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page 7</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.function>{{</><constant.language.variables.query>#tag</><keyword.operator.function>:</>references<keyword.operator>|\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>book name</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Interleaved extends groups",
		"wikitext": "<ref name=\"a\">text-a</ref>\n<ref name=\"c\">text-c</ref>\n\n<ref extends=\"a\">page b</ref>\n<ref extends=\"c\">page d</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>text-a</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>c<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>text-c</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page b</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>c<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page d</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Multiple groups with extends",
		"wikitext": "<ref name=\"a\">text-a</ref>\n<ref extends=\"a\">page b</ref>\n<references />\n\n<ref name=\"c\">text-c</ref>\n<ref extends=\"c\">page d</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>text-a</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page b</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>c<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>text-c</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>c<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page d</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Multiple groups with extends, duplicated names across groups",
		"wikitext": "<ref name=\"a\">text-a</ref>\n<ref extends=\"a\">page b</ref>\n<references />\n\n<ref name=\"a\">text-c</ref>\n<ref extends=\"a\">page d</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>text-a</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page b</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>text-c</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page d</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Intervening ref before extends",
		"wikitext": "<ref name=\"a\">book</ref>\n<ref>another</ref>\n<ref extends=\"a\">page 2</ref>\n\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>book</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>another</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page 2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Normal refs after extends",
		"wikitext": "<ref name=\"a\">text-a</ref>\n<ref extends=\"a\">page b</ref>\n\n<ref name=\"c\">text-c</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>text-a</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>page b</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>c<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>text-c</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T242110: Copy-pasted, named sub-references should be merged and not mess with the numbering",
		"wikitext": "<ref name=\"a1\" extends=\"a\">a1</ref>\n<ref name=\"a1\" extends=\"a\">a1</ref>\n<references>\n<ref name=\"a\">a</ref>\n</references>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>a1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>a1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>a</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T242110: Reused sub-references should be merged and not mess with the numbering",
		"wikitext": "<ref name=\"a1\" extends=\"a\">a1</ref>\n<ref name=\"a1\" extends=\"a\" />\n<references>\n<ref name=\"a\">a</ref>\n</references>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>a1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>a</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Reused sub-references can be rolled back without messing up numbering",
		"wikitext": "<ref name=\"a1\" extends=\"a\" />\n<ref group=\"g\" name=\"a1\" extends=\"a\" />\n{{#tag:references|\n<ref name=\"a\">a in group</ref>\n<ref name=\"a1\" extends=\"a\">a1 in group</ref>\n|group=g}}\n<ref name=\"a1\" extends=\"a\">a1</ref>\n<references>\n<ref name=\"a\">a</ref>\n</references>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.function>{{</><constant.language.variables.query>#tag</><keyword.operator.function>:</>references<keyword.operator>|\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>a in group</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>a1 in group</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><keyword.operator>|</>group=g<punctuation.definition.tag.function>}}\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>a1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>a</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T242110: Bad extends attributes on reused sub-references should report an error",
		"wikitext": "<ref name=\"a1\" extends=\"a\">a1</ref>\n<ref name=\"a1\" extends=\"unknown\" />\n<references>\n<ref name=\"a\">a</ref>\n</references>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>a1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>unknown<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>a</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T242110: Copy-pasted, named sub-references should appear in proper order",
		"wikitext": "<ref name=\"a1\" extends=\"a\">a1</ref>\n<ref name=\"a1\" extends=\"a\">a1</ref>\n<ref name=\"b1\" extends=\"b\">b1</ref>\n<ref name=\"b1\" extends=\"b\" />\n<ref name=\"c1\" extends=\"c\">c1</ref>\n<ref name=\"c1\" />\n<references>\n<ref name=\"a\">a</ref>\n<ref name=\"b\">a</ref>\n<ref name=\"c\">a</ref>\n</references>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>a1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>a1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>b1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>c1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.extends.html><entity.other.attribute-name.html>extends</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>c<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>c1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>c1<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>a</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>a</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>c<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>a</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "citeParserTests"
	},
	{
		"desc": "Simple <ref>, no <references/>",
		"wikitext": "Wikipedia rocks!<ref>Proceeds of Rockology, vol. XXI</ref>",
		"parsed": "Wikipedia rocks!<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>Proceeds of Rockology, vol. XXI</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Simple <ref>, no <references/>, page ends in a list",
		"wikitext": "blah<ref>foo</ref> --Matma Rex 17:35, 31 March 2020 (UTC)\n* bleh --Matma Rex 17:35, 31 March 2020 (UTC)",
		"parsed": "blah<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</> --Matma Rex 17:35, 31 March 2020 (UTC)\\n<punctuation.definition.list.begin.markdown>*</> bleh --Matma Rex 17:35, 31 March 2020 (UTC)"
	},
	{
		"desc": "Simple <ref>, with <references/>",
		"wikitext": "Wikipedia rocks!<ref>Proceeds of Rockology, vol. XXI</ref>\n\n<references />",
		"parsed": "Wikipedia rocks!<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>Proceeds of Rockology, vol. XXI</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "<ref> with a simple template",
		"wikitext": "Templating<ref>{{simple template}}</ref>\n\n<references />",
		"parsed": "Templating<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>simple template</><punctuation.definition.tag.template>}}</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "<ref> with a <nowiki>",
		"wikitext": "Templating<ref><nowiki>{{simple template}}</nowiki></ref>\n\n<references />",
		"parsed": "Templating<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>{{simple template}}</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "<ref> in a <nowiki>",
		"wikitext": "Templating<nowiki><ref>{{simple template}}</ref></nowiki>\n\n<references />",
		"parsed": "Templating<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>&lt;ref&gt{{simple template}}&lt;/ref&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "<ref> in a <!--comment-->",
		"wikitext": "Templating<!--<ref>{{simple template}}</ref>-->\n\n<references />",
		"parsed": "Templating<comment.block.html><punctuation.definition.comment.html>&lt;!--</>&lt;ref&gt{{simple template}}&lt;/ref&gt<punctuation.definition.comment.html>--&gt\\n\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "<!--comment--> in a <ref> (T7384)",
		"wikitext": "Templating<ref>Text<!--comment--></ref>\n\n<references />",
		"parsed": "Templating<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>Text<comment.block.html><punctuation.definition.comment.html>&lt;!--</>comment<punctuation.definition.comment.html>--&gt</></></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "<ref> in an ignored caption (T235656)",
		"wikitext": "[[File:Foobar.jpg|frameless|ignored caption with a ref<ref>boo</ref>]]\n\n<references />",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>frameless</><keyword.operator>|</>ignored caption with a ref<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>boo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.link.internal>]]\\n\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "<ref> in expanded attributes of tags (legitimate or otherwise)",
		"wikitext": "{|\n|- <ref>boo</ref>\n|x\n|}\n<references />",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.table-row><keyword.operator>|-</> <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>boo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>x\\n</></><keyword.operator>|}\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "<references> after <gallery> (bug 6164)",
		"wikitext": "<ref>one</ref>\n\n<gallery>Image:Foobar.jpg</gallery>\n\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>one</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</><meta.block.ref>Image:Foobar.jpg</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "{{REVISIONID}} on page with <ref> (bug 6299)",
		"wikitext": "{{REVISIONID}}<ref>elite</ref>",
		"parsed": "<constant.language.variables.metadata>{{REVISIONID}}</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>elite</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "{{REVISIONID}} on page without <ref> (bug 6299 sanity check)",
		"wikitext": "{{REVISIONID}}",
		"parsed": "<constant.language.variables.metadata>{{REVISIONID}}</>"
	},
	{
		"desc": "Ref with content followed by blank ref",
		"wikitext": "<ref name=\"blank\">content</ref>\n\n<ref name=\"blank\" />\n\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>blank<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>content</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>blank<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Blank ref followed by ref with content",
		"wikitext": "<ref name=\"blank\" />\n\n<ref name=\"blank\">content</ref>\n\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>blank<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>blank<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>content</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Regression: non-blank ref \"0\" followed by ref with content",
		"wikitext": "<ref name=\"blank\">0</ref>\n\n<ref name=\"blank\">content</ref>\n\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>blank<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>0</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>blank<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>content</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Regression sanity check: non-blank ref \"1\" followed by ref with content",
		"wikitext": "<ref name=\"blank\">1</ref>\n\n<ref name=\"blank\">content</ref>\n\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>blank<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>blank<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>content</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Ref names containing a number",
		"wikitext": "<ref name=\"test123test\">One</ref>\n<ref name=\"123test\">Two</ref>\n<ref name=\"test123\">Three</ref>\n\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>test123test<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>One</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>123test<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>Two</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>test123<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>Three</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T184912: Consistent normalization of consecutive underscores",
		"wikitext": "<ref name=\"test_123\">example</ref>\n<ref name=\"test__123\">example</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>test_123<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>example</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>test__123<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>example</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Erroneous refs",
		"wikitext": "<ref name=\"0\">Zero</ref>\n\n<ref>Also zero, but differently! (Normal ref)</ref>\n\n<ref />\n\n<ref name=\"foo\" name=\"bar\" />\n\n<ref name=\"blankwithnoreference\" />\n\n<references name=\"quasit\" />\n\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>0<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>Zero</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>Also zero, but differently! (Normal ref)</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <punctuation.definition.tag.end>/&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>bar<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>blankwithnoreference<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>quasit<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Can't have name=\"â€¦\" and follow=\"â€¦\" the same time",
		"wikitext": "<ref name=\"theName\" follow=\"theFollows\">theValue</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theName<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.follow.html><entity.other.attribute-name.html>follow</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theFollows<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>theValue</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Conflicting name=\"â€¦\" and follow=\"â€¦\" together with another invalid parameter",
		"wikitext": "<ref name=\"theName\" follow=\"theFollows\" dummy=\"dummy\">theValue</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theName<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.follow.html><entity.other.attribute-name.html>follow</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theFollows<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.dummy.html><entity.other.attribute-name.html>dummy</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>dummy<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>theValue</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "It's not possible to follow=\"â€¦\" a <ref> defined in the <references> section",
		"wikitext": "<ref follow=\"theName\">theFollows</ref>\n<references>\n<ref name=\"theName\">theValue</ref>\n</references>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.follow.html><entity.other.attribute-name.html>follow</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theName<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>theFollows</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theName<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>theValue</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "A follow=\"â€¦\" before its parent is not merged",
		"wikitext": "<ref follow=\"theName\">''theFollows''</ref>\n<ref name=\"theName\">''theValue''</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.follow.html><entity.other.attribute-name.html>follow</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theName<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref><markup.italic>''</>theFollows<markup.italic>''</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theName<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref><markup.italic>''</>theValue<markup.italic>''</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "\"follow\" after a named ref but before its parent",
		"wikitext": "<ref name=\"first\">First</ref>\n<ref follow=\"third\">Second</ref>\n<ref name=\"third\">Third</ref>\n<hr />\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>first<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>First</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.follow.html><entity.other.attribute-name.html>follow</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>third<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>Second</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>third<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>Third</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><meta.tag.structure.hr.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>hr</> <punctuation.definition.tag.end.html>/&gt\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "\"follow\" after an anonymous ref but before its parent",
		"wikitext": "<ref>First</ref>\n<ref follow=\"third\">Second</ref>\n<ref name=\"third\">Third</ref>\n<hr />\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>First</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.follow.html><entity.other.attribute-name.html>follow</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>third<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>Second</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>third<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>Third</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><meta.tag.structure.hr.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>hr</> <punctuation.definition.tag.end.html>/&gt\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Valid follow=\"â€¦\" after it's parent",
		"wikitext": "<ref name=\"theName\">theValue</ref>\n<ref follow=\"theName\">theFollows</ref>\n<ref>Should be 2</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theName<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>theValue</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.follow.html><entity.other.attribute-name.html>follow</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theName<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>theFollows</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>Should be 2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Forward-referenced ref with follow",
		"wikitext": "<ref name=\"theName\" />\n<ref follow=\"theName\">theFollows</ref>\n<references>\n<ref name=\"theName\">theValue</ref>\n</references>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theName<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.follow.html><entity.other.attribute-name.html>follow</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theName<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>theFollows</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theName<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>theValue</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Follow following a named ref with multiple definitions",
		"wikitext": "<ref name=\"test\">123</ref>\n<ref name=\"test\">234</ref>\n<ref follow=\"test\">345</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>test<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>123</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>test<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>234</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.follow.html><entity.other.attribute-name.html>follow</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>test<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>345</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Multiple follow after refs without content and trailing ref with content in references section",
		"wikitext": "ADD<ref name=\"theName\" />\nSUB<ref name=\"theName\"></ref>\nMUL<ref follow=\"theName\">theFollowValue</ref>\nMOD<ref follow=\"theName\">anotherFollowValue</ref>\n<references>\n<ref name=\"theName\"> theValue</ref>\n</references>",
		"parsed": "ADD<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theName<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</>SUB<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theName<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>MUL<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.follow.html><entity.other.attribute-name.html>follow</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theName<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>theFollowValue</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>MOD<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.follow.html><entity.other.attribute-name.html>follow</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theName<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>anotherFollowValue</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theName<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref> theValue</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Report bad attributes in ref tags",
		"wikitext": "<ref name=\"theName\" group=\"theGroup\" dummy=\"dummy\">theValue</ref>\n<references group=\"theGroup\" />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theName<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theGroup<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.dummy.html><entity.other.attribute-name.html>dummy</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>dummy<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>theValue</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theGroup<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Simple <ref>, with <references/> in group",
		"wikitext": "Wikipedia rocks!<ref>Proceeds of Rockology, vol. XXI</ref>\nWikipedia rocks!<ref group=\"note\">Proceeds of Rockology, vol. XXI</ref>\n\n<references />\n<references group=\"note\" />",
		"parsed": "Wikipedia rocks!<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>Proceeds of Rockology, vol. XXI</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>Wikipedia rocks!<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>note<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>Proceeds of Rockology, vol. XXI</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>note<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Simple <ref>, with <references/> in group, with groupname in Chinese",
		"wikitext": "AAA<ref group=\"å‚\">ref a</ref>BBB<ref group=\"æ³¨\">note b</ref>CCC<ref group=\"å‚\">ref c</ref>\n\n;refs\n<references group=\"å‚\" />\n\n;notes\n<references group=\"æ³¨\" />",
		"parsed": "AAA<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>å‚<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>ref a</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>BBB<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>æ³¨<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>note b</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>CCC<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>å‚<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>ref c</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.list.begin.markdown>;</>refs\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>å‚<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n\\n</><punctuation.definition.list.begin.markdown>;</>notes\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>æ³¨<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Attributes are trimmed by the parser, see Sanitizer::decodeTagAttributes()",
		"wikitext": "<ref group=\"g\" name=\"n1\">in group g</ref>\n<ref group=\" g \" name=\" n2 \">in group \" g \"</ref>\n<references group=\"g\" />\n<references group=\" g \" />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>n1<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>in group g</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</> g <punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</> n2 <punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>in group \" g \"</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</> g <punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "<ref> defined in <references>",
		"wikitext": "<ref name=\"foo\" />\n\n<references>\n<ref name=\"foo\">BAR</ref>\n</references>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>BAR</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "<ref> defined in <references> called with #tag",
		"wikitext": "<ref name=\"foo\" />\n\n{{#tag:references|\n<Ref name=\"foo\">BAR</ref>\n}}",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n\\n</><punctuation.definition.tag.function>{{</><constant.language.variables.query>#tag</><keyword.operator.function>:</>references<keyword.operator>|\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>Ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>BAR</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "T242437 - Nested references edge case, outer tag function with LDR",
		"wikitext": "<ref name=\"foo\" />\n{{#tag:references|\n  <ref name=\"foo\">bar</ref>\n\n  <References />\n}}",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.function>{{</><constant.language.variables.query>#tag</><keyword.operator.function>:</>references<keyword.operator>|\\n</>  <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>bar</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</>  <punctuation.definition.tag.begin>&lt;</><entity.name.tag>References</> <punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "T242437 - Nested references edge case, outer tag function, inner LDR",
		"wikitext": "<ref name=\"foo\" />\n{{#tag:references|\n  <references>\n    <ref name=\"foo\">bar</ref>\n  </references>\n}}",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.function>{{</><constant.language.variables.query>#tag</><keyword.operator.function>:</>references<keyword.operator>|\\n</>  <punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>    <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>bar</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>  </><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "T242437 - Nested references edge case, inner tag function with LDR",
		"wikitext": "<ref name=\"foo\" />\n\n<references>\n  {{#tag:references|\n    <ref name=\"foo\">bar</ref>\n  }}\n</references>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>  <punctuation.definition.tag.function>{{</><constant.language.variables.query>#tag</><keyword.operator.function>:</>references<keyword.operator>|\\n</>    <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>bar</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>  <punctuation.definition.tag.function>}}\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "<ref> defined in <references> error conditions",
		"wikitext": "<ref name=\"foo\" group=\"2\" />\n\n<references group=\"2\">\n<ref name=\"foo\" />\n<ref name=\"unused\">BAR</ref>\n<ref name=\"foo\" group=\"1\">bad group</ref>\n<ref name=\"bar\" group=\"1\" />\n<ref>BAR BAR</ref>\n</references>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>2<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>2<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>unused<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>BAR</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>1<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>bad group</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>bar<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>1<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>BAR BAR</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "<ref> ungrouped and grouped refs with and without content defined",
		"wikitext": "ONE<ref name=\"foo\" />\n<references />\nTWO<ref group=\"NOTES\" name=\"foo\" />\nTHREE<ref group=\"NOTES\" name=\"bar\">CONTENT</ref>\n<references group=\"NOTES\" />",
		"parsed": "ONE<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt\\n</>TWO<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>NOTES<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</>THREE<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>NOTES<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>bar<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>CONTENT</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>NOTES<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Error conditions on non-visible content",
		"wikitext": "<ref name=\"a\">x</ref>\n<ref name=\"b\"> </ref>\n<ref name=\"c\" />\n<references>\n<ref name=\"a\" />\n<ref name=\"b\" />\n<ref name=\"c\"> </ref>\n</references>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>x</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref> </><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>c<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>c<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref> </><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "<ref> with custom group link with number names in Klingon",
		"wikitext": "Wikipedia rocks!<ref group=\"klingon\">Proceeds of Rockology, vol. XXI</ref>\n\n<references group=\"klingon\" />",
		"parsed": "Wikipedia rocks!<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>klingon<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>Proceeds of Rockology, vol. XXI</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>klingon<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Consecutive whitespace in custom link label message should not create empty []",
		"wikitext": "<ref group=\"klingon\">1st</ref>\n<ref group=\"klingon\">2nd</ref>\n<references group=\"klingon\" />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>klingon<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>1st</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>klingon<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>2nd</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>klingon<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Bug 31374 regression check: nested strip items",
		"wikitext": "{{#tag:ref|note<ref>reference</ref>|group=Note}}\n<references group=\"Note\" />\n<references />",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#tag</><keyword.operator.function>:</>ref<keyword.operator>|</>note<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>reference</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><keyword.operator>|</>group=Note<punctuation.definition.tag.function>}}\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>Note<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Bug 13073 regression check: wrapped <references>",
		"wikitext": "<ref>\nfoo\n</ref>\n<div><references /></div>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>foo\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "<ref> with no name and no content.",
		"wikitext": "Bla.<ref></ref>\nfoo.<ref />\nzero{{1x|<ref />}}\n<references />",
		"parsed": "Bla.<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>foo.<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <punctuation.definition.tag.end>/&gt\\n</>zero<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <punctuation.definition.tag.end>/&gt</><punctuation.definition.tag.template>}}\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "<ref> with an empty-string name parameter and no content.",
		"wikitext": "Bla.<ref name=\"\"> </ref>\n<references />",
		"parsed": "Bla.<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref> </><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "<ref> with whitespace only name parameter and no content.",
		"wikitext": "Hi <ref name=\" \"> </ref>\nHo <ref name=\" \" />",
		"parsed": "Hi <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</> <punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref> </><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>Ho <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</> <punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "<ref> with a non-empty name parameter and no content.",
		"wikitext": "Bla.<ref name=\"void\"> </ref>\n<references />",
		"parsed": "Bla.<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>void<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref> </><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Whitespace only doesn't set content for named ref",
		"wikitext": "Hi <ref name=\"ho\"> </ref>\nHi <ref name=\"ho\">Off to work we go!</ref>\n<references />",
		"parsed": "Hi <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>ho<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref> </><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>Hi <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>ho<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>Off to work we go!</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Multiple definition (outside <references/>)",
		"wikitext": "<ref name=\"a\">abc</ref>\n<ref name=\"a\">def</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>abc</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>def</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Multiple definition (inside <references/>)",
		"wikitext": "<ref name=\"a\" />\n<references>\n<ref name=\"a\">abc</ref>\n<ref name=\"a\">def</ref>\n</references>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>abc</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>def</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Multiple definition (mixed outside/inside)",
		"wikitext": "<ref name=\"a\">abc</ref>\n<references>\n<ref name=\"a\">def</ref>\n</references>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>abc</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>def</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T202593: Conflicting dir attributes",
		"wikitext": "<ref name=\"a\" dir=\"ltr\" />\n<ref name=\"a\" dir=\"rtl\">abc</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>ltr<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>rtl<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>abc</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T202593: Conflicting dir attributes with the full ref first",
		"wikitext": "<ref name=\"a\" dir=\"ltr\">abc</ref>\n<ref name=\"a\" dir=\"rtl\" />\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>ltr<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>abc</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>rtl<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T202593: Identical dir attributes are pointless, but should not generate an error",
		"wikitext": "<ref name=\"a\" dir=\"RTL\" />\n<ref name=\"a\" dir=\"rtl\">abc</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>RTL<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>rtl<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>abc</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Multiple definition (inside {{#tag:references}})",
		"wikitext": "<ref name=\"a\" />\n{{#tag:references|\n<ref name=\"a\">abc</ref>\n<ref name=\"a\">def</ref>\n}}\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.function>{{</><constant.language.variables.query>#tag</><keyword.operator.function>:</>references<keyword.operator>|\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>abc</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>def</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.function>}}\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T29694 - [] in reference names in HTML5 fragment mode",
		"wikitext": "<ref name=\"[#foo] {bar} <baz>\">[bar]</ref>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>[#foo] {bar} &lt;baz</></><punctuation.definition.tag.end>&gt</><meta.block.ref>\"&gt[bar]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T29694 - [] in reference names in HTML5 fragment mode (tidied)",
		"wikitext": "<ref name=\"[#foo] {bar} <baz&gt;\">[bar]</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>[#foo] {bar} &lt;baz<constant.character.entity.named.gt.html><punctuation.definition.entity.html>&amp;</>gt<punctuation.definition.entity.html>;</></><punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>[bar]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Ref: 1. ref-location should be replaced with an index span",
		"wikitext": "A <ref>foo</ref>\nB <ref name=\"x\">foo</ref>\nC <ref name=\"y\" />\n<references />",
		"parsed": "A <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>B <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>C <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>y<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Ref: 2. ref-tags with identical names should all get the same index",
		"wikitext": "A <ref name=\"x\">foo</ref>\nB <ref name=\"x\" />\n<references />",
		"parsed": "A <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>B <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Ref: 3. spaces in ref-names should be ignored",
		"wikitext": "A <ref name=\"x\">foo</ref>\nB <ref name=\" x \" />\nC <ref name= x  />\n<references />",
		"parsed": "A <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>B <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</> x <punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</>C <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</> <string.unquoted.html>x</>  </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Ref: 4. 'constructor' should be accepted as a valid ref-name",
		"wikitext": "A <ref name=\"constructor\">foo</ref>\n<references />",
		"parsed": "A <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>constructor<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Ref: 5. body should accept generic wikitext",
		"wikitext": "A <ref>\n This is a '''[[bolded link]]''' and this is a {{1x|transclusion}}\n</ref>\n\n<references />",
		"parsed": "A <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref> This is a <markup.bold>'''</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>bolded link</><punctuation.definition.tag.link.internal>]]</></><markup.bold>'''</> and this is a <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>transclusion<punctuation.definition.tag.template>}}\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Ref: 6. indent-pres should not be output in ref-body",
		"wikitext": "A <ref>\n foo\n bar\n baz\n</ref>\n\n<references />",
		"parsed": "A <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref> foo\\n bar\\n baz\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Ref: 7. No p-wrapping in ref-body",
		"wikitext": "A <ref>\nfoo\n\nbar\n\n\nbaz\n\n\n\nbooz\n</ref>\n\n<references />",
		"parsed": "A <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>foo\\n\\nbar\\n\\n\\nbaz\\n\\n\\n\\nbooz\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Ref: 8. transclusion wikitext has lower precedence",
		"wikitext": "A <ref> foo {{1x|</ref> B C}}\n\n<references />",
		"parsed": "A <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref> foo <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.other.ref.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>ref</></><punctuation.definition.tag.end.html>&gt</></> B C<punctuation.definition.tag.template>}}\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</></>"
	},
	{
		"desc": "Ref: 9. unclosed comments should not leak out of ref-body",
		"wikitext": "A <ref> foo <!--</ref> B C\n<references />",
		"parsed": "A <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref> foo <comment.block.html><punctuation.definition.comment.html>&lt;!--</>&lt;/ref&gt B C\\n&lt;references /&gt</></>"
	},
	{
		"desc": "Ref: 10. Unclosed HTML tags should not leak out of ref-body",
		"wikitext": "A <ref> <b> foo </ref> B C\n\n<references />",
		"parsed": "A <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref> <meta.tag.inline.b.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></> foo </><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</> B C\\n\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Ref: 11. ref-tags acts like an inline element wrt P-wrapping",
		"wikitext": "A <ref>foo</ref> B\nC <ref>bar</ref> D\n<references />",
		"parsed": "A <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</> B\\nC <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>bar</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</> D\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Ref: 12. ref-tags act as trailing newline migration barrier",
		"wikitext": "<!--the newline at the end of this line moves out of the p tag-->a\n\nb<!--the newline at the end of this line stays inside the p tag--> <ref>foo</ref>\n<ref>bar</ref>\n\nc\n<references />",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</>the newline at the end of this line moves out of the p tag<punctuation.definition.comment.html>--&gt</></>a\\n\\nb<comment.block.html><punctuation.definition.comment.html>&lt;!--</>the newline at the end of this line stays inside the p tag<punctuation.definition.comment.html>--&gt</></> <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>bar</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</>c\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Ref: 13. ref-tags are not SOL-transparent and block indent-pres",
		"wikitext": "<ref>foo</ref> A\n<ref>bar\n</ref> B\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</> A\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>bar\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</> B\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Ref: 14. A nested ref-tag should be emitted as plain text",
		"wikitext": "<ref>foo <ref>bar</ref> baz</ref>\n\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>foo <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>bar</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</> baz</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Ref: 15. ref-tags with identical names should get identical indexes",
		"wikitext": "A1 <ref name=\"a\">foo</ref> A2 <ref name=\"a\" />\nB1 <ref name=\"b\" /> B2 <ref name=\"b\">bar</ref>\n\n<references />",
		"parsed": "A1 <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</> A2 <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</>B1 <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</> B2 <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>bar</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Ref: 16. Tokenizer should accept non-standard whitespace in <ref> and </ref> tags",
		"wikitext": "A <ref >foo</ref >\n\n<references />",
		"parsed": "A <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</> <punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Ref: 17. Generate valid HTML5 id/about attributes",
		"wikitext": "<ref name=\"a b\">foo</ref>\n<ref name=\":0\">ve-created name</ref>\n\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>:0<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>ve-created name</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Ref: 18. T58916: Extension attributes should be parsed as plain text",
		"wikitext": "<ref name=\"{{1x|a}}\">foo</ref>\n\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>{{1x|a}}<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Ref: 19. ref-tags with identical name encodings should get identical indexes",
		"wikitext": "1 <ref name=\"a & b\">foo</ref> 2 <ref name=\"a &amp; b\" />\n\n<references />",
		"parsed": "1 <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a &amp; b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</> 2 <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a <constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></> b<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Ref: 20. ref-tags with identical names but different content should keep it",
		"wikitext": "A <ref name=\"foo\">Foo one</ref>\nB <ref name=\"foo\">Foo two</ref>\nC <ref name=\"foo\" />\n\n<references />",
		"parsed": "A <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>Foo one</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>B <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>Foo two</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>C <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Verify invalid use of a numeric character in a ref name",
		"wikitext": "PRE <ref>preValue</ref>\nTHEVALUE <ref name=\"1\">theValue</ref>\nPOST <ref>postValue</ref>\n<references />",
		"parsed": "PRE <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>preValue</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>THEVALUE <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>1<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>theValue</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>POST <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>postValue</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Verify invalid use of a numeric character in a ref name and follow",
		"wikitext": "<ref name=\"1\">theValue</ref>\n<ref follow=\"1\">theFollow</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>1<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>theValue</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.follow.html><entity.other.attribute-name.html>follow</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>1<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>theFollow</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "References: 1a. references tag without any refs should be handled properly",
		"wikitext": "<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "References: 1b. references tag without any refs should be handled properly",
		"wikitext": "<references></references>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "References: 2. references tag with group only outputs references from that group",
		"wikitext": "A <ref group=\"a\">foo</ref>\nB <ref group=\"b\">bar</ref>\nC <ref>baz</ref>\n\n<references group=\"a\" />\n<references />\n<references group=\"b\" />",
		"parsed": "A <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>B <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>bar</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>C <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>baz</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "References: 3. ref list should be cleared after processing references",
		"wikitext": "A <ref>foo</ref>\n\n<references />\n\nB <ref>bar</ref>\n\n<references />",
		"parsed": "A <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt\\n\\n</>B <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>bar</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Counters should be cleared after processing named <references group=\"â€¦\">",
		"wikitext": "A <ref group=\"g\">foo</ref>\n\n<references group=\"g\" />\n\nB <ref group=\"g\">bar</ref>\n\n<references group=\"g\" />",
		"parsed": "A <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n\\n</>B <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>bar</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "References: 4. only referenced group should be cleared after processing references",
		"wikitext": "A <ref group=\"a\">afoo</ref>\nB <ref>bfoo</ref>\n\n<references group=\"a\" />\n\nC <ref>cfoo</ref>\n\n<references />",
		"parsed": "A <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>afoo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>B <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>bfoo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n\\n</>C <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>cfoo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "References: 5. ref tags in references should be processed while ignoring all other content",
		"wikitext": "A <ref name=\"a\" />\nB <ref name=\"b\">bar</ref>\n\n<references>\n<ref name=\"a\">foo</ref>\nThis should just get lost.\n</references>",
		"parsed": "A <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</>B <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>bar</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>This should just get lost.\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "References: 6. <references /> from a transclusion",
		"wikitext": "<ref>Foo</ref> {{1x|<references />}}",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>Foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</> <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "References: 7. Multiple references tags (one without and one with nested refs) should be correctly handled",
		"wikitext": "A <ref>foo bar for a</ref>\nB <ref group=\"X\" name=\"b\" />\n\n<references />\n\n<references group=\"X\">\n<ref name=\"b\">foo</ref>\n</references>",
		"parsed": "A <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>foo bar for a</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>B <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>X<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>X<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "References: 7b. Multiple references tags some with errors should be correctly handled",
		"wikitext": "ALPHA<ref name=\"foo\" />\nBETA<ref name=\"foo\" />\nONE<ref group=\"NOTES\" name=\"foo\" />\nTWO<ref group=\"NOTES\" name=\"foo\">food</ref>\n<references group=\"NOTES\" />\n<references />\nTHREE<ref group=\"NOTES\" name=\"bar\">CONTENT</ref>\nFOUR<ref group=\"NOTES\" name=\"foo\" />\nFIVE<ref group=\"NOTES\" name=\"foo\" />\nSIX<ref name=\"foo\" />\n<references group=\"NOTES\" />\n<references>\n<ref name=\"foo\">NOGROUPCONTENT</ref>\n</references>\nSEVEN<ref group=\"NOTES\" name=\"bar\" />\nEIGHT<ref group=\"NOTES\" name=\"foo\" />\n<references group=\"NOTES\" />\nNINE<ref group=\"NOTES\" name=\"bar\">NINECONTENT</ref>\nTEN<ref group=\"NOTES\" name=\"foo\">TENCONTENT</ref>\n<references group=\"NOTES\" />",
		"parsed": "ALPHA<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</>BETA<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</>ONE<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>NOTES<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</>TWO<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>NOTES<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>food</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>NOTES<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt\\n</>THREE<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>NOTES<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>bar<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>CONTENT</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>FOUR<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>NOTES<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</>FIVE<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>NOTES<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</>SIX<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>NOTES<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>NOGROUPCONTENT</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</>SEVEN<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>NOTES<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>bar<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</>EIGHT<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>NOTES<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>NOTES<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</>NINE<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>NOTES<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>bar<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>NINECONTENT</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>TEN<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>NOTES<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>TENCONTENT</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>NOTES<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "References: 8. T88019: Remove <meta>s from templates inside <ref> that's itself inside a template",
		"wikitext": "X{{1x|<ref>foo {{1x|<b>bar</b>}} and {{1x|baz}} boo</ref>}}\n<references />",
		"parsed": "X<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>foo <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.inline.b.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></>bar<meta.tag.inline.b.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</> and <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>baz<punctuation.definition.tag.template>}}</> boo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.template>}}\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "References: 9. Generate missing references list at the end",
		"wikitext": "A <ref>foo</ref>\nB <ref group=\"inexistent\">bar</ref>",
		"parsed": "A <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>B <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>inexistent<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>bar</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "References: 10.1. New <references/> shouldn't be added for unrelated edits.",
		"wikitext": "Unrelated text<span id=\"x\"> that's going to disappear</span>.\nA <ref>foo</ref>",
		"parsed": "Unrelated text<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></> that's going to disappear<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>.\\nA <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "References: 10.2. New <references/> shouldn't be added for unrelated edits.",
		"wikitext": "Unrelated text<span id=\"x\"> that's going to disappear</span>.\nA <ref>foo</ref>",
		"parsed": "Unrelated text<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></> that's going to disappear<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>.\\nA <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Grouped references with follow rendered in mixed order",
		"wikitext": "AA<ref group=\"a\" name=\"name_a\">group_a_name_a</ref>\nBA<ref group=\"b\" name=\"name_a\">group_b_name_a</ref>\nCA<ref group=\"c\" name=\"name_a\">group_c_name_a</ref>\nBB<ref group=\"b\" name=\"name_b\">group_b_name_b</ref>\nFBA<ref group=\"b\" follow=\"name_a\">group_b_follow_a</ref>\nFAA<ref group=\"a\" follow=\"name_a\">group_a_follow_a</ref>\nFBB<ref group=\"b\" follow=\"name_b\">group_b_follow_b</ref>\nFCA<ref group=\"c\" follow=\"name_a\">group_c_follow_a</ref>\n<references group=\"b\" />\n<references group=\"c\" />\n<references group=\"a\" />",
		"parsed": "AA<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>name_a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>group_a_name_a</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>BA<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>name_a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>group_b_name_a</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>CA<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>c<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>name_a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>group_c_name_a</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>BB<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>name_b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>group_b_name_b</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>FBA<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.follow.html><entity.other.attribute-name.html>follow</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>name_a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>group_b_follow_a</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>FAA<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.follow.html><entity.other.attribute-name.html>follow</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>name_a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>group_a_follow_a</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>FBB<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.follow.html><entity.other.attribute-name.html>follow</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>name_b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>group_b_follow_b</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>FCA<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>c<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.follow.html><entity.other.attribute-name.html>follow</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>name_a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>group_c_follow_a</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>c<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Grouped references with automatic group references generating errors",
		"wikitext": "GROUP <ref group=\"theGroup\" name=\"theName\">theValue</ref>\nGROUP3 <ref group=\"theGroup3\" name=\"theName3\">theValue3</ref>\nGROUP2 <ref group=\"theGroup2\" name=\"theName2\">theValue2</ref>\naDifferentNameGROUP3 <ref group=\"theGroup3\" name=\"theName\">anotherValue3differentName</ref>\naDifferentNameGROUP2 <ref group=\"theGroup2\" name=\"anotherName2\">anotherValue2DifferentName</ref>\nanotherGROUP3 <ref group=\"theGroup3\" name=\"theName3\">anotherValue3</ref>\naDifferentNameGROUP <ref group=\"theGroup\" name=\"anotherName2\">anotherValueDifferentName</ref>\n<references group=\"theGroup3\" />",
		"parsed": "GROUP <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theGroup<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theName<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>theValue</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>GROUP3 <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theGroup3<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theName3<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>theValue3</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>GROUP2 <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theGroup2<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theName2<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>theValue2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>aDifferentNameGROUP3 <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theGroup3<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theName<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>anotherValue3differentName</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>aDifferentNameGROUP2 <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theGroup2<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>anotherName2<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>anotherValue2DifferentName</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>anotherGROUP3 <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theGroup3<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theName3<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>anotherValue3</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>aDifferentNameGROUP <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theGroup<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>anotherName2<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>anotherValueDifferentName</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theGroup3<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Entities in ref name",
		"wikitext": "<ref name=\"test &amp; me {{1x|foo}}\">hi</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>test <constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></> me {{1x|foo}}<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>hi</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Generate references for unclosed references tag",
		"wikitext": "a<ref>foo</ref>\n\n<references>",
		"parsed": "a<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "New reference serializes on its own line",
		"wikitext": "foo\n<references />",
		"parsed": "foo\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Ref in ref: nested in top level ref",
		"wikitext": "test <ref>hi {{refinref|ho}}</ref>\n<references />",
		"parsed": "test <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>hi <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>refinref</><keyword.operator>|</>ho<punctuation.definition.tag.template>}}</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Ref in ref: top level ref nested in transclusion",
		"wikitext": "test {{refinref|456<ref>123</ref>}}\n<references />",
		"parsed": "test <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>refinref</><keyword.operator>|</>456<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>123</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.template>}}\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Ref in ref: top level ref nested in parser function",
		"wikitext": "test {{#tag:ref|456<ref>123</ref>}}\n<references />",
		"parsed": "test <punctuation.definition.tag.function>{{</><constant.language.variables.query>#tag</><keyword.operator.function>:</>ref<keyword.operator>|</>456<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>123</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.function>}}\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Ref in ref: Multiple levels of nesting in parser function",
		"wikitext": "one{{#tag:ref|two{{#tag:ref|three<ref>four</ref>}}}}",
		"parsed": "one<punctuation.definition.tag.function>{{</><constant.language.variables.query>#tag</><keyword.operator.function>:</>ref<keyword.operator>|</>two<punctuation.definition.tag.function>{{</><constant.language.variables.query>#tag</><keyword.operator.function>:</>ref<keyword.operator>|</>three<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>four</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.function>}}}}</>"
	},
	{
		"desc": "Ref in ref: self-referential",
		"wikitext": "{{#tag:ref|<ref name=\"x\" />|name=x}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#tag</><keyword.operator.function>:</>ref<keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</><keyword.operator>|</>name=x<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Nested ref with forward slash",
		"wikitext": "test {{nestedrefslash}}\n<references />",
		"parsed": "test <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>nestedrefslash</><punctuation.definition.tag.template>}}\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Responsive references: disabled, autogenerated",
		"wikitext": "Test <ref>1</ref><ref>2</ref>",
		"parsed": "Test <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Responsive references: enabled, autogenerated",
		"wikitext": "Test <ref>1</ref><ref>2</ref>",
		"parsed": "Test <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Responsive references: enabled, autogenerated, exceed",
		"wikitext": "Test <ref>1</ref><ref>2</ref>",
		"parsed": "Test <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Responsive references: disabled",
		"wikitext": "Test <ref>1</ref><ref>2</ref>\n<references />",
		"parsed": "Test <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Responsive references: enabled",
		"wikitext": "Test <ref>1</ref><ref>2</ref>\n<references />",
		"parsed": "Test <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Responsive references: enabled, exceed",
		"wikitext": "Test <ref>1</ref><ref>2</ref>\n<references />",
		"parsed": "Test <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Responsive references: disabled, explicit",
		"wikitext": "Test <ref>1</ref><ref>2</ref>\n<references responsive=\"\" />",
		"parsed": "Test <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.responsive.html><entity.other.attribute-name.html>responsive</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Responsive references: disabled, explicit, exceed",
		"wikitext": "Test <ref>1</ref><ref>2</ref>\n<references responsive=\"\" />",
		"parsed": "Test <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.responsive.html><entity.other.attribute-name.html>responsive</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Responsive references: enabled, explicit off",
		"wikitext": "Test <ref>1</ref><ref>2</ref>\n<references responsive=\"0\" />",
		"parsed": "Test <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.responsive.html><entity.other.attribute-name.html>responsive</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>0<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Responsive references: roundtrip templates",
		"wikitext": "test <ref>123</ref>\n\n{{1x|haha<references/>}}",
		"parsed": "test <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>123</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>haha<punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>/&gt</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "CircularRef",
		"wikitext": "<ref>Hi {{CircularRef}}</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>Hi <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>CircularRef</><punctuation.definition.tag.template>}}</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T15673: <ref> with direction \"rtl\"",
		"wikitext": "<ref dir=\"rtl\">TEST</ref>\n\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>rtl<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>TEST</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T15673: <ref> with direction \"ltr\"",
		"wikitext": "<ref dir=\"ltr\">TEST</ref>\n\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>ltr<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>TEST</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T15673: <ref> with direction \"LTR\", keeps upper case",
		"wikitext": "<ref dir=\"LTR\">TEST</ref>\n\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>LTR<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>TEST</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T15673: <ref> with direction \"nonsense\" and \"\" (empty), strip invalid dir attribute and shows error",
		"wikitext": "<ref dir=\"nonsense\">NONSENSE_DIR_TEST</ref>\n<ref dir=\"\">EMPTY_DIR_TEST</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>nonsense<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>NONSENSE_DIR_TEST</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>EMPTY_DIR_TEST</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T15673: Direction is supported when specifying name and group",
		"wikitext": "<ref dir=\"ltr\" name=\"a\" group=\"note\">TEST</ref>\n\n<references group=\"note\" />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>ltr<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>note<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>TEST</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>note<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Ref with block content in formatting tag",
		"wikitext": "''hi<ref><div>ho</div></ref>''\n<references />",
		"parsed": "<markup.italic>''</>hi<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>ho<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><markup.italic>''\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T196827: Use the dir parameter only from the full definition of a named ref tag",
		"wikitext": "abc<ref name=\"r1\" />def\n\nghi<ref name=\"r1\" dir=\"rtl\">jkl</ref>mno\n\n<references />",
		"parsed": "abc<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>r1<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>def\\n\\nghi<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>r1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>rtl<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>jkl</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>mno\\n\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T196827: Ignore the dir parameter from the first use, which is not a full definition, and use the dir value from the full definition of a named ref tag",
		"wikitext": "abc<ref name=\"r1\" dir=\"rtl\" />def\n\nghi<ref name=\"r1\">jkl</ref>mno\n\n<references />",
		"parsed": "abc<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>r1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>rtl<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>def\\n\\nghi<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>r1<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>jkl</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>mno\\n\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Similarly named refs with identical bodies",
		"wikitext": "1 <ref name=\"one\">1</ref> 2 <ref name=\"one\">1</ref>\n\n<references />",
		"parsed": "1 <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>one<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</> 2 <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>one<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T220196 - Reference names with high-bit characters, html5 mode",
		"wikitext": "<ref name=\"fÃ¼llen\">[bar]</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>fÃ¼llen<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>[bar]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T220196 - Reference names with high-bit characters, legacy mode",
		"wikitext": "<ref name=\"fÃ¼llen\">[bar]</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>fÃ¼llen<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>[bar]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Transclusion parameter spacing is lost without data-parsoid",
		"wikitext": "<ref>{{1x|\nHi ho\n}}</ref>\n\n<!-- Traverse with an encapsulation where the root isn't a native extension -->\n{{1x|<div><references /></div>}}",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|\\n</>Hi ho\\n<punctuation.definition.tag.template>}}</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><comment.block.html><punctuation.definition.comment.html>&lt;!--</> Traverse with an encapsulation where the root isn't a native extension <punctuation.definition.comment.html>--&gt\\n</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "T269531: Generic error message when a list-defined reference is not used in the text",
		"wikitext": "<references>\n<ref name=\"foo\">foo</ref>\n</references>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T269531: Special case when a named group is entirely unused in the text",
		"wikitext": "<references group=\"g\">\n<ref name=\"a\" group=\"g\">a</ref>\n</references>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>a</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T242437 - Blank ref name in #tag regression",
		"wikitext": "{{#tag:references|\n<ref name=\"\">foo</ref>\n}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#tag</><keyword.operator.function>:</>references<keyword.operator>|\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "T48140 - Make sure rollback/redo does not consume numbers",
		"wikitext": "<ref>should be [1]</ref>\n<ref name=\"a\" group=\"g\" />\n{{#tag:references|\n<ref name=\"a\">a</ref>\n|group=g}}\n<ref>should be [2]</ref>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>should be [1]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.function>{{</><constant.language.variables.query>#tag</><keyword.operator.function>:</>references<keyword.operator>|\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>a</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><keyword.operator>|</>group=g<punctuation.definition.tag.function>}}\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>should be [2]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Numbers in the default group need to start with 1, independent from other groups",
		"wikitext": "<ref name=\"a\" group=\"g\" />\n{{#tag:references|\n<ref name=\"a\">a</ref>\n|group=g}}\n<ref name=\"c\">c</ref>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.function>{{</><constant.language.variables.query>#tag</><keyword.operator.function>:</>references<keyword.operator>|\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>a</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><keyword.operator>|</>group=g<punctuation.definition.tag.function>}}\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>c<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>c</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Serialize reference tags by themselves on a line",
		"wikitext": "hi <ref>ho</ref>\n<references />\nhi ho",
		"parsed": "hi <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>ho</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt\\n</>hi ho"
	},
	{
		"desc": "T93580: 1. Templated <ref> inside block images",
		"wikitext": "[[File:Foobar.jpg|thumb|Caption with templated ref: {{1x|<ref>foo</ref>}}]]\n\n<references />",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>Caption with templated ref: <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]\\n\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T93580: 2. <ref> inside inline images",
		"wikitext": "[[File:Foobar.jpg|Undisplayed caption in inline image with ref: <ref>foo</ref>]]\n\n<references />",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>Undisplayed caption in inline image with ref: <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.link.internal>]]\\n\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T93580: 3. Templated <ref> inside inline images",
		"wikitext": "[[File:Foobar.jpg|Undisplayed caption in inline image with ref: {{1x|<ref>{{1x|foo}}</ref>}}]]\n\n<references />",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>Undisplayed caption in inline image with ref: <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo<punctuation.definition.tag.template>}}</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]\\n\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Report bad attributes in reference tags",
		"wikitext": "<ref>noGroupOrNameValue</ref>\n<references badattrib=\"invalidAttribute\" />\n<ref name=\"theName\">theNameValue</ref>\n<references name=\"theName\" badattrib=\"invalidNameAttribute\" />\n<ref group=\"theGroup\">theGroupValue</ref>\n<references group=\"theGroup\" badattrib=\"invalidGroupAttribute\" />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>noGroupOrNameValue</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.badattrib.html><entity.other.attribute-name.html>badattrib</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>invalidAttribute<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theName<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>theNameValue</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theName<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.badattrib.html><entity.other.attribute-name.html>badattrib</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>invalidNameAttribute<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theGroup<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>theGroupValue</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>theGroup<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.badattrib.html><entity.other.attribute-name.html>badattrib</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>invalidGroupAttribute<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Check Cite handing of different types of whitespace in reference names",
		"wikitext": "test space<ref name=\"a b\">testSpaceRef</ref>\nblah space<ref name=\"a b\" />\n\ntest underbar<ref name=\"a_b\">testUnderbarRef</ref>\nblah underbar<ref name=\"a_b\" />\n\ntest unicode u2028 whitespace<ref name=\"ab\">testUnicodeWhitespaceRef</ref>\nblah unicode u2028 whitespace<ref name=\"ab\" />\n<references />",
		"parsed": "test space<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>testSpaceRef</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>blah space<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a b<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n\\n</>test underbar<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a_b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>testUnderbarRef</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>blah underbar<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a_b<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n\\n</>test unicode u2028 whitespace<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>ab<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>testUnicodeWhitespaceRef</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>blah unicode u2028 whitespace<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>ab<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Check Cite handing of linefeed whitespace in reference names",
		"wikitext": "test linefeed<ref name=\"a\nb\">testLinefeedRef</ref>\n<references />",
		"parsed": "test linefeed<meta.tag.other.ref.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>ref</></> <meta.attribute.unrecognized.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a\\nb<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>testLinefeedRef<meta.tag.other.ref.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>ref</></><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "<ref> in a link should hoist the link outside the link (T301293)",
		"wikitext": "[[Foo|''x<ref>y</ref>z'']]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</><markup.italic>''</>x<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>y</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>z<markup.italic>''</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Hoisting a reference should not break template continuity",
		"wikitext": "{{1x|hello [[Foo|''x<ref>y</ref>z'']] world}}\n<references />",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>hello <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</><markup.italic>''</>x<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>y</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>z<markup.italic>''</><punctuation.definition.tag.link.internal>]]</></> world<punctuation.definition.tag.template>}}\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Hoisting multiple references should keep references in order",
		"wikitext": "[[Foo|hello <ref>note 1</ref><ref>note 2</ref>]]<ref>note 3</ref>\n<references />",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</>hello <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>note 1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>note 2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>note 3</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Red links in templated references",
		"wikitext": "<ref>[[Not_existing_article]]</ref>\n\n{{1x|<references />}}",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Not_existing_article</><punctuation.definition.tag.link.internal>]]</></></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Broken wikitext making a ref as extended attribute and a duplicated fragment",
		"wikitext": "<i <ref>y</ref>>\n\nz\n<references />",
		"parsed": "<meta.tag.inline.i.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>i</> <invalid.illegal.character-not-allowed-here.html>&lt;ref</><punctuation.definition.tag.end.html>&gt</></>y<meta.tag.other.ref.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>ref</></><punctuation.definition.tag.end.html>&gt</></>&gt\\n\\nz\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Broken wikitext making a ref as extended attribute and a duplicated fragment (with 2wt tests)",
		"wikitext": "<i title=\"<ref>y</ref>\">a\n\nz\n<references />",
		"parsed": "<meta.tag.inline.i.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>i</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>&lt;ref&gty&lt;/ref&gt<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>a\\n\\nz\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Templates: Wiki Tables: 7. Fosterable <ref>s should get fostered",
		"wikitext": "{{PartialTable}}<ref>foo</ref>\n|}\n\n<references />",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>PartialTable</><punctuation.definition.tag.template>}}</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>|}\\n\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Template nested in extension tag in template",
		"wikitext": "{{1x|hi<ref>[[ho|{{1x|hi}}]]</ref>}}\n{{1x|hi<ref>[http://test.com?q={{1x|ho}}]</ref>}}\n{{1x|hi<ref>-{ho|{{1x|hi}}}-</ref>}}\n<references />",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>hi<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>ho</><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>hi<punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]</></></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>hi<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref><punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://test.com?q={{1x|ho}}</><punctuation.definition.tag.link.external>]</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>hi<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref><punctuation.definition.tag.convert>-{</><entity.name.function.type>ho</><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>hi<punctuation.definition.tag.template>}}</><punctuation.definition.tag.convert>}-</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.template>}}\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Headings: Category in ref isn't hoisted",
		"wikitext": "== foo <ref>bar \n[[Category:Baz]] </ref> ==\n\n<references />",
		"parsed": "== foo <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>bar \\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Baz</><punctuation.definition.tag.link.internal>]]</></> </><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</> ==\\n\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Testing serialization after deletion in references",
		"wikitext": "hi <ref><div id=\"x\">ho</div></ref>\n\n<references />",
		"parsed": "hi <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>ho<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Catch regression when unpacking with trailing content",
		"wikitext": "{{1x|Foo <references/> bar}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>Foo <punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>/&gt</> bar<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "1. DOMDiff: Changes to <ref> content should be looked up using id",
		"wikitext": "X <ref><span id=\"X\">foo</span></ref>\nY <ref name=\"a\" />\n<references>\n<ref name=\"a\"><span id=\"Y\">foo</span></ref>\n</references>",
		"parsed": "X <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>X<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>Y <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>Y<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "2. DOMDiff: Changes to <ref> content should be looked up using id",
		"wikitext": "A <ref>foo bar for a</ref>\nB <ref group=\"X\" name=\"b\" />\n\n<references />\n\n<references group=\"X\">\n<ref name=\"b\"><span id=\"Z\">foo</span></ref>\n</references>",
		"parsed": "A <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>foo bar for a</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</>B <punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>X<punctuation.definition.string.end.html>\"</></></> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>X<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>Z<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "T107652: <ref>s in templates that also generate table cell attributes should be rendered properly",
		"wikitext": "{|\n|{{table_attribs_7}}\n|}\n<references />",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table_attribs_7</><punctuation.definition.tag.template>}}\\n</></></><keyword.operator>|}\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Handle extension content in section headers properly",
		"wikitext": "==c<ref>d</ref>==",
		"parsed": "<markup.heading>==<string.quoted.other.heading>c<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>d</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</></>==</>"
	},
	{
		"desc": "citeSmokeTests"
	},
	{
		"desc": "Smoke test for duplicated references with the same text",
		"wikitext": "<ref name=\"a\">text</ref>\n<ref name=\"a\">text</ref>\n<ref name=\"b\">other</ref>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>text</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>text</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>other</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Smoke test for duplicated references with conflicting text",
		"wikitext": "<ref name=\"a\">text</ref>\n<ref name=\"a\">bad</ref>\n<ref name=\"b\">other</ref>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>text</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>bad</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>other</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Smoke test for references that are reused *before* defined in <references>",
		"wikitext": "<ref name=\"a\" />\n<ref name=\"a\" />\n<ref name=\"b\">other</ref>\n<references>\n<ref name=\"a\">text</ref>\n</references>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>other</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>text</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "It should be impossible to roll back a follow=\"â€¦\", because it can't have a name",
		"wikitext": "<ref name=\"a\" />\n<ref name=\"b\">should be 2</ref>\n<references>\n<ref name=\"a\">should be 1</ref>\n<ref name=\"c\" follow=\"other page\">is invalid</ref>\n</references>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>should be 2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>should be 1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>c<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.follow.html><entity.other.attribute-name.html>follow</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>other page<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>is invalid</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "It should be impossible to roll back a follow=\"â€¦\", because it must have a name",
		"wikitext": "<ref name=\"a\" />\n<ref name=\"b\">should be 2</ref>\n<references>\n<ref name=\"a\">should be 1</ref>\n<ref follow=\"other page\">is invalid</ref>\n</references>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>should be 2</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>should be 1</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.unrecognized.follow.html><entity.other.attribute-name.html>follow</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>other page<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>is invalid</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>references</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "comments"
	},
	{
		"desc": "Comments and Indent-Pre",
		"wikitext": "<!-- comment 1 --> asdf\n\n<!-- comment 1 --> asdf\n<!-- comment 2 -->\n\n<!-- comment 1 --> asdf\n<!-- comment 2 -->xyz\n\n<!-- comment 1 --> asdf\n<!-- comment 2 --> xyz",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</> comment 1 <punctuation.definition.comment.html>--&gt</></> asdf\\n\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</> comment 1 <punctuation.definition.comment.html>--&gt</></> asdf\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</> comment 2 <punctuation.definition.comment.html>--&gt\\n\\n&lt;!--</> comment 1 <punctuation.definition.comment.html>--&gt</></> asdf\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</> comment 2 <punctuation.definition.comment.html>--&gt</></>xyz\\n\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</> comment 1 <punctuation.definition.comment.html>--&gt</></> asdf\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</> comment 2 <punctuation.definition.comment.html>--&gt</></> xyz"
	},
	{
		"desc": "Comment test 2a",
		"wikitext": "asdf\n<!-- comment 1 -->\njkl",
		"parsed": "asdf\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</> comment 1 <punctuation.definition.comment.html>--&gt\\n</></>jkl"
	},
	{
		"desc": "Comment test 2b",
		"wikitext": "asdf\n<!-- comment 1 -->\n\njkl",
		"parsed": "asdf\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</> comment 1 <punctuation.definition.comment.html>--&gt\\n\\n</></>jkl"
	},
	{
		"desc": "Comment test 3",
		"wikitext": "asdf\n<!-- comment 1 -->\n<!-- comment 2 -->\njkl",
		"parsed": "asdf\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</> comment 1 <punctuation.definition.comment.html>--&gt\\n&lt;!--</> comment 2 <punctuation.definition.comment.html>--&gt\\n</></>jkl"
	},
	{
		"desc": "Comment test 4",
		"wikitext": "asdf<!-- comment 1 -->jkl",
		"parsed": "asdf<comment.block.html><punctuation.definition.comment.html>&lt;!--</> comment 1 <punctuation.definition.comment.html>--&gt</></>jkl"
	},
	{
		"desc": "Comment spacing",
		"wikitext": "a\n <!-- foo --> b <!-- bar -->\nc",
		"parsed": "a\\n <comment.block.html><punctuation.definition.comment.html>&lt;!--</> foo <punctuation.definition.comment.html>--&gt</></> b <comment.block.html><punctuation.definition.comment.html>&lt;!--</> bar <punctuation.definition.comment.html>--&gt\\n</></>c"
	},
	{
		"desc": "Comment whitespace",
		"wikitext": "<!-- returns a single newline, not nothing, since the newline after > is not stripped -->",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</> returns a single newline, not nothing, since the newline after &gt is not stripped <punctuation.definition.comment.html>--&gt</></>"
	},
	{
		"desc": "Comment semantics and delimiters",
		"wikitext": "<!-- --><!----><!-----><!------>",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</> <punctuation.definition.comment.html>--&gt&lt;!----&gt&lt;!--</>-<punctuation.definition.comment.html>--&gt&lt;!--</>--<punctuation.definition.comment.html>--&gt</></>"
	},
	{
		"desc": "Comment semantics and delimiters, redux",
		"wikitext": "<!-- In SGML every \"foo\" here would actually show up in the text -- foo -- bar\n-- foo -- funky huh? ... -->",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</> In SGML every \"foo\" here would actually show up in the text -- foo -- bar\\n-- foo -- funky huh? ... <punctuation.definition.comment.html>--&gt</></>"
	},
	{
		"desc": "Comment semantics and delimiters: directors cut",
		"wikitext": "<!-- ... However we like to keep things simple and somewhat XML-ish so we eat\neverything starting with < followed by !-- until the first -- and > we see,\nthat wouldn't be valid XML however, since in XML -- has to terminate a comment\n-->-->",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</> ... However we like to keep things simple and somewhat XML-ish so we eat\\neverything starting with &lt; followed by !-- until the first -- and &gt we see,\\nthat wouldn't be valid XML however, since in XML -- has to terminate a comment\\n<punctuation.definition.comment.html>--&gt</></>--&gt"
	},
	{
		"desc": "Comment semantics: nesting",
		"wikitext": "<!--<!-- no, we're not going to do anything fancy here -->-->",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</><invalid.illegal.characters-not-allowed-here.html>&lt;!--</> no, we're not going to do anything fancy here <punctuation.definition.comment.html>--&gt</></>--&gt"
	},
	{
		"desc": "Comment semantics: unclosed comment at end",
		"wikitext": "<!--This comment will run out to the end of the document",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</>This comment will run out to the end of the document</>"
	},
	{
		"desc": "Comment semantics: normalize comments to play nice with XML and browsers",
		"wikitext": "<!-- Browsers --!> think this is closed -->\n<!--> This would normally be text -->\n<!---> As would this -->\n<!-- XML doesn't like trailing dashes -------->\n<!-- Nor doubled hyphens -- anywhere in the data -->\nBut this is not a comment.",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</> Browsers <invalid.illegal.characters-not-allowed-here.html>--!&gt</> think this is closed <punctuation.definition.comment.html>--&gt\\n&lt;!--</><invalid.illegal.characters-not-allowed-here.html>&gt</> This would normally be text <punctuation.definition.comment.html>--&gt\\n&lt;!--</><invalid.illegal.characters-not-allowed-here.html>-&gt</> As would this <punctuation.definition.comment.html>--&gt\\n&lt;!--</> XML doesn't like trailing dashes ------<punctuation.definition.comment.html>--&gt\\n&lt;!--</> Nor doubled hyphens -- anywhere in the data <punctuation.definition.comment.html>--&gt\\n</></>But this is not a comment."
	},
	{
		"desc": "Comment semantics: round-trip even text which contains encoded -->",
		"wikitext": "<!-- hello & goodbye - > --&gt; --&amp;gt; --&xx -->",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</> hello &amp; goodbye - &gt --&amp;gt; --&amp;amp;gt; --&amp;xx <punctuation.definition.comment.html>--&gt</></>"
	},
	{
		"desc": "Comment in template title",
		"wikitext": "{{f<!---->oo}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>f</><comment.block.html><punctuation.definition.comment.html>&lt;!----&gt</></>oo<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Comment on its own line post-expand",
		"wikitext": "a\n{{blank}}<!---->\nb",
		"parsed": "a\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>blank</><punctuation.definition.tag.template>}}</><comment.block.html><punctuation.definition.comment.html>&lt;!----&gt\\n</></>b"
	},
	{
		"desc": "Comment on its own line post-expand with non-significant whitespace",
		"wikitext": "a\n {{blank}} <!----> \nb",
		"parsed": "a\\n <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>blank</><punctuation.definition.tag.template>}}</> <comment.block.html><punctuation.definition.comment.html>&lt;!----&gt</></> \\nb"
	},
	{
		"desc": "Multiple comments should still parse as SOL-transparent",
		"wikitext": "<!--c1-->*a\n<!--c2--><!--c3--><!--c4-->*b",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</>c1<punctuation.definition.comment.html>--&gt</></>*a\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</>c2<punctuation.definition.comment.html>--&gt&lt;!--</>c3<punctuation.definition.comment.html>--&gt&lt;!--</>c4<punctuation.definition.comment.html>--&gt</></>*b"
	},
	{
		"desc": "IE conditional comments",
		"wikitext": "<!--[if lt IE 9]>\n\t<script>alert('hi');</script>\n<![endif]-->",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</>[if lt IE 9]&gt\\n\t&lt;script&gtalert('hi');&lt;/script&gt\\n&lt;![endif]<punctuation.definition.comment.html>--&gt</></>"
	},
	{
		"desc": "Comment with valid json",
		"wikitext": "hi <!--{\"hi\":\"ho\"}--> ho",
		"parsed": "hi <comment.block.html><punctuation.definition.comment.html>&lt;!--</>{\"hi\":\"ho\"}<punctuation.definition.comment.html>--&gt</></> ho"
	},
	{
		"desc": "definitionLists"
	},
	{
		"desc": "Simple definition",
		"wikitext": ";name :Definition",
		"parsed": "<punctuation.definition.list.begin.markdown>;</>name :Definition"
	},
	{
		"desc": "Definition list for indentation only",
		"wikitext": ":Indented text",
		"parsed": "<punctuation.definition.list.begin.markdown>:</>Indented text"
	},
	{
		"desc": "Definition list with no space",
		"wikitext": ";name:Definition",
		"parsed": "<punctuation.definition.list.begin.markdown>;</>name:Definition"
	},
	{
		"desc": "Definition list with URL link",
		"wikitext": ";http://example.com/ :definition",
		"parsed": "<punctuation.definition.list.begin.markdown>;</>http://example.com/ :definition"
	},
	{
		"desc": "Definition list with bracketed URL link",
		"wikitext": ";[http://www.example.com/ Example]:Something about it",
		"parsed": "<punctuation.definition.list.begin.markdown>;</><punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.com/</><string.other.link.external.title> Example</><punctuation.definition.tag.link.external>]</>:Something about it"
	},
	{
		"desc": "Definition list with wikilink containing colon",
		"wikitext": ";[[Help:FAQ]]:The least-read page on Wikipedia",
		"parsed": "<punctuation.definition.list.begin.markdown>;</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Help:</><entity.other.attribute-name>FAQ</><punctuation.definition.tag.link.internal>]]</></>:The least-read page on Wikipedia"
	},
	{
		"desc": "Definition list with news link containing colon",
		"wikitext": ";news:alt.wikipedia.rox :This isn't even a real newsgroup!",
		"parsed": "<punctuation.definition.list.begin.markdown>;</>news:alt.wikipedia.rox :This isn't even a real newsgroup!"
	},
	{
		"desc": "Malformed definition list with colon",
		"wikitext": ";news:alt.wikipedia.rox -- don't crash or enter an infinite loop",
		"parsed": "<punctuation.definition.list.begin.markdown>;</>news:alt.wikipedia.rox -- don't crash or enter an infinite loop"
	},
	{
		"desc": "Definition lists: colon in external link text",
		"wikitext": ";[http://www.wikipedia2.org/ Wikipedia :The Next Generation] :OK, I made that up",
		"parsed": "<punctuation.definition.list.begin.markdown>;</><punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.wikipedia2.org/</><string.other.link.external.title> Wikipedia :The Next Generation</><punctuation.definition.tag.link.external>]</> :OK, I made that up"
	},
	{
		"desc": "Definition lists: colon in HTML attribute",
		"wikitext": ";<b style=\"display: inline\">bold</b>",
		"parsed": "<punctuation.definition.list.begin.markdown>;</><meta.tag.inline.b.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>b</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>display: inline</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>bold<meta.tag.inline.b.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Definition lists: self-closed tag",
		"wikitext": ";one<br/>two :two-line fun",
		"parsed": "<punctuation.definition.list.begin.markdown>;</>one<meta.tag.inline.br.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>br</><punctuation.definition.tag.end.html>/&gt</></>two :two-line fun"
	},
	{
		"desc": "Definition lists: ignore colons inside tags",
		"wikitext": ";one <b>two : tag <i>fun:</i>:</b>:def",
		"parsed": "<punctuation.definition.list.begin.markdown>;</>one <meta.tag.inline.b.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></>two : tag <meta.tag.inline.i.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>i</><punctuation.definition.tag.end.html>&gt</></>fun:<meta.tag.inline.i.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>i</><punctuation.definition.tag.end.html>&gt</></>:<meta.tag.inline.b.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></>:def"
	},
	{
		"desc": "Definition lists: excess closed tags",
		"wikitext": ";one</b>two :bad tag fun",
		"parsed": "<punctuation.definition.list.begin.markdown>;</>one<meta.tag.inline.b.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></>two :bad tag fun"
	},
	{
		"desc": "T13748: Literal closing tags",
		"wikitext": "<dl>\n<dt>test 1</dt>\n<dd>test test test test test</dd>\n<dt>test 2</dt>\n<dd>test test test test test</dd>\n</dl>",
		"parsed": "<meta.tag.structure.dl.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>dl</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.dt.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>dt</><punctuation.definition.tag.end.html>&gt</></>test 1<meta.tag.structure.dt.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>dt</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.dd.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>dd</><punctuation.definition.tag.end.html>&gt</></>test test test test test<meta.tag.structure.dd.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>dd</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.dt.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>dt</><punctuation.definition.tag.end.html>&gt</></>test 2<meta.tag.structure.dt.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>dt</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.dd.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>dd</><punctuation.definition.tag.end.html>&gt</></>test test test test test<meta.tag.structure.dd.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>dd</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.dl.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>dl</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Definition and unordered list using wiki syntax nested in unordered list using html tags.",
		"wikitext": "<ul><li>\n;term :description\n*unordered\n</li></ul>",
		"parsed": "<meta.tag.structure.ul.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.list.begin.markdown>;</>term :description\\n<punctuation.definition.list.begin.markdown>*</>unordered\\n<meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.ul.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Definition list with empty definition and following paragraph",
		"wikitext": ";term:\n\nParagraph text",
		"parsed": "<punctuation.definition.list.begin.markdown>;</>term:\\n\\nParagraph text"
	},
	{
		"desc": "Nested definition lists using html syntax",
		"wikitext": "<dl><dt>x</dt>\n<dd>a</dd>\n<dd>b</dd></dl>",
		"parsed": "<meta.tag.structure.dl.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>dl</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.dt.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>dt</><punctuation.definition.tag.end.html>&gt</></>x<meta.tag.structure.dt.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>dt</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.dd.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>dd</><punctuation.definition.tag.end.html>&gt</></>a<meta.tag.structure.dd.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>dd</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.dd.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>dd</><punctuation.definition.tag.end.html>&gt</></>b<meta.tag.structure.dd.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>dd</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.dl.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>dl</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Definition Lists: No nesting: Multiple dd's",
		"wikitext": ";x\n:a\n:b",
		"parsed": "<punctuation.definition.list.begin.markdown>;</>x\\n<punctuation.definition.list.begin.markdown>:</>a\\n<punctuation.definition.list.begin.markdown>:</>b"
	},
	{
		"desc": "Definition Lists: Indentation: Regular",
		"wikitext": ":i1\n::i2\n:::i3",
		"parsed": "<punctuation.definition.list.begin.markdown>:</>i1\\n<punctuation.definition.list.begin.markdown>::</>i2\\n<punctuation.definition.list.begin.markdown>:::</>i3"
	},
	{
		"desc": "Definition Lists: Indentation: Missing 1st level",
		"wikitext": "::i2\n:::i3",
		"parsed": "<punctuation.definition.list.begin.markdown>::</>i2\\n<punctuation.definition.list.begin.markdown>:::</>i3"
	},
	{
		"desc": "Definition Lists: Indentation: Multi-level indent",
		"wikitext": ":::i3",
		"parsed": "<punctuation.definition.list.begin.markdown>:::</>i3"
	},
	{
		"desc": "Definition Lists: Hacky use to indent tables",
		"wikitext": "::{|\n|foo\n|bar\n|}\nthis text\nshould be left alone",
		"parsed": "<meta.tag.block.table><punctuation.definition.list.begin.markdown>::</><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>foo\\n</><keyword.operator>|</><markup.style>bar\\n</></><keyword.operator>|}\\n</></>this text\\nshould be left alone"
	},
	{
		"desc": "Definition Lists: Hacky use to indent tables (with content following table)",
		"wikitext": ":{|\n|foo\n|bar\n|} <!--c1--> this text should be part of the dl",
		"parsed": "<meta.tag.block.table><punctuation.definition.list.begin.markdown>:</><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>foo\\n</><keyword.operator>|</><markup.style>bar\\n</></><keyword.operator>|}</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c1<punctuation.definition.comment.html>--&gt</></> this text should be part of the dl"
	},
	{
		"desc": "Definition Lists: Hacky use to indent tables, with comments (T65979)",
		"wikitext": "<!-- foo -->\n::{|\n|foo\n|bar\n|}<!-- bar -->\nthis text\nshould be left alone",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</> foo <punctuation.definition.comment.html>--&gt\\n</></><meta.tag.block.table><punctuation.definition.list.begin.markdown>::</><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>foo\\n</><keyword.operator>|</><markup.style>bar\\n</></><keyword.operator>|}</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</> bar <punctuation.definition.comment.html>--&gt\\n</></>this text\\nshould be left alone"
	},
	{
		"desc": "Definition Lists: Hacky use to indent tables, with comment before table",
		"wikitext": "::<!-- foo -->{|\n|foo\n|}",
		"parsed": "<punctuation.definition.list.begin.markdown>::</><comment.block.html><punctuation.definition.comment.html>&lt;!--</> foo <punctuation.definition.comment.html>--&gt</></>{|\\n|foo\\n|}"
	},
	{
		"desc": "Definition Lists: Hack use to indent tables, in a nested list context (T262943)",
		"wikitext": "This is a discussion thread.\n\n:Parent comment.\n::Child comment\n::{|\n|With a\n|Table!\n|}",
		"parsed": "This is a discussion thread.\\n\\n<punctuation.definition.list.begin.markdown>:</>Parent comment.\\n<punctuation.definition.list.begin.markdown>::</>Child comment\\n<meta.tag.block.table><punctuation.definition.list.begin.markdown>::</><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>With a\\n</><keyword.operator>|</><markup.style>Table!\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Definition Lists: Hacky use to indent tables (WS-insensitive)",
		"wikitext": ":{|\n|a\n|}",
		"parsed": "<meta.tag.block.table><punctuation.definition.list.begin.markdown>:</><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>a\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Definition Lists: Hacky use to indent tables (nl-insensitive)",
		"wikitext": ":{|\n\n\n|a\n|}",
		"parsed": "<meta.tag.block.table><punctuation.definition.list.begin.markdown>:</><keyword.operator>{|\\n\\n\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>a\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Table / list interaction: indented table with lists in table contents",
		"wikitext": ":{|\n|-\n|a\n\n*b\n|-\n|c\n\n*d\n|}",
		"parsed": "<meta.tag.block.table><punctuation.definition.list.begin.markdown>:</><keyword.operator>{|\\n</><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>a\\n\\n</></><punctuation.definition.list.begin.markdown>*</>b\\n<meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>c\\n\\n</></><punctuation.definition.list.begin.markdown>*</>d\\n<keyword.operator>|}</></>"
	},
	{
		"desc": "Table / list interaction: lists nested in tables nested in indented lists",
		"wikitext": ":{|\n|\n:a\n:b\n|\n*c\n*d\n|}\n\n*e\n*f",
		"parsed": "<meta.tag.block.table><punctuation.definition.list.begin.markdown>:</><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|\\n</></><punctuation.definition.list.begin.markdown>:</>a\\n<punctuation.definition.list.begin.markdown>:</>b\\n<meta.tag.block.td><keyword.operator>|\\n</></><punctuation.definition.list.begin.markdown>*</>c\\n<punctuation.definition.list.begin.markdown>*</>d\\n<keyword.operator>|}\\n\\n</></><punctuation.definition.list.begin.markdown>*</>e\\n<punctuation.definition.list.begin.markdown>*</>f"
	},
	{
		"desc": "Definition Lists: Nesting: Multi-level (Parsoid only)",
		"wikitext": ";t1:d1\n;;t2::d2\n;;;t3:::d3",
		"parsed": "<punctuation.definition.list.begin.markdown>;</>t1:d1\\n<punctuation.definition.list.begin.markdown>;;</>t2::d2\\n<punctuation.definition.list.begin.markdown>;;;</>t3:::d3"
	},
	{
		"desc": "Definition Lists: Nesting: Test 2",
		"wikitext": ";t1\n::d2",
		"parsed": "<punctuation.definition.list.begin.markdown>;</>t1\\n<punctuation.definition.list.begin.markdown>::</>d2"
	},
	{
		"desc": "Definition Lists: Nesting: Test 3",
		"wikitext": ":;t1\n::::d2",
		"parsed": "<punctuation.definition.list.begin.markdown>:;</>t1\\n<punctuation.definition.list.begin.markdown>::::</>d2"
	},
	{
		"desc": "Definition Lists: Nesting: Test 4",
		"wikitext": "::;t3\n:::d3",
		"parsed": "<punctuation.definition.list.begin.markdown>::;</>t3\\n<punctuation.definition.list.begin.markdown>:::</>d3"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 1",
		"wikitext": ":;*foo\n::*bar\n:;baz",
		"parsed": "<punctuation.definition.list.begin.markdown>:;*</>foo\\n<punctuation.definition.list.begin.markdown>::*</>bar\\n<punctuation.definition.list.begin.markdown>:;</>baz"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 2",
		"wikitext": "*:d1\n*:d2",
		"parsed": "<punctuation.definition.list.begin.markdown>*:</>d1\\n<punctuation.definition.list.begin.markdown>*:</>d2"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 3",
		"wikitext": "*:::d1\n*:::d2",
		"parsed": "<punctuation.definition.list.begin.markdown>*:::</>d1\\n<punctuation.definition.list.begin.markdown>*:::</>d2"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 4",
		"wikitext": "*;d1 :d2\n*;d3 :d4",
		"parsed": "<punctuation.definition.list.begin.markdown>*;</>d1 :d2\\n<punctuation.definition.list.begin.markdown>*;</>d3 :d4"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 5",
		"wikitext": "*:d1\n*::d2",
		"parsed": "<punctuation.definition.list.begin.markdown>*:</>d1\\n<punctuation.definition.list.begin.markdown>*::</>d2"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 6",
		"wikitext": "#*:d1\n#*:::d3",
		"parsed": "<punctuation.definition.list.begin.markdown>#*:</>d1\\n<punctuation.definition.list.begin.markdown>#*:::</>d3"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 7",
		"wikitext": ":*d1\n:*d2",
		"parsed": "<punctuation.definition.list.begin.markdown>:*</>d1\\n<punctuation.definition.list.begin.markdown>:*</>d2"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 8",
		"wikitext": ":*d1\n::*d2",
		"parsed": "<punctuation.definition.list.begin.markdown>:*</>d1\\n<punctuation.definition.list.begin.markdown>::*</>d2"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 9",
		"wikitext": "*;foo :bar",
		"parsed": "<punctuation.definition.list.begin.markdown>*;</>foo :bar"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 10",
		"wikitext": "*#;foo :bar",
		"parsed": "<punctuation.definition.list.begin.markdown>*#;</>foo :bar"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 11",
		"wikitext": ";a\n:*b",
		"parsed": "<punctuation.definition.list.begin.markdown>;</>a\\n<punctuation.definition.list.begin.markdown>:*</>b"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 12",
		"wikitext": "*#*#;*;;foo :bar\n*#*#;boo :baz",
		"parsed": "<punctuation.definition.list.begin.markdown>*#*#;*;;</>foo :bar\\n<punctuation.definition.list.begin.markdown>*#*#;</>boo :baz"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 13",
		"wikitext": "*#*#;*;;foo : bar\n*#*#;boo : baz",
		"parsed": "<punctuation.definition.list.begin.markdown>*#*#;*;;</>foo : bar\\n<punctuation.definition.list.begin.markdown>*#*#;</>boo : baz"
	},
	{
		"desc": "Definition Lists: Weird Ones: Test 1",
		"wikitext": "*#;*::;;foo :bar (who uses this?)",
		"parsed": "<punctuation.definition.list.begin.markdown>*#;*::;;</>foo :bar (who uses this?)"
	},
	{
		"desc": "Definition Lists: colons occurring in tags",
		"wikitext": ";a:b\n;'''a:b'''\n;<i>a:b</i>\n;<span>a:b</span>\n;<div>a:b</div>\n;<div>a\n:b</div>\n;{{1x|a:b}}\n;{{1x|''a:b''}}\n;;;''a:b''",
		"parsed": "<punctuation.definition.list.begin.markdown>;</>a:b\\n<punctuation.definition.list.begin.markdown>;</><markup.bold>'''</>a:b<markup.bold>'''\\n</><punctuation.definition.list.begin.markdown>;</><meta.tag.inline.i.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>i</><punctuation.definition.tag.end.html>&gt</></>a:b<meta.tag.inline.i.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>i</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.list.begin.markdown>;</><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>a:b<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.list.begin.markdown>;</><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>a:b<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.list.begin.markdown>;</><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>a\\n<punctuation.definition.list.begin.markdown>:</>b<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.list.begin.markdown>;</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>a:b<punctuation.definition.tag.template>}}\\n</><punctuation.definition.list.begin.markdown>;</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><markup.italic>''</>a:b<markup.italic>''</><punctuation.definition.tag.template>}}\\n</><punctuation.definition.list.begin.markdown>;;;</><markup.italic>''</>a:b<markup.italic>''</>"
	},
	{
		"desc": "Definition Lists: colons and tables 1",
		"wikitext": ":{|\n|x\n|}\n:{|\n|y\n|}",
		"parsed": "<meta.tag.block.table><punctuation.definition.list.begin.markdown>:</><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>x\\n</></><keyword.operator>|}\\n</><punctuation.definition.list.begin.markdown>:</><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>y\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Definition Lists: template interaction",
		"wikitext": "::{{definition_list}}\n\n:one\n::{{definition_list}}\n:::two\n:::three\n::four",
		"parsed": "<punctuation.definition.list.begin.markdown>::</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>definition_list</><punctuation.definition.tag.template>}}\\n\\n</><punctuation.definition.list.begin.markdown>:</>one\\n<punctuation.definition.list.begin.markdown>::</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>definition_list</><punctuation.definition.tag.template>}}\\n</><punctuation.definition.list.begin.markdown>:::</>two\\n<punctuation.definition.list.begin.markdown>:::</>three\\n<punctuation.definition.list.begin.markdown>::</>four"
	},
	{
		"desc": "extLinks"
	},
	{
		"desc": "External links: non-bracketed",
		"wikitext": "Non-bracketed: http://example.com",
		"parsed": "Non-bracketed: http://example.com"
	},
	{
		"desc": "External links: numbered",
		"wikitext": "Numbered: [http://example.com]\nNumbered: [http://example.net]\nNumbered: [http://example.com]",
		"parsed": "Numbered: <punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com</><punctuation.definition.tag.link.external>]\\n</>Numbered: <punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.net</><punctuation.definition.tag.link.external>]\\n</>Numbered: <punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External links: specified text",
		"wikitext": "Specified text: [http://example.com link]",
		"parsed": "Specified text: <punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com</><string.other.link.external.title> link</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External links: trail",
		"wikitext": "Linktrails should not work for external links: [http://example.com link]s",
		"parsed": "Linktrails should not work for external links: <punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com</><string.other.link.external.title> link</><punctuation.definition.tag.link.external>]</>s"
	},
	{
		"desc": "External links: dollar sign in URL",
		"wikitext": "http://example.com/1$2345",
		"parsed": "http://example.com/1$2345"
	},
	{
		"desc": "External links: dollar sign in URL (autonumber)",
		"wikitext": "[http://example.com/1$2345]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com/1$2345</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External links: open square bracket forbidden in URL (T6377)",
		"wikitext": "http://example.com/1[2345",
		"parsed": "http://example.com/1[2345"
	},
	{
		"desc": "External links: open square bracket forbidden in URL (named) (T6377)",
		"wikitext": "[http://example.com/1[2345]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com/1</><string.other.link.external.title>[2345</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External links: open square bracket forbidden in URL (named) (T6377)\nParsoid variant.",
		"wikitext": "[http://example.com/1 [2345]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com/1</><string.other.link.external.title> [2345</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External links: nowiki in URL link text (T8230)",
		"wikitext": "[http://example.com/ <nowiki>''example site''</nowiki>]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com/</><string.other.link.external.title> <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>''example site''</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</></><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External links: newline forbidden in text (T8230 regression check)",
		"wikitext": "[http://example.com/ first\nsecond]",
		"parsed": "[http://example.com/ first\\nsecond]"
	},
	{
		"desc": "External links: Pipe char between url and text",
		"wikitext": "[http://example.com | link]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com</><string.other.link.external.title> | link</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External links: protocol-relative URL in brackets",
		"wikitext": "[//example.com/ Test]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>//example.com/</><string.other.link.external.title> Test</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External links: protocol-relative URL in brackets without text",
		"wikitext": "[//example.com]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>//example.com</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External links: protocol-relative URL in free text is left alone",
		"wikitext": "//example.com/Foo",
		"parsed": "//example.com/Foo"
	},
	{
		"desc": "External links: protocol-relative URL in the middle of a word is left alone (T32269)",
		"wikitext": "foo//example.com/Foo",
		"parsed": "foo//example.com/Foo"
	},
	{
		"desc": "External links: with no contents",
		"wikitext": "[http://en.wikipedia.org/wiki/Foo]\n\n[[wikipedia:Foo|Bar]]\n\n[[wikipedia:Foo|<span>Bar</span>]]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://en.wikipedia.org/wiki/Foo</><punctuation.definition.tag.link.external>]\\n\\n</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>wikipedia:</><entity.other.attribute-name>Foo</><keyword.operator>|</>Bar<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>wikipedia:</><entity.other.attribute-name>Foo</><keyword.operator>|</><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>Bar<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "External links: Free with trailing punctuation",
		"wikitext": "http://example.com,\nhttp://example.com;\nhttp://example.com\\\nhttp://example.com.\nhttp://example.com:\nhttp://example.com!\nhttp://example.com?\nhttp://example.com)\nhttp://example.com/url_with_(brackets)\n(http://example.com/url_without_brackets)\nhttp://example.com/url_with_entity&amp;\nhttp://example.com/url_with_entity&#x26;\nhttp://example.com/url_with_entity&#038;\nhttp://example.com/url_with_entity&nbsp;\nhttp://example.com/url_with_entity&#xA0;\nhttp://example.com/url_with_entity&#160;\nhttp://example.com/url_with_entity&lt;\nhttp://example.com/url_with_entity&#x3C;\nhttp://example.com/url_with_entity&#60;",
		"parsed": "http://example.com,\\nhttp://example.com;\\nhttp://example.com\\\\nhttp://example.com.\\nhttp://example.com:\\nhttp://example.com!\\nhttp://example.com?\\nhttp://example.com)\\nhttp://example.com/url_with_(brackets)\\n(http://example.com/url_without_brackets)\\nhttp://example.com/url_with_entity<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;\\n</></>http://example.com/url_with_entity<constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#x26;\\n</>http://example.com/url_with_entity<constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#038;\\n</>http://example.com/url_with_entity<constant.character.entity.named.nbsp.html><punctuation.definition.entity.html>&amp;</>nbsp<punctuation.definition.entity.html>;\\n</></>http://example.com/url_with_entity<constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#xA0;\\n</>http://example.com/url_with_entity<constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#160;\\n</>http://example.com/url_with_entity<constant.character.entity.named.lt.html><punctuation.definition.entity.html>&amp;</>lt<punctuation.definition.entity.html>;\\n</></>http://example.com/url_with_entity<constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#x3C;\\n</>http://example.com/url_with_entity<constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#60;</>"
	},
	{
		"desc": "External links: tricky Parsoid html2html case",
		"wikitext": "http://example.com/url_with_entity&amp;amp;",
		"parsed": "http://example.com/url_with_entity<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>amp;"
	},
	{
		"desc": "External links: html2html with trailing dot (T263203)",
		"wikitext": "test [http://example.com/test. http://example.com/test.] test\n\ntest http://example.com/test. test",
		"parsed": "test <punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com/test.</><string.other.link.external.title> http://example.com/test.</><punctuation.definition.tag.link.external>]</> test\\n\\ntest http://example.com/test. test"
	},
	{
		"desc": "External links: Free with trailing quotes (T113666)",
		"wikitext": "'''News:''' Stuff here\n\nnews:'a'b''c''d e",
		"parsed": "<markup.bold>'''</>News:<markup.bold>'''</> Stuff here\\n\\nnews:'a'b<markup.italic>''</>c<markup.italic>''</>d e"
	},
	{
		"desc": "External links: with entity",
		"wikitext": "[http://&#x20;www.librarieswithoutborders.org Libraries without borders]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://&amp;#x20;www.librarieswithoutborders.org</><string.other.link.external.title> Libraries without borders</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External links: Lone protocols are never linked (T105697)",
		"wikitext": "http://\nhttp://;\n(http://)\nbitcoin:\nbitcoin:;\n(bitcoin:)",
		"parsed": "http://\\nhttp://;\\n(http://)\\nbitcoin:\\nbitcoin:;\\n(bitcoin:)"
	},
	{
		"desc": "External links: No preceding word characters allowed (T67278)",
		"wikitext": "NOPEhttp://example.com\nN0http://example.com\nok:http://example.com\nok-http://example.com",
		"parsed": "NOPEhttp://example.com\\nN0http://example.com\\nok:http://example.com\\nok-http://example.com"
	},
	{
		"desc": "External links: nofollow domain exception",
		"wikitext": "A [https://no-nofollow.org/foobar link], and another [https://example.org link].",
		"parsed": "A <punctuation.definition.tag.link.external>[</><entity.name.tag.url>https://no-nofollow.org/foobar</><string.other.link.external.title> link</><punctuation.definition.tag.link.external>]</>, and another <punctuation.definition.tag.link.external>[</><entity.name.tag.url>https://example.org</><string.other.link.external.title> link</><punctuation.definition.tag.link.external>]</>."
	},
	{
		"desc": "External image",
		"wikitext": "External image: http://meta.wikimedia.org/upload/f/f1/Ncwikicol.png",
		"parsed": "External image: http://meta.wikimedia.org/upload/f/f1/Ncwikicol.png"
	},
	{
		"desc": "External image from https",
		"wikitext": "External image from https: https://meta.wikimedia.org/upload/f/f1/Ncwikicol.png",
		"parsed": "External image from https: https://meta.wikimedia.org/upload/f/f1/Ncwikicol.png"
	},
	{
		"desc": "External image (when not allowed)",
		"wikitext": "External image: http://meta.wikimedia.org/upload/f/f1/Ncwikicol.png",
		"parsed": "External image: http://meta.wikimedia.org/upload/f/f1/Ncwikicol.png"
	},
	{
		"desc": "Link to non-http image, no img tag",
		"wikitext": "Link to non-http image, no img tag: ftp://example.com/test.jpg",
		"parsed": "Link to non-http image, no img tag: ftp://example.com/test.jpg"
	},
	{
		"desc": "External links: terminating separator",
		"wikitext": "Terminating separator: http://example.com/thing,",
		"parsed": "Terminating separator: http://example.com/thing,"
	},
	{
		"desc": "External links: intervening separator",
		"wikitext": "Intervening separator: http://example.com/1,2,3",
		"parsed": "Intervening separator: http://example.com/1,2,3"
	},
	{
		"desc": "External links: old bug with URL in query",
		"wikitext": "Old bug with URL in query: [http://example.com/thing?url=http://example.com link]",
		"parsed": "Old bug with URL in query: <punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com/thing?url=http://example.com</><string.other.link.external.title> link</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External links: old URL-in-URL bug, mixed protocols",
		"wikitext": "And again with mixed protocols: [ftp://example.com?url=http://example.com link]",
		"parsed": "And again with mixed protocols: <punctuation.definition.tag.link.external>[</><entity.name.tag.url>ftp://example.com?url=http://example.com</><string.other.link.external.title> link</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External links: URL in text",
		"wikitext": "URL in text: [http://example.com http://example.com]",
		"parsed": "URL in text: <punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com</><string.other.link.external.title> http://example.com</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External links: Clickable images",
		"wikitext": "ja-style clickable images: [http://example.com http://meta.wikimedia.org/upload/f/f1/Ncwikicol.png]",
		"parsed": "ja-style clickable images: <punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com</><string.other.link.external.title> http://meta.wikimedia.org/upload/f/f1/Ncwikicol.png</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External links: raw ampersand",
		"wikitext": "Old &amp; use: http://x&y",
		"parsed": "Old <constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></> use: http://x&amp;y"
	},
	{
		"desc": "External links: encoded ampersand",
		"wikitext": "Old &amp; use: http://x&amp;y",
		"parsed": "Old <constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></> use: http://x<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>y"
	},
	{
		"desc": "External links: encoded equals (T8102)",
		"wikitext": "http://example.com/?foo&#61;bar",
		"parsed": "http://example.com/?foo<constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#61;</>bar"
	},
	{
		"desc": "External links: [raw ampersand]",
		"wikitext": "Old &amp; use: [http://x&y]",
		"parsed": "Old <constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></> use: <punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://x&amp;y</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External links: [encoded ampersand]",
		"wikitext": "Old &amp; use: [http://x&amp;y]",
		"parsed": "Old <constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></> use: <punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://x&amp;amp;y</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External links: [raw equals]",
		"wikitext": "[http://example.com/?foo=bar]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com/?foo=bar</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External links: [encoded equals] (T8102)",
		"wikitext": "[http://example.com/?foo&#61;bar]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com/?foo&amp;#61;bar</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External links: [IDN ignored character reference in hostname; strip it right off]",
		"wikitext": "[http://e&zwnj;xample.com/]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://e&amp;zwnj;xample.com/</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External links: IDN ignored character reference in hostname; strip it right off",
		"wikitext": "http://e&zwnj;xample.com/",
		"parsed": "http://e<constant.character.entity.named.zwnj.html><punctuation.definition.entity.html>&amp;</>zwnj<punctuation.definition.entity.html>;</></>xample.com/"
	},
	{
		"desc": "External links: www.jpeg.org (T2554)",
		"wikitext": "http://www.jpeg.org",
		"parsed": "http://www.jpeg.org"
	},
	{
		"desc": "External links: URL within URL (T2002)",
		"wikitext": "[http://www.unausa.org/newindex.asp?place=http://www.unausa.org/programs/mun.asp]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.unausa.org/newindex.asp?place=http://www.unausa.org/programs/mun.asp</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "T2361: URL inside bracketed URL",
		"wikitext": "[http://www.example.com/foo http://www.example.com/bar]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.com/foo</><string.other.link.external.title> http://www.example.com/bar</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "T2361: URL within URL, not bracketed",
		"wikitext": "http://www.example.com/foo?=http://www.example.com/bar",
		"parsed": "http://www.example.com/foo?=http://www.example.com/bar"
	},
	{
		"desc": "T2289: \">\"-token in URL-tail",
		"wikitext": "http://www.example.com/<hello>",
		"parsed": "http://www.example.com/<meta.tag.other.hello.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>hello</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T2289: literal \">\"-token in URL-tail",
		"wikitext": "http://www.example.com/<b>html</b>",
		"parsed": "http://www.example.com/<meta.tag.inline.b.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></>html<meta.tag.inline.b.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T2289: \">\"-token in bracketed URL",
		"wikitext": "[http://www.example.com/<hello> stuff]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.com/</><string.other.link.external.title><meta.tag.other.hello.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>hello</></><punctuation.definition.tag.end.html>&gt</></> stuff</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "T2289: literal \">\"-token in bracketed URL",
		"wikitext": "[http://www.example.com/<b>html</b> stuff]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.com/</><string.other.link.external.title><meta.tag.inline.b.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></>html<meta.tag.inline.b.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></> stuff</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "T2289: literal double quote at end of URL",
		"wikitext": "http://www.example.com/\"hello\"",
		"parsed": "http://www.example.com/\"hello\""
	},
	{
		"desc": "T2289: literal double quote in bracketed URL",
		"wikitext": "[http://www.example.com/\"hello\" stuff]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.com/</><string.other.link.external.title>\"hello\" stuff</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External links: multiple legal whitespace is fine, Magnus. Don't break it please. (T7081)",
		"wikitext": "[http://www.example.com  test]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.com</><string.other.link.external.title>  test</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External links: link text with spaces",
		"wikitext": "[http://www.example.com a b c]\n[http://www.example.com ''a'' ''b'']",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.com</><string.other.link.external.title> a b c</><punctuation.definition.tag.link.external>]\\n[</><entity.name.tag.url>http://www.example.com</><string.other.link.external.title> <markup.italic>''</>a<markup.italic>''</> <markup.italic>''</>b<markup.italic>''</></><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External links: wiki links within external link (T5695)",
		"wikitext": "[http://example.com [[wikilink]] embedded in ext link]\n\n[http://example.com test [[wikilink]] embedded in ext link]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com</><string.other.link.external.title> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>wikilink</></></><punctuation.definition.tag.link.external>]</>] embedded in ext link]\\n\\n<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com</><string.other.link.external.title> test <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>wikilink</></></><punctuation.definition.tag.link.external>]</>] embedded in ext link]"
	},
	{
		"desc": "T2787: Links with one slash after the url protocol are invalid",
		"wikitext": "http:/example.com\n\n[http:/example.com title]",
		"parsed": "http:/example.com\\n\\n[http:/example.com title]"
	},
	{
		"desc": "Bracketed external links with template-generated invalid target",
		"wikitext": "[{{1x|http:/example.com}} title]",
		"parsed": "[<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>http:/example.com<punctuation.definition.tag.template>}}</> title]"
	},
	{
		"desc": "T6781: %26 in URL",
		"wikitext": "http://www.example.com/?title=AT%26T",
		"parsed": "http://www.example.com/?title=AT%26T"
	},
	{
		"desc": "T6781, T7267: %25 in URL",
		"wikitext": "http://www.example.com/?title=100%25_Bran",
		"parsed": "http://www.example.com/?title=100%25_Bran"
	},
	{
		"desc": "T6781, T7267: %28, %29 in URL",
		"wikitext": "http://www.example.com/?title=Ben-Hur_%281959_film%29",
		"parsed": "http://www.example.com/?title=Ben-Hur_%281959_film%29"
	},
	{
		"desc": "T6781: %26 in autonumber URL",
		"wikitext": "[http://www.example.com/?title=AT%26T]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.com/?title=AT%26T</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "T6781, T7267: %26 in autonumber URL",
		"wikitext": "[http://www.example.com/?title=100%25_Bran]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.com/?title=100%25_Bran</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "T6781, T7267: %28, %29 in autonumber URL",
		"wikitext": "[http://www.example.com/?title=Ben-Hur_%281959_film%29]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.com/?title=Ben-Hur_%281959_film%29</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "T6781: %26 in bracketed URL",
		"wikitext": "[http://www.example.com/?title=AT%26T link]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.com/?title=AT%26T</><string.other.link.external.title> link</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "T6781, T7267: %25 in bracketed URL",
		"wikitext": "[http://www.example.com/?title=100%25_Bran link]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.com/?title=100%25_Bran</><string.other.link.external.title> link</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "T6781, T7267: %28, %29 in bracketed URL",
		"wikitext": "[http://www.example.com/?title=Ben-Hur_%281959_film%29 link]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.example.com/?title=Ben-Hur_%281959_film%29</><string.other.link.external.title> link</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External link containing a period in the anchor. (T65947)",
		"wikitext": "[//foo.org/bar#baz. bang]\n\n[//foo.org/bar. bang]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>//foo.org/bar#baz.</><string.other.link.external.title> bang</><punctuation.definition.tag.link.external>]\\n\\n[</><entity.name.tag.url>//foo.org/bar.</><string.other.link.external.title> bang</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External link containing a single quote. (T65947)",
		"wikitext": "[//foo.org/bar'baz]\n\n[//foo.org/bar'baz bang]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>//foo.org/bar'baz</><punctuation.definition.tag.link.external>]\\n\\n[</><entity.name.tag.url>//foo.org/bar'baz</><string.other.link.external.title> bang</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External link containing double-single-quotes in text '' (T6598 check)",
		"wikitext": "Some [http://example.com/ pretty ''italics'' and stuff]!",
		"parsed": "Some <punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com/</><string.other.link.external.title> pretty <markup.italic>''</>italics<markup.italic>''</> and stuff</><punctuation.definition.tag.link.external>]</>!"
	},
	{
		"desc": "External link containing double-single-quotes in text embedded in italics (T6598 check)",
		"wikitext": "''Some [http://example.com/ pretty ''italics'' and stuff]!''",
		"parsed": "<markup.italic>''</>Some <punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com/</><string.other.link.external.title> pretty <markup.italic>''</>italics<markup.italic>''</> and stuff</><punctuation.definition.tag.link.external>]</>!<markup.italic>''</>"
	},
	{
		"desc": "External link containing double-single-quotes with no space separating the url from text in italics",
		"wikitext": "[http://www.musee-picasso.fr/pages/page_id18528_u1l2.htm''La muerte de Casagemas'' (1901) en el sitio de [[Museo Picasso (ParÃ­s)|Museo Picasso]].]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.musee-picasso.fr/pages/page_id18528_u1l2.htm''La</><string.other.link.external.title> muerte de Casagemas<markup.italic>''</> (1901) en el sitio de <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Museo Picasso (ParÃ­s)</><keyword.operator>|</>Museo Picasso</></><punctuation.definition.tag.link.external>]</>].]"
	},
	{
		"desc": "External link with comments in link text",
		"wikitext": "[http://www.google.com Google <!-- comment -->]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.google.com</><string.other.link.external.title> Google <comment.block.html><punctuation.definition.comment.html>&lt;!--</> comment <punctuation.definition.comment.html>--&gt</></></><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "External link to bare IPv4 address",
		"wikitext": "[http://192.168.0.1 Link]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://192.168.0.1</><string.other.link.external.title> Link</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "URL-encoding in URL functions (single parameter)",
		"wikitext": "{{localurl:Some page|amp=&}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>localurl</><keyword.operator.function>:</>Some page<keyword.operator>|</>amp=&amp;<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "URL-encoding in URL functions (multiple parameters)",
		"wikitext": "{{localurl:Some page|q=?&amp=&}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>localurl</><keyword.operator.function>:</>Some page<keyword.operator>|</>q=?&amp;amp=&amp;<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Brackets in urls",
		"wikitext": "http://example.com/index.php?foozoid%5B%5D=bar\n\nhttp://example.com/index.php?foozoid&#x5B;&#x5D;=bar",
		"parsed": "http://example.com/index.php?foozoid%5B%5D=bar\\n\\nhttp://example.com/index.php?foozoid<constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#x5B;<punctuation.definition.entity.html>&amp;</>#x5D;</>=bar"
	},
	{
		"desc": "IPv6 urls, autolink format (T23261)",
		"wikitext": "http://[2404:130:0:1000::187:2]/index.php\n\nExamples from RFC 2373, section 2.2:\n\n*http://[1080::8:800:200C:417A]/unicast\n*http://[FF01::101]/multicast\n*http://[::1]/loopback\n*http://[::]/unspecified\n*http://[::13.1.68.3]/ipv4compat\n*http://[::FFFF:129.144.52.38]/ipv4compat\n\nExamples from RFC 2732, section 2:\n\n*http://[FEDC:BA98:7654:3210:FEDC:BA98:7654:3210]:80/index.html\n*http://[1080:0:0:0:8:800:200C:417A]/index.html\n*http://[3ffe:2a00:100:7031::1]\n*http://[1080::8:800:200C:417A]/foo\n*http://[::192.9.5.5]/ipng\n*http://[::FFFF:129.144.52.38]:80/index.html\n*http://[2010:836B:4179::836B:4179]",
		"parsed": "http://[2404:130:0:1000::187:2]/index.php\\n\\nExamples from <constant.language.variables.rfc>RFC 2373</>, section 2.2:\\n\\n<punctuation.definition.list.begin.markdown>*</>http://[1080::8:800:200C:417A]/unicast\\n<punctuation.definition.list.begin.markdown>*</>http://[FF01::101]/multicast\\n<punctuation.definition.list.begin.markdown>*</>http://[::1]/loopback\\n<punctuation.definition.list.begin.markdown>*</>http://[::]/unspecified\\n<punctuation.definition.list.begin.markdown>*</>http://[::13.1.68.3]/ipv4compat\\n<punctuation.definition.list.begin.markdown>*</>http://[::FFFF:129.144.52.38]/ipv4compat\\n\\nExamples from <constant.language.variables.rfc>RFC 2732</>, section 2:\\n\\n<punctuation.definition.list.begin.markdown>*</>http://[FEDC:BA98:7654:3210:FEDC:BA98:7654:3210]:80/index.html\\n<punctuation.definition.list.begin.markdown>*</>http://[1080:0:0:0:8:800:200C:417A]/index.html\\n<punctuation.definition.list.begin.markdown>*</>http://[3ffe:2a00:100:7031::1]\\n<punctuation.definition.list.begin.markdown>*</>http://[1080::8:800:200C:417A]/foo\\n<punctuation.definition.list.begin.markdown>*</>http://[::192.9.5.5]/ipng\\n<punctuation.definition.list.begin.markdown>*</>http://[::FFFF:129.144.52.38]:80/index.html\\n<punctuation.definition.list.begin.markdown>*</>http://[2010:836B:4179::836B:4179]"
	},
	{
		"desc": "Unicode text around autolinks",
		"wikitext": "grÃ¶ÃŸhttps://foo.org\n\ngrÃ¶ÃŸ https://foo.org\n\nì•„ë“¤ ê³ ê±´ ì‚¬ì§„https://foo.org\n\nğŸ’©https://foo.org",
		"parsed": "grÃ¶ÃŸhttps://foo.org\\n\\ngrÃ¶ÃŸ https://foo.org\\n\\nì•„ë“¤ ê³ ê±´ ì‚¬ì§„https://foo.org\\n\\nğŸ’©https://foo.org"
	},
	{
		"desc": "IPv6 urls, bracketed format (T23261)",
		"wikitext": "[http://[2404:130:0:1000::187:2]/index.php test]\n\nExamples from RFC 2373, section 2.2:\n\n*[http://[1080::8:800:200C:417A] unicast]\n*[http://[FF01::101] multicast]\n*[http://[::1]/ loopback]\n*[http://[::] unspecified]\n*[http://[::13.1.68.3] ipv4compat]\n*[http://[::FFFF:129.144.52.38] ipv4compat]\n\nExamples from RFC 2732, section 2:\n\n*[http://[FEDC:BA98:7654:3210:FEDC:BA98:7654:3210]:80/index.html 1]\n*[http://[1080:0:0:0:8:800:200C:417A]/index.html 2]\n*[http://[3ffe:2a00:100:7031::1] 3]\n*[http://[1080::8:800:200C:417A]/foo 4]\n*[http://[::192.9.5.5]/ipng 5]\n*[http://[::FFFF:129.144.52.38]:80/index.html 6]\n*[http://[2010:836B:4179::836B:4179] 7]",
		"parsed": "[http://[2404:130:0:1000::187:2]/index.php test]\\n\\nExamples from <constant.language.variables.rfc>RFC 2373</>, section 2.2:\\n\\n<punctuation.definition.list.begin.markdown>*</>[http://[1080::8:800:200C:417A] unicast]\\n<punctuation.definition.list.begin.markdown>*</>[http://[FF01::101] multicast]\\n<punctuation.definition.list.begin.markdown>*</>[http://[::1]/ loopback]\\n<punctuation.definition.list.begin.markdown>*</>[http://[::] unspecified]\\n<punctuation.definition.list.begin.markdown>*</>[http://[::13.1.68.3] ipv4compat]\\n<punctuation.definition.list.begin.markdown>*</>[http://[::FFFF:129.144.52.38] ipv4compat]\\n\\nExamples from <constant.language.variables.rfc>RFC 2732</>, section 2:\\n\\n<punctuation.definition.list.begin.markdown>*</>[http://[FEDC:BA98:7654:3210:FEDC:BA98:7654:3210]:80/index.html 1]\\n<punctuation.definition.list.begin.markdown>*</>[http://[1080:0:0:0:8:800:200C:417A]/index.html 2]\\n<punctuation.definition.list.begin.markdown>*</>[http://[3ffe:2a00:100:7031::1] 3]\\n<punctuation.definition.list.begin.markdown>*</>[http://[1080::8:800:200C:417A]/foo 4]\\n<punctuation.definition.list.begin.markdown>*</>[http://[::192.9.5.5]/ipng 5]\\n<punctuation.definition.list.begin.markdown>*</>[http://[::FFFF:129.144.52.38]:80/index.html 6]\\n<punctuation.definition.list.begin.markdown>*</>[http://[2010:836B:4179::836B:4179] 7]"
	},
	{
		"desc": "Non-extlinks in brackets",
		"wikitext": "[foo]\n[foo bar]\n[foo ''bar'']\n[fool's] errand\n[fool's errand]\n[{{1x|foo}}]\n[{{1x|foo}} bar]\n[{{1x|foo}} ''bar'']\n[{{1x|foo}}l's] errand\n[{{1x|foo}}l's errand]\n[url={{1x|foo}}]\n[url=http://example.com]\n[http:// bare protocols don't count]",
		"parsed": "[foo]\\n[foo bar]\\n[foo <markup.italic>''</>bar<markup.italic>''</>]\\n[fool's] errand\\n[fool's errand]\\n[<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo<punctuation.definition.tag.template>}}</>]\\n[<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo<punctuation.definition.tag.template>}}</> bar]\\n[<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo<punctuation.definition.tag.template>}}</> <markup.italic>''</>bar<markup.italic>''</>]\\n[<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo<punctuation.definition.tag.template>}}</>l's] errand\\n[<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo<punctuation.definition.tag.template>}}</>l's errand]\\n[url=<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo<punctuation.definition.tag.template>}}</>]\\n[url=http://example.com]\\n[http:// bare protocols don't count]"
	},
	{
		"desc": "Percent encoding in external links",
		"wikitext": "[https://github.com/search?l=&q=ResourceLoader+%40wikimedia Search]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>https://github.com/search?l=&amp;q=ResourceLoader+%40wikimedia</><string.other.link.external.title> Search</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "Use url link syntax for links where the content is equal the link target",
		"wikitext": "http://example.com",
		"parsed": "http://example.com"
	},
	{
		"desc": "Parenthesis in external links, especially URL links",
		"wikitext": "http://example.com)\n\nhttp://example.com/test)\n\nhttp://example.com/(test)\n\nhttp://example.com/((test)\n\n(http://example.com/(test))\n\n(http://example.com/(test)))))\n\nhttp://example.com/a)b\n\n[http://example.com) foo]",
		"parsed": "http://example.com)\\n\\nhttp://example.com/test)\\n\\nhttp://example.com/(test)\\n\\nhttp://example.com/((test)\\n\\n(http://example.com/(test))\\n\\n(http://example.com/(test)))))\\n\\nhttp://example.com/a)b\\n\\n<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com)</><string.other.link.external.title> foo</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "Parenthesis in external links, w/ transclusion or comment",
		"wikitext": "(http://example.com/{{1x|hi}})\n\n(http://example.com<!-- hi -->)",
		"parsed": "(http://example.com/<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>hi<punctuation.definition.tag.template>}}</>)\\n\\n(http://example.com<comment.block.html><punctuation.definition.comment.html>&lt;!--</> hi <punctuation.definition.comment.html>--&gt</></>)"
	},
	{
		"desc": "mw:ExtLink linking to a interwiki URL can be round-tripped losslessly (T94723)",
		"wikitext": "[http://en.wikipedia.org/wiki/European_Robin European Robin]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://en.wikipedia.org/wiki/European_Robin</><string.other.link.external.title> European Robin</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "Parsoid extlink with _blank target",
		"wikitext": "[https://www.example.com]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>https://www.example.com</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "Parsoid extlink with _self target",
		"wikitext": "[https://www.example.com]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>https://www.example.com</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "Extlink in square brackets with entity",
		"wikitext": "[&nbsp;[http://test.com 123]&nbsp;]\n\n[http://test.com [123]",
		"parsed": "[<constant.character.entity.named.nbsp.html><punctuation.definition.entity.html>&amp;</>nbsp<punctuation.definition.entity.html>;</></><punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://test.com</><string.other.link.external.title> 123</><punctuation.definition.tag.link.external>]</><constant.character.entity.named.nbsp.html><punctuation.definition.entity.html>&amp;</>nbsp<punctuation.definition.entity.html>;</></>]\\n\\n<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://test.com</><string.other.link.external.title> [123</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "fragmentModes"
	},
	{
		"desc": "Legacy fragment encoding",
		"wikitext": "<ref name=\"nature%20phylo\">A</ref>\n<ref name=\"Mininova%2E26%2E11%2E2009\">B</ref>\n<ref name=\"%c8%98tiri_2019\">C</ref>\n<ref name=\"play%21\">D</ref>\n<ref name=\"Terry+O%26rsquo%3BNâ€¦</ref\">E</ref>\n<ref name=\"9&nbsp;pm\">F</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>nature%20phylo<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>A</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>Mininova%2E26%2E11%2E2009<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>B</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>%c8%98tiri_2019<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>C</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>play%21<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>D</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>Terry+O%26rsquo%3BNâ€¦&lt;/ref<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>E</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>9<constant.character.entity.named.nbsp.html><punctuation.definition.entity.html>&amp;</>nbsp<punctuation.definition.entity.html>;</></>pm<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>F</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T298278: Collection of test cases in HTML5 mode",
		"wikitext": "<ref name=\"nature%20phylo\">A</ref>\n<ref name=\"Mininova%2E26%2E11%2E2009\">B</ref>\n<ref name=\"%c8%98tiri_2019\">C</ref>\n<ref name=\"play%21\">D</ref>\n<ref name=\"Terry+O%26rsquo%3BNâ€¦</ref\">E</ref>\n<ref name=\"9&nbsp;pm\">F</ref>\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>nature%20phylo<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>A</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>Mininova%2E26%2E11%2E2009<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>B</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>%c8%98tiri_2019<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>C</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>play%21<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>D</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>Terry+O%26rsquo%3BNâ€¦&lt;/ref<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>E</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>9<constant.character.entity.named.nbsp.html><punctuation.definition.entity.html>&amp;</>nbsp<punctuation.definition.entity.html>;</></>pm<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>F</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "URL encoded strings accidentally copy-pasted in legacy mode",
		"wikitext": "<ref name=\"n%25%32%30n\" group=\"g%25%32%30g\">A</ref>\n<references group=\"g%25%32%30g\" />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>n%25%32%30n<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g%25%32%30g<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>A</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g%25%32%30g<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "T298278: URL encoded strings accidentally copy-pasted in HTML5 mode",
		"wikitext": "<ref name=\"n%25%32%30n\" group=\"g%25%32%30g\">A</ref>\n<references group=\"g%25%32%30g\" />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>n%25%32%30n<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g%25%32%30g<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>A</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>g%25%32%30g<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Multiple, partly encoded spaces in legacy mode",
		"wikitext": "<ref name=\"a_ %20a\" group=\"b_ %20b\">A</ref>\n<references group=\"b_ %20b\" />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a_ %20a<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b_ %20b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>A</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b_ %20b<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Multiple, partly encoded spaces in HTML5 mode",
		"wikitext": "<ref name=\"a_ %20a\" group=\"b_ %20b\">A</ref>\n<references group=\"b_ %20b\" />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a_ %20a<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b_ %20b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>A</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <meta.attribute.unrecognized.group.html><entity.other.attribute-name.html>group</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>b_ %20b<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "funcsParserTests"
	},
	{
		"desc": "Input times are UTC, not local time",
		"wikitext": "{{#time:c|15 January 2001}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#time</><keyword.operator.function>:</>c<keyword.operator>|</>15 January 2001<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Time test in traditional range...",
		"wikitext": "{{#time:Y|15 January 2001}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#time</><keyword.operator.function>:</>Y<keyword.operator>|</>15 January 2001<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Time test prior to 1970 Unix creation myth",
		"wikitext": "{{#time:Y|5 April 1967}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#time</><keyword.operator.function>:</>Y<keyword.operator>|</>5 April 1967<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Time test after the 2038 32-bit Apocalype",
		"wikitext": "{{#time:Y|28 July 2061}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#time</><keyword.operator.function>:</>Y<keyword.operator>|</>28 July 2061<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Explicitly specified timezone: UTC",
		"wikitext": "{{#time:Y-m-d H:i| 2011-11-12 23:00 UTC }}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#time</><keyword.operator.function>:</>Y-m-d H:i<keyword.operator>|</> 2011-11-12 23:00 UTC <punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Explicitly specified timezone: Europe/Paris (UTC+1)",
		"wikitext": "{{#time:Y-m-d H:i| 2011-11-12 23:00 Europe/Paris }}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#time</><keyword.operator.function>:</>Y-m-d H:i<keyword.operator>|</> 2011-11-12 23:00 Europe/Paris <punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Explicitly specified timezone: America/New_York (UTC-5)",
		"wikitext": "{{#time:Y-m-d H:i| 2011-11-12 23:00 America/New_York }}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#time</><keyword.operator.function>:</>Y-m-d H:i<keyword.operator>|</> 2011-11-12 23:00 America/New_York <punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Explicitely specified output language (Dutch)",
		"wikitext": "{{#time:d F Y|1988-02-28|nl}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#time</><keyword.operator.function>:</>d F Y<keyword.operator>|</>1988-02-28<keyword.operator>|</>nl<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "#titleparts",
		"wikitext": "{{#titleparts:A/b/c/d}}\n{{#titleparts:A/b/c/d|1}}\n{{#titleparts:A/b/c/d|2}}\n{{#titleparts:A/b/c/d|-3}}\n{{#titleparts:A/b/c/d||1}}\n{{#titleparts:A/b/c/d||2}}\n{{#titleparts:A/b/c/d||-2}}\n{{#titleparts:A/b/c/d|1|1}}\n{{#titleparts:A/b/c/d|1|2}}\n{{#titleparts:A/b/c/d|1|-2}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#titleparts</><keyword.operator.function>:</>A/b/c/d<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#titleparts</><keyword.operator.function>:</>A/b/c/d<keyword.operator>|</>1<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#titleparts</><keyword.operator.function>:</>A/b/c/d<keyword.operator>|</>2<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#titleparts</><keyword.operator.function>:</>A/b/c/d<keyword.operator>|</>-3<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#titleparts</><keyword.operator.function>:</>A/b/c/d<keyword.operator>||</>1<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#titleparts</><keyword.operator.function>:</>A/b/c/d<keyword.operator>||</>2<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#titleparts</><keyword.operator.function>:</>A/b/c/d<keyword.operator>||</>-2<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#titleparts</><keyword.operator.function>:</>A/b/c/d<keyword.operator>|</>1<keyword.operator>|</>1<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#titleparts</><keyword.operator.function>:</>A/b/c/d<keyword.operator>|</>1<keyword.operator>|</>2<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#titleparts</><keyword.operator.function>:</>A/b/c/d<keyword.operator>|</>1<keyword.operator>|</>-2<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "#titleparts stops splitting after 25 parts",
		"wikitext": "{{#titleparts:A/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/!/!/!|24}}\n{{#titleparts:A/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/!/!/!|25}}\n{{#titleparts:A/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/!/!/!|-1}}\n{{#titleparts:A/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/!/!/!||-1}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#titleparts</><keyword.operator.function>:</>A/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/!/!/!<keyword.operator>|</>24<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#titleparts</><keyword.operator.function>:</>A/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/!/!/!<keyword.operator>|</>25<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#titleparts</><keyword.operator.function>:</>A/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/!/!/!<keyword.operator>|</>-1<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#titleparts</><keyword.operator.function>:</>A/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/!/!/!<keyword.operator>||</>-1<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Zero parameters in #if and such",
		"wikitext": "[{{#ifexpr:}},{{#if:}},{{#ifeq:}},{{#switch:}},{{#ifexist:}}]",
		"parsed": "[<punctuation.definition.tag.function>{{</><constant.language.variables.query>#ifexpr</><keyword.operator.function>:</><punctuation.definition.tag.function>}}</>,<punctuation.definition.tag.function>{{</><constant.language.variables.query>#if</><keyword.operator.function>:</><punctuation.definition.tag.function>}}</>,<punctuation.definition.tag.function>{{</><constant.language.variables.query>#ifeq</><keyword.operator.function>:</><punctuation.definition.tag.function>}}</>,<punctuation.definition.tag.function>{{</><constant.language.variables.query>#switch</><keyword.operator.function>:</><punctuation.definition.tag.function>}}</>,<punctuation.definition.tag.function>{{</><constant.language.variables.query>#ifexist</><keyword.operator.function>:</><punctuation.definition.tag.function>}}</>]"
	},
	{
		"desc": "Empty condition in #if and such",
		"wikitext": "Empty ifexpr is {{#ifexpr:|true|false}}\nEmpty if is {{#if:|true|false}}\nEmpty ifeq is {{#ifeq:||equal|not equal}}\nEmpty switch is {{#switch:|=empty|#default=something else}}\nEmpty ifexist is {{#ifexist:|true|false}}",
		"parsed": "Empty ifexpr is <punctuation.definition.tag.function>{{</><constant.language.variables.query>#ifexpr</><keyword.operator.function>:</><keyword.operator>|</>true<keyword.operator>|</>false<punctuation.definition.tag.function>}}\\n</>Empty if is <punctuation.definition.tag.function>{{</><constant.language.variables.query>#if</><keyword.operator.function>:</><keyword.operator>|</>true<keyword.operator>|</>false<punctuation.definition.tag.function>}}\\n</>Empty ifeq is <punctuation.definition.tag.function>{{</><constant.language.variables.query>#ifeq</><keyword.operator.function>:</><keyword.operator>||</>equal<keyword.operator>|</>not equal<punctuation.definition.tag.function>}}\\n</>Empty switch is <punctuation.definition.tag.function>{{</><constant.language.variables.query>#switch</><keyword.operator.function>:</><keyword.operator>|</>=empty<keyword.operator>|</>#default=something else<punctuation.definition.tag.function>}}\\n</>Empty ifexist is <punctuation.definition.tag.function>{{</><constant.language.variables.query>#ifexist</><keyword.operator.function>:</><keyword.operator>|</>true<keyword.operator>|</>false<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Missing or all-empty outputs",
		"wikitext": "[{{#ifexpr: 1}},{{#ifexpr: 1|}},{{#ifexpr: 1||}}]\n[{{#if: 1}},{{#if: 1|}},{{#if: 1||}}]\n[{{#ifeq: 1|1}},{{#ifeq: 1|1|}},{{#ifeq: 1|1||}}]\n[{{#switch: 1}},{{#switch: 1|}}]\n[{{#ifexist: ParserFunctions page}},{{#ifexist: ParserFunctions page|}},{{#ifexist: ParserFunctions page||}}]",
		"parsed": "[<punctuation.definition.tag.function>{{</><constant.language.variables.query>#ifexpr</><keyword.operator.function>:</> 1<punctuation.definition.tag.function>}}</>,<punctuation.definition.tag.function>{{</><constant.language.variables.query>#ifexpr</><keyword.operator.function>:</> 1<keyword.operator>|</><punctuation.definition.tag.function>}}</>,<punctuation.definition.tag.function>{{</><constant.language.variables.query>#ifexpr</><keyword.operator.function>:</> 1<keyword.operator>||</><punctuation.definition.tag.function>}}</>]\\n[<punctuation.definition.tag.function>{{</><constant.language.variables.query>#if</><keyword.operator.function>:</> 1<punctuation.definition.tag.function>}}</>,<punctuation.definition.tag.function>{{</><constant.language.variables.query>#if</><keyword.operator.function>:</> 1<keyword.operator>|</><punctuation.definition.tag.function>}}</>,<punctuation.definition.tag.function>{{</><constant.language.variables.query>#if</><keyword.operator.function>:</> 1<keyword.operator>||</><punctuation.definition.tag.function>}}</>]\\n[<punctuation.definition.tag.function>{{</><constant.language.variables.query>#ifeq</><keyword.operator.function>:</> 1<keyword.operator>|</>1<punctuation.definition.tag.function>}}</>,<punctuation.definition.tag.function>{{</><constant.language.variables.query>#ifeq</><keyword.operator.function>:</> 1<keyword.operator>|</>1<keyword.operator>|</><punctuation.definition.tag.function>}}</>,<punctuation.definition.tag.function>{{</><constant.language.variables.query>#ifeq</><keyword.operator.function>:</> 1<keyword.operator>|</>1<keyword.operator>||</><punctuation.definition.tag.function>}}</>]\\n[<punctuation.definition.tag.function>{{</><constant.language.variables.query>#switch</><keyword.operator.function>:</> 1<punctuation.definition.tag.function>}}</>,<punctuation.definition.tag.function>{{</><constant.language.variables.query>#switch</><keyword.operator.function>:</> 1<keyword.operator>|</><punctuation.definition.tag.function>}}</>]\\n[<punctuation.definition.tag.function>{{</><constant.language.variables.query>#ifexist</><keyword.operator.function>:</> ParserFunctions page<punctuation.definition.tag.function>}}</>,<punctuation.definition.tag.function>{{</><constant.language.variables.query>#ifexist</><keyword.operator.function>:</> ParserFunctions page<keyword.operator>|</><punctuation.definition.tag.function>}}</>,<punctuation.definition.tag.function>{{</><constant.language.variables.query>#ifexist</><keyword.operator.function>:</> ParserFunctions page<keyword.operator>||</><punctuation.definition.tag.function>}}</>]"
	},
	{
		"desc": "Preserve tags in #switch default value",
		"wikitext": "{{#switch:a|b|<div>c</div>}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#switch</><keyword.operator.function>:</>a<keyword.operator>|</>b<keyword.operator>|</><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>c<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Bug 19093: Default values don't fall through in switch",
		"wikitext": "<{{#switch: foo | bar | #default = DEF }}>\n<{{#switch: foo | #default | bar = DEF }}>",
		"parsed": "&lt;<punctuation.definition.tag.function>{{</><constant.language.variables.query>#switch</><keyword.operator.function>:</> foo <keyword.operator>|</> bar <keyword.operator>|</> #default = DEF <punctuation.definition.tag.function>}}</>&gt\\n&lt;<punctuation.definition.tag.function>{{</><constant.language.variables.query>#switch</><keyword.operator.function>:</> foo <keyword.operator>|</> #default <keyword.operator>|</> bar = DEF <punctuation.definition.tag.function>}}</>&gt"
	},
	{
		"desc": "{{#ifexist}}",
		"wikitext": "{{#ifexist:Media:Foobar.jpg|Found|Not found}}\n{{#ifexist:ParserFunctions page|Found|Not found}}\n{{#ifexist:Missing|Found|Not found}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#ifexist</><keyword.operator.function>:</>Media:Foobar.jpg<keyword.operator>|</>Found<keyword.operator>|</>Not found<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#ifexist</><keyword.operator.function>:</>ParserFunctions page<keyword.operator>|</>Found<keyword.operator>|</>Not found<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#ifexist</><keyword.operator.function>:</>Missing<keyword.operator>|</>Found<keyword.operator>|</>Not found<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "{{#ifexist:}} media redirect (bug 32031)",
		"wikitext": "{{#ifexist:Media:Redirect_to_Foobar.jpg|Found|Not found}}\n{{#ifexist:Media:Redirect_to_nowhere.jpg|Found|Not found}}\n{{#ifexist:Media:Missing file.jpg|Found|Not found}}\n{{#ifexist:Media:Dionysos-Brunnen am KÃ¶lner Dom.jpg|Found|Not found}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#ifexist</><keyword.operator.function>:</>Media:Redirect_to_Foobar.jpg<keyword.operator>|</>Found<keyword.operator>|</>Not found<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#ifexist</><keyword.operator.function>:</>Media:Redirect_to_nowhere.jpg<keyword.operator>|</>Found<keyword.operator>|</>Not found<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#ifexist</><keyword.operator.function>:</>Media:Missing file.jpg<keyword.operator>|</>Found<keyword.operator>|</>Not found<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#ifexist</><keyword.operator.function>:</>Media:Dionysos-Brunnen am KÃ¶lner Dom.jpg<keyword.operator>|</>Found<keyword.operator>|</>Not found<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "#if",
		"wikitext": "{{#if: | yes | no}}\n{{#if: string | yes | no}}\n{{#if:      | yes | no}}\n{{#if:\n\n\n| yes | no}}\n{{#if: 1==2 | yes | no}}\n{{#if: foo | yes }}\n{{#if: | yes }}(empty)\n{{#if: foo | | no}}(empty)\n{{#if: {{{1}}} | yes | no}}\n{{#if: {{{1|}}} | yes | no}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#if</><keyword.operator.function>:</> <keyword.operator>|</> yes <keyword.operator>|</> no<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#if</><keyword.operator.function>:</> string <keyword.operator>|</> yes <keyword.operator>|</> no<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#if</><keyword.operator.function>:</>      <keyword.operator>|</> yes <keyword.operator>|</> no<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#if</><keyword.operator.function>:\\n\\n\\n</><keyword.operator>|</> yes <keyword.operator>|</> no<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#if</><keyword.operator.function>:</> 1==2 <keyword.operator>|</> yes <keyword.operator>|</> no<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#if</><keyword.operator.function>:</> foo <keyword.operator>|</> yes <punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#if</><keyword.operator.function>:</> <keyword.operator>|</> yes <punctuation.definition.tag.function>}}</>(empty)\\n<punctuation.definition.tag.function>{{</><constant.language.variables.query>#if</><keyword.operator.function>:</> foo <keyword.operator>|</> <keyword.operator>|</> no<punctuation.definition.tag.function>}}</>(empty)\\n<punctuation.definition.tag.function>{{</><constant.language.variables.query>#if</><keyword.operator.function>:</> <punctuation.definition.tag.variable>{{{</><variable.other>1</><punctuation.definition.tag.variable>}}}</> <keyword.operator>|</> yes <keyword.operator>|</> no<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#if</><keyword.operator.function>:</> <punctuation.definition.tag.variable>{{{</><variable.other>1</><variable.parameter><keyword.operator>|</></><punctuation.definition.tag.variable>}}}</> <keyword.operator>|</> yes <keyword.operator>|</> no<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "#ifeq",
		"wikitext": "{{#ifeq: 01 | 1 | yes | no}}\n{{#ifeq: 0 | -0 | yes | no}}\n{{#ifeq: foo | bar | yes | no}}\n{{#ifeq: foo | Foo | yes | no}}\n{{#ifeq: \"01\" | \"1\" | yes | no}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#ifeq</><keyword.operator.function>:</> 01 <keyword.operator>|</> 1 <keyword.operator>|</> yes <keyword.operator>|</> no<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#ifeq</><keyword.operator.function>:</> 0 <keyword.operator>|</> -0 <keyword.operator>|</> yes <keyword.operator>|</> no<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#ifeq</><keyword.operator.function>:</> foo <keyword.operator>|</> bar <keyword.operator>|</> yes <keyword.operator>|</> no<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#ifeq</><keyword.operator.function>:</> foo <keyword.operator>|</> Foo <keyword.operator>|</> yes <keyword.operator>|</> no<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#ifeq</><keyword.operator.function>:</> \"01\" <keyword.operator>|</> \"1\" <keyword.operator>|</> yes <keyword.operator>|</> no<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "#ifeq entities",
		"wikitext": "{{#ifeq: {{PAGENAME:*foo&bar}} | *foo&bar | yes | no}}\n{{#ifeq: a'b | a&#39;b | yes | no}}\n{{#ifeq: a'b | a&amp;#39;b | yes | no}}\n{{#ifeq: foo | Foo | *yes | *no}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#ifeq</><keyword.operator.function>:</> <punctuation.definition.tag.function>{{</><constant.language.variables.query>PAGENAME</><keyword.operator.function>:</>*foo&amp;bar<punctuation.definition.tag.function>}}</> <keyword.operator>|</> *foo&amp;bar <keyword.operator>|</> yes <keyword.operator>|</> no<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#ifeq</><keyword.operator.function>:</> a'b <keyword.operator>|</> a<constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#39;</>b <keyword.operator>|</> yes <keyword.operator>|</> no<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#ifeq</><keyword.operator.function>:</> a'b <keyword.operator>|</> a<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>#39;b <keyword.operator>|</> yes <keyword.operator>|</> no<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#ifeq</><keyword.operator.function>:</> foo <keyword.operator>|</> Foo <keyword.operator>|</> *yes <keyword.operator>|</> *no<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "#iferror",
		"wikitext": "{{#iferror: {{#expr: 1 + 2 }} | error | correct }}\n{{#iferror: {{#expr: 1 + X }} | error | correct }}\n{{#iferror: {{#expr: 1 + 2 }} | error }}\n{{#iferror: {{#expr: 1 + X }} | error }}\n{{#iferror: {{#expr: 1 + 2 }} }}\n{{#iferror: {{#expr: 1 + X }} }}empty",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#iferror</><keyword.operator.function>:</> <punctuation.definition.tag.function>{{</><constant.language.variables.query>#expr</><keyword.operator.function>:</> 1 + 2 <punctuation.definition.tag.function>}}</> <keyword.operator>|</> error <keyword.operator>|</> correct <punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#iferror</><keyword.operator.function>:</> <punctuation.definition.tag.function>{{</><constant.language.variables.query>#expr</><keyword.operator.function>:</> 1 + X <punctuation.definition.tag.function>}}</> <keyword.operator>|</> error <keyword.operator>|</> correct <punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#iferror</><keyword.operator.function>:</> <punctuation.definition.tag.function>{{</><constant.language.variables.query>#expr</><keyword.operator.function>:</> 1 + 2 <punctuation.definition.tag.function>}}</> <keyword.operator>|</> error <punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#iferror</><keyword.operator.function>:</> <punctuation.definition.tag.function>{{</><constant.language.variables.query>#expr</><keyword.operator.function>:</> 1 + X <punctuation.definition.tag.function>}}</> <keyword.operator>|</> error <punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#iferror</><keyword.operator.function>:</> <punctuation.definition.tag.function>{{</><constant.language.variables.query>#expr</><keyword.operator.function>:</> 1 + 2 <punctuation.definition.tag.function>}}</> <punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#iferror</><keyword.operator.function>:</> <punctuation.definition.tag.function>{{</><constant.language.variables.query>#expr</><keyword.operator.function>:</> 1 + X <punctuation.definition.tag.function>}}</> <punctuation.definition.tag.function>}}</>empty"
	},
	{
		"desc": "#ifexpr",
		"wikitext": "{{#ifexpr: | yes | no}}\n{{#ifexpr: 1 > 0 | yes }}\n{{#ifexpr: 1 < 0 | yes }}empty\n{{#ifexpr: 1 > 0 | | no}}empty\n{{#ifexpr: 1 < 0 | | no}}\n{{#ifexpr: 1 > 0 }}empty",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#ifexpr</><keyword.operator.function>:</> <keyword.operator>|</> yes <keyword.operator>|</> no<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#ifexpr</><keyword.operator.function>:</> 1 &gt 0 <keyword.operator>|</> yes <punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#ifexpr</><keyword.operator.function>:</> 1 &lt; 0 <keyword.operator>|</> yes <punctuation.definition.tag.function>}}</>empty\\n<punctuation.definition.tag.function>{{</><constant.language.variables.query>#ifexpr</><keyword.operator.function>:</> 1 &gt 0 <keyword.operator>|</> <keyword.operator>|</> no<punctuation.definition.tag.function>}}</>empty\\n<punctuation.definition.tag.function>{{</><constant.language.variables.query>#ifexpr</><keyword.operator.function>:</> 1 &lt; 0 <keyword.operator>|</> <keyword.operator>|</> no<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#ifexpr</><keyword.operator.function>:</> 1 &gt 0 <punctuation.definition.tag.function>}}</>empty"
	},
	{
		"desc": "Bug 22866: #ifexpr should evaluate \"-0\" as false",
		"wikitext": "{{#ifexpr: (-1)*0 | true | false }}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#ifexpr</><keyword.operator.function>:</> (-1)*0 <keyword.operator>|</> true <keyword.operator>|</> false <punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Templates: Parser functions don't strip whitespace from positional parameters",
		"wikitext": "{{#if: {{foo}}\n| no-pre-then\n| no-pre-else\n}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#if</><keyword.operator.function>:</> <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>foo</><punctuation.definition.tag.template>}}\\n</><keyword.operator>|</> no-pre-then\\n<keyword.operator>|</> no-pre-else\\n<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "#switch",
		"wikitext": "{{#switch:foo&bar|foo&amp;bar=yes|no}}\n{{#switch:foo&bar|fred=1|foo&amp;bar|g=yes|no}}\n{{#switch:foo&bar|fred=1|foo&amp;&#39;bar|g=yes|no}}\n{{#switch:foo|bar|baz=no|*default}}\n{{#switch:none|foo=1|bar=2|#default=no match|baz=3}}\n{{#switch:none|foo=1|bar=2|#default=ignored|baz=3|Second default}}\n{{#switch:|a&amp;#39;b}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#switch</><keyword.operator.function>:</>foo&amp;bar<keyword.operator>|</>foo<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>bar=yes<keyword.operator>|</>no<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#switch</><keyword.operator.function>:</>foo&amp;bar<keyword.operator>|</>fred=1<keyword.operator>|</>foo<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>bar<keyword.operator>|</>g=yes<keyword.operator>|</>no<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#switch</><keyword.operator.function>:</>foo&amp;bar<keyword.operator>|</>fred=1<keyword.operator>|</>foo<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></><constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#39;</>bar<keyword.operator>|</>g=yes<keyword.operator>|</>no<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#switch</><keyword.operator.function>:</>foo<keyword.operator>|</>bar<keyword.operator>|</>baz=no<keyword.operator>|</>*default<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#switch</><keyword.operator.function>:</>none<keyword.operator>|</>foo=1<keyword.operator>|</>bar=2<keyword.operator>|</>#default=no match<keyword.operator>|</>baz=3<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#switch</><keyword.operator.function>:</>none<keyword.operator>|</>foo=1<keyword.operator>|</>bar=2<keyword.operator>|</>#default=ignored<keyword.operator>|</>baz=3<keyword.operator>|</>Second default<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#switch</><keyword.operator.function>:</><keyword.operator>|</>a<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>#39;b<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "#switch #default should match next and not last named parameter",
		"wikitext": "<{{#switch: foo | #default | bar = DEF }}>\n<{{#switch: foo | #default | bar = DEF | baz = GHI }}>",
		"parsed": "&lt;<punctuation.definition.tag.function>{{</><constant.language.variables.query>#switch</><keyword.operator.function>:</> foo <keyword.operator>|</> #default <keyword.operator>|</> bar = DEF <punctuation.definition.tag.function>}}</>&gt\\n&lt;<punctuation.definition.tag.function>{{</><constant.language.variables.query>#switch</><keyword.operator.function>:</> foo <keyword.operator>|</> #default <keyword.operator>|</> bar = DEF <keyword.operator>|</> baz = GHI <punctuation.definition.tag.function>}}</>&gt"
	},
	{
		"desc": "#switch should not match #default as a prefix",
		"wikitext": "<{{#switch: foo | #defaultWTF? = This is crazy }}>\n<{{#switch: foo | #defaultWTF? | bar = This is crazy }}>",
		"parsed": "&lt;<punctuation.definition.tag.function>{{</><constant.language.variables.query>#switch</><keyword.operator.function>:</> foo <keyword.operator>|</> #defaultWTF? = This is crazy <punctuation.definition.tag.function>}}</>&gt\\n&lt;<punctuation.definition.tag.function>{{</><constant.language.variables.query>#switch</><keyword.operator.function>:</> foo <keyword.operator>|</> #defaultWTF? <keyword.operator>|</> bar = This is crazy <punctuation.definition.tag.function>}}</>&gt"
	},
	{
		"desc": "#switch Test php truthy",
		"wikitext": "{{#switch: 01 | 1 = yes | no}}\n{{#switch: 0 | -0 = yes | no}}\n{{#switch: foo | bar = yes | no}}\n{{#switch: foo | Foo = yes | no}}\n{{#switch: \"01\" | \"1\" = yes | no}}\n{{#switch: 1 | 02 | 01 = yes | no}}\n{{#switch: 1 | \"01\" | \"1\" = yes | no}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#switch</><keyword.operator.function>:</> 01 <keyword.operator>|</> 1 = yes <keyword.operator>|</> no<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#switch</><keyword.operator.function>:</> 0 <keyword.operator>|</> -0 = yes <keyword.operator>|</> no<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#switch</><keyword.operator.function>:</> foo <keyword.operator>|</> bar = yes <keyword.operator>|</> no<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#switch</><keyword.operator.function>:</> foo <keyword.operator>|</> Foo = yes <keyword.operator>|</> no<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#switch</><keyword.operator.function>:</> \"01\" <keyword.operator>|</> \"1\" = yes <keyword.operator>|</> no<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#switch</><keyword.operator.function>:</> 1 <keyword.operator>|</> 02 <keyword.operator>|</> 01 = yes <keyword.operator>|</> no<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#switch</><keyword.operator.function>:</> 1 <keyword.operator>|</> \"01\" <keyword.operator>|</> \"1\" = yes <keyword.operator>|</> no<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "headings"
	},
	{
		"desc": "Basic test",
		"wikitext": "==h1==\n===h1.1===\n==h2==\n===h2.1===\n====h2.1.1====\n===h2.2===\n====h2.2.1====\n====h2.2.2====\n==h3==",
		"parsed": "<markup.heading>==<string.quoted.other.heading>h1</>==\\n===<string.quoted.other.heading>h1.1</>===\\n==<string.quoted.other.heading>h2</>==\\n===<string.quoted.other.heading>h2.1</>===\\n====<string.quoted.other.heading>h2.1.1</>====\\n===<string.quoted.other.heading>h2.2</>===\\n====<string.quoted.other.heading>h2.2.1</>====\\n====<string.quoted.other.heading>h2.2.2</>====\\n==<string.quoted.other.heading>h3</>==</>"
	},
	{
		"desc": "HTML headings should get TOC entries with some empty properties",
		"wikitext": "==a==\n<h2>b</h2>\n<h3>c</h3>\n===d===\n<h2>e</h2>",
		"parsed": "<markup.heading>==<string.quoted.other.heading>a</>==\\n</><meta.tag.structure.h2.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>h2</><punctuation.definition.tag.end.html>&gt</></>b<meta.tag.structure.h2.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>h2</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.h3.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>h3</><punctuation.definition.tag.end.html>&gt</></>c<meta.tag.structure.h3.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>h3</><punctuation.definition.tag.end.html>&gt\\n</></><markup.heading>===<string.quoted.other.heading>d</>===\\n</><meta.tag.structure.h2.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>h2</><punctuation.definition.tag.end.html>&gt</></>e<meta.tag.structure.h2.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>h2</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Literal html heading from template",
		"wikitext": "{{1x|\n<h2>hi</h2>\nho\n}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|\\n</><meta.tag.structure.h2.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>h2</><punctuation.definition.tag.end.html>&gt</></>hi<meta.tag.structure.h2.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>h2</><punctuation.definition.tag.end.html>&gt\\n</></>ho\\n<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Duplicate headings should get unique anchors",
		"wikitext": "==a==\n==a==\n==b==",
		"parsed": "<markup.heading>==<string.quoted.other.heading>a</>==\\n==<string.quoted.other.heading>a</>==\\n==<string.quoted.other.heading>b</>==</>"
	},
	{
		"desc": "Templated sections (heading from template content)",
		"wikitext": "==a==\n{{Test}}",
		"parsed": "<markup.heading>==<string.quoted.other.heading>a</>==\\n</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Test</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Ensure headings with html tags get the right anchors",
		"wikitext": "==<span>x</span>==\n==<strike>y</strike>==",
		"parsed": "<markup.heading>==<string.quoted.other.heading><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>x<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></></>==\\n==<string.quoted.other.heading><meta.tag.inline.strike.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.deprecated.html>strike</></><punctuation.definition.tag.end.html>&gt</></>y<meta.tag.inline.strike.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.deprecated.html>strike</></><punctuation.definition.tag.end.html>&gt</></></>==</>"
	},
	{
		"desc": "Ensure unallowed tag wrappers in headings get stripped",
		"wikitext": "==<div>b</div>==\n==<font>c</font>==",
		"parsed": "<markup.heading>==<string.quoted.other.heading><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>b<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></></>==\\n==<string.quoted.other.heading><meta.tag.inline.font.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.deprecated.html>font</></><punctuation.definition.tag.end.html>&gt</></>c<meta.tag.inline.font.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.deprecated.html>font</></><punctuation.definition.tag.end.html>&gt</></></>==</>"
	},
	{
		"desc": "Ensure disallowed attributes are stripped, but dir attribute in a span is left behind",
		"wikitext": "==<span dir='ltr' title='x'>a</span>==\n==<span dir='rtl' title='x'>b</span>==\n==<i dir='rtl' title='ha'>c</i>==",
		"parsed": "<markup.heading>==<string.quoted.other.heading><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.single.html><punctuation.definition.string.begin.html>'</>ltr<punctuation.definition.string.end.html>'</></></> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.single.html><punctuation.definition.string.begin.html>'</>x<punctuation.definition.string.end.html>'</></></><punctuation.definition.tag.end.html>&gt</></>a<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></></>==\\n==<string.quoted.other.heading><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.single.html><punctuation.definition.string.begin.html>'</>rtl<punctuation.definition.string.end.html>'</></></> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.single.html><punctuation.definition.string.begin.html>'</>x<punctuation.definition.string.end.html>'</></></><punctuation.definition.tag.end.html>&gt</></>b<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></></>==\\n==<string.quoted.other.heading><meta.tag.inline.i.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>i</> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.single.html><punctuation.definition.string.begin.html>'</>rtl<punctuation.definition.string.end.html>'</></></> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.single.html><punctuation.definition.string.begin.html>'</>ha<punctuation.definition.string.end.html>'</></></><punctuation.definition.tag.end.html>&gt</></>c<meta.tag.inline.i.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>i</><punctuation.definition.tag.end.html>&gt</></></>==</>"
	},
	{
		"desc": "Ensure empty tags are stripped",
		"wikitext": "==<span><div></div></span>x==\n==<span dir='ltr'><i dir='ltr'></i></span>y==",
		"parsed": "<markup.heading>==<string.quoted.other.heading><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>x</>==\\n==<string.quoted.other.heading><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.single.html><punctuation.definition.string.begin.html>'</>ltr<punctuation.definition.string.end.html>'</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.i.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>i</> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.single.html><punctuation.definition.string.begin.html>'</>ltr<punctuation.definition.string.end.html>'</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.i.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>i</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>y</>==</>"
	},
	{
		"desc": "Ensure comments in toc lines are stripped",
		"wikitext": "==hi<html><!--ho--></html>==",
		"parsed": "<markup.heading>==<string.quoted.other.heading>hi<meta.tag.structure.html.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>html</><punctuation.definition.tag.end.html>&gt</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</>ho<punctuation.definition.comment.html>--&gt</></><meta.tag.structure.html.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>html</><punctuation.definition.tag.end.html>&gt</></></>==</>"
	},
	{
		"desc": "Handle links in heading content",
		"wikitext": "==[[Cat]]==\n==[[Dog]]s==\n==[[Cat|I love my ''cat'']]==",
		"parsed": "<markup.heading>==<string.quoted.other.heading><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Cat</><punctuation.definition.tag.link.internal>]]</></></>==\\n==<string.quoted.other.heading><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Dog</><punctuation.definition.tag.link.internal>]]</></>s</>==\\n==<string.quoted.other.heading><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Cat</><keyword.operator>|</>I love my <markup.italic>''</>cat<markup.italic>''</><punctuation.definition.tag.link.internal>]]</></></>==</>"
	},
	{
		"desc": "Ensure headings with special chars get the right anchors",
		"wikitext": "===a=\n=''x''=",
		"parsed": "<markup.heading>=<string.quoted.other.heading>==a</>=\\n=<string.quoted.other.heading><markup.italic>''</>x<markup.italic>''</></>=</>"
	},
	{
		"desc": "Templated sections (heading from template arg)",
		"wikitext": "==a==\n{{1x|1=\n==b==\n}}",
		"parsed": "<markup.heading>==<string.quoted.other.heading>a</>==\\n</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><entity.other.attribute-name.local-name>1</><keyword.operator.equal>=\\n</><markup.heading>==<string.quoted.other.heading>b</>==\\n</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Offsets in toc metadata should be unicode codepoints, not bytes or UCS-2",
		"wikitext": "==One ğŸ’©==\n==Two ğŸ’©==\n==Three ğŸ’©==",
		"parsed": "<markup.heading>==<string.quoted.other.heading>One ğŸ’©</>==\\n==<string.quoted.other.heading>Two ğŸ’©</>==\\n==<string.quoted.other.heading>Three ğŸ’©</>==</>"
	},
	{
		"desc": "Handle multi-part content transclusion blocks",
		"wikitext": "<div>\n{{1x|1=\n==foo==\n</div>\n}}\n==bar==",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><entity.other.attribute-name.local-name>1</><keyword.operator.equal>=\\n</><markup.heading>==<string.quoted.other.heading>foo</>==\\n</><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.tag.template>}}\\n</><markup.heading>==<string.quoted.other.heading>bar</>==</>"
	},
	{
		"desc": "Handle parser functions generating sections",
		"wikitext": "{{#if:1|<h2>foo</h2>|unused}}\n==bar==",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#if</><keyword.operator.function>:</>1<keyword.operator>|</><meta.tag.structure.h2.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>h2</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.h2.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>h2</><punctuation.definition.tag.end.html>&gt</></><keyword.operator>|</>unused<punctuation.definition.tag.function>}}\\n</><markup.heading>==<string.quoted.other.heading>bar</>==</>"
	},
	{
		"desc": "Handle top-level template args generating sections",
		"wikitext": "{{{foo|\n==tplarg==\n|abcd}}}",
		"parsed": "<punctuation.definition.tag.variable>{{{</><variable.other>foo</><variable.parameter><keyword.operator>|\\n</><markup.heading>==<string.quoted.other.heading>tplarg</>==\\n</><invalid.deprecated.ineffective>|abcd</></><punctuation.definition.tag.variable>}}}</>"
	},
	{
		"desc": "Basic section headings",
		"wikitext": "==Headline 1==\nSome text\n\n==Headline 2==\nMore\n===Smaller headline===\nBlah blah",
		"parsed": "<markup.heading>==<string.quoted.other.heading>Headline 1</>==\\n</>Some text\\n\\n<markup.heading>==<string.quoted.other.heading>Headline 2</>==\\n</>More\\n<markup.heading>===<string.quoted.other.heading>Smaller headline</>===\\n</>Blah blah"
	},
	{
		"desc": "Section headings with TOC",
		"wikitext": "==Headline 1==\n===Subheadline 1===\n=====Skipping a level=====\n======Skipping a level======\n\n==Headline 2==\nSome text\n===Another headline===",
		"parsed": "<markup.heading>==<string.quoted.other.heading>Headline 1</>==\\n===<string.quoted.other.heading>Subheadline 1</>===\\n=====<string.quoted.other.heading>Skipping a level</>=====\\n======<string.quoted.other.heading>Skipping a level</>======\\n\\n==<string.quoted.other.heading>Headline 2</>==\\n</>Some text\\n<markup.heading>===<string.quoted.other.heading>Another headline</>===</>"
	},
	{
		"desc": "Section headings with TOC and language conversion (T295187, T306862)",
		"wikitext": "==Headline 1==\n===Subheadline 1===\n==Headline 2==\nSome text\n===Another headline===",
		"parsed": "<markup.heading>==<string.quoted.other.heading>Headline 1</>==\\n===<string.quoted.other.heading>Subheadline 1</>===\\n==<string.quoted.other.heading>Headline 2</>==\\n</>Some text\\n<markup.heading>===<string.quoted.other.heading>Another headline</>===</>"
	},
	{
		"desc": "Section headings with TOC and language conversion disabled (T295187)",
		"wikitext": "==Headline 1==\n===Subheadline 1===\n==Headline 2==\nSome text\n===Another headline===\n__NOCONTENTCONVERT__",
		"parsed": "<markup.heading>==<string.quoted.other.heading>Headline 1</>==\\n===<string.quoted.other.heading>Subheadline 1</>===\\n==<string.quoted.other.heading>Headline 2</>==\\n</>Some text\\n<markup.heading>===<string.quoted.other.heading>Another headline</>===\\n</><constant.language.behavior>__NOCONTENTCONVERT__</>"
	},
	{
		"desc": "Section headings with TOC, language conversion rules, and displaytitle\n(T306862, T331316, T26072)",
		"wikitext": "<!--\n-->-{H|Foo=>en:Boo;Foo=>en-x-piglatin:Bob;}-<!--\n-->-{H|Bar=>en:Bat;Bar=>en-x-piglatin:Ball;}-<!--\n-->-{T|en:Foo;en-x-piglatin:Bar;}-<!--\n-->\nIntroduction.\n-{A|en:Do; en-x-piglatin:Re;}-\n== Foo ==\nFoo Do\n== Bar ==\nBar Re\n== -{Foo Bar}- ==",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--\\n--&gt</></><punctuation.definition.tag.convert>-{</><entity.name.function.type>H</><keyword.operator>|</>Foo=&gten:Boo;Foo=&gten-x-piglatin:Bob;<punctuation.definition.tag.convert>}-</><comment.block.html><punctuation.definition.comment.html>&lt;!--\\n--&gt</></><punctuation.definition.tag.convert>-{</><entity.name.function.type>H</><keyword.operator>|</>Bar=&gten:Bat;Bar=&gten-x-piglatin:Ball;<punctuation.definition.tag.convert>}-</><comment.block.html><punctuation.definition.comment.html>&lt;!--\\n--&gt</></><punctuation.definition.tag.convert>-{</><entity.name.function.type>T</><keyword.operator>|</>en:Foo;en-x-piglatin:Bar;<punctuation.definition.tag.convert>}-</><comment.block.html><punctuation.definition.comment.html>&lt;!--\\n--&gt\\n</></>Introduction.\\n<punctuation.definition.tag.convert>-{</><entity.name.function.type>A</><keyword.operator>|</>en:Do; en-x-piglatin:Re;<punctuation.definition.tag.convert>}-\\n</><markup.heading>==<string.quoted.other.heading> Foo </>==\\n</>Foo Do\\n<markup.heading>==<string.quoted.other.heading> Bar </>==\\n</>Bar Re\\n<markup.heading>==<string.quoted.other.heading> <punctuation.definition.tag.convert>-{</>Foo Bar<punctuation.definition.tag.convert>}-</> </>==</>"
	},
	{
		"desc": "TOC anchors don't collide",
		"wikitext": "__FORCETOC__\n==Headline 2==\n==Headline==\n==Headline 2==\n==Headline==",
		"parsed": "<constant.language.behavior>__FORCETOC__\\n</><markup.heading>==<string.quoted.other.heading>Headline 2</>==\\n==<string.quoted.other.heading>Headline</>==\\n==<string.quoted.other.heading>Headline 2</>==\\n==<string.quoted.other.heading>Headline</>==</>"
	},
	{
		"desc": "Handling of sections up to level 6 and beyond",
		"wikitext": "=Level 1 Heading=\n==Level 2 Heading==\n===Level 3 Heading===\n====Level 4 Heading====\n=====Level 5 Heading=====\n======Level 6 Heading======\n=======Level 7 Heading=======\n========Level 8 Heading========\n=========Level 9 Heading=========\n==========Level 10 Heading==========",
		"parsed": "<markup.heading>=<string.quoted.other.heading>Level 1 Heading</>=\\n==<string.quoted.other.heading>Level 2 Heading</>==\\n===<string.quoted.other.heading>Level 3 Heading</>===\\n====<string.quoted.other.heading>Level 4 Heading</>====\\n=====<string.quoted.other.heading>Level 5 Heading</>=====\\n======<string.quoted.other.heading>Level 6 Heading</>======\\n======<string.quoted.other.heading>=Level 7 Heading=</>======\\n======<string.quoted.other.heading>==Level 8 Heading==</>======\\n======<string.quoted.other.heading>===Level 9 Heading===</>======\\n======<string.quoted.other.heading>====Level 10 Heading====</>======</>"
	},
	{
		"desc": "TOC regression (T11764)",
		"wikitext": "==title 1==\n===title 1.1===\n====title 1.1.1====\n===title 1.2===\n==title 2==\n===title 2.1===",
		"parsed": "<markup.heading>==<string.quoted.other.heading>title 1</>==\\n===<string.quoted.other.heading>title 1.1</>===\\n====<string.quoted.other.heading>title 1.1.1</>====\\n===<string.quoted.other.heading>title 1.2</>===\\n==<string.quoted.other.heading>title 2</>==\\n===<string.quoted.other.heading>title 2.1</>===</>"
	},
	{
		"desc": "TOC for heading containing <span id=\"...\"></span> (T96153)",
		"wikitext": "__FORCETOC__\n==<span id=\"old-anchor\"></span>New title==",
		"parsed": "<constant.language.behavior>__FORCETOC__\\n</><markup.heading>==<string.quoted.other.heading><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>old-anchor<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>New title</>==</>"
	},
	{
		"desc": "TOC with wgMaxTocLevel=3 (T8204)",
		"wikitext": "==title 1==\n===title 1.1===\n====title 1.1.1====\n===title 1.2===\n==title 2==\n===title 2.1===",
		"parsed": "<markup.heading>==<string.quoted.other.heading>title 1</>==\\n===<string.quoted.other.heading>title 1.1</>===\\n====<string.quoted.other.heading>title 1.1.1</>====\\n===<string.quoted.other.heading>title 1.2</>===\\n==<string.quoted.other.heading>title 2</>==\\n===<string.quoted.other.heading>title 2.1</>===</>"
	},
	{
		"desc": "TOC with wgMaxTocLevel=3 and two level four headings (T8204)",
		"wikitext": "==Section 1==\n===Section 1.1===\n====Section 1.1.1====\n====Section 1.1.1.1====\n==Section 2==",
		"parsed": "<markup.heading>==<string.quoted.other.heading>Section 1</>==\\n===<string.quoted.other.heading>Section 1.1</>===\\n====<string.quoted.other.heading>Section 1.1.1</>====\\n====<string.quoted.other.heading>Section 1.1.1.1</>====\\n==<string.quoted.other.heading>Section 2</>==</>"
	},
	{
		"desc": "Resolving duplicate section names",
		"wikitext": "==Foo bar==\n==Foo bar==",
		"parsed": "<markup.heading>==<string.quoted.other.heading>Foo bar</>==\\n==<string.quoted.other.heading>Foo bar</>==</>"
	},
	{
		"desc": "Resolving duplicate section names with differing case (T12721)",
		"wikitext": "==Foo bar==\n==Foo Bar==",
		"parsed": "<markup.heading>==<string.quoted.other.heading>Foo bar</>==\\n==<string.quoted.other.heading>Foo Bar</>==</>"
	},
	{
		"desc": "Template with sections, __NOTOC__",
		"wikitext": "__NOTOC__\n==Section 0==\n{{sections}}\n==Section 4==",
		"parsed": "<constant.language.behavior>__NOTOC__\\n</><markup.heading>==<string.quoted.other.heading>Section 0</>==\\n</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>sections</><punctuation.definition.tag.template>}}\\n</><markup.heading>==<string.quoted.other.heading>Section 4</>==</>"
	},
	{
		"desc": "T307691: show-toc flag: no sections, but __FORCETOC__",
		"wikitext": "__FORCETOC__",
		"parsed": "<constant.language.behavior>__FORCETOC__</>"
	},
	{
		"desc": "T307691: show-toc flag: no sections, but __TOC__",
		"wikitext": "__TOC__",
		"parsed": "<constant.language.behavior>__TOC__</>"
	},
	{
		"desc": "T307691: show-toc flag: no sections, and __NOTOC__",
		"wikitext": "__NOTOC__",
		"parsed": "<constant.language.behavior>__NOTOC__</>"
	},
	{
		"desc": "T307691: show-toc flag: not \"enough\" sections",
		"wikitext": "== One ==",
		"parsed": "<markup.heading>==<string.quoted.other.heading> One </>==</>"
	},
	{
		"desc": "T352467: synthetic sections shouldn't count towards \"enough\" sections",
		"wikitext": "<div>\n==a==\n==b==\n</div>\n==c==",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></><markup.heading>==<string.quoted.other.heading>a</>==\\n==<string.quoted.other.heading>b</>==\\n</><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></><markup.heading>==<string.quoted.other.heading>c</>==</>"
	},
	{
		"desc": "T307691: show-toc flag: not \"enough\" sections, but __FORCETOC__",
		"wikitext": "__FORCETOC__\n== One ==",
		"parsed": "<constant.language.behavior>__FORCETOC__\\n</><markup.heading>==<string.quoted.other.heading> One </>==</>"
	},
	{
		"desc": "T307691: show-toc flag: not \"enough\" sections, but __TOC__",
		"wikitext": "== One ==\n__TOC__",
		"parsed": "<markup.heading>==<string.quoted.other.heading> One </>==\\n</><constant.language.behavior>__TOC__</>"
	},
	{
		"desc": "T307691: show-toc flag: not \"enough\" sections, and __NOTOC__",
		"wikitext": "__NOTOC__\n== One ==",
		"parsed": "<constant.language.behavior>__NOTOC__\\n</><markup.heading>==<string.quoted.other.heading> One </>==</>"
	},
	{
		"desc": "T307691: show-toc flag: \"enough\" sections",
		"wikitext": "== One ==\n=== Two ===\n== Three ==\n=== Four ===",
		"parsed": "<markup.heading>==<string.quoted.other.heading> One </>==\\n===<string.quoted.other.heading> Two </>===\\n==<string.quoted.other.heading> Three </>==\\n===<string.quoted.other.heading> Four </>===</>"
	},
	{
		"desc": "T307691: show-toc flag: \"enough\" sections and __FORCETOC__",
		"wikitext": "__FORCETOC__\n== One ==\n=== Two ===\n== Three ==\n=== Four ===",
		"parsed": "<constant.language.behavior>__FORCETOC__\\n</><markup.heading>==<string.quoted.other.heading> One </>==\\n===<string.quoted.other.heading> Two </>===\\n==<string.quoted.other.heading> Three </>==\\n===<string.quoted.other.heading> Four </>===</>"
	},
	{
		"desc": "T307691: show-toc flag: \"enough\" sections and __NOTOC__",
		"wikitext": "__NOTOC__\n== One ==\n=== Two ===\n== Three ==\n=== Four ===",
		"parsed": "<constant.language.behavior>__NOTOC__\\n</><markup.heading>==<string.quoted.other.heading> One </>==\\n===<string.quoted.other.heading> Two </>===\\n==<string.quoted.other.heading> Three </>==\\n===<string.quoted.other.heading> Four </>===</>"
	},
	{
		"desc": "__NOEDITSECTION__ keyword",
		"wikitext": "__NOEDITSECTION__\n==Section 1==\n==Section 2==",
		"parsed": "<constant.language.behavior>__NOEDITSECTION__\\n</><markup.heading>==<string.quoted.other.heading>Section 1</>==\\n==<string.quoted.other.heading>Section 2</>==</>"
	},
	{
		"desc": "Link inside a section heading",
		"wikitext": "==Section with a [[Main Page|link]] in it==",
		"parsed": "<markup.heading>==<string.quoted.other.heading>Section with a <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</>link<punctuation.definition.tag.link.internal>]]</></> in it</>==</>"
	},
	{
		"desc": "TOC regression (T14077)",
		"wikitext": "__TOC__\n==title 1==\n===title 1.1===\n==title 2==",
		"parsed": "<constant.language.behavior>__TOC__\\n</><markup.heading>==<string.quoted.other.heading>title 1</>==\\n===<string.quoted.other.heading>title 1.1</>===\\n==<string.quoted.other.heading>title 2</>==</>"
	},
	{
		"desc": "__FORCETOC__ override",
		"wikitext": "__NEWSECTIONLINK__\n__FORCETOC__",
		"parsed": "<constant.language.switcher>__NEWSECTIONLINK__\\n</><constant.language.behavior>__FORCETOC__</>"
	},
	{
		"desc": "T28375: TOC with italics",
		"wikitext": "__TOC__\n==''Lost'' episodes==",
		"parsed": "<constant.language.behavior>__TOC__\\n</><markup.heading>==<string.quoted.other.heading><markup.italic>''</>Lost<markup.italic>''</> episodes</>==</>"
	},
	{
		"desc": "T28375: TOC with bold",
		"wikitext": "__TOC__\n=='''should be bold''' then normal text==",
		"parsed": "<constant.language.behavior>__TOC__\\n</><markup.heading>==<string.quoted.other.heading><markup.bold>'''</>should be bold<markup.bold>'''</> then normal text</>==</>"
	},
	{
		"desc": "T35845: Headings become cursive in TOC when they contain an image",
		"wikitext": "__TOC__\n==Image [[Image:foobar.jpg]]==",
		"parsed": "<constant.language.behavior>__TOC__\\n</><markup.heading>==<string.quoted.other.heading>Image <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>foobar.jpg</><punctuation.definition.tag.link.internal>]]</></></>==</>"
	},
	{
		"desc": "T35845 (2): Headings become bold in TOC when they contain a blockquote",
		"wikitext": "__TOC__\n==<blockquote>Quote</blockquote>==",
		"parsed": "<constant.language.behavior>__TOC__\\n</><markup.heading>==<string.quoted.other.heading><meta.tag.structure.blockquote.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></>Quote<meta.tag.structure.blockquote.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></></>==</>"
	},
	{
		"desc": "Unclosed tags in TOC",
		"wikitext": "__TOC__\n==Proof: 2 < 3==\n<small>Hanc marginis exiguitas non caperet.</small>\nQED",
		"parsed": "<constant.language.behavior>__TOC__\\n</><markup.heading>==<string.quoted.other.heading>Proof: 2 &lt; 3</>==\\n</><meta.tag.inline.small.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt</></>Hanc marginis exiguitas non caperet.<meta.tag.inline.small.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt\\n</></>QED"
	},
	{
		"desc": "Multiple tags in TOC",
		"wikitext": "__TOC__\n==<i>Foo</i> <b>Bar</b>==\n\n==<i>Foo</i> <blockquote>Bar</blockquote>==",
		"parsed": "<constant.language.behavior>__TOC__\\n</><markup.heading>==<string.quoted.other.heading><meta.tag.inline.i.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>i</><punctuation.definition.tag.end.html>&gt</></>Foo<meta.tag.inline.i.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>i</><punctuation.definition.tag.end.html>&gt</></> <meta.tag.inline.b.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></>Bar<meta.tag.inline.b.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></></>==\\n\\n==<string.quoted.other.heading><meta.tag.inline.i.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>i</><punctuation.definition.tag.end.html>&gt</></>Foo<meta.tag.inline.i.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>i</><punctuation.definition.tag.end.html>&gt</></> <meta.tag.structure.blockquote.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></>Bar<meta.tag.structure.blockquote.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></></>==</>"
	},
	{
		"desc": "Tags with parameters in TOC",
		"wikitext": "__TOC__\n==<sup class=\"in-h2\">Hello</sup>==\n\n==<sup class=\"a > b\">Evilbye</sup>==",
		"parsed": "<constant.language.behavior>__TOC__\\n</><markup.heading>==<string.quoted.other.heading><meta.tag.inline.sup.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>sup</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>in-h2<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>Hello<meta.tag.inline.sup.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>sup</><punctuation.definition.tag.end.html>&gt</></></>==\\n\\n==<string.quoted.other.heading><meta.tag.inline.sup.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>sup</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>a &gt b<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>Evilbye<meta.tag.inline.sup.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>sup</><punctuation.definition.tag.end.html>&gt</></></>==</>"
	},
	{
		"desc": "span tags with directionality in TOC",
		"wikitext": "__TOC__\n==<span dir=\"ltr\">C++</span>==\n\n==<span dir=\"rtl\">×–×‘× ×’!</span>==\n\n==<span style=\"font-style: italic\" dir=\"ltr\" title=\"hello\">Attributes other than dir</span>==",
		"parsed": "<constant.language.behavior>__TOC__\\n</><markup.heading>==<string.quoted.other.heading><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>ltr<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>C++<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></></>==\\n\\n==<string.quoted.other.heading><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>rtl<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>×–×‘× ×’!<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></></>==\\n\\n==<string.quoted.other.heading><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>font-style: italic</><punctuation.definition.string.end.html><source.css>\"</></></></></> <meta.attribute.dir.html><entity.other.attribute-name.html>dir</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>ltr<punctuation.definition.string.end.html>\"</></></> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>hello<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>Attributes other than dir<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></></>==</>"
	},
	{
		"desc": "T74884: bdi element in ToC",
		"wikitext": "__TOC__\n==<bdi>test</bdi>==",
		"parsed": "<constant.language.behavior>__TOC__\\n</><markup.heading>==<string.quoted.other.heading><meta.tag.inline.bdi.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>bdi</><punctuation.definition.tag.end.html>&gt</></>test<meta.tag.inline.bdi.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>bdi</><punctuation.definition.tag.end.html>&gt</></></>==</>"
	},
	{
		"desc": "T35715: s/strike element in ToC",
		"wikitext": "__TOC__\n==<s>test</s> test <strike>test</strike>==",
		"parsed": "<constant.language.behavior>__TOC__\\n</><markup.heading>==<string.quoted.other.heading><meta.tag.inline.s.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>s</><punctuation.definition.tag.end.html>&gt</></>test<meta.tag.inline.s.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>s</><punctuation.definition.tag.end.html>&gt</></> test <meta.tag.inline.strike.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.deprecated.html>strike</></><punctuation.definition.tag.end.html>&gt</></>test<meta.tag.inline.strike.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.deprecated.html>strike</></><punctuation.definition.tag.end.html>&gt</></></>==</>"
	},
	{
		"desc": "T198618: style element in ToC",
		"wikitext": "__TOC__\n==<style>.foo {}</style>Style<style>.bar {}</style>==",
		"parsed": "<constant.language.behavior>__TOC__\\n</><markup.heading>==<string.quoted.other.heading><meta.embedded.block.html><meta.tag.metadata.style.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt</></><source.css><meta.selector.css><entity.other.attribute-name.class.css><punctuation.definition.entity.css>.</>foo</></> <meta.property-list.css><punctuation.section.property-list.begin.bracket.curly.css>{</><punctuation.section.property-list.end.bracket.curly.css>}</></></><meta.tag.metadata.style.end.html><punctuation.definition.tag.begin.html><source.css-ignored-vscode>&lt;</>/</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt</></></>Style<meta.embedded.block.html><meta.tag.metadata.style.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt</></><source.css><meta.selector.css><entity.other.attribute-name.class.css><punctuation.definition.entity.css>.</>bar</></> <meta.property-list.css><punctuation.section.property-list.begin.bracket.curly.css>{</><punctuation.section.property-list.end.bracket.curly.css>}</></></><meta.tag.metadata.style.end.html><punctuation.definition.tag.begin.html><source.css-ignored-vscode>&lt;</>/</><entity.name.tag.html>style</><punctuation.definition.tag.end.html>&gt</></></></>==</>"
	},
	{
		"desc": "T198618: script element in ToC",
		"wikitext": "__TOC__\n==<html><script>alert(1);</script></html>Script<html><script>alert(1);</script></html>==",
		"parsed": "<constant.language.behavior>__TOC__\\n</><markup.heading>==<string.quoted.other.heading><meta.tag.structure.html.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>html</><punctuation.definition.tag.end.html>&gt</></><meta.embedded.block.html><meta.tag.metadata.script.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>script</><punctuation.definition.tag.end.html>&gt</></><source.js><meta.function-call.js><entity.name.function.js>alert</></><meta.brace.round.js>(</><constant.numeric.decimal.js>1</><meta.brace.round.js>)</><punctuation.terminator.statement.js>;</></><meta.tag.metadata.script.end.html><punctuation.definition.tag.begin.html><source.js-ignored-vscode>&lt;</>/</><entity.name.tag.html>script</><punctuation.definition.tag.end.html>&gt</></></><meta.tag.structure.html.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>html</><punctuation.definition.tag.end.html>&gt</></>Script<meta.tag.structure.html.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>html</><punctuation.definition.tag.end.html>&gt</></><meta.embedded.block.html><meta.tag.metadata.script.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>script</><punctuation.definition.tag.end.html>&gt</></><source.js><meta.function-call.js><entity.name.function.js>alert</></><meta.brace.round.js>(</><constant.numeric.decimal.js>1</><meta.brace.round.js>)</><punctuation.terminator.statement.js>;</></><meta.tag.metadata.script.end.html><punctuation.definition.tag.begin.html><source.js-ignored-vscode>&lt;</>/</><entity.name.tag.html>script</><punctuation.definition.tag.end.html>&gt</></></><meta.tag.structure.html.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>html</><punctuation.definition.tag.end.html>&gt</></></>==</>"
	},
	{
		"desc": "Empty <p> tag in TOC, removed by Sanitizer (T92892)",
		"wikitext": "__TOC__\n==x==",
		"parsed": "<constant.language.behavior>__TOC__\\n</><markup.heading>==<string.quoted.other.heading>x</>==</>"
	},
	{
		"desc": "Disable TOC",
		"wikitext": "Lead\n==Section 1==\n==Section 2==\n==Section 3==\n==Section 4==\n==Section 5==",
		"parsed": "Lead\\n<markup.heading>==<string.quoted.other.heading>Section 1</>==\\n==<string.quoted.other.heading>Section 2</>==\\n==<string.quoted.other.heading>Section 3</>==\\n==<string.quoted.other.heading>Section 4</>==\\n==<string.quoted.other.heading>Section 5</>==</>"
	},
	{
		"desc": "Short headings with trailing space should match behavior of Parser::doHeadings (T21910)",
		"wikitext": "=== \nThe line above must have a trailing space!\n=== <!--\n--> <!-- -->\nBut just in case it doesn't...",
		"parsed": "<markup.heading>=<string.quoted.other.heading>=</>= \\n</>The line above must have a trailing space!\\n=== <comment.block.html><punctuation.definition.comment.html>&lt;!--\\n--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</> <punctuation.definition.comment.html>--&gt\\n</></>But just in case it doesn't..."
	},
	{
		"desc": "Header with special characters (T27462)",
		"wikitext": "The tooltips shall not show entities to the user (ie. be double escaped)\n\n==text > text==\nsection 1\n\n==text < text==\nsection 2\n\n==text & text==\nsection 3\n\n==text ' text==\nsection 4\n\n==text \" text==\nsection 5",
		"parsed": "The tooltips shall not show entities to the user (ie. be double escaped)\\n\\n<markup.heading>==<string.quoted.other.heading>text &gt text</>==\\n</>section 1\\n\\n<markup.heading>==<string.quoted.other.heading>text &lt; text</>==\\n</>section 2\\n\\n<markup.heading>==<string.quoted.other.heading>text &amp; text</>==\\n</>section 3\\n\\n<markup.heading>==<string.quoted.other.heading>text ' text</>==\\n</>section 4\\n\\n<markup.heading>==<string.quoted.other.heading>text \" text</>==\\n</>section 5"
	},
	{
		"desc": "Header with space, plus and underscore as entity",
		"wikitext": "Id should not contain + for spaces\n\n==Space between Text==\nsection 1\n\n==Space-Entity&#32;between&#32;Text==\nsection 2\n\n==Plus+between+Text==\nsection 3\n\n==Plus-Entity&#43;between&#43;Text==\nsection 4\n\n==Underscore_between_Text==\nsection 5\n\n==Underscore-Entity&#95;between&#95;Text==\nsection 6\n\n[[#Space between Text]]\n[[#Space-Entity&#32;between&#32;Text]]\n[[#Plus+between+Text]]\n[[#Plus-Entity&#43;between&#43;Text]]\n[[#Underscore_between_Text]]\n[[#Underscore-Entity&#95;between&#95;Text]]",
		"parsed": "Id should not contain + for spaces\\n\\n<markup.heading>==<string.quoted.other.heading>Space between Text</>==\\n</>section 1\\n\\n<markup.heading>==<string.quoted.other.heading>Space-Entity<constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#32;</>between<constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#32;</>Text</>==\\n</>section 2\\n\\n<markup.heading>==<string.quoted.other.heading>Plus+between+Text</>==\\n</>section 3\\n\\n<markup.heading>==<string.quoted.other.heading>Plus-Entity<constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#43;</>between<constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#43;</>Text</>==\\n</>section 4\\n\\n<markup.heading>==<string.quoted.other.heading>Underscore_between_Text</>==\\n</>section 5\\n\\n<markup.heading>==<string.quoted.other.heading>Underscore-Entity<constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#95;</>between<constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#95;</>Text</>==\\n</>section 6\\n\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#Space between Text</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>#Space-Entity&amp;#32;between&amp;#32;Text</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>#Plus+between+Text</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>#Plus-Entity&amp;#43;between&amp;#43;Text</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>#Underscore_between_Text</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>#Underscore-Entity&amp;#95;between&amp;#95;Text</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Headers with excess '=' characters\n(Are similar tests necessary beyond the 1st level?)",
		"wikitext": "=foo==\n==foo=\n=''italic'' heading==\n==''italic'' heading=",
		"parsed": "<markup.heading>=<string.quoted.other.heading>foo=</>=\\n=<string.quoted.other.heading>=foo</>=\\n=<string.quoted.other.heading><markup.italic>''</>italic<markup.italic>''</> heading=</>=\\n=<string.quoted.other.heading>=<markup.italic>''</>italic<markup.italic>''</> heading</>=</>"
	},
	{
		"desc": "HTML headers vs TOC (T25393)\n(__NOEDITSECTION__ for clearer output, doesn't matter here)",
		"wikitext": "<h1>Header 1</h1>\n==Header 1.1==\n==Header 1.2==\n\n<h1>Header 2\n</h1>\n==Header 2.1==\n==Header 2.2==\n__NOEDITSECTION__",
		"parsed": "<meta.tag.structure.h1.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>h1</><punctuation.definition.tag.end.html>&gt</></>Header 1<meta.tag.structure.h1.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>h1</><punctuation.definition.tag.end.html>&gt\\n</></><markup.heading>==<string.quoted.other.heading>Header 1.1</>==\\n==<string.quoted.other.heading>Header 1.2</>==\\n\\n</><meta.tag.structure.h1.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>h1</><punctuation.definition.tag.end.html>&gt</></>Header 2\\n<meta.tag.structure.h1.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>h1</><punctuation.definition.tag.end.html>&gt\\n</></><markup.heading>==<string.quoted.other.heading>Header 2.1</>==\\n==<string.quoted.other.heading>Header 2.2</>==\\n</><constant.language.behavior>__NOEDITSECTION__</>"
	},
	{
		"desc": "Out-of-order TOC heading levels",
		"wikitext": "==2==\n======6======\n===3===\n=1=\n=====5=====\n==2==",
		"parsed": "<markup.heading>==<string.quoted.other.heading>2</>==\\n======<string.quoted.other.heading>6</>======\\n===<string.quoted.other.heading>3</>===\\n=<string.quoted.other.heading>1</>=\\n=====<string.quoted.other.heading>5</>=====\\n==<string.quoted.other.heading>2</>==</>"
	},
	{
		"desc": "TOC with HTML entities which are not wikitext entities (T355386)",
		"wikitext": "__TOC__\n== F&GT ==\nTest",
		"parsed": "<constant.language.behavior>__TOC__\\n</><markup.heading>==<string.quoted.other.heading> F&amp;GT </>==\\n</>Test"
	},
	{
		"desc": "TOC with french spacing (T324763)",
		"wikitext": "__TOC__\n== Renommer la page Â« Informatique durable Â» en Â« NumÃ©rique responsable Â» ? ==\nOui.",
		"parsed": "<constant.language.behavior>__TOC__\\n</><markup.heading>==<string.quoted.other.heading> Renommer la page Â« Informatique durable Â» en Â« NumÃ©rique responsable Â» ? </>==\\n</>Oui."
	},
	{
		"desc": "TOC data when heading content is equal to an id already set on the page",
		"wikitext": "<span id=\"hiho\">hiho</span>\n=== hiho ===",
		"parsed": "<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>hiho<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>hiho<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n</></><markup.heading>===<string.quoted.other.heading> hiho </>===</>"
	},
	{
		"desc": "TOC data when heading already has an id",
		"wikitext": "<h3 id=\"asdf\">odd</h3>",
		"parsed": "<meta.tag.structure.h3.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>h3</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>asdf<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>odd<meta.tag.structure.h3.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>h3</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Extra newlines followed by heading",
		"wikitext": "a\n\n\n=b=\n[[a]]\n\n\n=b=",
		"parsed": "a\\n\\n\\n<markup.heading>=<string.quoted.other.heading>b</>=\\n</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>a</><punctuation.definition.tag.link.internal>]]\\n\\n\\n</></><markup.heading>=<string.quoted.other.heading>b</>=</>"
	},
	{
		"desc": "Extra newlines between heading and content are swallowed (Parsoid does not)",
		"wikitext": "=b=\n\n\n\n[[a]]",
		"parsed": "<markup.heading>=<string.quoted.other.heading>b</>=\\n\\n\\n\\n</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>a</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Heading with line break in nowiki",
		"wikitext": "==A <nowiki>B\nC</nowiki>==",
		"parsed": "==A <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>B\\nC</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>=="
	},
	{
		"desc": "Heading with nonbreaking space in prefix/suffix (T235684)",
		"wikitext": "== &nbsp; A &nbsp; B &nbsp; ==",
		"parsed": "<markup.heading>==<string.quoted.other.heading> <constant.character.entity.named.nbsp.html><punctuation.definition.entity.html>&amp;</>nbsp<punctuation.definition.entity.html>;</></> A <constant.character.entity.named.nbsp.html><punctuation.definition.entity.html>&amp;</>nbsp<punctuation.definition.entity.html>;</></> B <constant.character.entity.named.nbsp.html><punctuation.definition.entity.html>&amp;</>nbsp<punctuation.definition.entity.html>;</></> </>==</>"
	},
	{
		"desc": "Heading with literal wikitext - the wikitext is not parsed in section edit link tooltip",
		"wikitext": "== <nowiki>{{PAGENAME}}</nowiki> ==\n== &#123;&#123;PAGENAME}} ==",
		"parsed": "<markup.heading>==<string.quoted.other.heading> <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>{{PAGENAME}}</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</> </>==\\n==<string.quoted.other.heading> <constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#123;<punctuation.definition.entity.html>&amp;</>#123;</>PAGENAME}} </>==</>"
	},
	{
		"desc": "T8563: Edit link generation for section shown by <includeonly>",
		"wikitext": "{{includeonly section}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>includeonly section</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "T8563: Edit link generation for section suppressed by <includeonly>",
		"wikitext": "<includeonly>\n==Includeonly section==\n</includeonly>\n==Section 1==",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt\\n</><markup.heading>==<string.quoted.other.heading>Includeonly section</>==\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt\\n</><markup.heading>==<string.quoted.other.heading>Section 1</>==</>"
	},
	{
		"desc": "Fuzz testing: Parser14",
		"wikitext": "==onmouseover===\nhttp://__TOC__",
		"parsed": "<markup.heading>==<string.quoted.other.heading>onmouseover=</>==\\n</>http://<constant.language.behavior>__TOC__</>"
	},
	{
		"desc": "Fuzz testing: Parser14-table",
		"wikitext": "==a==\n{| STYLE=__TOC__",
		"parsed": "<markup.heading>==<string.quoted.other.heading>a</>==\\n</><meta.tag.block.table><keyword.operator>{|</> <meta.attribute.unrecognized.STYLE.html><entity.other.attribute-name.html>STYLE</><punctuation.separator.key-value.html>=</><string.unquoted.html>__TOC__</></></>"
	},
	{
		"desc": "Inclusion of !userCanEdit() content",
		"wikitext": "{{MediaWiki:Fake}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>MediaWiki:Fake</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Morwen/13: Unclosed link followed by heading",
		"wikitext": "[[link\n==heading==",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>link\\n</>==heading==</>"
	},
	{
		"desc": "HHP2.1: Heuristics for headings in preprocessor parenthetical structures",
		"wikitext": "{{foo|\n=heading=",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>foo</><keyword.operator>|\\n</><markup.heading>=<string.quoted.other.heading>heading</>=</>"
	},
	{
		"desc": "HHP2.2: Heuristics for headings in preprocessor parenthetical structures",
		"wikitext": "{{foo|\n==heading==",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>foo</><keyword.operator>|\\n</><markup.heading>==<string.quoted.other.heading>heading</>==</>"
	},
	{
		"desc": "nowiki inside link inside heading (T20295)",
		"wikitext": "==[[foo|x<nowiki>y</nowiki>z]]==",
		"parsed": "<markup.heading>==<string.quoted.other.heading><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>foo</><keyword.operator>|</>x<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>y</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>z<punctuation.definition.tag.link.internal>]]</></></>==</>"
	},
	{
		"desc": "Decoding of HTML entities in headings and links for IDs and link fragments (T103714)",
		"wikitext": "==A&B&amp;C&amp;amp;D&amp;amp;amp;E==\n[[#A&B&amp;C&amp;amp;D&amp;amp;amp;E]]",
		"parsed": "<markup.heading>==<string.quoted.other.heading>A&amp;B<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>C<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>amp;D<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>amp;amp;E</>==\\n</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#A&amp;B&amp;amp;C&amp;amp;amp;D&amp;amp;amp;amp;E</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Decoding of HTML entities in headings and links for IDs and link fragments (T103714) (legacy)",
		"wikitext": "==A&B&amp;C&amp;amp;D&amp;amp;amp;E==\n[[#A&B&amp;C&amp;amp;D&amp;amp;amp;E]]",
		"parsed": "<markup.heading>==<string.quoted.other.heading>A&amp;B<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>C<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>amp;D<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>amp;amp;E</>==\\n</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#A&amp;B&amp;amp;C&amp;amp;amp;D&amp;amp;amp;amp;E</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "HTML5 ids: fallback to legacy",
		"wikitext": "==Foo bar==\n\n==foo Bar==\n\n==Ğ¢ĞµÑÑ‚==\n\n==Ğ¢ĞµÑÑ‚==\n\n==Ñ‚ĞµÑÑ‚==\n\n==Hey < # \" > % : '==\n[[#Foo bar]] [[#foo Bar]] [[#Ğ¢ĞµÑÑ‚]] [[#Ñ‚ĞµÑÑ‚]] [[#Hey < # \" > % : ']]\n\n{{anchorencode:ğŸ’©}} <span id=\"{{anchorencode:ğŸ’©}}\"></span>\n\n<!-- These two links should produce identical HTML -->\n[[#å•¤é…’]] [[#%E5%95%A4%E9%85%92]]",
		"parsed": "<markup.heading>==<string.quoted.other.heading>Foo bar</>==\\n\\n==<string.quoted.other.heading>foo Bar</>==\\n\\n==<string.quoted.other.heading>Ğ¢ĞµÑÑ‚</>==\\n\\n==<string.quoted.other.heading>Ğ¢ĞµÑÑ‚</>==\\n\\n==<string.quoted.other.heading>Ñ‚ĞµÑÑ‚</>==\\n\\n==<string.quoted.other.heading>Hey &lt; # \" &gt % : '</>==\\n</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#Foo bar</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#foo Bar</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#Ğ¢ĞµÑÑ‚</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#Ñ‚ĞµÑÑ‚</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#Hey &lt; # \" &gt % : '</><punctuation.definition.tag.link.internal>]]\\n\\n</></><punctuation.definition.tag.function>{{</><constant.language.variables.query>anchorencode</><keyword.operator.function>:</>ğŸ’©<punctuation.definition.tag.function>}}</> <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>{{anchorencode:ğŸ’©}}<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n\\n</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</> These two links should produce identical HTML <punctuation.definition.comment.html>--&gt\\n</></><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#å•¤é…’</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#%E5%95%A4%E9%85%92</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "HTML5 ids: legacy with a fallback to modern",
		"wikitext": "==Foo bar==\n\n==foo Bar==\n\n==Ğ¢ĞµÑÑ‚==\n\n==Ğ¢ĞµÑÑ‚==\n\n==Ñ‚ĞµÑÑ‚==\n\n==Hey < # \" > % : '==\n[[#Foo bar]] [[#foo Bar]] [[#Ğ¢ĞµÑÑ‚]] [[#Ñ‚ĞµÑÑ‚]] [[#Hey < # \" > % : ']]\n\n{{anchorencode:ğŸ’©}} <span id=\"{{anchorencode:ğŸ’©}}\"></span>\n\n<!-- These two links should produce identical HTML -->\n[[#å•¤é…’]] [[#%E5%95%A4%E9%85%92]]",
		"parsed": "<markup.heading>==<string.quoted.other.heading>Foo bar</>==\\n\\n==<string.quoted.other.heading>foo Bar</>==\\n\\n==<string.quoted.other.heading>Ğ¢ĞµÑÑ‚</>==\\n\\n==<string.quoted.other.heading>Ğ¢ĞµÑÑ‚</>==\\n\\n==<string.quoted.other.heading>Ñ‚ĞµÑÑ‚</>==\\n\\n==<string.quoted.other.heading>Hey &lt; # \" &gt % : '</>==\\n</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#Foo bar</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#foo Bar</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#Ğ¢ĞµÑÑ‚</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#Ñ‚ĞµÑÑ‚</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#Hey &lt; # \" &gt % : '</><punctuation.definition.tag.link.internal>]]\\n\\n</></><punctuation.definition.tag.function>{{</><constant.language.variables.query>anchorencode</><keyword.operator.function>:</>ğŸ’©<punctuation.definition.tag.function>}}</> <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>{{anchorencode:ğŸ’©}}<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n\\n</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</> These two links should produce identical HTML <punctuation.definition.comment.html>--&gt\\n</></><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#å•¤é…’</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#%E5%95%A4%E9%85%92</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "HTML5 ids: no legacy",
		"wikitext": "==Foo bar==\n\n==foo Bar==\n\n==Ğ¢ĞµÑÑ‚==\n\n==Ğ¢ĞµÑÑ‚==\n\n==Ñ‚ĞµÑÑ‚==\n\n==Hey < # \" > % : '==\n[[#Foo bar]] [[#foo Bar]] [[#Ğ¢ĞµÑÑ‚]] [[#Ñ‚ĞµÑÑ‚]] [[#Hey < # \" > % : ']]\n\n{{anchorencode:ğŸ’©}} <span id=\"{{anchorencode:ğŸ’©}}\"></span>\n\n<!-- These two links should produce identical HTML -->\n[[#å•¤é…’]] [[#%E5%95%A4%E9%85%92]]",
		"parsed": "<markup.heading>==<string.quoted.other.heading>Foo bar</>==\\n\\n==<string.quoted.other.heading>foo Bar</>==\\n\\n==<string.quoted.other.heading>Ğ¢ĞµÑÑ‚</>==\\n\\n==<string.quoted.other.heading>Ğ¢ĞµÑÑ‚</>==\\n\\n==<string.quoted.other.heading>Ñ‚ĞµÑÑ‚</>==\\n\\n==<string.quoted.other.heading>Hey &lt; # \" &gt % : '</>==\\n</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#Foo bar</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#foo Bar</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#Ğ¢ĞµÑÑ‚</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#Ñ‚ĞµÑÑ‚</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#Hey &lt; # \" &gt % : '</><punctuation.definition.tag.link.internal>]]\\n\\n</></><punctuation.definition.tag.function>{{</><constant.language.variables.query>anchorencode</><keyword.operator.function>:</>ğŸ’©<punctuation.definition.tag.function>}}</> <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>{{anchorencode:ğŸ’©}}<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n\\n</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</> These two links should produce identical HTML <punctuation.definition.comment.html>--&gt\\n</></><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#å•¤é…’</><punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#%E5%95%A4%E9%85%92</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T90902: Normalize weird characters in section IDs",
		"wikitext": "==Foo&nbsp;bar==\n[[#Foo&nbsp;bar]]",
		"parsed": "<markup.heading>==<string.quoted.other.heading>Foo<constant.character.entity.named.nbsp.html><punctuation.definition.entity.html>&amp;</>nbsp<punctuation.definition.entity.html>;</></>bar</>==\\n</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>#Foo&amp;nbsp;bar</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "mw-heading wrapper edge cases",
		"wikitext": "==Normal heading!==\n\n<h2>HTML heading!</h2>\n\n<h2 style=\"border: 1px solid green; background: lightgreen; padding: 5px; font-size: 1.5em;\">HTML heading with attributes!</h2>\n\n<div class=\"mw-heading mw-heading2\">\n==Normal heading with existing wrapper!==\n</div>",
		"parsed": "<markup.heading>==<string.quoted.other.heading>Normal heading!</>==\\n\\n</><meta.tag.structure.h2.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>h2</><punctuation.definition.tag.end.html>&gt</></>HTML heading!<meta.tag.structure.h2.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>h2</><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.structure.h2.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>h2</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>border: 1px solid green; background: lightgreen; padding: 5px; font-size: 1.5em;</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>HTML heading with attributes!<meta.tag.structure.h2.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>h2</><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>mw-heading mw-heading2<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt\\n</></><markup.heading>==<string.quoted.other.heading>Normal heading with existing wrapper!</>==\\n</><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T365413: Headings with dollar signs",
		"wikitext": "==$text==\n\n==$ text==\n\n==text $text==\n\n==\\$text==\n\n==$$text==",
		"parsed": "<markup.heading>==<string.quoted.other.heading>$text</>==\\n\\n==<string.quoted.other.heading>$ text</>==\\n\\n==<string.quoted.other.heading>text $text</>==\\n\\n==<string.quoted.other.heading>\\$text</>==\\n\\n==<string.quoted.other.heading>$$text</>==</>"
	},
	{
		"desc": "T368334: Headings from template titles that would need uri encoding",
		"wikitext": "{{With a section?}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>With a section?</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "indentPre"
	},
	{
		"desc": "Preformatted text",
		"wikitext": " This is some\n Preformatted text\n With ''italic''\n And '''bold'''\n And a [[Main Page|link]]",
		"parsed": " This is some\\n Preformatted text\\n With <markup.italic>''</>italic<markup.italic>''\\n</> And <markup.bold>'''</>bold<markup.bold>'''\\n</> And a <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</>link<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Tabs don't trigger preformatted text",
		"wikitext": "\tThis is not\n\t preformatted text.\n This is preformatted text.\n \tSo is this.",
		"parsed": "\tThis is not\\n\t preformatted text.\\n This is preformatted text.\\n \tSo is this."
	},
	{
		"desc": "Space before tab needs nowiki pre protection",
		"wikitext": "a",
		"parsed": "a"
	},
	{
		"desc": "Indent preformatting with inline content",
		"wikitext": " a\n ''b''",
		"parsed": " a\\n <markup.italic>''</>b<markup.italic>''</>"
	},
	{
		"desc": "<pre> with <nowiki> inside (compatibility with 1.6 and earlier)",
		"wikitext": "<pre><nowiki>\n<b>\n<cite>\n<em>\n</nowiki></pre>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>&lt;nowiki&gt\\n&lt;b&gt\\n&lt;cite&gt\\n&lt;em&gt\\n&lt;/nowiki&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Regression with preformatted in <center>",
		"wikitext": "<center>\n Blah\n</center>",
		"parsed": "<meta.tag.structure.center.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.deprecated.html>center</></><punctuation.definition.tag.end.html>&gt\\n</></> Blah\\n<meta.tag.structure.center.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.deprecated.html>center</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T54763: Preformatted in <blockquote>",
		"wikitext": "<blockquote>\n Blah\n{|\n|\n indented cell (no pre-wrapping!)\n|}\n</blockquote>",
		"parsed": "<meta.tag.structure.blockquote.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt\\n</></> Blah\\n<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|\\n</></> indented cell (no pre-wrapping!)\\n<keyword.operator>|}\\n</></><meta.tag.structure.blockquote.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Templates: Indent-Pre: 1a. Templates that break a line should suppress <pre>",
		"wikitext": " {{1x|}}",
		"parsed": " <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Indent-Pre: 1b. Templates that break a line should suppress <pre>",
		"wikitext": " {{1x|\nfoo}}",
		"parsed": " <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|\\n</>foo<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Indent-Pre: 1c: Wrapping should be based on expanded content",
		"wikitext": " {{1x|a\nb}}",
		"parsed": " <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>a\\nb<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Indent-Pre: 1d: Wrapping should be based on expanded content",
		"wikitext": " {{1x|a\nb\nc\n d\ne\n}}",
		"parsed": " <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>a\\nb\\nc\\n d\\ne\\n<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Indent-Pre: 1e. Wrapping should be based on expanded content",
		"wikitext": "{{1x| foo}}\n\n{{1x| foo}}{{1x| bar}}\n\n{{1x| foo}}\n{{1x| bar}}\n\n{{1x|<!--cmt--> foo}}\n\n<!--cmt-->{{1x| foo}}\n\n{{1x|{{1x| }}bar}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</> foo<punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</> foo<punctuation.definition.tag.template>}}{{</><entity.name.tag.local-name>1x</><keyword.operator>|</> bar<punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</> foo<punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</> bar<punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><comment.block.html><punctuation.definition.comment.html>&lt;!--</>cmt<punctuation.definition.comment.html>--&gt</></> foo<punctuation.definition.tag.template>}}\\n\\n</><comment.block.html><punctuation.definition.comment.html>&lt;!--</>cmt<punctuation.definition.comment.html>--&gt</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</> foo<punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</> <punctuation.definition.tag.template>}}</>bar<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates: Indent-Pre: 1f: Wrapping should be based on expanded content",
		"wikitext": "{{1x| }}a\n\n{{1x|\n }}a\n\n{{1x|\n b}}\n\n{{1x|a\n }}b\n\n{{1x|a\n}} b",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</> <punctuation.definition.tag.template>}}</>a\\n\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|\\n</> <punctuation.definition.tag.template>}}</>a\\n\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|\\n</> b<punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>a\\n <punctuation.definition.tag.template>}}</>b\\n\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>a\\n<punctuation.definition.tag.template>}}</> b"
	},
	{
		"desc": "Off-by-1 DSR values: Regression test for indent-pre usages",
		"wikitext": " {{1x|\n}} ''{{1x|\n}} X'' {{1x|<span></span>\n}} Y",
		"parsed": " <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|\\n</><punctuation.definition.tag.template>}}</> <markup.italic>''</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|\\n</><punctuation.definition.tag.template>}}</> X<markup.italic>''</> <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.tag.template>}}</> Y"
	},
	{
		"desc": "Ensure DSR values for mw:DisplaySpace spans are computed correctly",
		"wikitext": " x\n y :)",
		"parsed": " x\\n y :)"
	},
	{
		"desc": "pwrap test",
		"wikitext": "{{T1}}{{T1}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>T1</><punctuation.definition.tag.template>}}{{</><entity.name.tag.local-name>T1</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "1a. Indent-Pre and Comments",
		"wikitext": " a\n<!--a-->\nc",
		"parsed": " a\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</>a<punctuation.definition.comment.html>--&gt\\n</></>c"
	},
	{
		"desc": "1b. Indent-Pre and Comments",
		"wikitext": " a\n <!--a-->\nc",
		"parsed": " a\\n <comment.block.html><punctuation.definition.comment.html>&lt;!--</>a<punctuation.definition.comment.html>--&gt\\n</></>c"
	},
	{
		"desc": "1c. Indent-Pre and Comments",
		"wikitext": "<!--a-->  a\n\n <!--a--> a",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</>a<punctuation.definition.comment.html>--&gt</></>  a\\n\\n <comment.block.html><punctuation.definition.comment.html>&lt;!--</>a<punctuation.definition.comment.html>--&gt</></> a"
	},
	{
		"desc": "1d. Indent-Pre and Comments\n(Pre-handler currently cannot distinguish between comment/ws order and normalizes them to [comment,ws] order)",
		"wikitext": "<!--a--> a\n\n <!--b-->b",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</>a<punctuation.definition.comment.html>--&gt</></> a\\n\\n <comment.block.html><punctuation.definition.comment.html>&lt;!--</>b<punctuation.definition.comment.html>--&gt</></>b"
	},
	{
		"desc": "2a. Indent-Pre and tables",
		"wikitext": " {|\n |-\n !h1!!h2\n |foo||bar\n |}",
		"parsed": "<meta.tag.block.table><punctuation.definition.list.begin.markdown> </><keyword.operator>{|\\n</><meta.tag.block.table-row> <keyword.operator>|-\\n</></><meta.tag.block.th><keyword.operator> !</><markup.style>h1</><keyword.operator>!!</><markup.style>h2\\n</></><meta.tag.block.td><keyword.operator> |</><markup.style>foo</><keyword.operator>||</><markup.style>bar\\n</></><punctuation.definition.list.begin.markdown> </><keyword.operator>|}</></>"
	},
	{
		"desc": "2b. Indent-Pre and tables",
		"wikitext": "  {|\n |-\n|foo\n|}",
		"parsed": "<meta.tag.block.table><punctuation.definition.list.begin.markdown>  </><keyword.operator>{|\\n</><meta.tag.block.table-row> <keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>foo\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "2c. Indent-Pre and tables (T44252)",
		"wikitext": "{|\n |+foo\n !  |bar\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator> |+</><markup.style>foo\\n</></><meta.tag.block.th><keyword.operator> !</>  <keyword.operator>|</><markup.style>bar\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "2d. Indent-Pre and tables",
		"wikitext": " a\n {|\n |b\n |}",
		"parsed": " a\\n<meta.tag.block.table><punctuation.definition.list.begin.markdown> </><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator> |</><markup.style>b\\n</></><punctuation.definition.list.begin.markdown> </><keyword.operator>|}</></>"
	},
	{
		"desc": "2e. Indent-Pre and table-line syntax",
		"wikitext": " a\n | b\n | c",
		"parsed": " a\\n | b\\n | c"
	},
	{
		"desc": "2f. Indent-pre started by table-line syntax",
		"wikitext": "a\n | b\n | c",
		"parsed": "a\\n | b\\n | c"
	},
	{
		"desc": "2g. Indented table markup mixed with indented pre content (proposed in T8200)",
		"wikitext": " <table>\n <tr>\n <td>\n Text that should be rendered preformatted\n </td>\n </tr>\n </table>",
		"parsed": " <meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt\\n</></> <meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt\\n</></> <meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt\\n</></> Text that should be rendered preformatted\\n <meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt\\n</></> <meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt\\n</></> <meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "2h. Indent pre in tables",
		"wikitext": "{|\n !\n foo\n !\n bar\n |-\n |\n baz\n {{!}}\n bam\n |}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator> !\\n</></> foo\\n<meta.tag.block.th><keyword.operator> !\\n</></> bar\\n<meta.tag.block.table-row> <keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator> |\\n</></> baz\\n<meta.tag.block.td><keyword.operator> {{!}}\\n</></> bam\\n<punctuation.definition.list.begin.markdown> </><keyword.operator>|}</></>"
	},
	{
		"desc": "3a. Indent-Pre and block tags (single-line html)",
		"wikitext": " a <p> foo </p>\n b <div> foo </div>\n c <blockquote> foo </blockquote>\n <span> foo </span>",
		"parsed": " a <meta.tag.structure.p.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></> foo <meta.tag.structure.p.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt\\n</></> b <meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></> foo <meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></> c <meta.tag.structure.blockquote.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></> foo <meta.tag.structure.blockquote.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt\\n</></> <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></> foo <meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "3b. Indent-Pre and block tags (multi-line html)",
		"wikitext": " a <span>foo</span>\n<!-- comment --> b <div> foo </div>",
		"parsed": " a <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</> comment <punctuation.definition.comment.html>--&gt</></> b <meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></> foo <meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "3c. Indent-Pre and block tags (pre-content on separate line)",
		"wikitext": "<p>\n foo\n</p>\n\n<div>\n foo\n</div>\n\n<center>\n foo\n</center>\n\n<blockquote>\n foo\n</blockquote>\n\n<blockquote>\n<pre>\nfoo\n</pre>\n</blockquote>\n\n<table><tr><td>\n foo\n</td></tr></table>\n\n<ul><li>\n  foo\n</li></ul>",
		"parsed": "<meta.tag.structure.p.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt\\n</></> foo\\n<meta.tag.structure.p.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></> foo\\n<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.structure.center.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.deprecated.html>center</></><punctuation.definition.tag.end.html>&gt\\n</></> foo\\n<meta.tag.structure.center.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.deprecated.html>center</></><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.structure.blockquote.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt\\n</></> foo\\n<meta.tag.structure.blockquote.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.structure.blockquote.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n</><meta.embedded.block.plaintext>foo\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n</><meta.tag.structure.blockquote.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt\\n</></> foo\\n<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt\\n\\n</></><meta.tag.structure.ul.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n</></>  foo\\n<meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.ul.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ul</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "5. Indent-Pre and html pre",
		"wikitext": " <pre class=\"123\">hi</pre>",
		"parsed": " <punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>123<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>hi</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Serializing indent pre at sol",
		"wikitext": " hi",
		"parsed": " hi"
	},
	{
		"desc": "Render paragraphs when indent-pre is suppressed in blocklevels",
		"wikitext": "<blockquote>\n foo\n\n bar\n</blockquote>",
		"parsed": "<meta.tag.structure.blockquote.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt\\n</></> foo\\n\\n bar\\n<meta.tag.structure.blockquote.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "4. Multiple spaces at start-of-line",
		"wikitext": "    <p> foo </p>\n    foo\n\t{|\n|foo\n|}",
		"parsed": "    <meta.tag.structure.p.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></> foo <meta.tag.structure.p.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt\\n</></>    foo\\n<meta.tag.block.table><punctuation.definition.list.begin.markdown>\t</><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>foo\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "5a. White-space in indent-pre",
		"wikitext": " a<br />\n \n b",
		"parsed": " a<meta.tag.inline.br.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>br</> <punctuation.definition.tag.end.html>/&gt\\n</></> \\n b"
	},
	{
		"desc": "5b. White-space in indent-pre",
		"wikitext": " a\n \n b\n \n \n c",
		"parsed": " a\\n \\n b\\n \\n \\n c"
	},
	{
		"desc": "5c. White-space in indent-pre",
		"wikitext": " ''a''\n  ''b''\n   ''c''",
		"parsed": " <markup.italic>''</>a<markup.italic>''\\n</>  <markup.italic>''</>b<markup.italic>''\\n</>   <markup.italic>''</>c<markup.italic>''</>"
	},
	{
		"desc": "6. Pre-blocks should extend across lines with leading WS even when there is no wrappable content",
		"wikitext": " a\n \n <!-- continue -->\n b\n\n c\n \nd",
		"parsed": " a\\n \\n <comment.block.html><punctuation.definition.comment.html>&lt;!--</> continue <punctuation.definition.comment.html>--&gt\\n</></> b\\n\\n c\\n \\nd"
	},
	{
		"desc": "7a. Indent-pre and category links",
		"wikitext": " [[Category:foo]] <!-- No pre-wrapping -->\n{{1x| [[Category:foo]]}} <!-- No pre-wrapping -->",
		"parsed": " <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>foo</><punctuation.definition.tag.link.internal>]]</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</> No pre-wrapping <punctuation.definition.comment.html>--&gt\\n</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>foo</><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.template>}}</> <comment.block.html><punctuation.definition.comment.html>&lt;!--</> No pre-wrapping <punctuation.definition.comment.html>--&gt</></>"
	},
	{
		"desc": "7b. Indent-pre and category links",
		"wikitext": " [[Category:foo]] a\n [[Category:foo]] {{1x|b}}",
		"parsed": " <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>foo</><punctuation.definition.tag.link.internal>]]</></> a\\n <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>foo</><punctuation.definition.tag.link.internal>]]</></> <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>b<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Indent-Pre: Newlines in comments shouldn't affect sol state",
		"wikitext": "a <!--\nfoo\n--> b",
		"parsed": "a <comment.block.html><punctuation.definition.comment.html>&lt;!--\\n</>foo\\n<punctuation.definition.comment.html>--&gt</></> b"
	},
	{
		"desc": "Indent pre with leading colon",
		"wikitext": " :foo",
		"parsed": " :foo"
	},
	{
		"desc": "Indent-Pre regression test: Trailing whitespace after sol-transparent content",
		"wikitext": "[[Category:Foo]]   \n[[Category:Bar]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></>   \\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Bar</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Preserving leading whitespace in indent-pre suppressing contexts",
		"wikitext": "<ol>\n<li>\n foo\n bar\n</li>\n</ol>",
		"parsed": "<meta.tag.structure.ol.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>ol</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.li.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n</></> foo\\n bar\\n<meta.tag.structure.li.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>li</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.ol.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>ol</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "indicators"
	},
	{
		"desc": "Page status indicators: Empty name is invalid",
		"wikitext": "<indicator name=\" \"></indicator>\n<indicator></indicator>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</> <punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Page status indicators: Weird syntaxes that are okay",
		"wikitext": "<indicator name=\"empty\" />\n<indicator name=\"name\"></indicator>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>empty<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>name<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Page status indicators: Stress test",
		"wikitext": "<indicator name=\"01\">hello world</indicator>\n<indicator name=\"02\">[[Main Page]]</indicator>\n<indicator name=\"03\">[[File:Foobar.jpg|25px|link=]]</indicator>\n<indicator name=\"04\">[[File:Foobar.jpg|25px]]</indicator>\n<indicator name=\"05\">*foo\n*bar</indicator>\n<indicator name=\"06\"><nowiki>foo</nowiki></indicator>\n<indicator name=\"07\"> Preformatted</indicator>\n<indicator name=\"08\"><div>Broken tag</indicator>\n<indicator name=\"09\">{| class=wikitable\n|cell\n|}</indicator>\n<indicator name=\"10\">Two\n\nparagraphs</indicator>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>01<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>hello world</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>02<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</></></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>03<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>25<entity.other.attribute-name.localname>px</><keyword.operator>|</><entity.other.attribute-name.localname>link=</><punctuation.definition.tag.link.internal>]]</></></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>04<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>25<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]</></></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>05<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>*foo\\n<punctuation.definition.list.begin.markdown>*</>bar</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>06<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>07<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref> Preformatted</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>08<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>Broken tag</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>09<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>{| class=wikitable\\n|cell\\n|}</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>10<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>Two\\n\\nparagraphs</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Decoding of HTML entities in indicator names for IDs (T104196)",
		"wikitext": "<indicator name=\"1&2&amp;3&amp;amp;4&amp;amp;amp;5\">Indicator</indicator>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>1&amp;2<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>3<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>amp;4<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>amp;amp;5<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>Indicator</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Decoding of HTML entities in indicator names for IDs (unambiguous) (T104196)",
		"wikitext": "<indicator name=\"1&2&3&amp;amp;4&amp;amp;amp;5\">Indicator</indicator>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>1&amp;2&amp;3<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>amp;4<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>amp;amp;5<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>Indicator</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Indicators with duplicate names: Last one wins",
		"wikitext": "<indicator name=\"x\">foo</indicator>\n<indicator name=\"x\">bar</indicator>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>bar</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Templates where an indicator is the leading content (1)",
		"wikitext": "abcd\n{{1x|<indicator name=\"x\">foo</indicator>}}",
		"parsed": "abcd\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates where an indicator is the leading content (2)",
		"wikitext": "abcd\n<indicator name=\"x\">bar</indicator>\n{{1x|<indicator name=\"x\">foo</indicator>}}",
		"parsed": "abcd\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>bar</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates where an indicator is not the leading content (1)",
		"wikitext": "abcd\n{{1x|efgh<indicator name=\"x\">foo</indicator>}}",
		"parsed": "abcd\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>efgh<punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templates where an indicator is not the leading content (2)",
		"wikitext": "abcd\n<indicator name=\"x\">bar</indicator>\n{{1x|efgh<indicator name=\"x\">foo</indicator>}}",
		"parsed": "abcd\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>bar</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>efgh<punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Indicator in fosterable position should not dirty-diff in selser mode",
		"wikitext": "{|\n<indicator name='x'>foo</indicator>\n|x\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.single.html><punctuation.definition.string.begin.html>'</>x<punctuation.definition.string.end.html>'</></></><punctuation.definition.tag.end>&gt</><meta.block.ref>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>x\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Indicator with comments should not be <p>-wrapped",
		"wikitext": "<indicator name=\"x\"><!-- hello -->\n<span>some stuff</span>\n<!-- second comment--></indicator>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>indicator</> <meta.attribute.name.html><entity.other.attribute-name.html>name</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.block.ref><comment.block.html><punctuation.definition.comment.html>&lt;!--</> hello <punctuation.definition.comment.html>--&gt\\n</></><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>some stuff<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</> second comment<punctuation.definition.comment.html>--&gt</></></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>indicator</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "langParserTests"
	},
	{
		"desc": "Language converter: output gets cut off unexpectedly (T7757)",
		"wikitext": "this bit is safe: }-\n\nbut if we add a conversion instance: -{zh-cn:xxx;zh-tw:yyy}-\n\nthen we get cut off here: }-\n\nall additional text is vanished",
		"parsed": "this bit is safe: }-\\n\\nbut if we add a conversion instance: <punctuation.definition.tag.convert>-{</><entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>xxx<punctuation.terminator.rule>;</><entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>yyy<punctuation.definition.tag.convert>}-\\n\\n</>then we get cut off here: }-\\n\\nall additional text is vanished"
	},
	{
		"desc": "Don't convert blue categorylinks to another variant (T35210)",
		"wikitext": "[[A]][[Category:åˆ†ç±»]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>A</><punctuation.definition.tag.link.internal>]][[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>åˆ†ç±»</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Explicit definition of language variant alternatives",
		"wikitext": "-{zh:China;zh-tw:Taiwan}-, not China",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.tag.language>zh</><punctuation.separator.key-value>:</>China<punctuation.terminator.rule>;</><entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>Taiwan<punctuation.definition.tag.convert>}-</>, not China"
	},
	{
		"desc": "Explicit definition of language variant alternatives (BCP 47 codes)",
		"wikitext": "-{zh:China;zh-Hant-TW:Taiwan}-, not China",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.tag.language>zh</><punctuation.separator.key-value>:</>China<punctuation.terminator.rule>;</>zh-Hant-TW:Taiwan<punctuation.definition.tag.convert>}-</>, not China"
	},
	{
		"desc": "Filter syntax for language variants",
		"wikitext": "foo-{zh;zh-hans;zh-hant|blog, WEBJOURNAL, WEBLOG}-quux",
		"parsed": "foo<punctuation.definition.tag.convert>-{</><entity.name.function.type>zh<punctuation.terminator.flag>;</>zh-hans<punctuation.terminator.flag>;</>zh-hant</><keyword.operator>|</>blog, WEBJOURNAL, WEBLOG<punctuation.definition.tag.convert>}-</>quux"
	},
	{
		"desc": "Explicit session-wise two-way language variant mapping (A flag and - flag)",
		"wikitext": "This is -{zh:China; zh-tw:Taiwan}-, but we'll forget that now.\n\nTaiwan is not China.\n\nBut -{A|zh:China; zh-tw:Taiwan}- is China,\n\n(This-{-|zh:China; zh-tw:Taiwan}- should be stripped!)\n\nand -{China}- is China.",
		"parsed": "This is <punctuation.definition.tag.convert>-{</><entity.name.tag.language>zh</><punctuation.separator.key-value>:</>China<punctuation.terminator.rule>;</> <entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>Taiwan<punctuation.definition.tag.convert>}-</>, but we'll forget that now.\\n\\nTaiwan is not China.\\n\\nBut <punctuation.definition.tag.convert>-{</><entity.name.function.type>A</><keyword.operator>|</><entity.name.tag.language>zh</><punctuation.separator.key-value>:</>China<punctuation.terminator.rule>;</> <entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>Taiwan<punctuation.definition.tag.convert>}-</> is China,\\n\\n(This<punctuation.definition.tag.convert>-{</><entity.name.function.type>-</><keyword.operator>|</><entity.name.tag.language>zh</><punctuation.separator.key-value>:</>China<punctuation.terminator.rule>;</> <entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>Taiwan<punctuation.definition.tag.convert>}-</> should be stripped!)\\n\\nand <punctuation.definition.tag.convert>-{</>China<punctuation.definition.tag.convert>}-</> is China."
	},
	{
		"desc": "Explicit session-wise one-way language variant mapping (A flag and - flag)",
		"wikitext": "This is -{COUNTRY=>zh:China;COUNTRY=>zh-tw:Taiwan}-, but we'll forget that now.\n\nCOUNTRY is China or Taiwan.\n\nBut -{A|COUNTRY=>zh:China;COUNTRY=>zh-tw:Taiwan}- is COUNTRY,\n\n(This-{-|COUNTRY=>zh:China;COUNTRY=>zh-tw:Taiwan}- should be stripped!)\n\nand -{COUNTRY}- is COUNTRY.",
		"parsed": "This is <punctuation.definition.tag.convert>-{</>COUNTRY=&gt<entity.name.tag.language>zh</><punctuation.separator.key-value>:</>China<punctuation.terminator.rule>;</>COUNTRY=&gt<entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>Taiwan<punctuation.definition.tag.convert>}-</>, but we'll forget that now.\\n\\nCOUNTRY is China or Taiwan.\\n\\nBut <punctuation.definition.tag.convert>-{</><entity.name.function.type>A</><keyword.operator>|</>COUNTRY=&gt<entity.name.tag.language>zh</><punctuation.separator.key-value>:</>China<punctuation.terminator.rule>;</>COUNTRY=&gt<entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>Taiwan<punctuation.definition.tag.convert>}-</> is COUNTRY,\\n\\n(This<punctuation.definition.tag.convert>-{</><entity.name.function.type>-</><keyword.operator>|</>COUNTRY=&gt<entity.name.tag.language>zh</><punctuation.separator.key-value>:</>China<punctuation.terminator.rule>;</>COUNTRY=&gt<entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>Taiwan<punctuation.definition.tag.convert>}-</> should be stripped!)\\n\\nand <punctuation.definition.tag.convert>-{</>COUNTRY<punctuation.definition.tag.convert>}-</> is COUNTRY."
	},
	{
		"desc": "Explicit session-wise two-way language variant mapping (H flag for hide)",
		"wikitext": "(This-{H|zh:China;zh-tw:Taiwan}- should be stripped!)\n\nTaiwan is China.",
		"parsed": "(This<punctuation.definition.tag.convert>-{</><entity.name.function.type>H</><keyword.operator>|</><entity.name.tag.language>zh</><punctuation.separator.key-value>:</>China<punctuation.terminator.rule>;</><entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>Taiwan<punctuation.definition.tag.convert>}-</> should be stripped!)\\n\\nTaiwan is China."
	},
	{
		"desc": "Explicit session-wise one-way language variant mapping (H flag for hide)",
		"wikitext": "(This-{H|COUNTRY=>zh:China;COUNTRY=>zh-tw:Taiwan}- should be stripped!)\n\nCOUNTRY is Taiwan or China.",
		"parsed": "(This<punctuation.definition.tag.convert>-{</><entity.name.function.type>H</><keyword.operator>|</>COUNTRY=&gt<entity.name.tag.language>zh</><punctuation.separator.key-value>:</>China<punctuation.terminator.rule>;</>COUNTRY=&gt<entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>Taiwan<punctuation.definition.tag.convert>}-</> should be stripped!)\\n\\nCOUNTRY is Taiwan or China."
	},
	{
		"desc": "Adding explicit conversion rule for title (T flag)",
		"wikitext": "Should be stripped-{T|zh:China;zh-tw:Taiwan}-!\n\nTaiwan is China.",
		"parsed": "Should be stripped<punctuation.definition.tag.convert>-{</><entity.name.function.type>T</><keyword.operator>|</><entity.name.tag.language>zh</><punctuation.separator.key-value>:</>China<punctuation.terminator.rule>;</><entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>Taiwan<punctuation.definition.tag.convert>}-</>!\\n\\nTaiwan is China."
	},
	{
		"desc": "Code coverage: T combined with H flag",
		"wikitext": "Should be stripped-{T;H|zh:China; zh-tw:Taiwan}-!\n\nTaiwan is China.",
		"parsed": "Should be stripped<punctuation.definition.tag.convert>-{</><entity.name.function.type>T<punctuation.terminator.flag>;</>H</><keyword.operator>|</><entity.name.tag.language>zh</><punctuation.separator.key-value>:</>China<punctuation.terminator.rule>;</> <entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>Taiwan<punctuation.definition.tag.convert>}-</>!\\n\\nTaiwan is China."
	},
	{
		"desc": "Code coverage: T with no variants",
		"wikitext": "-{H|zh:China; zh-tw:Taiwan}-\nTaiwan is China.-{T|Taiwan is China}-",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.function.type>H</><keyword.operator>|</><entity.name.tag.language>zh</><punctuation.separator.key-value>:</>China<punctuation.terminator.rule>;</> <entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>Taiwan<punctuation.definition.tag.convert>}-\\n</>Taiwan is China.<punctuation.definition.tag.convert>-{</><entity.name.function.type>T</><keyword.operator>|</>Taiwan is China<punctuation.definition.tag.convert>}-</>"
	},
	{
		"desc": "Code coverage: rules with no variants",
		"wikitext": "-{H|zh:China; zh-tw:Taiwan}-\nTaiwan is China.\n-{H|China}-\nTaiwan is China.",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.function.type>H</><keyword.operator>|</><entity.name.tag.language>zh</><punctuation.separator.key-value>:</>China<punctuation.terminator.rule>;</> <entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>Taiwan<punctuation.definition.tag.convert>}-\\n</>Taiwan is China.\\n<punctuation.definition.tag.convert>-{</><entity.name.function.type>H</><keyword.operator>|</>China<punctuation.definition.tag.convert>}-\\n</>Taiwan is China."
	},
	{
		"desc": "Code coverage: D flag for conversion rule",
		"wikitext": "-{D|zh-cn:XA; zh-tw:YA}-\n-{A;D|zh-cn:XB; zh-tw:YB}-\n-{D;H|zh-cn:XC; zh-tw:YC}-\n\n-{D;H|FOO=>zh-tw:BAR;FOO=>zh-cn:BAT}-\n\n-{D|0=>zh-tw:1}-\n-{A;D|2=>zh-tw:3}-\n-{D;H|4=>zh-tw:5}-\n\nXA XB XC YA YB YC FOO BAR BAT 012345",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.function.type>D</><keyword.operator>|</><entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>XA<punctuation.terminator.rule>;</> <entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>YA<punctuation.definition.tag.convert>}-\\n-{</><entity.name.function.type>A<punctuation.terminator.flag>;</>D</><keyword.operator>|</><entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>XB<punctuation.terminator.rule>;</> <entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>YB<punctuation.definition.tag.convert>}-\\n-{</><entity.name.function.type>D<punctuation.terminator.flag>;</>H</><keyword.operator>|</><entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>XC<punctuation.terminator.rule>;</> <entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>YC<punctuation.definition.tag.convert>}-\\n\\n-{</><entity.name.function.type>D<punctuation.terminator.flag>;</>H</><keyword.operator>|</>FOO=&gt<entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>BAR<punctuation.terminator.rule>;</>FOO=&gt<entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>BAT<punctuation.definition.tag.convert>}-\\n\\n-{</><entity.name.function.type>D</><keyword.operator>|</>0=&gt<entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>1<punctuation.definition.tag.convert>}-\\n-{</><entity.name.function.type>A<punctuation.terminator.flag>;</>D</><keyword.operator>|</>2=&gt<entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>3<punctuation.definition.tag.convert>}-\\n-{</><entity.name.function.type>D<punctuation.terminator.flag>;</>H</><keyword.operator>|</>4=&gt<entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>5<punctuation.definition.tag.convert>}-\\n\\n</>XA XB XC YA YB YC FOO BAR BAT 012345"
	},
	{
		"desc": "Code coverage: N flag for conversion rule",
		"wikitext": "-{N|zh-cn}-\n\n-{N|zh-tw}-\n\n-{N|sr-ec}-",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.function.type>N</><keyword.operator>|</>zh-cn<punctuation.definition.tag.convert>}-\\n\\n-{</><entity.name.function.type>N</><keyword.operator>|</>zh-tw<punctuation.definition.tag.convert>}-\\n\\n-{</><entity.name.function.type>N</><keyword.operator>|</>sr-ec<punctuation.definition.tag.convert>}-</>"
	},
	{
		"desc": "Code coverage: N flag for conversion rule (wt2html only)",
		"wikitext": "-{D;N|en}-",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.function.type>D<punctuation.terminator.flag>;</>N</><keyword.operator>|</>en<punctuation.definition.tag.convert>}-</>"
	},
	{
		"desc": "Testing that changing the language variant here in the tests actually works",
		"wikitext": "Should be stripped-{T|zh:China; zh-tw:Taiwan}-!",
		"parsed": "Should be stripped<punctuation.definition.tag.convert>-{</><entity.name.function.type>T</><keyword.operator>|</><entity.name.tag.language>zh</><punctuation.separator.key-value>:</>China<punctuation.terminator.rule>;</> <entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>Taiwan<punctuation.definition.tag.convert>}-</>!"
	},
	{
		"desc": "Title with HTML",
		"wikitext": "-{T|zh:Title <i style=\"color:red\">with</i> HTML&amp;Entities}-\nShould be stripped!",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.function.type>T</><keyword.operator>|</><entity.name.tag.language>zh</><punctuation.separator.key-value>:</>Title <meta.tag.inline.i.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>i</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>color:red</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>with<meta.tag.inline.i.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>i</><punctuation.definition.tag.end.html>&gt</></> HTML&amp;amp<punctuation.terminator.rule>;</>Entities<punctuation.definition.tag.convert>}-\\n</>Should be stripped!"
	},
	{
		"desc": "Title with Wiki syntax",
		"wikitext": "-{T|zh:Title ''with'' Wiki's s&uuml;ntax&copy}-\nShould be stripped!",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.function.type>T</><keyword.operator>|</><entity.name.tag.language>zh</><punctuation.separator.key-value>:</>Title <markup.italic>''</>with<markup.italic>''</> Wiki's s&amp;uuml<punctuation.terminator.rule>;</>ntax&amp;copy<punctuation.definition.tag.convert>}-\\n</>Should be stripped!"
	},
	{
		"desc": "Title with JavaScript injection",
		"wikitext": "-{T|zh:Title <i onclick=\"alert(42)\">click me</i> <script>alert(43)</script>}-\nShould be stripped!",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.function.type>T</><keyword.operator>|</><entity.name.tag.language>zh</><punctuation.separator.key-value>:</>Title <meta.tag.inline.i.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>i</> <meta.attribute.event-handler.click.html><entity.other.attribute-name.html>onclick</><punctuation.separator.key-value.html>=</><meta.embedded.line.js><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.js><meta.function-call.js><entity.name.function.js>alert</></><meta.brace.round.js>(</><constant.numeric.decimal.js>42</><meta.brace.round.js>)</></><punctuation.definition.string.end.html><source.js>\"</></></></></><punctuation.definition.tag.end.html>&gt</></>click me<meta.tag.inline.i.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>i</><punctuation.definition.tag.end.html>&gt</></> <meta.embedded.block.html><meta.tag.metadata.script.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>script</><punctuation.definition.tag.end.html>&gt</></><source.js><meta.function-call.js><entity.name.function.js>alert</></><meta.brace.round.js>(</><constant.numeric.decimal.js>43</><meta.brace.round.js>)</></><meta.tag.metadata.script.end.html><punctuation.definition.tag.begin.html><source.js-ignored-vscode>&lt;</>/</><entity.name.tag.html>script</><punctuation.definition.tag.end.html>&gt</></></><punctuation.definition.tag.convert>}-\\n</>Should be stripped!"
	},
	{
		"desc": "Test 1 from T298401/T67747",
		"wikitext": "-{T|zh:Title <script>a</script>&amp;<i>b</i>}-\nShould be stripped!",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.function.type>T</><keyword.operator>|</><entity.name.tag.language>zh</><punctuation.separator.key-value>:</>Title <meta.embedded.block.html><meta.tag.metadata.script.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>script</><punctuation.definition.tag.end.html>&gt</></><source.js><variable.other.readwrite.js>a</></><meta.tag.metadata.script.end.html><punctuation.definition.tag.begin.html><source.js-ignored-vscode>&lt;</>/</><entity.name.tag.html>script</><punctuation.definition.tag.end.html>&gt</></></>&amp;amp<punctuation.terminator.rule>;</><meta.tag.inline.i.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>i</><punctuation.definition.tag.end.html>&gt</></>b<meta.tag.inline.i.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>i</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.convert>}-\\n</>Should be stripped!"
	},
	{
		"desc": "Test 2 from T298401/T67747",
		"wikitext": "-{T|zh:Title <code style=\"display:none\">}-\nShould be stripped!",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.function.type>T</><keyword.operator>|</><entity.name.tag.language>zh</><punctuation.separator.key-value>:</>Title <meta.tag.inline.code.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>code</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>display:none</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.convert>}-\\n</>Should be stripped!"
	},
	{
		"desc": "Test 3 from T298401/T67747",
		"wikitext": "-{T|zh:Title <b>Foo bar<b>}-\nShould be stripped!",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.function.type>T</><keyword.operator>|</><entity.name.tag.language>zh</><punctuation.separator.key-value>:</>Title <meta.tag.inline.b.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></>Foo bar<meta.tag.inline.b.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.convert>}-\\n</>Should be stripped!"
	},
	{
		"desc": "Recursive conversion of alt and title attrs shouldn't clear converter state",
		"wikitext": "-{H|zh-cn:Exclamation; zh-tw:exclamation}-\nShould be stripped-{T|zh-cn:China; zh-tw:Taiwan}-<span title=\"exclamation\">!</span>",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.function.type>H</><keyword.operator>|</><entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>Exclamation<punctuation.terminator.rule>;</> <entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>exclamation<punctuation.definition.tag.convert>}-\\n</>Should be stripped<punctuation.definition.tag.convert>-{</><entity.name.function.type>T</><keyword.operator>|</><entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>China<punctuation.terminator.rule>;</> <entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>Taiwan<punctuation.definition.tag.convert>}-</><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>exclamation<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>!<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T26072: more test on conversion rule for title",
		"wikitext": "This should be stripped-{T|zh:China; zh-tw:Taiwan}-!\n\nThis won't take interferes with the title rule-{H|zh:Beijing; zh-tw:Taipei}-.",
		"parsed": "This should be stripped<punctuation.definition.tag.convert>-{</><entity.name.function.type>T</><keyword.operator>|</><entity.name.tag.language>zh</><punctuation.separator.key-value>:</>China<punctuation.terminator.rule>;</> <entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>Taiwan<punctuation.definition.tag.convert>}-</>!\\n\\nThis won't take interferes with the title rule<punctuation.definition.tag.convert>-{</><entity.name.function.type>H</><keyword.operator>|</><entity.name.tag.language>zh</><punctuation.separator.key-value>:</>Beijing<punctuation.terminator.rule>;</> <entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>Taipei<punctuation.definition.tag.convert>}-</>."
	},
	{
		"desc": "Partly disable title conversion if variant == main language code",
		"wikitext": "-{T|zh-cn:CN;zh-tw:TW}-",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.function.type>T</><keyword.operator>|</><entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>CN<punctuation.terminator.rule>;</><entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>TW<punctuation.definition.tag.convert>}-</>"
	},
	{
		"desc": "Partly disable title conversion if variant == main language code, more",
		"wikitext": "-{T|TW}-",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.function.type>T</><keyword.operator>|</>TW<punctuation.definition.tag.convert>}-</>"
	},
	{
		"desc": "Raw output of variant escape tags (R flag)",
		"wikitext": "Raw: -{R|zh:China;zh-tw:Taiwan}-",
		"parsed": "Raw: <punctuation.definition.tag.convert>-{</><entity.name.function.type>R</><keyword.operator>|</><entity.name.tag.language>zh</><punctuation.separator.key-value>:</>China<punctuation.terminator.rule>;</><entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>Taiwan<punctuation.definition.tag.convert>}-</>"
	},
	{
		"desc": "Raw output of variant escape tags (R flag) (wt2html only)",
		"wikitext": "-{Variant}- -{D|syntax}- -{D;R|options}-",
		"parsed": "<punctuation.definition.tag.convert>-{</>Variant<punctuation.definition.tag.convert>}-</> <punctuation.definition.tag.convert>-{</><entity.name.function.type>D</><keyword.operator>|</>syntax<punctuation.definition.tag.convert>}-</> <punctuation.definition.tag.convert>-{</><entity.name.function.type>D<punctuation.terminator.flag>;</>R</><keyword.operator>|</>options<punctuation.definition.tag.convert>}-</>"
	},
	{
		"desc": "Nested markup inside raw output of variant escape tags (R flag)",
		"wikitext": "Nested raw: -{R|nested -{zh:China;zh-tw:Taiwan}- nested}-",
		"parsed": "Nested raw: <punctuation.definition.tag.convert>-{</><entity.name.function.type>R</><keyword.operator>|</>nested <punctuation.definition.tag.convert>-{</><entity.name.tag.language>zh</><punctuation.separator.key-value>:</>China<punctuation.terminator.rule>;</><entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>Taiwan<punctuation.definition.tag.convert>}-</> nested<punctuation.definition.tag.convert>}-</>"
	},
	{
		"desc": "Nested markup and spaces inside raw output of variant escape tags (R flag)",
		"wikitext": "X-{ outer -{ inner }- outer }-X",
		"parsed": "X<punctuation.definition.tag.convert>-{</> outer <punctuation.definition.tag.convert>-{</> inner <punctuation.definition.tag.convert>}-</> outer <punctuation.definition.tag.convert>}-</>X"
	},
	{
		"desc": "Templates inside raw output of variant escape tags (R flag)",
		"wikitext": "Nested raw: -{R|nested {{1x|hi}} templates}-",
		"parsed": "Nested raw: <punctuation.definition.tag.convert>-{</><entity.name.function.type>R</><keyword.operator>|</>nested <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>hi<punctuation.definition.tag.template>}}</> templates<punctuation.definition.tag.convert>}-</>"
	},
	{
		"desc": "Strings evaluating false shouldn't be ignored by Language converter (T51072)",
		"wikitext": "-{zh-cn:0;zh-sg:1;zh-tw:2;zh-hk:3}-",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>0<punctuation.terminator.rule>;</><entity.name.tag.language>zh-sg</><punctuation.separator.key-value>:</>1<punctuation.terminator.rule>;</><entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>2<punctuation.terminator.rule>;</><entity.name.tag.language>zh-hk</><punctuation.separator.key-value>:</>3<punctuation.definition.tag.convert>}-</>"
	},
	{
		"desc": "Conversion rules from [numeric-only string] to [something else] (T48634)",
		"wikitext": "-{H|0=>zh-cn:B}--{H|0=>zh-cn:C;0=>zh-cn:D}--{H|0=>zh-hans:A}-012345-{A|zh-tw:0;zh-cn:E;}-012345",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.function.type>H</><keyword.operator>|</>0=&gt<entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>B<punctuation.definition.tag.convert>}--{</><entity.name.function.type>H</><keyword.operator>|</>0=&gt<entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>C<punctuation.terminator.rule>;</>0=&gt<entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>D<punctuation.definition.tag.convert>}--{</><entity.name.function.type>H</><keyword.operator>|</>0=&gt<entity.name.tag.language>zh-hans</><punctuation.separator.key-value>:</>A<punctuation.definition.tag.convert>}-</>012345<punctuation.definition.tag.convert>-{</><entity.name.function.type>A</><keyword.operator>|</><entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>0<punctuation.terminator.rule>;</><entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>E<punctuation.terminator.rule>;</><punctuation.definition.tag.convert>}-</>012345"
	},
	{
		"desc": "Two-way converter rule entries with an empty value should be ignored (T53551)",
		"wikitext": "-{H|zh-cn:foo;zh-tw:;}-foobar",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.function.type>H</><keyword.operator>|</><entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>foo<punctuation.terminator.rule>;</><entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</><punctuation.terminator.rule>;</><punctuation.definition.tag.convert>}-</>foobar"
	},
	{
		"desc": "One-way converter rule entries with an empty \"from\" string should be ignored (T53551)",
		"wikitext": "-{H|=>zh-cn:foo;}-foobar",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.function.type>H</><keyword.operator>|</>=&gt<entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>foo<punctuation.terminator.rule>;</><punctuation.definition.tag.convert>}-</>foobar"
	},
	{
		"desc": "Empty converter rule entries shouldn't be inserted into the conversion table (T53551)",
		"wikitext": "-{H|}-foobar",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.function.type>H</><keyword.operator>|</><punctuation.definition.tag.convert>}-</>foobar"
	},
	{
		"desc": "Nested using of manual convert syntax",
		"wikitext": "Nested: -{zh-hans:Hi -{zh-cn:China;zh-sg:Singapore;}-;zh-hant:Hello -{zh-tw:Taiwan;zh-hk:H-{ong}- K-{}-ong;}-;}-!",
		"parsed": "Nested: <punctuation.definition.tag.convert>-{</><entity.name.tag.language>zh-hans</><punctuation.separator.key-value>:</>Hi <punctuation.definition.tag.convert>-{</>zh-cn:China<punctuation.terminator.rule>;</><entity.name.tag.language>zh-sg</><punctuation.separator.key-value>:</>Singapore<punctuation.terminator.rule>;</><punctuation.definition.tag.convert>}-</>;zh-hant:Hello <punctuation.definition.tag.convert>-{</><entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>Taiwan<punctuation.terminator.rule>;</><entity.name.tag.language>zh-hk</><punctuation.separator.key-value>:</>H<punctuation.definition.tag.convert>-{</>ong<punctuation.definition.tag.convert>}-</> K<punctuation.definition.tag.convert>-{}-</>ong;}-;}-!"
	},
	{
		"desc": "HTML markups with conversion syntax in attribs, nested in other conversion blocks",
		"wikitext": "-{zh;zh-hans;zh-hant|<span title=\"-{X}-\">A</span>}-",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.function.type>zh<punctuation.terminator.flag>;</>zh-hans<punctuation.terminator.flag>;</>zh-hant</><keyword.operator>|</><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>-{X}-<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>A<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.convert>}-</>"
	},
	{
		"desc": "HTML markups with conversion syntax in attribs, nested in other conversion blocks (not working yet in PHP parser)",
		"wikitext": "-{<span title=\"-{X}-\">A</span>}-",
		"parsed": "<punctuation.definition.tag.convert>-{</><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>-{X}-<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>A<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.convert>}-</>"
	},
	{
		"desc": "Language converter markup with block content",
		"wikitext": "<span>a-{b<div>c}-d\n\n<span>a-{zh;zh-hans;zh-hant|b<div>c}-d\n\n<span>a-{H|0=>zh-cn:x<span>y;0=>zh-tw:b<div>c}-d",
		"parsed": "<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>a<punctuation.definition.tag.convert>-{</>b<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>c<punctuation.definition.tag.convert>}-</>d\\n\\n<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>a<punctuation.definition.tag.convert>-{</><entity.name.function.type>zh<punctuation.terminator.flag>;</>zh-hans<punctuation.terminator.flag>;</>zh-hant</><keyword.operator>|</>b<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>c<punctuation.definition.tag.convert>}-</>d\\n\\n<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>a<punctuation.definition.tag.convert>-{</><entity.name.function.type>H</><keyword.operator>|</>0=&gt<entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>x<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>y<punctuation.terminator.rule>;</>0=&gt<entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>b<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>c<punctuation.definition.tag.convert>}-</>d"
	},
	{
		"desc": "LanguageConverter selser (1)",
		"wikitext": "-{raw}-",
		"parsed": "<punctuation.definition.tag.convert>-{</>raw<punctuation.definition.tag.convert>}-</>"
	},
	{
		"desc": "LanguageConverter selser (2)",
		"wikitext": "<span class=\"x\">TEXT1</span>\n[http://example.com TEXT2]\n[[Foo|TEXT3]]\n{{1x|TEXT4}}",
		"parsed": "<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>TEXT1<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com</><string.other.link.external.title> TEXT2</><punctuation.definition.tag.link.external>]\\n</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</>TEXT3<punctuation.definition.tag.link.internal>]]\\n</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>TEXT4<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "LanguageConverter selser (3)",
		"wikitext": "{|\n|-\n|<span>Foo</span>\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>Foo<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n</></></></><keyword.operator>|}</></>"
	},
	{
		"desc": "LanguageConverter selser (4)",
		"wikitext": "{|\n|-\n|<span class=\"x\">Foo</span>-{Bar}-\n||<span class=\"x\">Foo</span>-{Bar}-\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>Foo<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.convert>-{</>Bar<punctuation.definition.tag.convert>}-\\n</></><keyword.operator>||</><markup.style><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>x<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>Foo<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.convert>-{</>Bar<punctuation.definition.tag.convert>}-\\n</></></><keyword.operator>|}</></>"
	},
	{
		"desc": "T153135: Don't break list handling if language converter markup is in the item.",
		"wikitext": ";-{zh-cn:AAA;zh-tw:BBB}-\n;-{R|foo:bar}-",
		"parsed": "<punctuation.definition.list.begin.markdown>;</><punctuation.definition.tag.convert>-{</><entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>AAA<punctuation.terminator.rule>;</><entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>BBB<punctuation.definition.tag.convert>}-\\n</><punctuation.definition.list.begin.markdown>;</><punctuation.definition.tag.convert>-{</><entity.name.function.type>R</><keyword.operator>|</>foo:bar<punctuation.definition.tag.convert>}-</>"
	},
	{
		"desc": "T153135: Unclosed markup in definition list (code coverage)",
		"wikitext": ";<b>foo:bar\n;-{zh-cn:AAA",
		"parsed": "<punctuation.definition.list.begin.markdown>;</><meta.tag.inline.b.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></>foo:bar\\n<punctuation.definition.list.begin.markdown>;</><punctuation.definition.tag.convert>-{</>zh-cn:AAA"
	},
	{
		"desc": "T153135: Nested language converter markup in definition list (code coverage)",
		"wikitext": ";-{|zh-cn:AAA -{zh-hans|foo:bar}- -{R|bat:baz}-}-:def",
		"parsed": "<punctuation.definition.list.begin.markdown>;</><punctuation.definition.tag.convert>-{</><keyword.operator>|</><entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>AAA <punctuation.definition.tag.convert>-{</><entity.name.function.type>zh-hans</><keyword.operator>|</>foo:bar<punctuation.definition.tag.convert>}-</> <punctuation.definition.tag.convert>-{</><entity.name.function.type>R</><keyword.operator>|</>bat:baz<punctuation.definition.tag.convert>}-</>}-:def"
	},
	{
		"desc": "Language converter tricky html2wt cases (5)",
		"wikitext": "-{H|<nowiki>a:b=>c</nowiki>=>zh-cn:<nowiki>x;foo=>zh-cn:boo</nowiki>;bar=>zh-cn:<nowiki>bat;xyz=>zh-cn:abc</nowiki>}-foobar\n\n-{H|A=><nowiki>bo:g;us</nowiki>:B}-\n\n-{A|zh-tw:xyz; zh-cn:<nowiki>0;zh-tw:bar</nowiki>}-\n\n-{<nowiki>bo:g;us</nowiki>:xyz; zh-cn:abc}-\n\na:b=>c xyz",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.function.type>H</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>a:b=&gtc</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>=&gt<entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>x</><punctuation.terminator.rule>;</>foo=&gt<entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>boo<meta.tag.other.nowiki.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>nowiki</></><punctuation.definition.tag.end.html>&gt</></><punctuation.terminator.rule>;</>bar=&gt<entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>bat</><punctuation.terminator.rule>;</>xyz=&gt<entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>abc<meta.tag.other.nowiki.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>nowiki</></><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.convert>}-</>foobar\\n\\n<punctuation.definition.tag.convert>-{</><entity.name.function.type>H</><keyword.operator>|</>A=&gt<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>bo:g;us</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>:B<punctuation.definition.tag.convert>}-\\n\\n-{</><entity.name.function.type>A</><keyword.operator>|</><entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>xyz<punctuation.terminator.rule>;</> <entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>0</><punctuation.terminator.rule>;</><entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>bar<meta.tag.other.nowiki.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>nowiki</></><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.convert>}-\\n\\n-{</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>bo:g;us</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>:xyz; <entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>abc<punctuation.definition.tag.convert>}-\\n\\n</>a:b=&gtc xyz"
	},
	{
		"desc": "T239806: Trailing garbage in language converter rules (1)",
		"wikitext": "-{H|zh-cn:çº¦ç¿°Â·å¡çº³; zh-hk:èŠÂ·å…ˆæ‹¿; zh-tw:ç´„ç¿°Â·å¸Œå—; ;}-\n-{H|zh-cn:æ³°ç‘æ–¯Â·å‰å¸ƒæ£®; zh-hk:æ³°åˆ—æ–¯Â·å‰éœ; zh-tw:æ³°ç‘æ–¯Â·å‰å¸ƒæ£®; ;}-\n-{H|zh-cn:é‡‘Â·ç±³å°”ç¦ç‰¹; zh-tw:é‡‘Â·ç±³çˆ¾ç¦ç‰¹; çœŸÂ·ç±³çˆ¾ç¦ç‰¹;}-",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.function.type>H</><keyword.operator>|</><entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>çº¦ç¿°Â·å¡çº³<punctuation.terminator.rule>;</> <entity.name.tag.language>zh-hk</><punctuation.separator.key-value>:</>èŠÂ·å…ˆæ‹¿<punctuation.terminator.rule>;</> <entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>ç´„ç¿°Â·å¸Œå—<punctuation.terminator.rule>;</> ;<punctuation.definition.tag.convert>}-\\n-{</><entity.name.function.type>H</><keyword.operator>|</><entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>æ³°ç‘æ–¯Â·å‰å¸ƒæ£®<punctuation.terminator.rule>;</> <entity.name.tag.language>zh-hk</><punctuation.separator.key-value>:</>æ³°åˆ—æ–¯Â·å‰éœ<punctuation.terminator.rule>;</> <entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>æ³°ç‘æ–¯Â·å‰å¸ƒæ£®<punctuation.terminator.rule>;</> ;<punctuation.definition.tag.convert>}-\\n-{</><entity.name.function.type>H</><keyword.operator>|</><entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>é‡‘Â·ç±³å°”ç¦ç‰¹<punctuation.terminator.rule>;</> <entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>é‡‘Â·ç±³çˆ¾ç¦ç‰¹<punctuation.terminator.rule>;</> çœŸÂ·ç±³çˆ¾ç¦ç‰¹;<punctuation.definition.tag.convert>}-</>"
	},
	{
		"desc": "T239806: Trailing garbage in language converter rules (2)",
		"wikitext": "-{H|zh-cn:ç›æ ¼ç‰¹Â·ç½—æ¯”; zh-tw:ç‘ªæ ¼Â·ç¾…æ¯”; zh-hk:ç‘ªæ­ŒÂ·ç¾…æ¯”; zh-sg:ç›æ ¼Â·ç½—æ¯”; ;}-",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.function.type>H</><keyword.operator>|</><entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>ç›æ ¼ç‰¹Â·ç½—æ¯”<punctuation.terminator.rule>;</> <entity.name.tag.language>zh-tw</><punctuation.separator.key-value>:</>ç‘ªæ ¼Â·ç¾…æ¯”<punctuation.terminator.rule>;</> <entity.name.tag.language>zh-hk</><punctuation.separator.key-value>:</>ç‘ªæ­ŒÂ·ç¾…æ¯”<punctuation.terminator.rule>;</> <entity.name.tag.language>zh-sg</><punctuation.separator.key-value>:</>ç›æ ¼Â·ç½—æ¯”<punctuation.terminator.rule>;</> ;<punctuation.definition.tag.convert>}-</>"
	},
	{
		"desc": "Langconvert tag: crh-latn to crh-cyrl",
		"wikitext": "<langconvert from=\"crh-latn\" to=\"crh-cyrl\">test</langconvert>",
		"parsed": "<meta.tag.other.langconvert.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>langconvert</></> <meta.attribute.unrecognized.from.html><entity.other.attribute-name.html>from</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>crh-latn<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.to.html><entity.other.attribute-name.html>to</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>crh-cyrl<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>test<meta.tag.other.langconvert.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>langconvert</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Langconvert tag: en to en-x-piglatin",
		"wikitext": "<langconvert from=\"en\" to=\"en-x-piglatin\">test</langconvert>",
		"parsed": "<meta.tag.other.langconvert.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>langconvert</></> <meta.attribute.unrecognized.from.html><entity.other.attribute-name.html>from</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>en<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.to.html><entity.other.attribute-name.html>to</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>en-x-piglatin<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>test<meta.tag.other.langconvert.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>langconvert</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Langconvert tag: gan-hans to gan-hant",
		"wikitext": "<langconvert from=\"gan-hans\" to=\"gan-hant\">çˆ±</langconvert>",
		"parsed": "<meta.tag.other.langconvert.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>langconvert</></> <meta.attribute.unrecognized.from.html><entity.other.attribute-name.html>from</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>gan-hans<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.to.html><entity.other.attribute-name.html>to</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>gan-hant<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>çˆ±<meta.tag.other.langconvert.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>langconvert</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Langconvert tag: ku-latn to ku-arab",
		"wikitext": "<langconvert from=\"ku-latn\" to=\"ku-arab\">test</langconvert>",
		"parsed": "<meta.tag.other.langconvert.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>langconvert</></> <meta.attribute.unrecognized.from.html><entity.other.attribute-name.html>from</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>ku-latn<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.to.html><entity.other.attribute-name.html>to</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>ku-arab<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>test<meta.tag.other.langconvert.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>langconvert</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Langconvert tag: shi-latn to shi-tfng",
		"wikitext": "<langconvert from=\"shi-latn\" to=\"shi-tfng\">test</langconvert>",
		"parsed": "<meta.tag.other.langconvert.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>langconvert</></> <meta.attribute.unrecognized.from.html><entity.other.attribute-name.html>from</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>shi-latn<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.to.html><entity.other.attribute-name.html>to</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>shi-tfng<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>test<meta.tag.other.langconvert.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>langconvert</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Langconvert tag: sr-latn to sr-cyrl",
		"wikitext": "<langconvert from=\"sr-latn\" to=\"sr-cyrl\">zdravo</langconvert>",
		"parsed": "<meta.tag.other.langconvert.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>langconvert</></> <meta.attribute.unrecognized.from.html><entity.other.attribute-name.html>from</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>sr-latn<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.to.html><entity.other.attribute-name.html>to</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>sr-cyrl<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>zdravo<meta.tag.other.langconvert.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>langconvert</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Langconvert tag: sr-el to sr-ec (should fail)",
		"wikitext": "<langconvert from=\"sr-el\" to=\"sr-ec\">zdravo</langconvert>",
		"parsed": "<meta.tag.other.langconvert.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>langconvert</></> <meta.attribute.unrecognized.from.html><entity.other.attribute-name.html>from</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>sr-el<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.to.html><entity.other.attribute-name.html>to</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>sr-ec<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>zdravo<meta.tag.other.langconvert.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>langconvert</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Langconvert tag: tg to tg-latn",
		"wikitext": "<langconvert from=\"tg\" to=\"tg-latn\">Ñ‚ĞµÑÑ‚</langconvert>",
		"parsed": "<meta.tag.other.langconvert.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>langconvert</></> <meta.attribute.unrecognized.from.html><entity.other.attribute-name.html>from</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>tg<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.to.html><entity.other.attribute-name.html>to</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>tg-latn<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>Ñ‚ĞµÑÑ‚<meta.tag.other.langconvert.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>langconvert</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Langconvert tag: uz-cyrl to uz-latn",
		"wikitext": "<langconvert from=\"uz-cyrl\" to=\"uz-latn\">Ñ‚ĞµÑÑ‚</langconvert>",
		"parsed": "<meta.tag.other.langconvert.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>langconvert</></> <meta.attribute.unrecognized.from.html><entity.other.attribute-name.html>from</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>uz-cyrl<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.to.html><entity.other.attribute-name.html>to</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>uz-latn<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>Ñ‚ĞµÑÑ‚<meta.tag.other.langconvert.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>langconvert</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Langconvert tag: zh-hans to zh-hant",
		"wikitext": "<langconvert from=\"zh-hans\" to=\"zh-hant\">çˆ±</langconvert>",
		"parsed": "<meta.tag.other.langconvert.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>langconvert</></> <meta.attribute.unrecognized.from.html><entity.other.attribute-name.html>from</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>zh-hans<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.to.html><entity.other.attribute-name.html>to</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>zh-hant<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>çˆ±<meta.tag.other.langconvert.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>langconvert</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Langconvert tag: self-closed",
		"wikitext": "x<langconvert from=\"crh-latn\" to=\"crh-cyrl\"/>x",
		"parsed": "x<punctuation.definition.tag.begin>&lt;</><entity.name.tag>langconvert</> <meta.attribute.unrecognized.from.html><entity.other.attribute-name.html>from</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>crh-latn<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.to.html><entity.other.attribute-name.html>to</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>crh-cyrl<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>/&gt</>x"
	},
	{
		"desc": "T302678: Serialize empty twoway",
		"wikitext": "-{H|}-",
		"parsed": "<punctuation.definition.tag.convert>-{</><entity.name.function.type>H</><keyword.operator>|</><punctuation.definition.tag.convert>}-</>"
	},
	{
		"desc": "luaParserTests"
	},
	{
		"desc": "Scribunto: no such module",
		"wikitext": "{{#invoke:foo|bar}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>foo<keyword.operator>|</>bar<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: no such function",
		"wikitext": "{{#invoke:test|blah}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>blah<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: hello world",
		"wikitext": "{{#invoke:test|hello}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>hello<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: redirect to hello world",
		"wikitext": "{{#invoke:redirected|hello}}\n{{#invoke:redirected \"with\" quotes|hello}}\n{{#invoke:redirected|testIsRedirect|Module:Redirected}}\n{{#invoke:redirected \"with\" quotes|testIsRedirect|Module:Test \"with\" quotes}}\n{{#invoke:redirected \"with\" quotes|testIsRedirect|Module:Redirected \"with\" quotes}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>redirected<keyword.operator>|</>hello<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>redirected \"with\" quotes<keyword.operator>|</>hello<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>redirected<keyword.operator>|</>testIsRedirect<keyword.operator>|</>Module:Redirected<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>redirected \"with\" quotes<keyword.operator>|</>testIsRedirect<keyword.operator>|</>Module:Test \"with\" quotes<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>redirected \"with\" quotes<keyword.operator>|</>testIsRedirect<keyword.operator>|</>Module:Redirected \"with\" quotes<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: getAllArgs",
		"wikitext": "{{#invoke:test|getAllArgs|x|y|z|a=1|b=2|c=3|7=?}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>getAllArgs<keyword.operator>|</>x<keyword.operator>|</>y<keyword.operator>|</>z<keyword.operator>|</>a=1<keyword.operator>|</>b=2<keyword.operator>|</>c=3<keyword.operator>|</>7=?<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: getAllArgs, deprecated style",
		"wikitext": "{{#invoke:test|getAllArgs2|x|y|z|a=1|b=2|c=3|7=?}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>getAllArgs2<keyword.operator>|</>x<keyword.operator>|</>y<keyword.operator>|</>z<keyword.operator>|</>a=1<keyword.operator>|</>b=2<keyword.operator>|</>c=3<keyword.operator>|</>7=?<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: getNumericArgs",
		"wikitext": "{{#invoke:test|getNumericArgs|x|y|z|a=1|b=2|c=3|7=?}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>getNumericArgs<keyword.operator>|</>x<keyword.operator>|</>y<keyword.operator>|</>z<keyword.operator>|</>a=1<keyword.operator>|</>b=2<keyword.operator>|</>c=3<keyword.operator>|</>7=?<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: named numeric parameters",
		"wikitext": "{{#invoke:test|getArg|2|a|2=b}}\n{{#invoke:test|getArg|2|2=a|b}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>getArg<keyword.operator>|</>2<keyword.operator>|</>a<keyword.operator>|</>2=b<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>getArg<keyword.operator>|</>2<keyword.operator>|</>2=a<keyword.operator>|</>b<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: template-style argument trimming",
		"wikitext": "{{#invoke:test|getArgLength|2| x }}\n{{#invoke:test|getArgLength|2|2= x }}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>getArgLength<keyword.operator>|</>2<keyword.operator>|</> x <punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>getArgLength<keyword.operator>|</>2<keyword.operator>|</>2= x <punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: missing argument",
		"wikitext": "{{#invoke:test|getArgType|2}}\n{{#invoke:test|getArgType|blah}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>getArgType<keyword.operator>|</>2<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>getArgType<keyword.operator>|</>blah<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: parent frame access",
		"wikitext": "{{Scribunto_all_args|x|y|z|a = 1|b = 2|c = 3}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Scribunto_all_args</><keyword.operator>|</>x<keyword.operator>|</>y<keyword.operator>|</>z<keyword.operator>|</><entity.other.attribute-name.local-name>a </><keyword.operator.equal>=</> 1<keyword.operator>|</><entity.other.attribute-name.local-name>b </><keyword.operator.equal>=</> 2<keyword.operator>|</><entity.other.attribute-name.local-name>c </><keyword.operator.equal>=</> 3<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Scribunto: expandTemplate",
		"wikitext": "{{#invoke:test|testExpandTemplate}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>testExpandTemplate<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: expandTemplate with headers",
		"wikitext": "==foo==\n{{#invoke:test|testExpandTemplateWithHeaders}}",
		"parsed": "<markup.heading>==<string.quoted.other.heading>foo</>==\\n</><punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>testExpandTemplateWithHeaders<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: newTemplateParserValue",
		"wikitext": "{{#invoke:test|testNewTemplateParserValue}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>testNewTemplateParserValue<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: preprocess",
		"wikitext": "{{#invoke:test|testPreprocess|foo}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>testPreprocess<keyword.operator>|</>foo<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: newParserValue",
		"wikitext": "{{#invoke:test|testNewParserValue|foo}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>testNewParserValue<keyword.operator>|</>foo<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: table return",
		"wikitext": "{{#invoke:test|emptyTable}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>emptyTable<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: require",
		"wikitext": "{{#invoke:test|import}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>import<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: access to a module imported at the chunk level",
		"wikitext": "{{#invoke:test|bitop}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>bitop<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: invoke instance upvalue isolation",
		"wikitext": "{{#invoke:test|isolationTestUpvalue|1}}\n{{#invoke:test|isolationTestUpvalue|2}}\n{{#invoke:test|isolationTestUpvalue|3}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>isolationTestUpvalue<keyword.operator>|</>1<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>isolationTestUpvalue<keyword.operator>|</>2<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>isolationTestUpvalue<keyword.operator>|</>3<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: invoke instance global isolation",
		"wikitext": "{{#invoke:test|isolationTestGlobal|1}}\n{{#invoke:test|isolationTestGlobal|2}}\n{{#invoke:test|isolationTestGlobal|3}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>isolationTestGlobal<keyword.operator>|</>1<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>isolationTestGlobal<keyword.operator>|</>2<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>isolationTestGlobal<keyword.operator>|</>3<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: ASCII null",
		"wikitext": "{{#invoke:test|null}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>null<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: isSubsting during PST",
		"wikitext": "{{safesubst:#invoke:test|isSubsting}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>safesubst</><keyword.operator.function>:</>#invoke:test<keyword.operator>|</>isSubsting<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: isSubsting during normal parse",
		"wikitext": "{{safesubst:#invoke:test|isSubsting}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>safesubst</><keyword.operator.function>:</>#invoke:test<keyword.operator>|</>isSubsting<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: frame:getTitle",
		"wikitext": "{{#invoke:test|getFrameTitle}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>getFrameTitle<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: Metatable on export table",
		"wikitext": "{{#invoke:Metatables|zero}}\n{{#invoke:Metatables|one}}\n{{#invoke:Metatables|two}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>Metatables<keyword.operator>|</>zero<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>Metatables<keyword.operator>|</>one<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>Metatables<keyword.operator>|</>two<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: Correct argument numbering with equals sign in function name",
		"wikitext": "{{#invoke:test|test=InFunctionName|good|bad}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>test=InFunctionName<keyword.operator>|</>good<keyword.operator>|</>bad<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: Strip markers in CSS",
		"wikitext": "{{#invoke:test|testStrippedCss|<nowiki>#ff0000</nowiki>}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>testStrippedCss<keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>#ff0000</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Scribunto: Parser output isn't incorrectly cached across frames",
		"wikitext": "Root: {{#invoke:test|testFrameCaching}} Template: {{Scribunto frame caching}}",
		"parsed": "Root: <punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>test<keyword.operator>|</>testFrameCaching<punctuation.definition.tag.function>}}</> Template: <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Scribunto frame caching</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Scribunto: Test unstripNowiki behavior",
		"wikitext": "{{#invoke:EchoTest|echo|<nowiki>foo</nowiki>}}\n{{#invoke:EchoTest|echo|<nowiki>[[Foo]]</nowiki>}}\n\n{{#invoke:UnstripTest|unstrip|<nowiki>foo</nowiki>}}\n{{#invoke:UnstripTest|unstrip|<nowiki>[[Foo]]</nowiki>}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>EchoTest<keyword.operator>|</>echo<keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>EchoTest<keyword.operator>|</>echo<keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>[[Foo]]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.function>}}\\n\\n{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>UnstripTest<keyword.operator>|</>unstrip<keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#invoke</><keyword.operator.function>:</>UnstripTest<keyword.operator>|</>unstrip<keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>[[Foo]]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "magicLinks"
	},
	{
		"desc": "Magic links: internal link to RFC (T2479)",
		"wikitext": "[[RFC 123]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>RFC 123</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Magic links: RFC (T2479)",
		"wikitext": "RFC 822",
		"parsed": "<constant.language.variables.rfc>RFC 822</>"
	},
	{
		"desc": "Magic links: RFC (T67278)",
		"wikitext": "This is RFC 822 but thisRFC 822 is not RFC 822linked.",
		"parsed": "This is <constant.language.variables.rfc>RFC 822</> but this<constant.language.variables.rfc>RFC 822</> is not <constant.language.variables.rfc>RFC 822</>linked."
	},
	{
		"desc": "Magic links: RFC (w/ non-newline whitespace, T30950/T31025)",
		"wikitext": "RFC &nbsp;&#160;&#0160;&#xA0;&#Xa0; 822\nRFC\n822",
		"parsed": "RFC <constant.character.entity.named.nbsp.html><punctuation.definition.entity.html>&amp;</>nbsp<punctuation.definition.entity.html>;</></><constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#160;<punctuation.definition.entity.html>&amp;</>#0160;</><constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#xA0;<punctuation.definition.entity.html>&amp;</>#Xa0;</> 822\\nRFC\\n822"
	},
	{
		"desc": "Magic links: ISBN (T3937)",
		"wikitext": "ISBN 0-306-40615-2",
		"parsed": "<constant.language.variables.isbn>ISBN 0-306-40615-2</>"
	},
	{
		"desc": "Magic links: ISBN (T67278)",
		"wikitext": "This is ISBN 978-0-316-09811-3 but thisISBN 978-0-316-09811-3 is not ISBN 978-0-316-09811-3linked.",
		"parsed": "This is <constant.language.variables.isbn>ISBN 978-0-316-09811-3</> but this<constant.language.variables.isbn>ISBN 978-0-316-09811-3</> is not <constant.language.variables.isbn>ISBN 978-0-316-09811-3</>linked."
	},
	{
		"desc": "Magic links: ISBN (w/ non-newline whitespace, T30950/T31025)",
		"wikitext": "ISBN &nbsp;&#160;&#0160;&#xA0;&#Xa0; 978&nbsp;0&#160;316&#0160;09811&#xA0;3\nISBN\n9780316098113\nISBN 978\n0316098113",
		"parsed": "ISBN <constant.character.entity.named.nbsp.html><punctuation.definition.entity.html>&amp;</>nbsp<punctuation.definition.entity.html>;</></><constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#160;<punctuation.definition.entity.html>&amp;</>#0160;</><constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#xA0;<punctuation.definition.entity.html>&amp;</>#Xa0;</> 978<constant.character.entity.named.nbsp.html><punctuation.definition.entity.html>&amp;</>nbsp<punctuation.definition.entity.html>;</></>0<constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#160;</>316<constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#0160;</>09811<constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#xA0;</>3\\nISBN\\n9780316098113\\nISBN 978\\n0316098113"
	},
	{
		"desc": "Magic links: PMID incorrectly converts space to underscore",
		"wikitext": "PMID 1234",
		"parsed": "<constant.language.variables.pmid>PMID 1234</>"
	},
	{
		"desc": "Magic links: PMID (T67278)",
		"wikitext": "This is PMID 1234 but thisPMID 1234 is not PMID 1234linked.",
		"parsed": "This is <constant.language.variables.pmid>PMID 1234</> but this<constant.language.variables.pmid>PMID 1234</> is not <constant.language.variables.pmid>PMID 1234</>linked."
	},
	{
		"desc": "Magic links: PMID (w/ non-newline whitespace, T30950/T31025)",
		"wikitext": "PMID &nbsp;&#160;&#0160;&#xA0;&#Xa0; 1234\nPMID\n1234",
		"parsed": "PMID <constant.character.entity.named.nbsp.html><punctuation.definition.entity.html>&amp;</>nbsp<punctuation.definition.entity.html>;</></><constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#160;<punctuation.definition.entity.html>&amp;</>#0160;</><constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#xA0;<punctuation.definition.entity.html>&amp;</>#Xa0;</> 1234\\nPMID\\n1234"
	},
	{
		"desc": "Magic links: use appropriate serialization for \"almost\" magic links.",
		"wikitext": "X[[Special:BookSources/0978739256|foo]]\n\nX[https://tools.ietf.org/html/rfc1234 foo]",
		"parsed": "X<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Special:</><entity.other.attribute-name>BookSources/0978739256</><keyword.operator>|</>foo<punctuation.definition.tag.link.internal>]]\\n\\n</></>X<punctuation.definition.tag.link.external>[</><entity.name.tag.url>https://tools.ietf.org/html/rfc1234</><string.other.link.external.title> foo</><punctuation.definition.tag.link.external>]</>"
	},
	{
		"desc": "Magic links: All disabled (T47942)",
		"wikitext": "ISBN 0-306-40615-2\nPMID 1234\nRFC 4321",
		"parsed": "<constant.language.variables.isbn>ISBN 0-306-40615-2\\n</><constant.language.variables.pmid>PMID 1234\\n</><constant.language.variables.rfc>RFC 4321</>"
	},
	{
		"desc": "magicWords"
	},
	{
		"desc": "Magic Word: {{CURRENTDAY}}",
		"wikitext": "{{CURRENTDAY}}",
		"parsed": "<constant.language.variables.metadata>{{CURRENTDAY}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTDAY2}}",
		"wikitext": "{{CURRENTDAY2}}",
		"parsed": "<constant.language.variables.metadata>{{CURRENTDAY2}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTDAYNAME}}",
		"wikitext": "{{CURRENTDAYNAME}}",
		"parsed": "<constant.language.variables.metadata>{{CURRENTDAYNAME}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTDOW}}",
		"wikitext": "{{CURRENTDOW}}",
		"parsed": "<constant.language.variables.metadata>{{CURRENTDOW}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTMONTH}}",
		"wikitext": "{{CURRENTMONTH}}",
		"parsed": "<constant.language.variables.metadata>{{CURRENTMONTH}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTMONTH1}}",
		"wikitext": "{{CURRENTMONTH1}}",
		"parsed": "<constant.language.variables.metadata>{{CURRENTMONTH1}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTMONTHABBREV}}",
		"wikitext": "{{CURRENTMONTHABBREV}}",
		"parsed": "<constant.language.variables.metadata>{{CURRENTMONTHABBREV}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTMONTHNAME}}",
		"wikitext": "{{CURRENTMONTHNAME}}",
		"parsed": "<constant.language.variables.metadata>{{CURRENTMONTHNAME}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTMONTHNAMEGEN}}",
		"wikitext": "{{CURRENTMONTHNAMEGEN}}",
		"parsed": "<constant.language.variables.metadata>{{CURRENTMONTHNAMEGEN}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTTIME}}",
		"wikitext": "{{CURRENTTIME}}",
		"parsed": "<constant.language.variables.metadata>{{CURRENTTIME}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTHOUR}}",
		"wikitext": "{{CURRENTHOUR}}",
		"parsed": "<constant.language.variables.metadata>{{CURRENTHOUR}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTWEEK}} (T6594)",
		"wikitext": "{{CURRENTWEEK}}",
		"parsed": "<constant.language.variables.metadata>{{CURRENTWEEK}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTYEAR}}",
		"wikitext": "{{CURRENTYEAR}}",
		"parsed": "<constant.language.variables.metadata>{{CURRENTYEAR}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTTIMESTAMP}}",
		"wikitext": "{{CURRENTTIMESTAMP}}",
		"parsed": "<constant.language.variables.metadata>{{CURRENTTIMESTAMP}}</>"
	},
	{
		"desc": "Magic Words LOCAL (UTC)",
		"wikitext": "*{{LOCALMONTH}}\n*{{LOCALMONTH1}}\n*{{LOCALMONTHNAME}}\n*{{LOCALMONTHNAMEGEN}}\n*{{LOCALMONTHABBREV}}\n*{{LOCALDAY}}\n*{{LOCALDAY2}}\n*{{LOCALDAYNAME}}\n*{{LOCALYEAR}}\n*{{LOCALTIME}}\n*{{LOCALHOUR}}\n*{{LOCALWEEK}}\n*{{LOCALDOW}}\n*{{LOCALTIMESTAMP}}",
		"parsed": "<punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{LOCALMONTH}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{LOCALMONTH1}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{LOCALMONTHNAME}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{LOCALMONTHNAMEGEN}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{LOCALMONTHABBREV}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{LOCALDAY}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{LOCALDAY2}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{LOCALDAYNAME}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{LOCALYEAR}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{LOCALTIME}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{LOCALHOUR}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{LOCALWEEK}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{LOCALDOW}}\\n</><punctuation.definition.list.begin.markdown>*</><constant.language.variables.metadata>{{LOCALTIMESTAMP}}</>"
	},
	{
		"desc": "Magic Word: {{FULLPAGENAME}}",
		"wikitext": "{{FULLPAGENAME}}",
		"parsed": "<constant.language.variables.metadata>{{FULLPAGENAME}}</>"
	},
	{
		"desc": "Magic Word: {{FULLPAGENAMEE}}",
		"wikitext": "{{FULLPAGENAMEE}}",
		"parsed": "<constant.language.variables.metadata>{{FULLPAGENAMEE}}</>"
	},
	{
		"desc": "Magic Word: {{TALKSPACE}}",
		"wikitext": "{{TALKSPACE}}",
		"parsed": "<constant.language.variables.metadata>{{TALKSPACE}}</>"
	},
	{
		"desc": "Magic Word: {{TALKSPACE}}, same namespace",
		"wikitext": "{{TALKSPACE}}",
		"parsed": "<constant.language.variables.metadata>{{TALKSPACE}}</>"
	},
	{
		"desc": "Magic Word: {{TALKSPACE}}, main namespace",
		"wikitext": "{{TALKSPACE}}",
		"parsed": "<constant.language.variables.metadata>{{TALKSPACE}}</>"
	},
	{
		"desc": "Magic Word: {{TALKSPACEE}}",
		"wikitext": "{{TALKSPACEE}}",
		"parsed": "<constant.language.variables.metadata>{{TALKSPACEE}}</>"
	},
	{
		"desc": "Magic Word: {{SUBJECTSPACE}}",
		"wikitext": "{{SUBJECTSPACE}}",
		"parsed": "<constant.language.variables.metadata>{{SUBJECTSPACE}}</>"
	},
	{
		"desc": "Magic Word: {{SUBJECTSPACE}}, same namespace",
		"wikitext": "{{SUBJECTSPACE}}",
		"parsed": "<constant.language.variables.metadata>{{SUBJECTSPACE}}</>"
	},
	{
		"desc": "Magic Word: {{SUBJECTSPACE}}, main namespace",
		"wikitext": "{{SUBJECTSPACE}}",
		"parsed": "<constant.language.variables.metadata>{{SUBJECTSPACE}}</>"
	},
	{
		"desc": "Magic Word: {{SUBJECTSPACEE}}",
		"wikitext": "{{SUBJECTSPACEE}}",
		"parsed": "<constant.language.variables.metadata>{{SUBJECTSPACEE}}</>"
	},
	{
		"desc": "Magic Word: {{NAMESPACE}}",
		"wikitext": "{{NAMESPACE}}",
		"parsed": "<constant.language.variables.metadata>{{NAMESPACE}}</>"
	},
	{
		"desc": "Magic Word: {{NAMESPACEE}}",
		"wikitext": "{{NAMESPACEE}}",
		"parsed": "<constant.language.variables.metadata>{{NAMESPACEE}}</>"
	},
	{
		"desc": "Magic Word: {{NAMESPACENUMBER}}",
		"wikitext": "{{NAMESPACENUMBER}}",
		"parsed": "<constant.language.variables.metadata>{{NAMESPACENUMBER}}</>"
	},
	{
		"desc": "Magic Word: {{SUBPAGENAME}}",
		"wikitext": "{{SUBPAGENAME}}",
		"parsed": "<constant.language.variables.metadata>{{SUBPAGENAME}}</>"
	},
	{
		"desc": "Magic Word: {{SUBPAGENAMEE}}",
		"wikitext": "{{SUBPAGENAMEE}}",
		"parsed": "<constant.language.variables.metadata>{{SUBPAGENAMEE}}</>"
	},
	{
		"desc": "Magic Word: {{ROOTPAGENAME}}",
		"wikitext": "{{ROOTPAGENAME}}",
		"parsed": "<constant.language.variables.metadata>{{ROOTPAGENAME}}</>"
	},
	{
		"desc": "Magic Word: {{ROOTPAGENAMEE}}",
		"wikitext": "{{ROOTPAGENAMEE}}",
		"parsed": "<constant.language.variables.metadata>{{ROOTPAGENAMEE}}</>"
	},
	{
		"desc": "Magic Word: {{BASEPAGENAME}}",
		"wikitext": "{{BASEPAGENAME}}",
		"parsed": "<constant.language.variables.metadata>{{BASEPAGENAME}}</>"
	},
	{
		"desc": "Magic Word: {{BASEPAGENAMEE}}",
		"wikitext": "{{BASEPAGENAMEE}}",
		"parsed": "<constant.language.variables.metadata>{{BASEPAGENAMEE}}</>"
	},
	{
		"desc": "Magic Word: {{TALKPAGENAME}}",
		"wikitext": "{{TALKPAGENAME}}",
		"parsed": "<constant.language.variables.metadata>{{TALKPAGENAME}}</>"
	},
	{
		"desc": "Magic Word: {{TALKPAGENAMEE}}",
		"wikitext": "{{TALKPAGENAMEE}}",
		"parsed": "<constant.language.variables.metadata>{{TALKPAGENAMEE}}</>"
	},
	{
		"desc": "Magic Word: {{SUBJECTPAGENAME}}",
		"wikitext": "{{SUBJECTPAGENAME}}",
		"parsed": "<constant.language.variables.metadata>{{SUBJECTPAGENAME}}</>"
	},
	{
		"desc": "Magic Word: {{SUBJECTPAGENAMEE}}",
		"wikitext": "{{SUBJECTPAGENAMEE}}",
		"parsed": "<constant.language.variables.metadata>{{SUBJECTPAGENAMEE}}</>"
	},
	{
		"desc": "Magic Word: {{NUMBEROFFILES}}",
		"wikitext": "{{NUMBEROFFILES}}",
		"parsed": "<constant.language.variables.metadata>{{NUMBEROFFILES}}</>"
	},
	{
		"desc": "Magic Word: {{PAGENAME}}",
		"wikitext": "{{PAGENAME}}",
		"parsed": "<constant.language.variables.metadata>{{PAGENAME}}</>"
	},
	{
		"desc": "Magic Word: {{PAGENAME}} with metacharacters",
		"wikitext": "''{{PAGENAME}}''",
		"parsed": "<markup.italic>''</><constant.language.variables.metadata>{{PAGENAME}}</><markup.italic>''</>"
	},
	{
		"desc": "Magic Word: {{PAGENAME}} with metacharacters (T28781)",
		"wikitext": "{{PAGENAME}}",
		"parsed": "<constant.language.variables.metadata>{{PAGENAME}}</>"
	},
	{
		"desc": "Magic Word: {{PAGENAMEE}}",
		"wikitext": "{{PAGENAMEE}}",
		"parsed": "<constant.language.variables.metadata>{{PAGENAMEE}}</>"
	},
	{
		"desc": "Magic Word: {{PAGENAMEE}} with metacharacters (T28781)",
		"wikitext": "{{PAGENAMEE}}",
		"parsed": "<constant.language.variables.metadata>{{PAGENAMEE}}</>"
	},
	{
		"desc": "Magic Word: {{REVISIONID}} on latest revision",
		"wikitext": "{{REVISIONID}}",
		"parsed": "<constant.language.variables.metadata>{{REVISIONID}}</>"
	},
	{
		"desc": "Magic Word: {{REVISIONID}} on non-latest revision",
		"wikitext": "{{REVISIONID}}",
		"parsed": "<constant.language.variables.metadata>{{REVISIONID}}</>"
	},
	{
		"desc": "Magic Word: {{REVISIONTIMESTAMP}} on latest revision",
		"wikitext": "{{REVISIONTIMESTAMP}}",
		"parsed": "<constant.language.variables.metadata>{{REVISIONTIMESTAMP}}</>"
	},
	{
		"desc": "Magic Word: {{REVISIONTIMESTAMP:{{PAGENAME}}}} on latest revision",
		"wikitext": "{{REVISIONTIMESTAMP:{{PAGENAME}}}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONTIMESTAMP</><keyword.operator.function>:</><constant.language.variables.metadata>{{PAGENAME}}</><punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Magic Word: {{REVISIONTIMESTAMP}} on not-yet-existing current page",
		"wikitext": "{{REVISIONTIMESTAMP}}",
		"parsed": "<constant.language.variables.metadata>{{REVISIONTIMESTAMP}}</>"
	},
	{
		"desc": "Magic Word: {{REVISIONTIMESTAMP:{{PAGENAME}}}} on not-yet-existing current page",
		"wikitext": "{{REVISIONTIMESTAMP:{{PAGENAME}}}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONTIMESTAMP</><keyword.operator.function>:</><constant.language.variables.metadata>{{PAGENAME}}</><punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Magic Word: {{REVISIONTIMESTAMP:...}}} on non-existing non-current page",
		"wikitext": "{{REVISIONTIMESTAMP:This page does not exist}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONTIMESTAMP</><keyword.operator.function>:</>This page does not exist<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Magic Word: {{REVISIONUSER}} on latest revision",
		"wikitext": "{{REVISIONUSER}}",
		"parsed": "<constant.language.variables.metadata>{{REVISIONUSER}}</>"
	},
	{
		"desc": "Magic Word: {{REVISIONUSER}} on not-yet-existing current page",
		"wikitext": "{{REVISIONUSER}}",
		"parsed": "<constant.language.variables.metadata>{{REVISIONUSER}}</>"
	},
	{
		"desc": "Magic Word: {{REVISIONUSER:{{PAGENAME}}}} on not-yet-existing current page",
		"wikitext": "{{REVISIONUSER:{{PAGENAME}}}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONUSER</><keyword.operator.function>:</><constant.language.variables.metadata>{{PAGENAME}}</><punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Magic Word: {{REVISIONUSER:...}} on non-existing non-current page",
		"wikitext": "{{REVISIONUSER:This page does not exist}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONUSER</><keyword.operator.function>:</>This page does not exist<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Magic Word: {{REVISIONUSER}} on non-latest revision",
		"wikitext": "{{REVISIONUSER}}",
		"parsed": "<constant.language.variables.metadata>{{REVISIONUSER}}</>"
	},
	{
		"desc": "Parser Function: {{REVISIONID:{{PAGENAME}}}} on latest revision",
		"wikitext": "{{REVISIONID:{{PAGENAME}}}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONID</><keyword.operator.function>:</><constant.language.variables.metadata>{{PAGENAME}}</><punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Parser Function: {{REVISIONID:{{PAGENAME}}}} on non-saved revision",
		"wikitext": "{{REVISIONID:{{PAGENAME}}}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONID</><keyword.operator.function>:</><constant.language.variables.metadata>{{PAGENAME}}</><punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Parser Function: {{REVISIONDAY}} on latest revision",
		"wikitext": "{{REVISIONDAY}}",
		"parsed": "<constant.language.variables.metadata>{{REVISIONDAY}}</>"
	},
	{
		"desc": "Parser Function: {{REVISIONDAY:{{PAGENAME}}}} on latest revision",
		"wikitext": "{{REVISIONDAY:{{PAGENAME}}}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONDAY</><keyword.operator.function>:</><constant.language.variables.metadata>{{PAGENAME}}</><punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Parser Function: {{REVISIONMONTH}} on latest revision",
		"wikitext": "{{REVISIONMONTH}}",
		"parsed": "<constant.language.variables.metadata>{{REVISIONMONTH}}</>"
	},
	{
		"desc": "Parser Function: {{REVISIONMONTH:{{PAGENAME}}}} on latest revision",
		"wikitext": "{{REVISIONMONTH:{{PAGENAME}}}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONMONTH</><keyword.operator.function>:</><constant.language.variables.metadata>{{PAGENAME}}</><punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Parser Function: {{REVISIONYEAR:{{PAGENAME}}}} on latest revision",
		"wikitext": "{{REVISIONYEAR:{{PAGENAME}}}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONYEAR</><keyword.operator.function>:</><constant.language.variables.metadata>{{PAGENAME}}</><punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Parser Function: {{PAGESIZE:{{PAGENAME}}}} on latest revision",
		"wikitext": "{{PAGESIZE:{{PAGENAME}}}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>PAGESIZE</><keyword.operator.function>:</><constant.language.variables.metadata>{{PAGENAME}}</><punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Parser functions with interwiki titles (T355706)",
		"wikitext": "* {{PAGEID:Parser test}} - {{PAGEID:wikipedia:Parser test}}\n* {{PAGESIZE:Parser test}} - {{PAGESIZE:wikipedia:Parser test}}\n* {{REVISIONID:Parser test}} - {{REVISIONID:wikipedia:Parser test}}\n* {{REVISIONDAY:Parser test}} - {{REVISIONDAY:wikipedia:Parser test}}\n* {{REVISIONDAY2:Parser test}} - {{REVISIONDAY2:wikipedia:Parser test}}\n* {{REVISIONMONTH:Parser test}} - {{REVISIONMONTH:wikipedia:Parser test}}\n* {{REVISIONMONTH1:Parser test}} - {{REVISIONMONTH1:wikipedia:Parser test}}\n* {{REVISIONYEAR:Parser test}} - {{REVISIONYEAR:wikipedia:Parser test}}\n* {{REVISIONTIMESTAMP:Parser test}} - {{REVISIONTIMESTAMP:wikipedia:Parser test}}\n* {{REVISIONUSER:Parser test}} - {{REVISIONUSER:wikipedia:Parser test}}",
		"parsed": "<punctuation.definition.list.begin.markdown>*</> <punctuation.definition.tag.function>{{</><constant.language.variables.query>PAGEID</><keyword.operator.function>:</>Parser test<punctuation.definition.tag.function>}}</> - <punctuation.definition.tag.function>{{</><constant.language.variables.query>PAGEID</><keyword.operator.function>:</>wikipedia:Parser test<punctuation.definition.tag.function>}}\\n</><punctuation.definition.list.begin.markdown>*</> <punctuation.definition.tag.function>{{</><constant.language.variables.query>PAGESIZE</><keyword.operator.function>:</>Parser test<punctuation.definition.tag.function>}}</> - <punctuation.definition.tag.function>{{</><constant.language.variables.query>PAGESIZE</><keyword.operator.function>:</>wikipedia:Parser test<punctuation.definition.tag.function>}}\\n</><punctuation.definition.list.begin.markdown>*</> <punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONID</><keyword.operator.function>:</>Parser test<punctuation.definition.tag.function>}}</> - <punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONID</><keyword.operator.function>:</>wikipedia:Parser test<punctuation.definition.tag.function>}}\\n</><punctuation.definition.list.begin.markdown>*</> <punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONDAY</><keyword.operator.function>:</>Parser test<punctuation.definition.tag.function>}}</> - <punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONDAY</><keyword.operator.function>:</>wikipedia:Parser test<punctuation.definition.tag.function>}}\\n</><punctuation.definition.list.begin.markdown>*</> <punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONDAY2</><keyword.operator.function>:</>Parser test<punctuation.definition.tag.function>}}</> - <punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONDAY2</><keyword.operator.function>:</>wikipedia:Parser test<punctuation.definition.tag.function>}}\\n</><punctuation.definition.list.begin.markdown>*</> <punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONMONTH</><keyword.operator.function>:</>Parser test<punctuation.definition.tag.function>}}</> - <punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONMONTH</><keyword.operator.function>:</>wikipedia:Parser test<punctuation.definition.tag.function>}}\\n</><punctuation.definition.list.begin.markdown>*</> <punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONMONTH1</><keyword.operator.function>:</>Parser test<punctuation.definition.tag.function>}}</> - <punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONMONTH1</><keyword.operator.function>:</>wikipedia:Parser test<punctuation.definition.tag.function>}}\\n</><punctuation.definition.list.begin.markdown>*</> <punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONYEAR</><keyword.operator.function>:</>Parser test<punctuation.definition.tag.function>}}</> - <punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONYEAR</><keyword.operator.function>:</>wikipedia:Parser test<punctuation.definition.tag.function>}}\\n</><punctuation.definition.list.begin.markdown>*</> <punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONTIMESTAMP</><keyword.operator.function>:</>Parser test<punctuation.definition.tag.function>}}</> - <punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONTIMESTAMP</><keyword.operator.function>:</>wikipedia:Parser test<punctuation.definition.tag.function>}}\\n</><punctuation.definition.list.begin.markdown>*</> <punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONUSER</><keyword.operator.function>:</>Parser test<punctuation.definition.tag.function>}}</> - <punctuation.definition.tag.function>{{</><constant.language.variables.query>REVISIONUSER</><keyword.operator.function>:</>wikipedia:Parser test<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "Magic Word: {{SCRIPTPATH}}",
		"wikitext": "{{SCRIPTPATH}}",
		"parsed": "<constant.language.variables.query>{{SCRIPTPATH}}</>"
	},
	{
		"desc": "Magic Word: {{STYLEPATH}}",
		"wikitext": "{{STYLEPATH}}",
		"parsed": "<constant.language.variables.query>{{STYLEPATH}}</>"
	},
	{
		"desc": "Magic Word: {{SERVER}}",
		"wikitext": "{{SERVER}}",
		"parsed": "<constant.language.variables.query>{{SERVER}}</>"
	},
	{
		"desc": "Magic Word: {{SERVERNAME}}",
		"wikitext": "{{SERVERNAME}}",
		"parsed": "<constant.language.variables.query>{{SERVERNAME}}</>"
	},
	{
		"desc": "Magic Word: {{SITENAME}}",
		"wikitext": "{{SITENAME}}",
		"parsed": "<constant.language.variables.metadata>{{SITENAME}}</>"
	},
	{
		"desc": "Magic Word: {{PAGELANGUAGE}} on a page with no explicitly set language",
		"wikitext": "{{PAGELANGUAGE}}",
		"parsed": "<constant.language.variables.metadata>{{PAGELANGUAGE}}</>"
	},
	{
		"desc": "Case-sensitive magic words, when cased differently, should just be template transclusions",
		"wikitext": "{{CurrentMonth}}\n{{currentday}}\n{{cURreNTweEK}}\n{{currentHour}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>CurrentMonth</><punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>currentday</><punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>cURreNTweEK</><punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>currentHour</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Case-insensitive magic words should still work with weird casing.",
		"wikitext": "{{sErVeRNaMe}}\n{{LCFirst:AOEU}}\n{{ucFIRST:aoeu}}\n{{SERver}}",
		"parsed": "<constant.language.variables.query>{{sErVeRNaMe}}\\n</><punctuation.definition.tag.function>{{</><constant.language.variables.query>LCFirst</><keyword.operator.function>:</>AOEU<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>ucFIRST</><keyword.operator.function>:</>aoeu<punctuation.definition.tag.function>}}\\n</><constant.language.variables.query>{{SERver}}</>"
	},
	{
		"desc": "Magic Word: prioritize type info over data-parsoid",
		"wikitext": "__FORCETOC__",
		"parsed": "<constant.language.behavior>__FORCETOC__</>"
	},
	{
		"desc": "Magic Word: serialize on separate line (parsoid)",
		"wikitext": "foo\n__NOTOC__\nbar",
		"parsed": "foo\\n<constant.language.behavior>__NOTOC__\\n</>bar"
	},
	{
		"desc": "Magic Word: case-insensitive (all-lowercase)",
		"wikitext": "foo\n__notoc__\nbar",
		"parsed": "foo\\n<constant.language.behavior>__notoc__\\n</>bar"
	},
	{
		"desc": "Magic Word: case-insensitive (mixed case)",
		"wikitext": "foo\n__NOtOC__\nbar",
		"parsed": "foo\\n<constant.language.behavior>__NOtOC__\\n</>bar"
	},
	{
		"desc": "Magic words",
		"wikitext": "__TOC__\n__NOTOC__\n__FORCETOC__\n__INDEX__\n__NOINDEX__\n__NOGALLERY__\n__NOEDITSECTION__\n__NOTITLECONVERT__\n__NOCONTENTCONVERT__",
		"parsed": "<constant.language.behavior>__TOC__\\n__NOTOC__\\n__FORCETOC__\\n</><constant.language.switcher>__INDEX__\\n__NOINDEX__\\n</><constant.language.behavior>__NOGALLERY__\\n__NOEDITSECTION__\\n__NOTITLECONVERT__\\n__NOCONTENTCONVERT__</>"
	},
	{
		"desc": "media"
	},
	{
		"desc": "Simple image",
		"wikitext": "[[Image:foobar.jpg]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>foobar.jpg</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Simple image redirect",
		"wikitext": "[[Image:Redirect to foobar.jpg]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>Redirect to foobar.jpg</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Serialize simple image with figure-inline wrapper",
		"wikitext": "[[File:Foobar.jpg]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Serialize simple image with mw:Image typeof",
		"wikitext": "[[File:Foobar.jpg]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Simple image (using File: namespace, now canonical)",
		"wikitext": "[[File:Foobar.jpg]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Right-aligned image",
		"wikitext": "[[File:Foobar.jpg|right]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>right</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with caption",
		"wikitext": "[[File:Foobar.jpg|right|Caption text]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>right</><keyword.operator>|</>Caption text<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with caption, T55312 #1",
		"wikitext": "[[File:Foobar.jpg|right|Caption page stuff]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>right</><keyword.operator>|</>Caption page stuff<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with caption, T55312 #2",
		"wikitext": "[[File:Foobar.jpg|right|Caption page=]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>right</><keyword.operator>|</>Caption page=<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with caption, T55312 #3",
		"wikitext": "[[File:Foobar.jpg|right|Caption page=stuff]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>right</><keyword.operator>|</>Caption page=stuff<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image caption with pipe entity",
		"wikitext": "[[File:Foobar.jpg|thumb|one &#x7C; two]]\n[[File:Foobar.jpg|thumb|one ''two'' &#x7C; three]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>one <constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#x7C;</> two<punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>one <markup.italic>''</>two<markup.italic>''</> <constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#x7C;</> three<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Bad images - basic functionality",
		"wikitext": "[[File:Bad.jpg]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Bad.jpg</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Bad images - T18039: text after bad image disappears",
		"wikitext": "Foo bar\n[[File:Bad.jpg]]\nBar foo",
		"parsed": "Foo bar\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Bad.jpg</><punctuation.definition.tag.link.internal>]]\\n</></>Bar foo"
	},
	{
		"desc": "Bad images - manualthumb",
		"wikitext": "[[File:Foobar.jpg|thumbnail=Bad.jpg|Uh oh]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumbnail=</>Bad.jpg<keyword.operator>|</>Uh oh<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Bad images - in gallery",
		"wikitext": "<gallery>\nFile:Bad.jpg\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Bad.jpg\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Allow empty links in image captions (T62753)",
		"wikitext": "[[File:Foobar.jpg|thumb|Caption [[Link1]]\n[[]]\n[[Link2]]\n]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>Caption <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Link1</><punctuation.definition.tag.link.internal>]]\\n[[]]\\n[[</><entity.other.attribute-name>Link2</><punctuation.definition.tag.link.internal>]]\\n</></><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Titles in unlinked images (T23454)",
		"wikitext": "[[File:Foobar.jpg|link=|stuff]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</><keyword.operator>|</>stuff<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Unlinked media in gallery",
		"wikitext": "<gallery>\nFile:Foobar.jpg|link=|stuff\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|link=|stuff\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Link with empty target",
		"wikitext": "[[]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[]]</></>"
	},
	{
		"desc": "Image with link trail",
		"wikitext": "Linktrails should not work for images: [[File:Foobar.jpg]]s",
		"parsed": "Linktrails should not work for images: <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><punctuation.definition.tag.link.internal>]]</></>s"
	},
	{
		"desc": "Image with empty attribute",
		"wikitext": "[[File:Foobar.jpg|right||Caption text]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>right</><keyword.operator>||</>Caption text<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "1. Block image with individual attributes from templates",
		"wikitext": "[[File:Foobar.jpg|thumb|{{1x|137px}}|This is a caption]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>137px<punctuation.definition.tag.template>}}</><keyword.operator>|</>This is a caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "2. Block Image with individual attributes from templates",
		"wikitext": "[[File:Foobar.jpg|{{1x|thumb}}|{{1x|137px}}|This is a caption]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>thumb<punctuation.definition.tag.template>}}</><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>137px<punctuation.definition.tag.template>}}</><keyword.operator>|</>This is a caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "3. Inline image with individual attributes from templates",
		"wikitext": "[[File:Foobar.jpg|{{1x|50px}}]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>50px<punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with multiple attributes from the same template",
		"wikitext": "[[File:Foobar.jpg|{{image_attribs}}]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>image_attribs</><punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with link tails",
		"wikitext": "123[[File:Foobar.jpg]]456\n123[[File:Foobar.jpg|right]]456\n123[[File:Foobar.jpg|thumb]]456",
		"parsed": "123<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><punctuation.definition.tag.link.internal>]]</></>456\\n123<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>right</><punctuation.definition.tag.link.internal>]]</></>456\\n123<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><punctuation.definition.tag.link.internal>]]</></>456"
	},
	{
		"desc": "Image with multiple captions -- only last one is accepted",
		"wikitext": "[[File:Foobar.jpg|right|Caption1 - ignored|[[Caption2]] - ignored|Caption3 - accepted]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>right</><keyword.operator>|</>Caption1 - ignored<keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Caption2</><punctuation.definition.tag.link.internal>]]</></> - ignored<keyword.operator>|</>Caption3 - accepted<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with multiple widths -- use last",
		"wikitext": "[[File:Foobar.jpg|200px|300px|caption]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>200<entity.other.attribute-name.localname>px</><keyword.operator>|</>300<entity.other.attribute-name.localname>px</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with multiple alignments -- use first (T50664)",
		"wikitext": "[[File:Foobar.jpg|thumb|left|right|center|caption]]\n\n[[File:Foobar.jpg|middle|text-top|caption]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</><entity.other.attribute-name.localname>left</><keyword.operator>|</><entity.other.attribute-name.localname>right</><keyword.operator>|</><entity.other.attribute-name.localname>center</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>middle</><keyword.operator>|</><entity.other.attribute-name.localname>text-top</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with width attribute at different positions",
		"wikitext": "[[File:Foobar.jpg|200px|right|Caption]]\n[[File:Foobar.jpg|right|200px|Caption]]\n[[File:Foobar.jpg|right|Caption|200px]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>200<entity.other.attribute-name.localname>px</><keyword.operator>|</><entity.other.attribute-name.localname>right</><keyword.operator>|</>Caption<punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>right</><keyword.operator>|</>200<entity.other.attribute-name.localname>px</><keyword.operator>|</>Caption<punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>right</><keyword.operator>|</>Caption<keyword.operator>|</>200<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with size specified with pxpx (T15500, T53628)",
		"wikitext": "[[File:Foobar.jpg|20pxpx]]\n[[File:Foobar.jpg|200x20pxpx]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>20px<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>200x20px<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with link parameter, wiki target",
		"wikitext": "[[File:Foobar.jpg|link=Main Page]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</>Main Page<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "File with link to page section",
		"wikitext": "[[Main Page#section]]\n[[File:Foobar.jpg|link=Main Page#section]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page#section</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</>Main Page#section<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with link parameter, URL target",
		"wikitext": "[[File:Foobar.jpg|link=http://example.com/]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</>http://example.com/<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with link parameter, protocol-less URL target",
		"wikitext": "[[File:Foobar.jpg|link=//example.com/]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</>//example.com/<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Escaping non-block captions (T107435)",
		"wikitext": "[[Image:Foobar.jpg|alt=123|caption]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>alt=</>123<keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with link parameter, wgExternalLinkTarget",
		"wikitext": "[[File:Foobar.jpg|link=http://example.com/]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</>http://example.com/<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Thumb with link parameter, wgExternalLinkTarget",
		"wikitext": "[[File:Foobar.jpg|link=http://example.com/|thumb]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</>http://example.com/<keyword.operator>|</><entity.other.attribute-name.localname>thumb</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with link parameter, wgNoFollowLinks set to false",
		"wikitext": "[[File:Foobar.jpg|link=http://example.com/]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</>http://example.com/<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with link parameter, wgNoFollowDomainExceptions",
		"wikitext": "[[File:Foobar.jpg|link=http://example.com/]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</>http://example.com/<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with link parameter, wgExternalLinkTarget, unnamed parameter",
		"wikitext": "[[File:Foobar.jpg|link=http://example.com/|Title]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</>http://example.com/<keyword.operator>|</>Title<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with empty link parameter",
		"wikitext": "[[File:Foobar.jpg|link=]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with link parameter (wiki target) and unnamed parameter",
		"wikitext": "[[File:Foobar.jpg|link=Main_Page|Title]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</>Main_Page<keyword.operator>|</>Title<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with link parameter (URL target) and unnamed parameter",
		"wikitext": "[[File:Foobar.jpg|link=http://example.com/|Title]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</>http://example.com/<keyword.operator>|</>Title<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Thumbnail image with link parameter",
		"wikitext": "[[File:Foobar.jpg|thumb|link=http://example.com/|Title]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</><entity.other.attribute-name.localname>link=</>http://example.com/<keyword.operator>|</>Title<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Manually-specified thumbnail image",
		"wikitext": "[[File:Foobar.jpg|thumbnail=Thumb.png|Title]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumbnail=</>Thumb.png<keyword.operator>|</>Title<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Manually-specified thumbnail image (backwards compat)",
		"wikitext": "[[File:Foobar.jpg|thumbnail=Thumb.png|Title]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumbnail=</>Thumb.png<keyword.operator>|</>Title<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Manually-specified thumbnail image with explicit link to wiki page",
		"wikitext": "[[File:Foobar.jpg|thumb=Thumb.png|link=Main_Page|Title]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb=</>Thumb.png<keyword.operator>|</><entity.other.attribute-name.localname>link=</>Main_Page<keyword.operator>|</>Title<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Manually-specified thumbnail image with explicit link to url",
		"wikitext": "[[File:Foobar.jpg|thumb=Thumb.png|link=http://example.com|Title]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb=</>Thumb.png<keyword.operator>|</><entity.other.attribute-name.localname>link=</>http://example.com<keyword.operator>|</>Title<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Manually-specified thumbnail image with explicit no link",
		"wikitext": "[[File:Foobar.jpg|thumb=Thumb.png|link=|Title]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb=</>Thumb.png<keyword.operator>|</><entity.other.attribute-name.localname>link=</><keyword.operator>|</>Title<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Manually-specified thumbnail image with explicit link and alt text",
		"wikitext": "[[File:Foobar.jpg|thumb=Thumb.png|link=Main_Page|alt=alttext|Title]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb=</>Thumb.png<keyword.operator>|</><entity.other.attribute-name.localname>link=</>Main_Page<keyword.operator>|</><entity.other.attribute-name.localname>alt=</>alttext<keyword.operator>|</>Title<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with frame and link",
		"wikitext": "[[File:Foobar.jpg|frame|left|This is a test image [[Main Page]]]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>frame</><keyword.operator>|</><entity.other.attribute-name.localname>left</><keyword.operator>|</>This is a test image <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with frame and link and explicit alt",
		"wikitext": "[[Image:Foobar.jpg|frame|left|This is a test image [[Main Page]]|alt=Altitude]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>frame</><keyword.operator>|</><entity.other.attribute-name.localname>left</><keyword.operator>|</>This is a test image <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</></><keyword.operator>|</><entity.other.attribute-name.localname>alt=</>Altitude<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with wiki markup in implicit alt",
		"wikitext": "[[Image:Foobar.jpg|testing '''bold''' in alt]]\n\n[[Image:Foobar.jpg|alt=testing '''bold''' in alt]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>testing <markup.bold>'''</>bold<markup.bold>'''</> in alt<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>alt=</>testing <markup.bold>'''</>bold<markup.bold>'''</> in alt<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Alt image option should handle most kinds of wikitext without barfing",
		"wikitext": "[[Image:Foobar.jpg|thumb|This is the image caption|alt=This is a [[link]] and a {{1x|''bold template''}}.]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>This is the image caption<keyword.operator>|</><entity.other.attribute-name.localname>alt=</>This is a <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>link</><punctuation.definition.tag.link.internal>]]</></> and a <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><markup.italic>''</>bold template<markup.italic>''</><punctuation.definition.tag.template>}}</>.<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Ampersand in alt attribute (T206940)",
		"wikitext": "[[File:Foobar.jpg|alt=&amp;amp;]]\n\n<!-- consistency with gallery extension -->\n<gallery>\nFile:Foobar.jpg|alt=&amp;amp;\n</gallery>",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>alt=</><constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>amp;<punctuation.definition.tag.link.internal>]]\\n\\n</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</> consistency with gallery extension <punctuation.definition.comment.html>--&gt\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|alt=<constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></>amp;\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Link with encoded pipe in alt option",
		"wikitext": "[[File:Foobar.jpg|alt=http://testing.123?4=5&#x7C;6|caption]]\n\n[[File:Foobar.jpg|alt=http://testing.123?4=5&vert;6|caption]]\n\n<!-- consistency with gallery extension -->\n<gallery>\nFile:Foobar.jpg|alt=http://testing.123?4=5&#x7C;6|caption\nFile:Foobar.jpg|alt=http://testing.123?4=5&vert;6|caption\n</gallery>",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>alt=</>http://testing.123?4=5<constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#x7C;</>6<keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>alt=</>http://testing.123?4=5<constant.character.entity.named.vert.html><punctuation.definition.entity.html>&amp;</>vert<punctuation.definition.entity.html>;</></>6<keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n\\n</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</> consistency with gallery extension <punctuation.definition.comment.html>--&gt\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|alt=http://testing.123?4=5<constant.character.entity.numeric.hexadecimal.html><punctuation.definition.entity.html>&amp;</>#x7C;</>6|caption\\nFile:Foobar.jpg|alt=http://testing.123?4=5<constant.character.entity.named.vert.html><punctuation.definition.entity.html>&amp;</>vert<punctuation.definition.entity.html>;</></>6|caption\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Italics markup in alt attribute (T206940)",
		"wikitext": "[[File:Foobar.jpg|alt=''x''|caption]]\n\n<!-- consistency with gallery extension -->\n<gallery>\nFile:Foobar.jpg|alt=''x''|caption\n</gallery>",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>alt=</><markup.italic>''</>x<markup.italic>''</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n\\n</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</> consistency with gallery extension <punctuation.definition.comment.html>--&gt\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|alt=<markup.italic>''</>x<markup.italic>''</>|caption\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Nowiki markup in alt attribute (edited html, no data-parsoid) (T206940)",
		"wikitext": "[[File:Foobar.jpg|alt=<nowiki>''x''</nowiki>|caption]]\n\n<!-- consistency with gallery extension -->\n<gallery>\nFile:Foobar.jpg|alt=<nowiki>''x''</nowiki>|caption\n</gallery>",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>alt=</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>''x''</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n\\n</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</> consistency with gallery extension <punctuation.definition.comment.html>--&gt\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|alt=<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>''x''</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>|caption\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Ampersand in link attribute (edited html, no data-parsoid) (T206940)",
		"wikitext": "[[File:Foobar.jpg|link=Foo_&_bar]]\n\n<!-- consistency with gallery extension -->\n<gallery>\nFile:Foobar.jpg|link=Foo_&_bar\n</gallery>",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</>Foo_&amp;_bar<punctuation.definition.tag.link.internal>]]\\n\\n</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</> consistency with gallery extension <punctuation.definition.comment.html>--&gt\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|link=Foo_&amp;_bar\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Italics markup in link attribute (T206940)",
		"wikitext": "[[Foo''s bar''s]]\n\n<!-- Note that \"italics\" are stripped, even though this is a valid page title -->\n[[File:Foobar.jpg|link=Foo''s bar''s|caption1]]\n\n[[File:Foobar.jpg|link=''Main Page''|caption2]]\n\n<!-- consistency with gallery extension -->\n<gallery>\nFile:Foobar.jpg|link=Foo''s bar''s|caption1\nFile:Foobar.jpg|link=''Main Page''|caption2\n</gallery>",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo''s bar''s</><punctuation.definition.tag.link.internal>]]\\n\\n</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</> Note that \"italics\" are stripped, even though this is a valid page title <punctuation.definition.comment.html>--&gt\\n</></><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</>Foo<markup.italic>''</>s bar<markup.italic>''</>s<keyword.operator>|</>caption1<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</><markup.italic>''</>Main Page<markup.italic>''</><keyword.operator>|</>caption2<punctuation.definition.tag.link.internal>]]\\n\\n</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</> consistency with gallery extension <punctuation.definition.comment.html>--&gt\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|link=Foo<markup.italic>''</>s bar<markup.italic>''</>s|caption1\\nFile:Foobar.jpg|link=<markup.italic>''</>Main Page<markup.italic>''</>|caption2\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Nowiki markup in link attribute (edited html, no data-parsoid) (T206940)",
		"wikitext": "[[File:Foobar.jpg|link=Foo<nowiki>''s_bar''</nowiki>s|caption]]\n\n<!-- consistency with gallery extension -->\n<gallery>\nFile:Foobar.jpg|link=Foo<nowiki>''s_bar''</nowiki>s|caption\n</gallery>",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</>Foo<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>''s_bar''</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>s<keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n\\n</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</> consistency with gallery extension <punctuation.definition.comment.html>--&gt\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|link=Foo<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>''s_bar''</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>s|caption\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "HTML entity prefix in link markup (T209236)",
		"wikitext": "[[File:Foobar.jpg|link=https://example.com?foo&params=bar]]\n\n<!-- consistency with gallery extension -->\n<gallery>\nFile:Foobar.jpg|link=https://example.com?foo&params=bar\n</gallery>",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</>https://example.com?foo&amp;params=bar<punctuation.definition.tag.link.internal>]]\\n\\n</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</> consistency with gallery extension <punctuation.definition.comment.html>--&gt\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|link=https://example.com?foo&amp;params=bar\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Image with table with attributes in caption",
		"wikitext": "[[File:Foobar.jpg|thumb|\n{| class=\"123\" |\n|- class=\"456\" |\n| ha\n|}\n]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|\\n</><meta.tag.block.table><keyword.operator>{|</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>123<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.|.html><entity.other.attribute-name.html>|\\n</></><meta.tag.block.table-row><keyword.operator>|-</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>456<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.|.html><entity.other.attribute-name.html>|\\n</></></><meta.tag.block.td><keyword.operator>|</><markup.style> ha\\n</></><keyword.operator>|}\\n</></><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with table with rows from templates in caption",
		"wikitext": "[[File:Foobar.jpg|thumb|\n{|\n{{1x|{{!}} hi}}\n|}\n]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|\\n</><meta.tag.block.table><keyword.operator>{|\\n</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><constant.language.variables.metadata>{{!}}</> hi<punctuation.definition.tag.template>}}\\n</><keyword.operator>|}\\n</></><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with nested tables in caption",
		"wikitext": "[[File:Foobar.jpg|thumb|Foo<br />\n{|\n|\n{|\n|z\n|}\n|}\n]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>Foo<meta.tag.inline.br.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>br</> <punctuation.definition.tag.end.html>/&gt\\n</></><meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|\\n</></><meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>z\\n</></><keyword.operator>|}\\n</></><keyword.operator>|}\\n</></><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with heading and horizontal rule in caption",
		"wikitext": "[[File:Foobar.jpg|thumb|\n===Testing===\n123\n--------------\n]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|\\n</><markup.heading>===<string.quoted.other.heading>Testing</>===\\n</>123\\n<markup.changed>--------------\\n</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with 'frameless' first.",
		"wikitext": "[[File:Foobar.jpg|frameless|caption]]\n\n[[File:Foobar.jpg|frameless|frame|caption]]\n\n[[File:Foobar.jpg|frameless|thumb|caption]]\n\n[[File:Foobar.jpg|frameless|thumbnail=Thumb.png|caption]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>frameless</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>frameless</><keyword.operator>|</><entity.other.attribute-name.localname>frame</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>frameless</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>frameless</><keyword.operator>|</><entity.other.attribute-name.localname>thumbnail=</>Thumb.png<keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with 'frame' first.",
		"wikitext": "[[File:Foobar.jpg|frame|caption]]\n[[File:Foobar.jpg|frame|frameless|caption]]\n[[File:Foobar.jpg|frame|thumb|caption]]\n[[File:Foobar.jpg|frame|thumbnail=Thumb.png|caption]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>frame</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>frame</><keyword.operator>|</><entity.other.attribute-name.localname>frameless</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>frame</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>frame</><keyword.operator>|</><entity.other.attribute-name.localname>thumbnail=</>Thumb.png<keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with 'thumb' first.",
		"wikitext": "[[File:Foobar.jpg|thumb|caption]]\n[[File:Foobar.jpg|thumb|frameless|caption]]\n[[File:Foobar.jpg|thumb|frame|caption]]\n[[File:Foobar.jpg|thumb|thumbnail=Thumb.png|caption]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</><entity.other.attribute-name.localname>frameless</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</><entity.other.attribute-name.localname>frame</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</><entity.other.attribute-name.localname>thumbnail=</>Thumb.png<keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with 'thumbnail=' first.",
		"wikitext": "[[File:Foobar.jpg|thumbnail=Thumb.png|caption]]\n[[File:Foobar.jpg|thumbnail=Thumb.png|frameless|caption]]\n[[File:Foobar.jpg|thumbnail=Thumb.png|frame|caption]]\n[[File:Foobar.jpg|thumbnail=Thumb.png|thumb|caption]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumbnail=</>Thumb.png<keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumbnail=</>Thumb.png<keyword.operator>|</><entity.other.attribute-name.localname>frameless</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumbnail=</>Thumb.png<keyword.operator>|</><entity.other.attribute-name.localname>frame</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumbnail=</>Thumb.png<keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: unspecified format and border enlarge",
		"wikitext": "[[File:Foobar.jpg|2000px]]\n\n[[File:Foobar.jpg|border|2000px]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>2000<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>border</><keyword.operator>|</>2000<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: \"unspecified format\" and border reduce",
		"wikitext": "[[File:Foobar.jpg|1000px]]\n\n[[File:Foobar.jpg|border|1000px]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>1000<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>border</><keyword.operator>|</>1000<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: thumbs reduce",
		"wikitext": "[[File:Foobar.jpg|thumb|50px]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>50<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: bitmap thumbs can't be enlarged past original size, but vector can.",
		"wikitext": "[[File:Foobar.jpg|thumb|2000px]]\n\n[[File:Foobar.svg|thumb|2000px]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>2000<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.svg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>2000<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: frameless can reduce in size",
		"wikitext": "[[File:Foobar.jpg|frameless|50px]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>frameless</><keyword.operator>|</>50<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: bitmap frameless can't be enlarged past original size, but vector can",
		"wikitext": "[[File:Foobar.jpg|frameless|2000px]]\n\n[[File:Foobar.svg|frameless|2000px]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>frameless</><keyword.operator>|</>2000<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.svg</><keyword.operator>|</><entity.other.attribute-name.localname>frameless</><keyword.operator>|</>2000<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: framed images are always unscaled.",
		"wikitext": "[[File:Foobar.jpg|frame]]\n\n[[File:Foobar.jpg|frame|50px]]\n\n[[File:Foobar.jpg|frame|50x50px]]\n\n[[File:Foobar.jpg|frame|2000px]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>frame</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>frame</><keyword.operator>|</>50<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>frame</><keyword.operator>|</>50x50<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>frame</><keyword.operator>|</>2000<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: framed vector images are scaled to their default size AND have srcset",
		"wikitext": "[[File:Foobar.svg|frame]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.svg</><keyword.operator>|</><entity.other.attribute-name.localname>frame</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: manualthumb images are always unscaled.",
		"wikitext": "[[File:Foobar.jpg|thumbnail=Thumb.png]]\n\n[[File:Foobar.jpg|thumbnail=Thumb.png|50px]]\n\n[[File:Foobar.jpg|thumbnail=Thumb.png|50x50px]]\n\n[[File:Foobar.jpg|thumbnail=Thumb.png|2000px]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumbnail=</>Thumb.png<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumbnail=</>Thumb.png<keyword.operator>|</>50<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumbnail=</>Thumb.png<keyword.operator>|</>50x50<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumbnail=</>Thumb.png<keyword.operator>|</>2000<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Bogus sizes during html2wt",
		"wikitext": "[[File:Foobar.jpg]]\n\n[[File:Foobar.jpg|10x10px]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>10x10<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Link to image page- image page normally doesn't exist, hence edit link\nAdd test with existing image page\n#<p><a href=\"/wiki/File:Test\" title=\"Image:Test\">Image:test</a>",
		"wikitext": "[[:Image:test]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>:Image:</><entity.other.attribute-name>test</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T20784  Link to non-existent image page with caption should use caption as link text",
		"wikitext": "[[:Image:test|caption]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>:Image:</><entity.other.attribute-name>test</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Frameless image caption with a free URL",
		"wikitext": "[[File:Foobar.jpg|http://example.com]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>http://example.com<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Thumbnail image caption with a free URL",
		"wikitext": "[[File:Foobar.jpg|thumb|http://example.com]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>http://example.com<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Thumbnail image caption with a free URL and explicit alt",
		"wikitext": "[[File:Foobar.jpg|thumb|http://example.com|alt=Alteration]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>http://example.com<keyword.operator>|</><entity.other.attribute-name.localname>alt=</>Alteration<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "SVG thumbnails with no language set",
		"wikitext": "[[File:Foobar.svg|thumb|caption]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.svg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "SVG thumbnails with language de",
		"wikitext": "[[File:Foobar.svg|lang=de|thumb|caption]]\n\n<gallery>\nFile:Foobar.svg|lang=de|caption\n</gallery>",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.svg</><keyword.operator>|</><entity.other.attribute-name.localname>lang=</>de<keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.svg|lang=de|caption\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "SVG thumbnails with invalid language code",
		"wikitext": "[[File:Foobar.svg|thumb|caption|lang=invalid:language:code]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.svg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>caption<keyword.operator>|</><entity.other.attribute-name.localname>lang=</>invalid:language:code<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T3887: A ISBN with a thumbnail",
		"wikitext": "[[File:Foobar.jpg|thumb|ISBN 1235467890]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</><constant.language.variables.isbn>ISBN 1235467890</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T3887: A RFC with a thumbnail",
		"wikitext": "[[File:Foobar.jpg|thumb|This is RFC 12354]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>This is <constant.language.variables.rfc>RFC 12354</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T3887: A mailto link with a thumbnail",
		"wikitext": "[[File:Foobar.jpg|thumb|Please mailto:nobody@example.com]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>Please mailto:nobody@example.com<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T2648: Frameless image caption with a link",
		"wikitext": "[[File:Foobar.jpg|text with a [[link]] in it]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>text with a <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>link</><punctuation.definition.tag.link.internal>]]</></> in it<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T2648: Frameless image caption with a link (suffix)",
		"wikitext": "[[File:Foobar.jpg|text with a [[link]]foo in it]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>text with a <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>link</><punctuation.definition.tag.link.internal>]]</></>foo in it<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T2648: Frameless image caption with an interwiki link",
		"wikitext": "[[File:Foobar.jpg|text with a [[MeatBall:Link]] in it]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>text with a <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>MeatBall:Link</><punctuation.definition.tag.link.internal>]]</></> in it<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T2648: Frameless image caption with a piped interwiki link",
		"wikitext": "[[File:Foobar.jpg|text with a [[MeatBall:Link|link]] in it]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>text with a <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>MeatBall:Link</><keyword.operator>|</>link<punctuation.definition.tag.link.internal>]]</></> in it<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T107474: Frameless image caption with <nowiki>",
		"wikitext": "[[File:Foobar.jpg|<nowiki>text with a [[MeatBall:Link|link]] in it</nowiki>]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>text with a [[MeatBall:Link|link]] in it</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Escape HTML special chars in image alt text",
		"wikitext": "[[File:Foobar.jpg|& < > \"]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>&amp; &lt; &gt \"<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Escape HTML special chars in image alt text with LanguageConverter",
		"wikitext": "[[File:Foobar.jpg|& < > \"]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>&amp; &lt; &gt \"<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Entities in file name and attributes",
		"wikitext": "[[File:7%25 solution.gif|manualthumb=7%25 solution.gif|link=7%25 solution|[[7%25 solution]]]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>7%25 solution.gif</><keyword.operator>|</>manualthumb=7%25 solution.gif<keyword.operator>|</><entity.other.attribute-name.localname>link=</>7%25 solution<keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>7%25 solution</><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T2499: Alt text should have &#1234;, not &amp;1234;",
		"wikitext": "[[File:Foobar.jpg|&#9792;]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#9792;</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Broken image caption with link",
		"wikitext": "[[Image:Foobar.jpg|thumb|This is a broken caption. But [[Main Page|this]] is just an ordinary link.",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>This is a broken caption. But <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</>this<punctuation.definition.tag.link.internal>]]</></> is just an ordinary link.</>"
	},
	{
		"desc": "Image caption containing another image",
		"wikitext": "[[File:Foobar.jpg|thumb|This is a caption with another [[File:Thumb.png|image]] inside it!]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>This is a caption with another <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Thumb.png</><keyword.operator>|</>image<punctuation.definition.tag.link.internal>]]</></> inside it!<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: caption containing a newline",
		"wikitext": "[[File:Foobar.jpg|This\n*is some text]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>This\\n<punctuation.definition.list.begin.markdown>*</>is some text<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: caption containing leading space",
		"wikitext": "[[File:Foobar.jpg|thumb| bar]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</> bar<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: caption containing a table",
		"wikitext": "[[Image:Foobar.jpg|thumb|200px|This is an example image thumbnail caption with a table\n{|\n!Foo!!Bar\n|-\n|Foo1||Bar1\n|}\nand some more text.]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>200<entity.other.attribute-name.localname>px</><keyword.operator>|</>This is an example image thumbnail caption with a table\\n<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</><markup.style>Foo</><keyword.operator>!!</><markup.style>Bar\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>Foo1</><keyword.operator>||</><markup.style>Bar1\\n</></><keyword.operator>|}\\n</></>and some more text.<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T5090: External links other than http: in image captions",
		"wikitext": "[[File:Foobar.jpg|thumb|200x200px|This caption has [irc://example.net irc] and [https://example.com Secure] ext links in it.]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>200x200<entity.other.attribute-name.localname>px</><keyword.operator>|</>This caption has <punctuation.definition.tag.link.external>[</><entity.name.tag.url>irc://example.net</><string.other.link.external.title> irc</><punctuation.definition.tag.link.external>]</> and <punctuation.definition.tag.link.external>[</><entity.name.tag.url>https://example.com</><string.other.link.external.title> Secure</><punctuation.definition.tag.link.external>]</> ext links in it.<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Custom class",
		"wikitext": "[[Image:foobar.jpg|a|class=b]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>foobar.jpg</><keyword.operator>|</>a<keyword.operator>|</><entity.other.attribute-name.localname>class=</>b<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "\"border\", \"frameless\" and \"class\" attributes on an image.",
		"wikitext": "[[File:Foobar.jpg|frameless|border|class=extra|caption]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>frameless</><keyword.operator>|</><entity.other.attribute-name.localname>border</><keyword.operator>|</><entity.other.attribute-name.localname>class=</>extra<keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Invalid image attributes (T64500)",
		"wikitext": "[[File:Foobar.jpg|thumb|float|left|caption]]\n\n[[File:Foobar.jpg|thumb|righ|caption]]\n\n[[File:Foobar.jpg|bogus1|thumb|bogus2|left|bogus3|caption]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>float<keyword.operator>|</><entity.other.attribute-name.localname>left</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>righ<keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>bogus1<keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>bogus2<keyword.operator>|</><entity.other.attribute-name.localname>left</><keyword.operator>|</>bogus3<keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Redirected image",
		"wikitext": "[[Image:Barfoo.jpg]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>Barfoo.jpg</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Missing image with uploads disabled",
		"wikitext": "[[File:Foobaz.jpg]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobaz.jpg</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid-specific image handling - simple image with size and middle alignment",
		"wikitext": "[[File:Foobar.jpg|middle|50px]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>middle</><keyword.operator>|</>50<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid-specific image handling - simple image with size, middle alignment, non-standard namespace alias",
		"wikitext": "[[Image:Foobar.jpg|middle|50px]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>middle</><keyword.operator>|</>50<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid-specific image handling - simple image with size and middle alignment (existing content)",
		"wikitext": "[[File:Foobar.jpg|50px|middle]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>50<entity.other.attribute-name.localname>px</><keyword.operator>|</><entity.other.attribute-name.localname>middle</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid-specific image handling - simple image with size and middle alignment and non-standard namespace name",
		"wikitext": "[[Image:Foobar.jpg|50px|middle]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>50<entity.other.attribute-name.localname>px</><keyword.operator>|</><entity.other.attribute-name.localname>middle</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid-specific image handling - simple image with both sizes, a baseline alignment, and a caption",
		"wikitext": "[[File:Foobar.jpg|500x10px|baseline|caption]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>500x10<entity.other.attribute-name.localname>px</><keyword.operator>|</><entity.other.attribute-name.localname>baseline</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid-specific image handling - simple image with border and size spec",
		"wikitext": "[[File:Foobar.jpg|50px|border|caption]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>50<entity.other.attribute-name.localname>px</><keyword.operator>|</><entity.other.attribute-name.localname>border</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid-specific image handling - thumbnail with halign, valign, and caption",
		"wikitext": "[[File:Foobar.jpg|left|baseline|thumb|caption content]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>left</><keyword.operator>|</><entity.other.attribute-name.localname>baseline</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>caption content<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid-specific image handling - thumbnail with halign, valign, and caption (existing content)",
		"wikitext": "[[File:Foobar.jpg|thumb|left|baseline|caption content]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</><entity.other.attribute-name.localname>left</><keyword.operator>|</><entity.other.attribute-name.localname>baseline</><keyword.operator>|</>caption content<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid-specific image handling - thumbnail with specific size, halign, valign, and caption",
		"wikitext": "[[Image:Foobar.jpg|right|middle|thumb|50x50px|caption]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>right</><keyword.operator>|</><entity.other.attribute-name.localname>middle</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>50x50<entity.other.attribute-name.localname>px</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid-specific image handling - thumbnail with specific size, halign, valign, and caption (existing content)",
		"wikitext": "[[File:Foobar.jpg|thumb|50x50px|right|middle|caption]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>50x50<entity.other.attribute-name.localname>px</><keyword.operator>|</><entity.other.attribute-name.localname>right</><keyword.operator>|</><entity.other.attribute-name.localname>middle</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid-specific image handling - framed image with specific size and caption (size is ignored)",
		"wikitext": "[[File:Foobar.jpg|frame|500x50px|caption]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>frame</><keyword.operator>|</>500x50<entity.other.attribute-name.localname>px</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid-specific image handling - framed image with specific size, halign, valign, and caption (size is ignored)",
		"wikitext": "[[File:Foobar.jpg|left|baseline|frame|500x50px|caption]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>left</><keyword.operator>|</><entity.other.attribute-name.localname>baseline</><keyword.operator>|</><entity.other.attribute-name.localname>frame</><keyword.operator>|</>500x50<entity.other.attribute-name.localname>px</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid-specific image handling - frameless image with specific size, border, and caption",
		"wikitext": "[[File:Foobar.jpg|frameless|442x50px|border|caption]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>frameless</><keyword.operator>|</>442x50<entity.other.attribute-name.localname>px</><keyword.operator>|</><entity.other.attribute-name.localname>border</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid-specific image handling - simple image with a formatted caption",
		"wikitext": "[[File:Foobar.jpg|<table><tr><td>a</td><td>b</td></tr><tr><td>c</td></tr></table>]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>a<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>b<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>c<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid-specific image handling - caption with a template in it",
		"wikitext": "[[File:Foobar.jpg|thumb|200x23px|This caption has a {{1x|transclusion}} in it.]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>200x23<entity.other.attribute-name.localname>px</><keyword.operator>|</>This caption has a <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>transclusion<punctuation.definition.tag.template>}}</> in it.<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid-specific image handling - caption with unbalanced tags in it",
		"wikitext": "foo\n[[File:Foobar.jpg|thumb|200x200px|This caption has a <center>unbalanced tag in it.]]\nbar",
		"parsed": "foo\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>200x200<entity.other.attribute-name.localname>px</><keyword.operator>|</>This caption has a <meta.tag.structure.center.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.deprecated.html>center</></><punctuation.definition.tag.end.html>&gt</></>unbalanced tag in it.<punctuation.definition.tag.link.internal>]]\\n</></>bar"
	},
	{
		"desc": "Parsoid-specific image handling - empty caption (1)",
		"wikitext": "[[File:Foobar.jpg|thumb|]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid-specific image handling - empty caption (2)",
		"wikitext": "[[File:Foobar.jpg|thumb]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid-specific image handling - whitespace caption",
		"wikitext": "[[File:Foobar.jpg|thumb| ]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</> <punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid-specific image handling - lang option",
		"wikitext": "foo\n[[File:Foobar.svg|lang=de|caption]]\nbar",
		"parsed": "foo\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.svg</><keyword.operator>|</><entity.other.attribute-name.localname>lang=</>de<keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n</></>bar"
	},
	{
		"desc": "File containing double quotes and spaces",
		"wikitext": "[[File:Cool \"Gator\".png]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Cool \"Gator\".png</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "File containing single quotes",
		"wikitext": "[[File:Foo's ''italic'' bar.jpg]]\n[[File:Foo's ''italic'' bar.jpg|Foo's ''italic'' bar]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foo's ''italic'' bar.jpg</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foo's ''italic'' bar.jpg</><keyword.operator>|</>Foo's <markup.italic>''</>italic<markup.italic>''</> bar<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Broken image links with HTML captions (T41700)",
		"wikitext": "[[File:Nonexistent|<script></script>]]\n[[File:Nonexistent|100x100px|<script></script>]]\n[[File:Nonexistent|&lt;]]\n[[File:Nonexistent|a<i>b</i>c]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Nonexistent</><keyword.operator>|</><meta.embedded.block.html><meta.tag.metadata.script.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>script</><punctuation.definition.tag.end.html>&gt</></><meta.tag.metadata.script.end.html><punctuation.definition.tag.begin.html><source.js-ignored-vscode>&lt;</>/</><entity.name.tag.html>script</><punctuation.definition.tag.end.html>&gt</></></><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Nonexistent</><keyword.operator>|</>100x100<entity.other.attribute-name.localname>px</><keyword.operator>|</><meta.embedded.block.html><meta.tag.metadata.script.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>script</><punctuation.definition.tag.end.html>&gt</></><meta.tag.metadata.script.end.html><punctuation.definition.tag.begin.html><source.js-ignored-vscode>&lt;</>/</><entity.name.tag.html>script</><punctuation.definition.tag.end.html>&gt</></></><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Nonexistent</><keyword.operator>|</><constant.character.entity.named.lt.html><punctuation.definition.entity.html>&amp;</>lt<punctuation.definition.entity.html>;</></><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Nonexistent</><keyword.operator>|</>a<meta.tag.inline.i.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>i</><punctuation.definition.tag.end.html>&gt</></>b<meta.tag.inline.i.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>i</><punctuation.definition.tag.end.html>&gt</></>c<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Media in wikilink",
		"wikitext": "[[Test|[[File:Foobar.jpg]]]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Test</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Template with thumb image (with link in description)",
		"wikitext": "{{paramtest|param=[[Image:noimage.png|thumb|[[no link|link]] [[no link|caption]]]]}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>paramtest</><keyword.operator>|</><entity.other.attribute-name.local-name>param</><keyword.operator.equal>=</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>noimage.png</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>no link</><keyword.operator>|</>link<punctuation.definition.tag.link.internal>]]</></> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>no link</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "T3219 URL next to image (good)",
		"wikitext": "http://example.com [[File:Foobar.jpg]]",
		"parsed": "http://example.com <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T3219 URL next to image (broken)",
		"wikitext": "http://example.com[[File:Foobar.jpg]]",
		"parsed": "http://example.com<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image link to nonexistent file (T3850 - good)",
		"wikitext": "[[File:No_such.jpg]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>No_such.jpg</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": ":Image link to nonexistent file (T3850 - bad)",
		"wikitext": "[[:Image:No such.jpg]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>:Image:</><entity.other.attribute-name>No such.jpg</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Fuzz testing: image with bogus manual thumbnail",
		"wikitext": "[[Image:foobar.jpg|thumbnail= ]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumbnail=</> <punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Gallery with valid attributes",
		"wikitext": "<gallery type=\"123\" summary=\"345\">\nFile:File:Foobar.jpg\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</> <meta.attribute.type.html><entity.other.attribute-name.html>type</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>123<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.summary.html><entity.other.attribute-name.html>summary</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>345<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:File:Foobar.jpg\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Gallery",
		"wikitext": "<gallery>\nimage1.png |\nimage2.gif|||||\n\nimage3|\nimage4    |300px| centre\n image5.svg| http://///////\n[[x|xx]]]]\n* image6\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>image1.png |\\nimage2.gif|||||\\n\\nimage3|\\nimage4    |300px| centre\\n image5.svg| http://///////\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>x</><keyword.operator>|</>xx<punctuation.definition.tag.link.internal>]]</></>]]\\n<punctuation.definition.list.begin.markdown>*</> image6\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Gallery with line not in the file namespace",
		"wikitext": "<gallery>\n:'''''Albert Willimsky''' ''Geboren am 28.2.1890''\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.list.begin.markdown>:</><markup.bold.italic>'''''</>Albert Willimsky<markup.bold>'''</> <markup.italic>''</>Geboren am 28.2.1890<markup.italic>''\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Gallery (with options, html)",
		"wikitext": "<gallery widths=\"70px\" heights=\"40px\" perrow=\"2\" caption=\"Foo [[Main Page]]\">\nFile:Nonexistent.jpg|caption\nFile:Nonexistent.jpg\nimage:foobar.jpg|some '''caption''' [[Main Page]]\nimage:foobar.jpg\nimage:foobar.jpg|alt=This is a foo-bar.|blabla.\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</> <meta.attribute.unrecognized.widths.html><entity.other.attribute-name.html>widths</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>70px<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.heights.html><entity.other.attribute-name.html>heights</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>40px<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.perrow.html><entity.other.attribute-name.html>perrow</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>2<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.caption.html><entity.other.attribute-name.html>caption</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>Foo [[Main Page]]<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Nonexistent.jpg|caption\\nFile:Nonexistent.jpg\\nimage:foobar.jpg|some <markup.bold>'''</>caption<markup.bold>'''</> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]\\n</></>image:foobar.jpg\\nimage:foobar.jpg|alt=This is a foo-bar.|blabla.\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Gallery (without px units)",
		"wikitext": "<gallery widths=\"70\" heights=\"40\">\nFile:Foobar.jpg\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</> <meta.attribute.unrecognized.widths.html><entity.other.attribute-name.html>widths</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>70<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.heights.html><entity.other.attribute-name.html>heights</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>40<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Gallery (with invalid units)",
		"wikitext": "<gallery widths=\"70em\" heights=\"40em\">\nFile:Foobar.jpg\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</> <meta.attribute.unrecognized.widths.html><entity.other.attribute-name.html>widths</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>70em<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.heights.html><entity.other.attribute-name.html>heights</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>40em<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Gallery with link that has fragment",
		"wikitext": "<gallery>\nimage:foobar.jpg|link=Main_Page\nimage:foobar.jpg|link=Main_Page#section\nimage:foobar.jpg|link=Main Page#section|caption\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>image:foobar.jpg|link=Main_Page\\nimage:foobar.jpg|link=Main_Page#section\\nimage:foobar.jpg|link=Main Page#section|caption\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Gallery with template inside caption",
		"wikitext": "<gallery caption=\"{{1x|hi}}\">\nFile:Foobar.jpg|{{1x|ho}}\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</> <meta.attribute.unrecognized.caption.html><entity.other.attribute-name.html>caption</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>{{1x|hi}}<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>ho<punctuation.definition.tag.template>}}\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Gallery with wikitext inside gallery caption",
		"wikitext": "<gallery caption=\"# This should not be a list item\n\nText '''bold''' [[link]] {{ns:-1}}\n\n[[File:Foobar.jpg|thumb|File in gallery caption]]\">\nFile:Foobar.jpg|Image caption\n</gallery>",
		"parsed": "<meta.tag.other.gallery.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>gallery</></> <meta.attribute.unrecognized.caption.html><entity.other.attribute-name.html>caption</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</># This should not be a list item\\n\\nText '''bold''' [[link]] {{ns:-1}}\\n\\n[[File:Foobar.jpg|thumb|File in gallery caption]]<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt\\n</></>File:Foobar.jpg|Image caption\\n<meta.tag.other.gallery.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>gallery</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Gallery with wikitext inside caption",
		"wikitext": "<gallery>\nFile:Foobar.jpg|alt=galleryalt|[[File:Foobar.jpg|alt=inneralt|20x20px|desc]]\nFile:Foobar.jpg|alt=galleryalt|{{Test|unamedParam|alt=param}}\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|alt=galleryalt|<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>alt=</>inneralt<keyword.operator>|</>20x20<entity.other.attribute-name.localname>px</><keyword.operator>|</>desc<punctuation.definition.tag.link.internal>]]\\n</></>File:Foobar.jpg|alt=galleryalt|<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Test</><keyword.operator>|</>unamedParam<keyword.operator>|</><entity.other.attribute-name.local-name>alt</><keyword.operator.equal>=</>param<punctuation.definition.tag.template>}}\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Gallery with wikitext incl bogus HTML tag (T237318)",
		"wikitext": "<gallery>\nFile:Foobar.jpg|</ref>\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|<meta.tag.other.ref.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>ref</></><punctuation.definition.tag.end.html>&gt\\n</></></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Gallery (with showfilename option)",
		"wikitext": "<gallery showfilename=\"\">\nFile:Nonexistent.jpg|caption\nFile:Nonexistent.jpg\nFile:Foobar.jpg|some '''caption''' [[Main Page]]\nFile:Foobar.jpg\nFile:Redirect to foobar.jpg\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</> <meta.attribute.unrecognized.showfilename.html><entity.other.attribute-name.html>showfilename</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Nonexistent.jpg|caption\\nFile:Nonexistent.jpg\\nFile:Foobar.jpg|some <markup.bold>'''</>caption<markup.bold>'''</> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]\\n</></>File:Foobar.jpg\\nFile:Redirect to foobar.jpg\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Gallery (with namespace-less filenames)",
		"wikitext": "<gallery>\nFile:Nonexistent.jpg\nNonexistent.jpg\nimage:foobar.jpg\nfoobar.jpg\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Nonexistent.jpg\\nNonexistent.jpg\\nimage:foobar.jpg\\nfoobar.jpg\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Gallery override link with wikilink (T36852)",
		"wikitext": "<gallery>\nFile:Foobar.jpg|link=Wikilink|alt=galleryalt\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|link=Wikilink|alt=galleryalt\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Gallery override link with absolute external link (T36852)",
		"wikitext": "<gallery>\nFile:Foobar.jpg|alt=galleryalt|link=http://www.example.org\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|alt=galleryalt|link=http://www.example.org\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Gallery override link with absolute external link with LanguageConverter",
		"wikitext": "<gallery>\nFile:foobar.jpg|caption|alt=galleryalt|link=http://www.example.org\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:foobar.jpg|caption|alt=galleryalt|link=http://www.example.org\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Gallery override link with malicious javascript (T36852)",
		"wikitext": "<gallery>\nFile:Foobar.jpg|alt=galleryalt|link=\" onclick=\"alert('malicious javascript code!');\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|alt=galleryalt|link=\" onclick=\"alert('malicious javascript code!');\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Gallery with invalid title as link (T45964)",
		"wikitext": "<gallery>\nFile:Foobar.jpg|link=<\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|link=&lt;\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Serialize gallery without attrs in data-mw",
		"wikitext": "<gallery caption=\"123\">\nFile:Test.png\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</> <meta.attribute.unrecognized.caption.html><entity.other.attribute-name.html>caption</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>123<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Test.png\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Gallery with class and style attributes",
		"wikitext": "<gallery class=\"center\" style=\"text-align: center;\">\nFile:Foobar.jpg\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>center<punctuation.definition.string.end.html>\"</></></> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>text-align: center;</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Gallery in nolines mode",
		"wikitext": "<gallery mode=\"nolines\" showfilenames=\"yes\" caption=\"No Lines!\">\nFile:Foobar.jpg|foo\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</> <meta.attribute.unrecognized.mode.html><entity.other.attribute-name.html>mode</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>nolines<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.showfilenames.html><entity.other.attribute-name.html>showfilenames</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>yes<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.caption.html><entity.other.attribute-name.html>caption</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>No Lines!<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|foo\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Gallery in slideshow mode",
		"wikitext": "<gallery mode=\"slideshow\" showthumbnails=\"\">\nFile:Foobar.jpg\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</> <meta.attribute.unrecognized.mode.html><entity.other.attribute-name.html>mode</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>slideshow<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.showthumbnails.html><entity.other.attribute-name.html>showthumbnails</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Gallery in packed mode",
		"wikitext": "<gallery mode=\"packed\">\nFile:Foobar.jpg\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</> <meta.attribute.unrecognized.mode.html><entity.other.attribute-name.html>mode</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>packed<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Gallery in packed-overlay mode",
		"wikitext": "<gallery mode=\"packed-overlay\" showfilenames=\"yes\" caption=\"Packed Overlay!\">\nFile:Foobar.jpg|foo\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</> <meta.attribute.unrecognized.mode.html><entity.other.attribute-name.html>mode</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>packed-overlay<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.showfilenames.html><entity.other.attribute-name.html>showfilenames</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>yes<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.caption.html><entity.other.attribute-name.html>caption</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>Packed Overlay!<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|foo\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Gallery in packed-hover mode",
		"wikitext": "<gallery mode=\"packed-hover\" showfilenames=\"yes\" caption=\"Packed Hover!\">\nFile:Foobar.jpg|foo\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</> <meta.attribute.unrecognized.mode.html><entity.other.attribute-name.html>mode</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>packed-hover<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.showfilenames.html><entity.other.attribute-name.html>showfilenames</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>yes<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.caption.html><entity.other.attribute-name.html>caption</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>Packed Hover!<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|foo\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Serialize gallery image captions on a line",
		"wikitext": "<gallery>\nFile:Foobar.jpg| hi  ho \nFile:Foobar.jpg|hi<br />ho\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg| hi  ho \\nFile:Foobar.jpg|hi<meta.tag.inline.br.void.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>br</> <punctuation.definition.tag.end.html>/&gt</></>ho\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Centre-aligned image",
		"wikitext": "[[Image:foobar.jpg|centre]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>centre</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "None-aligned image",
		"wikitext": "[[Image:foobar.jpg|none]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>none</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Width + Height sized image (using px) (height is ignored)",
		"wikitext": "[[Image:foobar.jpg|640x480px]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>foobar.jpg</><keyword.operator>|</>640x480<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Width-sized image (using px, no following whitespace)",
		"wikitext": "[[Image:foobar.jpg|640px]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>foobar.jpg</><keyword.operator>|</>640<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Width-sized image (using px, with following whitespace - test regression from r39467)",
		"wikitext": "[[Image:foobar.jpg|640px ]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>foobar.jpg</><keyword.operator>|</>640<entity.other.attribute-name.localname>px</> <punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Width-sized image (using px, with preceding whitespace - test regression from r39467)",
		"wikitext": "[[Image:foobar.jpg| 640px]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>foobar.jpg</><keyword.operator>|</> 640<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with page parameter",
		"wikitext": "[[File:LoremIpsum.djvu]]\n\n[[File:LoremIpsum.djvu|page=2]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>LoremIpsum.djvu</><punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>LoremIpsum.djvu</><keyword.operator>|</><entity.other.attribute-name.localname>page=</>2<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with page parameter and link",
		"wikitext": "[[File:LoremIpsum.djvu|link=https://google.com|page=2]]\n[[File:LoremIpsum.djvu|link=https://google.com?page=4|page=2]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>LoremIpsum.djvu</><keyword.operator>|</><entity.other.attribute-name.localname>link=</>https://google.com<keyword.operator>|</><entity.other.attribute-name.localname>page=</>2<punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>LoremIpsum.djvu</><keyword.operator>|</><entity.other.attribute-name.localname>link=</>https://google.com?page=4<keyword.operator>|</><entity.other.attribute-name.localname>page=</>2<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with page parameter and manualthumb",
		"wikitext": "[[File:LoremIpsum.djvu|thumbnail=Thumb.png|page=2]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>LoremIpsum.djvu</><keyword.operator>|</><entity.other.attribute-name.localname>thumbnail=</>Thumb.png<keyword.operator>|</><entity.other.attribute-name.localname>page=</>2<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with page parameter generated by a template",
		"wikitext": "[[File:LoremIpsum.djvu|page={{1x|2}}]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>LoremIpsum.djvu</><keyword.operator>|</><entity.other.attribute-name.localname>page=</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>2<punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with modified page parameter; serialize data-mw not href query",
		"wikitext": "[[File:LoremIpsum.djvu|page 2]]\n\n[[File:LoremIpsum.djvu|page {{1x|2}}]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>LoremIpsum.djvu</><keyword.operator>|</><entity.other.attribute-name.localname>page </>2<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>LoremIpsum.djvu</><keyword.operator>|</><entity.other.attribute-name.localname>page </><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>2<punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with modified page parameter; serialize data-mw not href query (2)",
		"wikitext": "[[File:LoremIpsum.djvu|page 2]]\n\n[[File:LoremIpsum.djvu|page {{1x|2}}]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>LoremIpsum.djvu</><keyword.operator>|</><entity.other.attribute-name.localname>page </>2<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>LoremIpsum.djvu</><keyword.operator>|</><entity.other.attribute-name.localname>page </><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>2<punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Images with the \"|\" character in the comment",
		"wikitext": "[[File:Foobar.jpg|thumb|An [http://test/?param1=|left|&param2=|x external] URL]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>An <punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://test/?param1=|left|&amp;param2=|x</><string.other.link.external.title> external</><punctuation.definition.tag.link.external>]</> URL<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "T146305: Don't break image parsing if nested language converter markup is in the caption.",
		"wikitext": "[[File:Foobar.jpg|thumb|-{|zh-cn:blog (hk: -{zh-hans|WEBJOURNAL}-, tw: -{zh-hans|WEBLOG}-)}-]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</><punctuation.definition.tag.convert>-{</><keyword.operator>|</><entity.name.tag.language>zh-cn</><punctuation.separator.key-value>:</>blog (hk: <punctuation.definition.tag.convert>-{</><entity.name.function.type>zh-hans</><keyword.operator>|</>WEBJOURNAL<punctuation.definition.tag.convert>}-</>, tw: <punctuation.definition.tag.convert>-{</><entity.name.function.type>zh-hans</><keyword.operator>|</>WEBLOG<punctuation.definition.tag.convert>}-</>)}-<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Don't break gallery if language converter markup is inside.",
		"wikitext": "<gallery>\nFile:Foobar.jpg|alt=-{R|bat}-|[[File:foobar.jpg|20px|desc|alt=-{R|foo}-|-{R|bar}-]]\nFile:Foobar.jpg|alt=galleryalt|{{Test|unamedParam|alt=-{R|param}-}}\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|alt=<punctuation.definition.tag.convert>-{</><entity.name.function.type>R</><keyword.operator>|</>bat<punctuation.definition.tag.convert>}-</>|<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>foobar.jpg</><keyword.operator>|</>20<entity.other.attribute-name.localname>px</><keyword.operator>|</>desc<keyword.operator>|</><entity.other.attribute-name.localname>alt=</><punctuation.definition.tag.convert>-{</><entity.name.function.type>R</><keyword.operator>|</>foo<punctuation.definition.tag.convert>}-</><keyword.operator>|</><punctuation.definition.tag.convert>-{</><entity.name.function.type>R</><keyword.operator>|</>bar<punctuation.definition.tag.convert>}-</><punctuation.definition.tag.link.internal>]]\\n</></>File:Foobar.jpg|alt=galleryalt|<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Test</><keyword.operator>|</>unamedParam<keyword.operator>|</><entity.other.attribute-name.local-name>alt</><keyword.operator.equal>=</><punctuation.definition.tag.convert>-{</><entity.name.function.type>R</><keyword.operator>|</>param<punctuation.definition.tag.convert>}-</><punctuation.definition.tag.template>}}\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Free external link invading image caption",
		"wikitext": "[[File:Foobar.jpg|thumb|http://x|hello]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>http://x<keyword.operator>|</>hello<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Special characters in embedded file links (T29679)",
		"wikitext": "[[File:Contains & ampersand.jpg]]\n[[File:Does not exist.jpg|Title with & ampersand]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Contains &amp; ampersand.jpg</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Does not exist.jpg</><keyword.operator>|</>Title with &amp; ampersand<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "1. Treebuilder fixup of formatting elt",
		"wikitext": "{|\n|\n<small>\n[[Image:Foobar.jpg|right|Test]]\n</small>\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|\\n</></><meta.tag.inline.small.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt\\n</></><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>right</><keyword.operator>|</>Test<punctuation.definition.tag.link.internal>]]\\n</></><meta.tag.inline.small.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "2. Treebuilder fixup of formatting elt",
		"wikitext": "'''foo[[File:Foobar.jpg|thumb|caption]]bar'''\n\n<small>[[Image:Foobar.jpg|right|300px]]</small>",
		"parsed": "<markup.bold>'''</>foo<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]</></>bar<markup.bold>'''\\n\\n</><meta.tag.inline.small.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt</></><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>right</><keyword.operator>|</>300<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]</></><meta.tag.inline.small.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "3. Treebuilder fixup of formatting elt",
		"wikitext": "<small>'''foo[[File:Foobar.jpg|thumb|caption]]bar'''</small>",
		"parsed": "<meta.tag.inline.small.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt</></><markup.bold>'''</>foo<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]</></>bar<markup.bold>'''</><meta.tag.inline.small.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "4. Treebuilder fixup of formatting elt: formatting tags around captionless images",
		"wikitext": "'''<small>[[Image:Foobar.jpg|right|300px]]</small>'''",
		"parsed": "<markup.bold>'''</><meta.tag.inline.small.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt</></><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>right</><keyword.operator>|</>300<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]</></><meta.tag.inline.small.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>small</><punctuation.definition.tag.end.html>&gt</></><markup.bold>'''</>"
	},
	{
		"desc": "Image: Modifying size of an image (1)",
		"wikitext": "[[Image:Foobar.jpg|230x230px]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>230x230<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: Modifying size of an image (2)",
		"wikitext": "[[Image:Foobar.jpg|230x230px]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>230x230<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: Modifying size of an image (3)",
		"wikitext": "[[Image:Foobar.jpg|thumb]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: Modifying alignment of an image (T50665)",
		"wikitext": "[[Image:Foobar.jpg|thumb|caption|right]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>caption<keyword.operator>|</><entity.other.attribute-name.localname>right</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: Modifying mw-default-size of an frameless image (T64805)",
		"wikitext": "[[Image:Foobar.jpg|frameless|right]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>frameless</><keyword.operator>|</><entity.other.attribute-name.localname>right</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: Modifying valign of an image (T51221)",
		"wikitext": "[[File:Foobar.jpg|20px|middle]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>20<entity.other.attribute-name.localname>px</><keyword.operator>|</><entity.other.attribute-name.localname>middle</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: Modifying alt attribute of an image (T58400)",
		"wikitext": "[[File:Foobar.jpg|thumb|some caption|alt=some alternate text]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>some caption<keyword.operator>|</><entity.other.attribute-name.localname>alt=</>some alternate text<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: Modifying caption of an image",
		"wikitext": "[[Image:Foobar.jpg|thumb|original caption]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>original caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: empty alt attribute (T50924)",
		"wikitext": "[[File:Foobar.jpg|alt=|thumb|bar]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>alt=</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>bar<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: Block level image should have \\n before and after",
		"wikitext": "123\n[[File:Foobar.jpg|right|thumb|150x150px]]\n456",
		"parsed": "123\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>right</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>150x150<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]\\n</></>456"
	},
	{
		"desc": "Image: New block level image should have \\n before and after (existing content)",
		"wikitext": "123\n[[File:Foobar.jpg|right|thumb|150x150px]]\n456",
		"parsed": "123\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>right</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>150x150<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]\\n</></>456"
	},
	{
		"desc": "Image: upright option (parsoid)",
		"wikitext": "[[File:Foobar.jpg|thumb|upright|caption]]\n[[File:Foobar.jpg|thumb|upright=0.5|caption]]\n[[File:Foobar.jpg|thumb|500x500px|upright=0.5|caption]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</><entity.other.attribute-name.localname>upright</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</><entity.other.attribute-name.localname>upright=</>0.5<keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>500x500<entity.other.attribute-name.localname>px</><keyword.operator>|</><entity.other.attribute-name.localname>upright=</>0.5<keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: upright option is ignored on inline and frame images (parsoid)",
		"wikitext": "[[File:Foobar.jpg|500x500px|upright=0.5|caption]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>500x500<entity.other.attribute-name.localname>px</><keyword.operator>|</><entity.other.attribute-name.localname>upright=</>0.5<keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: in template parameter with empty parameter",
		"wikitext": "{{1x|[[File:Foobar.jpg|link=]]}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Image: from basic HTML (1)",
		"wikitext": "[[File:Foobar.jpg|link=|alt=Alt|100x100px]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</><keyword.operator>|</><entity.other.attribute-name.localname>alt=</>Alt<keyword.operator>|</>100x100<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: from basic HTML (2)",
		"wikitext": "[[File:Foobar.jpg|link=|alt=Alt|100x100px]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</><keyword.operator>|</><entity.other.attribute-name.localname>alt=</>Alt<keyword.operator>|</>100x100<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: from basic HTML (3)",
		"wikitext": "[[File:Foobar.jpg|link=Main|alt=Alt|100x100px]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</>Main<keyword.operator>|</><entity.other.attribute-name.localname>alt=</>Alt<keyword.operator>|</>100x100<entity.other.attribute-name.localname>px</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: from basic HTML (4)",
		"wikitext": "[[File:Foobar.jpg|link=]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image: Invalid title as link",
		"wikitext": "[[File:Foobar.jpg|link=<]]\n[[File:Foobar.jpg|link=<|thumb]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</>&lt;<punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</>&lt;<keyword.operator>|</><entity.other.attribute-name.localname>thumb</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Image with page parameter and invalid link",
		"wikitext": "[[File:LoremIpsum.djvu|link=<|page=2]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>LoremIpsum.djvu</><keyword.operator>|</><entity.other.attribute-name.localname>link=</>&lt;<keyword.operator>|</><entity.other.attribute-name.localname>page=</>2<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Percent decode titles in the link option (T216003#7836261)",
		"wikitext": "[[Test%22123]]\n[[File:Foobar.jpg|link=Test%22123]]\n[[File:Foobar.jpg|link=[[Test%22123]]]]\n\n<gallery>\nFile:Foobar.jpg|link=Test%22123\nFile:Foobar.jpg|link=[[Test%22123]]\n</gallery>",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Test%22123</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</>Test%22123<punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Test%22123</><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.link.internal>]]\\n\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|link=Test%22123\\nFile:Foobar.jpg|link=<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Test%22123</><punctuation.definition.tag.link.internal>]]\\n</></></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Should not double decode the link option",
		"wikitext": "[[Test%2522]]\n[[File:Foobar.jpg|link=Test%2522]]\n[[File:Foobar.jpg|link=[[Test%2522]]]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Test%2522</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</>Test%2522<punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Test%2522</><punctuation.definition.tag.link.internal>]]</></><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Various link types in alt and link options",
		"wikitext": "[[File:Foobar.jpg|link=[[Main Page]]|alt=[[Main Page]]|caption]]\n\n[[File:Foobar.jpg|link=[[Media:Thumb.png]]|alt=[[Media:Thumb.png]]|caption]]\n\n[[File:Foobar.jpg|link=[[wikipedia:Foo]]|alt=[[wikipedia:Foo]]|caption]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</></><keyword.operator>|</><entity.other.attribute-name.localname>alt=</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</></><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Media:</><entity.other.attribute-name>Thumb.png</><punctuation.definition.tag.link.internal>]]</></><keyword.operator>|</><entity.other.attribute-name.localname>alt=</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Media:</><entity.other.attribute-name>Thumb.png</><punctuation.definition.tag.link.internal>]]</></><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]\\n\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>link=</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>wikipedia:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></><keyword.operator>|</><entity.other.attribute-name.localname>alt=</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>wikipedia:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Magic links inside image captions (autolinked)",
		"wikitext": "[[File:Foobar.jpg|thumb|http://example.com]]\n[[File:Foobar.jpg|thumb|RFC 1234]]\n[[File:Foobar.jpg|thumb|PMID 1234]]\n[[File:Foobar.jpg|thumb|ISBN 123456789x]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>http://example.com<punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</><constant.language.variables.rfc>RFC 1234</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</><constant.language.variables.pmid>PMID 1234</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</><constant.language.variables.isbn>ISBN 123456789x</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "File in link scenarios",
		"wikitext": "[http://www.google.com [[File:Foobar.jpg|123]]]\n\n[http://www.google.com [[File:Foobar.jpg|thumb|123]]]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.google.com</><string.other.link.external.title> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>123</></><punctuation.definition.tag.link.external>]</>]]\\n\\n<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://www.google.com</><string.other.link.external.title> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>123</></><punctuation.definition.tag.link.external>]</>]]"
	},
	{
		"desc": "Thumbnail output",
		"wikitext": "[[File:Thumb.png|thumb]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Thumb.png</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "File with caption with pipe in extension tag attribute",
		"wikitext": "[[File:Foobar.jpg|thumb|Test <nowiki bogus=\"attri|bute\"/> 123]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>Test <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</> <meta.attribute.unrecognized.bogus.html><entity.other.attribute-name.html>bogus</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>attri|bute<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>/&gt</> 123<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "File with table in caption with extra table attribute spaces",
		"wikitext": "[[File:Foobar.jpg|thumb|\n{|\n|-  \n|hi\n|}\n]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|\\n</><meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.table-row><keyword.operator>|-</>  \\n</><meta.tag.block.td><keyword.operator>|</><markup.style>hi\\n</></><keyword.operator>|}\\n</></><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "File in formatting element violating content model",
		"wikitext": "<p>''[[File:Foobar.jpg|thumb]]''</p>",
		"parsed": "<meta.tag.structure.p.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></><markup.italic>''</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><punctuation.definition.tag.link.internal>]]</></><markup.italic>''</><meta.tag.structure.p.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "File in formatting element violating content model, multiple open",
		"wikitext": "<p>'''''[[File:Foobar.jpg|thumb]]'''''</p>",
		"parsed": "<meta.tag.structure.p.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></><markup.bold.italic>'''''</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><punctuation.definition.tag.link.internal>]]</></><markup.bold.italic>'''''</><meta.tag.structure.p.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "File in formatting element violating content model, figcaption content",
		"wikitext": "<p>''test [[File:Foobar.jpg|thumb|123]] 456''</p>",
		"parsed": "<meta.tag.structure.p.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></><markup.italic>''</>test <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>123<punctuation.definition.tag.link.internal>]]</></> 456<markup.italic>''</><meta.tag.structure.p.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Table in figcaption nested in table",
		"wikitext": "{|\n|foo\n|[[File:Foobar.jpg|thumb|\n{|\n|bar\n|}\n]]\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>foo\\n</><keyword.operator>|</><markup.style><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|\\n</></></></><meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>bar\\n</></><keyword.operator>|}\\n</></>]]\\n<keyword.operator>|}</></>"
	},
	{
		"desc": "Files with case sensitive media options",
		"wikitext": "[[File:Foobar.jpg|thumb|left]]\n[[File:Foobar.jpg|thumb|Left]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</><entity.other.attribute-name.localname>left</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>Left<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Exercise selser on native galleries",
		"wikitext": "<gallery>\nFile:Foobar.jpg|alt=123|123\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|alt=123|123\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Selser preserves spacing in gallery when only caption is edited",
		"wikitext": "<gallery caption=\"123\">\nFile:Foobar.jpg\n\nFile:Foobar.jpg\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</> <meta.attribute.unrecognized.caption.html><entity.other.attribute-name.html>caption</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>123<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg\\n\\nFile:Foobar.jpg\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Selser preserves unedited gallery lines",
		"wikitext": "<gallery>\nFile:Foobar.jpg|123\nFile:Foobar.jpg|thumb|haha\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|123\\nFile:Foobar.jpg|thumb|haha\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Format option in gallery - T214601",
		"wikitext": "<gallery>\nFile:Foobar.jpg|thumb|123\nFile:Doesnotexist.jpg|thumb|456 - has an error noted in the rdfa\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|thumb|123\\nFile:Doesnotexist.jpg|thumb|456 - has an error noted in the rdfa\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Broken inline media with a caption and an alt",
		"wikitext": "[[File:Broken.jpg|alt=An alternative text description.|A caption for the media.]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Broken.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>alt=</>An alternative text description.<keyword.operator>|</>A caption for the media.<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Broken block media with a caption and an alt",
		"wikitext": "[[File:Broken.jpg|alt=An alternative text description.|thumb|A caption for the media.]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Broken.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>alt=</>An alternative text description.<keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>A caption for the media.<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Broken inline media with a caption",
		"wikitext": "[[File:Broken.jpg|A caption for the media.]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Broken.jpg</><keyword.operator>|</>A caption for the media.<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Broken block media with a caption",
		"wikitext": "[[File:Broken.jpg|thumb|A caption for the media.]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Broken.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>A caption for the media.<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Gallery line without file namespace",
		"wikitext": "<gallery>\nFoobar.jpg\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>Foobar.jpg\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Lines added to a self-closed gallery should not be dropped",
		"wikitext": "<gallery caption=\"123\" />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</> <meta.attribute.unrecognized.caption.html><entity.other.attribute-name.html>caption</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>123<punctuation.definition.string.end.html>\"</></> </><punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "Broken media with frame and frameless formats",
		"wikitext": "[[File:Barfoo.jpg|frame|123]]\n[[File:Barfoo.jpg|frameless|123]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Barfoo.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>frame</><keyword.operator>|</>123<punctuation.definition.tag.link.internal>]]\\n[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Barfoo.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>frameless</><keyword.operator>|</>123<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Media with broken manualthumb",
		"wikitext": "[[File:Foobar.jpg|thumbnail=Barfoo.jpg|123]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumbnail=</>Barfoo.jpg<keyword.operator>|</>123<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Media with caption that would stringify to a valid media option",
		"wikitext": "[[File:Foobar.jpg|'''thumb''']]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><markup.bold>'''</>thumb<markup.bold>'''</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Collect media metadata",
		"wikitext": "[[File:Foobar.jpg|123]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</>123<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Entities in media filenames",
		"wikitext": "[[File:Hi&#45;ho.jpg|thumb]]\n\n<gallery>\nHi&#45;ho.jpg\nFile:Hi&#45;ho.jpg\n</gallery>",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Hi&amp;</><invalid.deprecated.ineffective>#45;ho.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><punctuation.definition.tag.link.internal>]]\\n\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>Hi<constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#45;</>ho.jpg\\nFile:Hi<constant.character.entity.numeric.decimal.html><punctuation.definition.entity.html>&amp;</>#45;</>ho.jpg\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Inline gallery attributes are appended to the defaults",
		"wikitext": "<gallery perrow=\"1\" style=\"color: red\">\nFile:Foobar.jpg|One\nFile:Foobar.jpg|Two\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</> <meta.attribute.unrecognized.perrow.html><entity.other.attribute-name.html>perrow</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>color: red</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|One\\nFile:Foobar.jpg|Two\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Gallery line with trailing closing square brackets",
		"wikitext": "<gallery>\nFile:Foobar.jpg|Testing 123]]\nFile:Foobar.jpg|Testing [[123]]\n</gallery>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>File:Foobar.jpg|Testing 123]]\\nFile:Foobar.jpg|Testing <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>123</><punctuation.definition.tag.link.internal>]]\\n</></></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>gallery</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "parserFunctionTests"
	},
	{
		"desc": "T240248: Erroring parser function shouldn't break references",
		"wikitext": "<ref>something</ref>\n{{#ifeq: {{#expr: string < 5 }} | 1 | true | false or error }}\n<references />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt</><meta.block.ref>something</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>ref</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.function>{{</><constant.language.variables.query>#ifeq</><keyword.operator.function>:</> <punctuation.definition.tag.function>{{</><constant.language.variables.query>#expr</><keyword.operator.function>:</> string &lt; 5 <punctuation.definition.tag.function>}}</> <keyword.operator>|</> 1 <keyword.operator>|</> true <keyword.operator>|</> false or error <punctuation.definition.tag.function>}}\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>references</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "pfeqParserTests"
	},
	{
		"desc": "Basic usage of {{=}}",
		"wikitext": "This uses {{=}}.",
		"parsed": "This uses <constant.language.variables.metadata>{{=}}</>."
	},
	{
		"desc": "Using {{Template:=}} doesn't invoke the parser function",
		"wikitext": "This uses {{Template:=}}.",
		"parsed": "This uses <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Template:=</><punctuation.definition.tag.template>}}</>."
	},
	{
		"desc": "poem"
	},
	{
		"desc": "<poem>",
		"wikitext": "<poem>\nthis\nis\na\ntest\n</poem>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>poem</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>this\\nis\\na\\ntest\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>poem</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "<poem> with recursive parsing",
		"wikitext": "<poem>\nthis ''is'' a '''test'''\n</poem>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>poem</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>this <markup.italic>''</>is<markup.italic>''</> a <markup.bold>'''</>test<markup.bold>'''\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>poem</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "<poem> with leading whitespace",
		"wikitext": "<poem>\n\n   test\n\n</poem>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>poem</><punctuation.definition.tag.end>&gt\\n\\n</><meta.block.ref>   test\\n\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>poem</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Horizontal rule",
		"wikitext": "<poem>\nsome\n-----\ntext\n</poem>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>poem</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>some\\n<markup.changed>-----\\n</>text\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>poem</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "nested <poem><nowiki>",
		"wikitext": "<poem><nowiki>\nthis\nis\na\ntest\n</nowiki></poem>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>poem</><punctuation.definition.tag.end>&gt</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n</><meta.embedded.block.plaintext>this\\nis\\na\\ntest\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>poem</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "nested <poem><nowiki> with formatting",
		"wikitext": "<poem><nowiki>\nthis\n'''is'''\na\ntest\n</nowiki></poem>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>poem</><punctuation.definition.tag.end>&gt</><meta.block.ref><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n</><meta.embedded.block.plaintext>this\\n'''is'''\\na\\ntest\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>poem</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Basic <poem> usage with style",
		"wikitext": "<poem style=\"border: 2px solid #d6d2c5; background-color: #f9f4e6; padding: 1em;\">\nA stately pleasure-dome decree:\nWhere Alph, the sacred river, ran\nThrough caverns measureless to man\nDown to a sunless sea.\n</poem>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>poem</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>border: 2px solid #d6d2c5; background-color: #f9f4e6; padding: 1em;</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>A stately pleasure-dome decree:\\nWhere Alph, the sacred river, ran\\nThrough caverns measureless to man\\nDown to a sunless sea.\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>poem</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Verify Parsoid handles entities in nowikis in poem correctly",
		"wikitext": "<poem>\nL1\nL2\n<nowiki>\n<ref>Not a ref</ref>\nfoo &amp; bar\n[[Not a link]]\n</nowiki>\nL3\n</poem>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>poem</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>L1\\nL2\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n</><meta.embedded.block.plaintext>&lt;ref&gtNot a ref&lt;/ref&gt\\nfoo <constant.character.entity.named.amp.html><punctuation.definition.entity.html>&amp;</>amp<punctuation.definition.entity.html>;</></> bar\\n[[Not a link]]\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n</>L3\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>poem</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "UTF-8 sequences in extension tags (T231945)",
		"wikitext": "<poem>\n{{1x|á¶á€­á€°á€á€ºá€¸á‚á€á€ºá¶á€­á€°á€á€ºá€¸á€›á‚ƒá‚‡á¸á‚ƒá‚‡}}\n</poem>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>poem</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>á¶á€­á€°á€á€ºá€¸á‚á€á€ºá¶á€­á€°á€á€ºá€¸á€›á‚ƒá‚‡á¸á‚ƒá‚‡<punctuation.definition.tag.template>}}\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>poem</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Multi-line poems with indentation use spans and breaks correctly (T235709)",
		"wikitext": "<poem>\n''CONGREGATI''\n:'''EX TOTO ORBE'''\n::'''''MATHEMATICI'''''\n:<span>foo</span>\n</poem>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>poem</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><markup.italic>''</>CONGREGATI<markup.italic>''\\n</><punctuation.definition.list.begin.markdown>:</><markup.bold>'''</>EX TOTO ORBE<markup.bold>'''\\n</><punctuation.definition.list.begin.markdown>::</><markup.bold.italic>'''''</>MATHEMATICI<markup.bold.italic>'''''\\n</><punctuation.definition.list.begin.markdown>:</><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n</></></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>poem</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Indention syntax with no content",
		"wikitext": "<poem>\n::\n</poem>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>poem</><punctuation.definition.tag.end>&gt\\n</><meta.block.ref><punctuation.definition.list.begin.markdown>::\\n</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>poem</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Poem with class",
		"wikitext": "<poem class=\"hiho\">\nhi ho\n</poem>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>poem</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>hiho<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>hi ho\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>poem</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Poem with empty class",
		"wikitext": "<poem class=\"\">\nhi ho\n</poem>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>poem</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt\\n</><meta.block.ref>hi ho\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>poem</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "preTags"
	},
	{
		"desc": "<pre> with attributes (T5202)",
		"wikitext": "<pre style=\"background: blue; color:white\">Bluescreen of WikiDeath</pre>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>background: blue; color:white</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>Bluescreen of WikiDeath</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "<pre> with width attribute (T5202)",
		"wikitext": "<pre width=\"8\">Narrow screen goodies</pre>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</> <meta.attribute.width.html><entity.other.attribute-name.html>width</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>8<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>Narrow screen goodies</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "<pre> with forbidden attribute (T5202)",
		"wikitext": "<pre width=\"8\" onmouseover=\"alert(document.cookie)\">Narrow screen goodies</pre>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</> <meta.attribute.width.html><entity.other.attribute-name.html>width</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>8<punctuation.definition.string.end.html>\"</></></> <meta.attribute.event-handler.mouseover.html><entity.other.attribute-name.html>onmouseover</><punctuation.separator.key-value.html>=</><meta.embedded.line.js><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.js><meta.function-call.js><entity.name.function.js>alert</></><meta.brace.round.js>(</><variable.other.object.js>document</><punctuation.accessor.js>.</><variable.other.property.js>cookie</><meta.brace.round.js>)</></><punctuation.definition.string.end.html><source.js>\"</></></></></><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>Narrow screen goodies</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Entities inside <pre>",
		"wikitext": "<pre>&lt;</pre>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext><constant.character.entity.named.lt.html><punctuation.definition.entity.html>&amp;</>lt<punctuation.definition.entity.html>;</></></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "<pre> with forbidden attribute values (T5202)",
		"wikitext": "<pre width=\"8\" style=\"border-width: expression(alert(document.cookie))\">Narrow screen goodies</pre>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</> <meta.attribute.width.html><entity.other.attribute-name.html>width</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>8<punctuation.definition.string.end.html>\"</></></> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>border-width: expression(alert(document.cookie))</><punctuation.definition.string.end.html><source.css>\"</></></></></><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>Narrow screen goodies</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "<nowiki> inside <pre> (T15238)",
		"wikitext": "<pre>\n<nowiki>\n</pre>\n<pre>\n<nowiki></nowiki>\n</pre>\n<pre><nowiki><nowiki></nowiki>Foo<nowiki></nowiki></nowiki></pre>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n</><meta.embedded.block.plaintext>&lt;nowiki&gt\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n</><meta.embedded.block.plaintext>&lt;nowiki&gt&lt;/nowiki&gt\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>&lt;nowiki&gt&lt;nowiki&gt&lt;/nowiki&gtFoo&lt;nowiki&gt&lt;/nowiki&gt&lt;/nowiki&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "<nowiki> inside of #tag:pre",
		"wikitext": "{{#tag:pre|Foo <nowiki>&rarr;bar</nowiki>}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#tag</><keyword.operator.function>:</>pre<keyword.operator>|</>Foo <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext><constant.character.entity.named.rarr.html><punctuation.definition.entity.html>&amp;</>rarr<punctuation.definition.entity.html>;</></>bar</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "<nowiki> and <pre> preference (first one wins)",
		"wikitext": "<pre>\n<nowiki>\n</pre>\n</nowiki>\n</pre>\n\n<nowiki>\n<pre>\n<nowiki>\n</pre>\n</nowiki>\n</pre>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n</><meta.embedded.block.plaintext>&lt;nowiki&gt\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n</><meta.tag.other.nowiki.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>nowiki</></><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.pre.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>pre</><punctuation.definition.tag.end.html>&gt\\n\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n</><meta.embedded.block.plaintext>&lt;pre&gt\\n&lt;nowiki&gt\\n&lt;/pre&gt\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n</><meta.tag.structure.pre.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>pre</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "</pre> inside nowiki",
		"wikitext": "<nowiki></pre></nowiki>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>&lt;/pre&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Empty pre; pre inside other HTML tags (T56946)",
		"wikitext": "a\n\n<div><pre>\nfoo\n</pre></div>\n<pre></pre>",
		"parsed": "a\\n\\n<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n</><meta.embedded.block.plaintext>foo\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "HTML pre followed by indent-pre",
		"wikitext": "<pre>foo</pre>\n bar",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n</> bar"
	},
	{
		"desc": "Block tag pre",
		"wikitext": "<p><pre>foo</pre></p>",
		"parsed": "<meta.tag.structure.p.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</><meta.tag.structure.p.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>p</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Pres with newline attributes",
		"wikitext": "<pre class=\"one\ntwo\">hi</pre>",
		"parsed": "<meta.tag.structure.pre.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>pre</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>one\\ntwo<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>hi<meta.tag.structure.pre.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>pre</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Things that look like <pre> tags aren't treated as such",
		"wikitext": "Barack Obama <President> of the United States\n<President></President>",
		"parsed": "Barack Obama <meta.tag.other.President.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>President</></><punctuation.definition.tag.end.html>&gt</></> of the United States\\n<meta.tag.other.President.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>President</></><punctuation.definition.tag.end.html>&gt</><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>President</></><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Handle broken pre-like tags (T66025)",
		"wikitext": "{{1x|<pre <pre>x</pre>}}\n\n<table><pre </table>",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</> <invalid.illegal.character-not-allowed-here.html>&lt;pre</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>x</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.template>}}\\n\\n</><meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</> <invalid.illegal.character-not-allowed-here.html>&lt;/table</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Less than in attribute position",
		"wikitext": "<pre <pre>123</pre>\n\n<div <div>123</div>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</> <invalid.illegal.character-not-allowed-here.html>&lt;pre</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>123</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n\\n</><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <invalid.illegal.character-not-allowed-here.html>&lt;div</><punctuation.definition.tag.end.html>&gt</></>123<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Parsoid: handle pre with space after attribute",
		"wikitext": "<pre style=\"width:50%;\" >{{1x|foo}}</pre>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>width:50%;</><punctuation.definition.string.end.html><source.css>\"</></></></> </><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>{{1x|foo}}</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Self-closed pre",
		"wikitext": "<pre />",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</> <punctuation.definition.tag.end>/&gt</>"
	},
	{
		"desc": "HTML-pre: 1. embedded newlines",
		"wikitext": "<pre>foo</pre>\n\n<pre>\nfoo\n</pre>\n\n<pre>\n\nfoo\n</pre>\n\n<pre>\n\n\nfoo\n</pre>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n</><meta.embedded.block.plaintext>foo\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n\\n</><meta.embedded.block.plaintext>foo\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n\\n\\n</><meta.embedded.block.plaintext>foo\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "HTML-pre: big spaces",
		"wikitext": "<pre>\n\n\n\n\nhaha\n\n\n\n\nhaha\n\n\n\n\n</pre>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n\\n\\n\\n\\n</><meta.embedded.block.plaintext>haha\\n\\n\\n\\n\\nhaha\\n\\n\\n\\n\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "HTML-pre: 2: indented text",
		"wikitext": "<pre>\n foo\n</pre>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n</><meta.embedded.block.plaintext> foo\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "HTML-pre: 3: other wikitext",
		"wikitext": "<pre>\n* foo\n# bar\n= no-h =\n'' no-italic ''\n[[ NoLink ]]\n</pre>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt\\n</><meta.embedded.block.plaintext>* foo\\n# bar\\n= no-h =\\n'' no-italic ''\\n[[ NoLink ]]\\n</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>pre</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "preprocessor"
	},
	{
		"desc": "Preprocessor precedence 1: link is rightmost opening",
		"wikitext": "{{[[Foo|bar}}]]\n\nBut close-brace is not a valid character in a link title:\n{{[[Foo}}|bar]]\n\nHowever, we can still tell this was handled as a link in the preprocessor:\n{{1x|[[Foo}}|bar]]|bat}}",
		"parsed": "{{<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</>bar}}<punctuation.definition.tag.link.internal>]]\\n\\n</></>But close-brace is not a valid character in a link title:\\n{{<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><invalid.deprecated.ineffective>}}</><keyword.operator>|</>bar<punctuation.definition.tag.link.internal>]]\\n\\n</></>However, we can still tell this was handled as a link in the preprocessor:\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><invalid.deprecated.ineffective>}}</><keyword.operator>|</>bar<punctuation.definition.tag.link.internal>]]</></><keyword.operator>|</>bat<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Preprocessor precedence 2: template is rightmost opening",
		"wikitext": "-{{1x|foo}-}}-",
		"parsed": "-<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo}-<punctuation.definition.tag.template>}}</>-"
	},
	{
		"desc": "Preprocessor precedence 3: language converter is rightmost opening",
		"wikitext": "{{1x|hi}}\n\n{{-{R|1x|hi}}}-\n\n[[-{R|raw]]}-",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>hi<punctuation.definition.tag.template>}}\\n\\n{{</><entity.name.tag.local-name>-</>{R<keyword.operator>|</>1x<keyword.operator>|</>hi<punctuation.definition.tag.template>}}</>}-\\n\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>-</>{R<keyword.operator>|</>raw<punctuation.definition.tag.link.internal>]]</></>}-"
	},
	{
		"desc": "Preprocessor precedence 4: left-most angle bracket",
		"wikitext": "<!--{raw}-->",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</>{raw}<punctuation.definition.comment.html>--&gt</></>"
	},
	{
		"desc": "Preprocessor precedence 5: tplarg takes precedence over template",
		"wikitext": "{{Precedence5|Bullet}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Precedence5</><keyword.operator>|</>Bullet<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Preprocessor precedence 6: broken link is rightmost opening",
		"wikitext": "{{1x|[[Foo}}\n\n{{1x|[[Foo|bar|bat=baz}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><invalid.deprecated.ineffective>}}\\n\\n</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</>bar|bat=baz}}</></>"
	},
	{
		"desc": "Preprocessor precedence 7: broken template is rightmost opening",
		"wikitext": "[[Foo|{{1x|Bar]]\n\n[[Foo|{{1x|Bar]]-x}}-y]]-z\n\nCareful: linktrails can move the end of the wikilink:\n[[Foo|{{1x|y']]a}}l]]l",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>Bar]]\\n\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>Bar]]-x<punctuation.definition.tag.template>}}</>-y<punctuation.definition.tag.link.internal>]]</></>-z\\n\\nCareful: linktrails can move the end of the wikilink:\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>y']]a<punctuation.definition.tag.template>}}</>l<punctuation.definition.tag.link.internal>]]</></>l</>"
	},
	{
		"desc": "Preprocessor precedence 8: broken language converter is rightmost opening",
		"wikitext": "[[Foo-{R|raw]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo-</>{R<keyword.operator>|</>raw<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Preprocessor precedence 9: groups of braces",
		"wikitext": "{{Preprocessor precedence 9|Four|Bullet|1|2}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Preprocessor precedence 9</><keyword.operator>|</>Four<keyword.operator>|</>Bullet<keyword.operator>|</>1<keyword.operator>|</>2<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Preprocessor precedence 10: groups of braces with leading dash",
		"wikitext": "{{Preprocessor precedence 10|Three|raw2|Bullet|1|2}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Preprocessor precedence 10</><keyword.operator>|</>Three<keyword.operator>|</>raw2<keyword.operator>|</>Bullet<keyword.operator>|</>1<keyword.operator>|</>2<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Preprocessor precedence 11: found during visual diff testing",
		"wikitext": "{{#tag:span|-{{#tag:span|-{{1x|x}}}}}}\n\n{{1x|-{{1x|-{{1x|x}}}}}}\n\n{{1x|-{{1x|x}}}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#tag</><keyword.operator.function>:</>span<keyword.operator>|</>-<punctuation.definition.tag.function>{{</><constant.language.variables.query>#tag</><keyword.operator.function>:</>span<keyword.operator>|</>-<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>x<punctuation.definition.tag.template>}}</><punctuation.definition.tag.function>}}}}\\n\\n</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>-<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>-<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>x<punctuation.definition.tag.template>}}}}}}\\n\\n{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>-<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>x<punctuation.definition.tag.template>}}}}</>"
	},
	{
		"desc": "Preprocessor precedence 13: broken language converter in external link",
		"wikitext": "*[http://example.com/-{foo Example in URL]\n*[http://example.com Example in -{link} description]\n*{{1x|[http://example.com/-{foo Breaks template, however]}}",
		"parsed": "<punctuation.definition.list.begin.markdown>*</><punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com/-{foo</><string.other.link.external.title> Example in URL</><punctuation.definition.tag.link.external>]\\n</><punctuation.definition.list.begin.markdown>*</><punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com</><string.other.link.external.title> Example in <punctuation.definition.tag.convert>-{</>link} description</><punctuation.definition.tag.link.external>]\\n</><punctuation.definition.list.begin.markdown>*</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://example.com/-{foo</><string.other.link.external.title> Breaks template, however</><punctuation.definition.tag.link.external>]</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Preprocessor precedence 14: broken language converter in comment",
		"wikitext": "*<!--{{foo}}-->...should be ok\n*<!---{{foo}}-->...extra dashes\n*{{1x|foo<!-- -{bar} -->bat}}...should be ok",
		"parsed": "<punctuation.definition.list.begin.markdown>*</><comment.block.html><punctuation.definition.comment.html>&lt;!--</>{{foo}}<punctuation.definition.comment.html>--&gt</></>...should be ok\\n<punctuation.definition.list.begin.markdown>*</><comment.block.html><punctuation.definition.comment.html>&lt;!--</>-{{foo}}<punctuation.definition.comment.html>--&gt</></>...extra dashes\\n<punctuation.definition.list.begin.markdown>*</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>foo<comment.block.html><punctuation.definition.comment.html>&lt;!--</> -{bar} <punctuation.definition.comment.html>--&gt</></>bat<punctuation.definition.tag.template>}}</>...should be ok"
	},
	{
		"desc": "Preprocessor precedence 15: broken brace markup in headings",
		"wikitext": "__NOTOC__ __NOEDITSECTION__\n===1 foo[bar 1===\n1\n===2 foo[[bar 2===\n2\n===3 foo{bar 3===\n3\n===4 foo{{bar 4===\n4\n===5 foo{{{bar 5===\n5\n===6 foo-{bar 6===\n6",
		"parsed": "<constant.language.behavior>__NOTOC__</> <constant.language.behavior>__NOEDITSECTION__\\n</><markup.heading>===<string.quoted.other.heading>1 foo[bar 1</>===\\n</>1\\n<markup.heading>===<string.quoted.other.heading>2 foo<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>bar 2</></></>===\\n</>2\\n<markup.heading>===<string.quoted.other.heading>3 foo{bar 3</>===\\n</>3\\n<markup.heading>===<string.quoted.other.heading>4 foo<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>bar 4</></>===\\n</>4\\n<markup.heading>===<string.quoted.other.heading>5 foo<punctuation.definition.tag.variable>{{{</><variable.other>bar 5</></>===\\n</>5\\n<markup.heading>===<string.quoted.other.heading>6 foo<punctuation.definition.tag.convert>-{</>bar 6</>===\\n</>6"
	},
	{
		"desc": "Preprocessor precedence 16: matching closing braces to opening braces",
		"wikitext": "-{{{1x|foo}}bar}-",
		"parsed": "-<punctuation.definition.tag.variable>{{{</><variable.other>1x</><variable.parameter><keyword.operator>|</>foo}}bar}-</>"
	},
	{
		"desc": "Preprocessor precedence 17: template w/o target shouldn't prevent closing",
		"wikitext": "{{1x|hi {{}}}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>hi {{<punctuation.definition.tag.template>}}</>}}"
	},
	{
		"desc": "Preprocessor precedence 19: break syntax",
		"wikitext": "-{{",
		"parsed": "-<punctuation.definition.tag.template>{{</>"
	},
	{
		"desc": "Language converter over extlink",
		"wikitext": "{{1x\n| [-{oh no]}-]\n}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x\\n</><keyword.operator>|</> [<punctuation.definition.tag.convert>-{</>oh no]<punctuation.definition.tag.convert>}-</>]\\n<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "pst"
	},
	{
		"desc": "pre-save transform: subst:",
		"wikitext": "{{subst:test}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>subst</><keyword.operator.function>:</>test<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "pre-save transform: normal template",
		"wikitext": "{{test}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>test</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "pre-save transform: nonexistent template",
		"wikitext": "{{thistemplatedoesnotexist}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>thistemplatedoesnotexist</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "pre-save transform: subst magic variables",
		"wikitext": "{{subst:SITENAME}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>subst</><keyword.operator.function>:</>SITENAME<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "pre-save transform: subst: templates with parameters",
		"wikitext": "{{subst:paramtest|param=\"something else\"}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>subst</><keyword.operator.function>:</>paramtest<keyword.operator>|</>param=\"something else\"<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "pre-save transform: nowiki in subst (T3188)",
		"wikitext": "{{subst:nowikitest}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>subst</><keyword.operator.function>:</>nowikitest<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "pre-save transform: comment in subst (T3936)",
		"wikitext": "{{subst:commenttest}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>subst</><keyword.operator.function>:</>commenttest<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "pre-save transform: unclosed tag",
		"wikitext": "<nowiki>'''not wiki'''",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>'''not wiki'''</>"
	},
	{
		"desc": "pre-save transform: mixed tag case",
		"wikitext": "<NOwiki>'''not wiki'''</noWIKI>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>NOwiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>'''not wiki'''</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noWIKI</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "pre-save transform: unclosed comment in <nowiki>",
		"wikitext": "wiki<nowiki>nowiki<!--nowiki</nowiki>wiki",
		"parsed": "wiki<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>nowiki&lt;!--nowiki</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>wiki"
	},
	{
		"desc": "(confirming safety of fix for subst T3936)",
		"wikitext": "{{Template:dangerous}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>Template:dangerous</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "pre-save transform: comment containing gallery (T7024)",
		"wikitext": "<!-- <gallery>data</gallery> -->",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</> &lt;gallery&gtdata&lt;/gallery&gt <punctuation.definition.comment.html>--&gt</></>"
	},
	{
		"desc": "pre-save transform: comment containing nowiki",
		"wikitext": "<!-- <nowiki>data</nowiki> -->",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</> &lt;nowiki&gtdata&lt;/nowiki&gt <punctuation.definition.comment.html>--&gt</></>"
	},
	{
		"desc": "pre-save transform: <noinclude> in subst (T5298)",
		"wikitext": "{{subst:Includes}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>subst</><keyword.operator.function>:</>Includes<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "pre-save transform: <onlyinclude> in subst (T5298)",
		"wikitext": "{{subst:Includes2}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>subst</><keyword.operator.function>:</>Includes2<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "T24297: safesubst: works during PST",
		"wikitext": "{{subst:SafeSubstTest}}{{safesubst:SubstTest}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>subst</><keyword.operator.function>:</>SafeSubstTest<punctuation.definition.tag.function>}}{{</><constant.language.variables.query>safesubst</><keyword.operator.function>:</>SubstTest<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "T24297: safesubst: works during normal parse",
		"wikitext": "{{SafeSubstTest}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>SafeSubstTest</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "subst: does not work during normal parse",
		"wikitext": "{{SubstTest}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>SubstTest</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "safesubst self: does not work during normal parse - T276476",
		"wikitext": "{{SafeSubstSelfTest}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>SafeSubstSelfTest</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Template named safesubst - T309405",
		"wikitext": "{{safesubst|123}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>safesubst</><keyword.operator>|</>123<punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "subst: with whitespace - variable vs. template",
		"wikitext": "Variable: {{subst: ROOTPAGENAME}}\nVariable: {{subst:ROOTPAGENAME}}\nTemplate: {{subst: ROOTPAGENAME|template}}\nTemplate: {{subst:ROOTPAGENAME|template}}",
		"parsed": "Variable: <punctuation.definition.tag.function>{{</><constant.language.variables.query>subst</><keyword.operator.function>:</> ROOTPAGENAME<punctuation.definition.tag.function>}}\\n</>Variable: <punctuation.definition.tag.function>{{</><constant.language.variables.query>subst</><keyword.operator.function>:</>ROOTPAGENAME<punctuation.definition.tag.function>}}\\n</>Template: <punctuation.definition.tag.function>{{</><constant.language.variables.query>subst</><keyword.operator.function>:</> ROOTPAGENAME<keyword.operator>|</>template<punctuation.definition.tag.function>}}\\n</>Template: <punctuation.definition.tag.function>{{</><constant.language.variables.query>subst</><keyword.operator.function>:</>ROOTPAGENAME<keyword.operator>|</>template<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\")",
		"wikitext": "[[Article (context)|]]\n[[Bar:Article|]]\n[[:Bar:Article|]]\n[[Bar:Article (context)|]]\n[[:Bar:Article (context)|]]\n[[|Article]]\n[[|Article (context)]]\n[[Bar:X (Y) Z|]]\n[[:Bar:X (Y) Z|]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Article (context)</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Bar:Article</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>:Bar:Article</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Bar:Article (context)</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>:Bar:Article (context)</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><keyword.operator>|</>Article<punctuation.definition.tag.link.internal>]]\\n[[</><keyword.operator>|</>Article (context)<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Bar:X (Y) Z</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>:Bar:X (Y) Z</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with interwiki prefix",
		"wikitext": "[[interwiki:Article|]]\n[[:interwiki:Article|]]\n[[interwiki:Bar:Article|]]\n[[:interwiki:Bar:Article|]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>interwiki:Article</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>:interwiki:Article</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>interwiki:Bar:Article</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>:interwiki:Bar:Article</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with parens in title",
		"wikitext": "[[|Article]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><keyword.operator>|</>Article<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with single, double-width and Arabic comma in title",
		"wikitext": "[[|Otherplace]]\n[[Otherplace, Elsewhere|]]\n[[Otherplace, Elsewhere, Anywhere|]]\n[[Otherplaceï¼ŒElsewhere|]]\n[[OtherplaceØŒ Elsewhere|]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><keyword.operator>|</>Otherplace<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Otherplace, Elsewhere</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Otherplace, Elsewhere, Anywhere</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Otherplaceï¼ŒElsewhere</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>OtherplaceØŒ Elsewhere</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with parens and comma",
		"wikitext": "[[|Otherplace]]\n[[Otherplace (place), Elsewhere|]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><keyword.operator>|</>Otherplace<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Otherplace (place), Elsewhere</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with comma and parens",
		"wikitext": "[[|Yes, you.]]\n[[Me, Myself, and I (1937 song)|]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><keyword.operator>|</>Yes, you.<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Me, Myself, and I (1937 song)</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with namespace",
		"wikitext": "[[|Article]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><keyword.operator>|</>Article<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with namespace and parens",
		"wikitext": "[[|Article]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><keyword.operator>|</>Article<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with namespace and comma",
		"wikitext": "[[|Article]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><keyword.operator>|</>Article<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with namespace, comma and parens",
		"wikitext": "[[|Article]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><keyword.operator>|</>Article<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with namespace, parens and comma",
		"wikitext": "[[|Article]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><keyword.operator>|</>Article<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with full-width parens and no space (Japanese and Chinese style, T32149)",
		"wikitext": "[[Articleï¼ˆcontextï¼‰|]]\n[[Bar:Articleï¼ˆcontextï¼‰|]]\n[[:Bar:Articleï¼ˆcontextï¼‰|]]\n[[|Articleï¼ˆcontextï¼‰]]\n[[Bar:Xï¼ˆYï¼‰Z|]]\n[[:Bar:Xï¼ˆYï¼‰Z|]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Articleï¼ˆcontextï¼‰</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Bar:Articleï¼ˆcontextï¼‰</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>:Bar:Articleï¼ˆcontextï¼‰</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><keyword.operator>|</>Articleï¼ˆcontextï¼‰<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Bar:Xï¼ˆYï¼‰Z</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>:Bar:Xï¼ˆYï¼‰Z</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with full-width parens and space (Japanese and Chinese style, T32149)",
		"wikitext": "[[Article ï¼ˆcontextï¼‰|]]\n[[Bar:Article ï¼ˆcontextï¼‰|]]\n[[:Bar:Article ï¼ˆcontextï¼‰|]]\n[[|Article ï¼ˆcontextï¼‰]]\n[[Bar:X ï¼ˆYï¼‰ Z|]]\n[[:Bar:X ï¼ˆYï¼‰ Z|]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Article ï¼ˆcontextï¼‰</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Bar:Article ï¼ˆcontextï¼‰</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>:Bar:Article ï¼ˆcontextï¼‰</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><keyword.operator>|</>Article ï¼ˆcontextï¼‰<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Bar:X ï¼ˆYï¼‰ Z</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>:Bar:X ï¼ˆYï¼‰ Z</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with parens and no space (Korean style, T32149)",
		"wikitext": "[[Article(context)|]]\n[[Bar:Article(context)|]]\n[[:Bar:Article(context)|]]\n[[|Article(context)]]\n[[Bar:X(Y)Z|]]\n[[:Bar:X(Y)Z|]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Article(context)</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Bar:Article(context)</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>:Bar:Article(context)</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><keyword.operator>|</>Article(context)<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Bar:X(Y)Z</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>:Bar:X(Y)Z</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with commas (T23660)",
		"wikitext": "[[Article (context), context|]]\n[[Article (context)ï¼Œcontext|]]\n[[Bar:Article (context), context|]]\n[[Bar:Article (context)ï¼Œcontext|]]\n[[:Bar:Article (context), context|]]\n[[:Bar:Article (context)ï¼Œcontext|]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Article (context), context</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Article (context)ï¼Œcontext</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Bar:Article (context), context</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Bar:Article (context)ï¼Œcontext</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>:Bar:Article (context), context</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>:Bar:Article (context)ï¼Œcontext</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Parsoid: backwards pipe trick",
		"wikitext": "[[|'''bar''']]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><keyword.operator>|</><markup.bold>'''</>bar<markup.bold>'''</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "pre-save transform: trim trailing empty lines",
		"wikitext": "Empty lines are trimmed",
		"parsed": "Empty lines are trimmed"
	},
	{
		"desc": "pre-save transform: Signature expansion",
		"wikitext": "* ~~~\n* ~~~~\n* ~~~~~\n* <noinclude>~~~</noinclude>\n* <includeonly>~~~</includeonly>\n* <onlyinclude>~~~</onlyinclude>",
		"parsed": "<punctuation.definition.list.begin.markdown>*</> <keyword.other.signature>~~~\\n</><punctuation.definition.list.begin.markdown>*</> <keyword.other.signature>~~~~\\n</><punctuation.definition.list.begin.markdown>*</> <keyword.other.signature>~~~~~\\n</><punctuation.definition.list.begin.markdown>*</> <punctuation.definition.tag.begin>&lt;</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</><keyword.other.signature>~~~</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.list.begin.markdown>*</> <punctuation.definition.tag.begin>&lt;</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</><keyword.other.signature>~~~</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.list.begin.markdown>*</> <punctuation.definition.tag.begin>&lt;</><entity.name.tag>onlyinclude</><punctuation.definition.tag.end>&gt</><meta.block.onlyinclude><keyword.other.signature>~~~</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>onlyinclude</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "ParserOutput flags from signature expansion (T84843)",
		"wikitext": "~~~~",
		"parsed": "<keyword.other.signature>~~~~</>"
	},
	{
		"desc": "pre-save transform: Signature expansion in nowiki tags (T2093)",
		"wikitext": "Shall not expand:\n\n<nowiki>~~~~</nowiki>\n\n<includeonly><nowiki>~~~~</nowiki></includeonly>\n\n<noinclude><nowiki>~~~~</nowiki></noinclude>\n\n<onlyinclude><nowiki>~~~~</nowiki></onlyinclude>\n\n{{subst:Foo}} shall be converted to FOO\n\nAs well as inside noinclude/onlyinclude\n<noinclude>{{subst:Foo}}</noinclude>\n<onlyinclude>{{subst:Foo}}</onlyinclude>\n\nBut not inside includeonly\n<includeonly>{{subst:Foo}}</includeonly>",
		"parsed": "Shall not expand:\\n\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>~~~~</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>~~~~</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>~~~~</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>onlyinclude</><punctuation.definition.tag.end>&gt</><meta.block.onlyinclude><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>~~~~</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>onlyinclude</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.function>{{</><constant.language.variables.query>subst</><keyword.operator.function>:</>Foo<punctuation.definition.tag.function>}}</> shall be converted to FOO\\n\\nAs well as inside noinclude/onlyinclude\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.function>{{</><constant.language.variables.query>subst</><keyword.operator.function>:</>Foo<punctuation.definition.tag.function>}}</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>noinclude</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>onlyinclude</><punctuation.definition.tag.end>&gt</><meta.block.onlyinclude><punctuation.definition.tag.function>{{</><constant.language.variables.query>subst</><keyword.operator.function>:</>Foo<punctuation.definition.tag.function>}}</></><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>onlyinclude</><punctuation.definition.tag.end>&gt\\n\\n</>But not inside includeonly\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.function>{{</><constant.language.variables.query>subst</><keyword.operator.function>:</>Foo<punctuation.definition.tag.function>}}</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>includeonly</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Parsoid: Recognize nowiki with trailing space in tags",
		"wikitext": "<nowiki ><div>[[foo]]</nowiki >\n\na<nowiki / >b\n\nc<nowiki />d\n\ne<nowiki/ >f",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</> <punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>&lt;div&gt[[foo]]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</> <punctuation.definition.tag.end>&gt\\n\\n</>a<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</> <invalid.illegal.character-not-allowed-here.html>/</> <punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>b\\n\\nc&lt;nowiki /&gtd\\n\\ne&lt;nowiki/ &gtf</>"
	},
	{
		"desc": "Category with empty sort key",
		"wikitext": "[[Category:MediaWiki User's Guide|]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>MediaWiki User's Guide</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Category with empty sort key and parentheses",
		"wikitext": "[[Category:Foo (bar)|]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo (bar)</><keyword.operator>|</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Category with link tail",
		"wikitext": "123[[Category:Foo]]456",
		"parsed": "123<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></>456"
	},
	{
		"desc": "Category with template",
		"wikitext": "[[Category:{{1x|Foo}}]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>Foo<punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Category with template in sort key",
		"wikitext": "[[Category:Foo|{{1x|Bar}}]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>Bar<punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Category with template in sort key and title",
		"wikitext": "[[Category:{{1x|Foo}}|{{1x|Bar}}]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>Foo<punctuation.definition.tag.template>}}</><keyword.operator>|</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>Bar<punctuation.definition.tag.template>}}</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Tildes in comments",
		"wikitext": "<!-- ~~~~ -->",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</> ~~~~ <punctuation.definition.comment.html>--&gt</></>"
	},
	{
		"desc": "quotes"
	},
	{
		"desc": "Quotes",
		"wikitext": "Normal text. '''Bold text.''' Normal text. ''Italic text.''\n\nNormal text. '''''Bold italic text.''''' Normal text.",
		"parsed": "Normal text. <markup.bold>'''</>Bold text.<markup.bold>'''</> Normal text. <markup.italic>''</>Italic text.<markup.italic>''\\n\\n</>Normal text. <markup.bold.italic>'''''</>Bold italic text.<markup.bold.italic>'''''</> Normal text."
	},
	{
		"desc": "Quotes wrapping HTML table",
		"wikitext": "'''<table><tr><td>hi</td></tr></table>'''",
		"parsed": "<markup.bold>'''</><meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>hi<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><markup.bold>'''</>"
	},
	{
		"desc": "Unclosed and unmatched quotes",
		"wikitext": "'''''Bold italic text '''with bold deactivated''' in between.'''''\n\n'''''Bold italic text ''with italic deactivated'' in between.'''''\n\n'''Bold text..\n\n..spanning two paragraphs (should not work).'''\n\n'''Bold tag left open\n\n''Italic tag left open\n\nNormal text.\n\n<!-- Unmatching number of opening, closing tags: -->\n'''This year''''s election ''should'' beat '''last year''''s.\n\n''Tom'''s car is bigger than ''Susan'''s.\n\nPlain ''italic'''s plain",
		"parsed": "<markup.bold.italic>'''''</>Bold italic text <markup.bold>'''</>with bold deactivated<markup.bold>'''</> in between.<markup.bold.italic>'''''\\n\\n'''''</>Bold italic text <markup.italic>''</>with italic deactivated<markup.italic>''</> in between.<markup.bold.italic>'''''\\n\\n</><markup.bold>'''</>Bold text..\\n\\n..spanning two paragraphs (should not work).<markup.bold>'''\\n\\n'''</>Bold tag left open\\n\\n<markup.italic>''</>Italic tag left open\\n\\nNormal text.\\n\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</> Unmatching number of opening, closing tags: <punctuation.definition.comment.html>--&gt\\n</></><markup.bold>'''</>This year'<markup.bold>'''</>s election <markup.italic>''</>should<markup.italic>''</> beat <markup.bold>'''</>last year'<markup.bold>'''</>s.\\n\\n<markup.italic>''</>Tom<markup.bold>'''</>s car is bigger than <markup.italic>''</>Susan<markup.bold>'''</>s.\\n\\nPlain <markup.italic>''</>italic<markup.bold>'''</>s plain"
	},
	{
		"desc": "Italics and bold",
		"wikitext": "*plain\n*plain''italic''plain\n*plain''italic''plain''italic''plain\n*plain'''bold'''plain\n*plain'''bold'''plain'''bold'''plain\n*plain''italic''plain'''bold'''plain\n*plain'''bold'''plain''italic''plain\n*plain''italic'''bold-italic'''italic''plain\n*plain'''bold''bold-italic''bold'''plain\n*plain'''''bold-italic'''italic''plain\n*plain'''''bold-italic''bold'''plain\n*plain''italic'''bold-italic'''''plain\n*plain'''bold''bold-italic'''''plain\n*plain l'''italic''plain\n*plain l''''bold''' plain",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>plain\\n<punctuation.definition.list.begin.markdown>*</>plain<markup.italic>''</>italic<markup.italic>''</>plain\\n<punctuation.definition.list.begin.markdown>*</>plain<markup.italic>''</>italic<markup.italic>''</>plain<markup.italic>''</>italic<markup.italic>''</>plain\\n<punctuation.definition.list.begin.markdown>*</>plain<markup.bold>'''</>bold<markup.bold>'''</>plain\\n<punctuation.definition.list.begin.markdown>*</>plain<markup.bold>'''</>bold<markup.bold>'''</>plain<markup.bold>'''</>bold<markup.bold>'''</>plain\\n<punctuation.definition.list.begin.markdown>*</>plain<markup.italic>''</>italic<markup.italic>''</>plain<markup.bold>'''</>bold<markup.bold>'''</>plain\\n<punctuation.definition.list.begin.markdown>*</>plain<markup.bold>'''</>bold<markup.bold>'''</>plain<markup.italic>''</>italic<markup.italic>''</>plain\\n<punctuation.definition.list.begin.markdown>*</>plain<markup.italic>''</>italic<markup.bold>'''</>bold-italic<markup.bold>'''</>italic<markup.italic>''</>plain\\n<punctuation.definition.list.begin.markdown>*</>plain<markup.bold>'''</>bold<markup.italic>''</>bold-italic<markup.italic>''</>bold<markup.bold>'''</>plain\\n<punctuation.definition.list.begin.markdown>*</>plain<markup.bold.italic>'''''</>bold-italic<markup.bold>'''</>italic<markup.italic>''</>plain\\n<punctuation.definition.list.begin.markdown>*</>plain<markup.bold.italic>'''''</>bold-italic<markup.italic>''</>bold<markup.bold>'''</>plain\\n<punctuation.definition.list.begin.markdown>*</>plain<markup.italic>''</>italic<markup.bold>'''</>bold-italic<markup.bold.italic>'''''</>plain\\n<punctuation.definition.list.begin.markdown>*</>plain<markup.bold>'''</>bold<markup.italic>''</>bold-italic<markup.bold.italic>'''''</>plain\\n<punctuation.definition.list.begin.markdown>*</>plain l<markup.bold>'''</>italic<markup.italic>''</>plain\\n<punctuation.definition.list.begin.markdown>*</>plain l'<markup.bold>'''</>bold<markup.bold>'''</> plain"
	},
	{
		"desc": "Italics and possessives (1)",
		"wikitext": "obtained by ''[[Lunar Prospector]]'''s gamma-ray spectrometer",
		"parsed": "obtained by <markup.italic>''</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Lunar Prospector</><punctuation.definition.tag.link.internal>]]</></><markup.bold>'''</>s gamma-ray spectrometer"
	},
	{
		"desc": "Italics and possessives (2)",
		"wikitext": "'''''Flaming Pie''''' is ... released in 1997. In ''Flaming Pie'''s liner notes",
		"parsed": "<markup.bold.italic>'''''</>Flaming Pie<markup.bold.italic>'''''</> is ... released in 1997. In <markup.italic>''</>Flaming Pie<markup.bold>'''</>s liner notes"
	},
	{
		"desc": "Italics and possessives (3)",
		"wikitext": "The first monolingual dictionary written in a Romance language was ''SebastiÃ¡n Covarrubias''' ''Tesoro de la lengua castellana o espaÃ±ola'', published in 1611 in Madrid. In 1612 the first edition of the ''Vocabolario dell'[[Accademia della Crusca]]'', for Italian, was published. In 1690 in Rotterdam was published, posthumously, the ''Dictionnaire Universel''.",
		"parsed": "The first monolingual dictionary written in a Romance language was <markup.italic>''</>SebastiÃ¡n Covarrubias<markup.bold>'''</> <markup.italic>''</>Tesoro de la lengua castellana o espaÃ±ola<markup.italic>''</>, published in 1611 in Madrid. In 1612 the first edition of the <markup.italic>''</>Vocabolario dell'<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Accademia della Crusca</><punctuation.definition.tag.link.internal>]]</></><markup.italic>''</>, for Italian, was published. In 1690 in Rotterdam was published, posthumously, the <markup.italic>''</>Dictionnaire Universel<markup.italic>''</>."
	},
	{
		"desc": "Italics and bold: 2-quote opening sequence: (2,2)",
		"wikitext": "''foo''",
		"parsed": "<markup.italic>''</>foo<markup.italic>''</>"
	},
	{
		"desc": "Italics and bold: 2-quote opening sequence: (2,3)",
		"wikitext": "''foo'''",
		"parsed": "<markup.italic>''</>foo<markup.bold>'''</>"
	},
	{
		"desc": "Italics and bold: 2-quote opening sequence: (2,4)",
		"wikitext": "''foo''''",
		"parsed": "<markup.italic>''</>foo'<markup.bold>'''</>"
	},
	{
		"desc": "Italics and bold: 2-quote opening sequence: (2,4) w/ nowiki",
		"wikitext": "''foo<nowiki>''</nowiki>''",
		"parsed": "<markup.italic>''</>foo<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>''</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><markup.italic>''</>"
	},
	{
		"desc": "Italics and bold: 2-quote opening sequence: (2,5)",
		"wikitext": "''foo'''''",
		"parsed": "<markup.italic>''</>foo<markup.bold.italic>'''''</>"
	},
	{
		"desc": "Italics and bold: 2-quote opening sequence: (2,5-3)",
		"wikitext": "''foo''",
		"parsed": "<markup.italic>''</>foo<markup.italic>''</>"
	},
	{
		"desc": "Italics and bold: 3-quote opening sequence: (3,2)",
		"wikitext": "'''foo''",
		"parsed": "<markup.bold>'''</>foo<markup.italic>''</>"
	},
	{
		"desc": "Italics and bold: 3-quote opening sequence: (3,3)",
		"wikitext": "'''foo'''",
		"parsed": "<markup.bold>'''</>foo<markup.bold>'''</>"
	},
	{
		"desc": "Italics and bold: 3-quote opening sequence: (3,4)",
		"wikitext": "'''foo''''",
		"parsed": "<markup.bold>'''</>foo'<markup.bold>'''</>"
	},
	{
		"desc": "Italics and bold: 3-quote opening sequence: (3,5)",
		"wikitext": "'''foo'''''",
		"parsed": "<markup.bold>'''</>foo<markup.bold.italic>'''''</>"
	},
	{
		"desc": "Italics and bold: 3-quote opening sequence: (3,5-2)",
		"wikitext": "'''foo'''",
		"parsed": "<markup.bold>'''</>foo<markup.bold>'''</>"
	},
	{
		"desc": "Italics and bold: 4-quote opening sequence: (4,2)",
		"wikitext": "''''foo''",
		"parsed": "'<markup.bold>'''</>foo<markup.italic>''</>"
	},
	{
		"desc": "Italics and bold: 4-quote opening sequence: (4,2) w/ nowiki",
		"wikitext": "<nowiki>''</nowiki>''foo''",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>''</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><markup.italic>''</>foo<markup.italic>''</>"
	},
	{
		"desc": "Italics and bold: 4-quote opening sequence: (4,3)",
		"wikitext": "''''foo'''",
		"parsed": "'<markup.bold>'''</>foo<markup.bold>'''</>"
	},
	{
		"desc": "Italics and bold: 4-quote opening sequence: (4,4)",
		"wikitext": "''''foo''''",
		"parsed": "'<markup.bold>'''</>foo'<markup.bold>'''</>"
	},
	{
		"desc": "Italics and bold: 4-quote opening sequence: (4,4) w/ nowiki",
		"wikitext": "'<nowiki/>'''foo''''",
		"parsed": "'<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</><markup.bold>'''</>foo'<markup.bold>'''</>"
	},
	{
		"desc": "Italics and bold: 4-quote opening sequence: (4,5)",
		"wikitext": "''''foo'''''",
		"parsed": "'<markup.bold>'''</>foo<markup.bold.italic>'''''</>"
	},
	{
		"desc": "Italics and bold: 4-quote opening sequence: (4,5-2)",
		"wikitext": "''''foo'''",
		"parsed": "'<markup.bold>'''</>foo<markup.bold>'''</>"
	},
	{
		"desc": "Italics and bold: 5-quote opening sequence: (5,2)",
		"wikitext": "'''''foo''",
		"parsed": "<markup.bold.italic>'''''</>foo<markup.italic>''</>"
	},
	{
		"desc": "Italics and bold: 5-quote opening sequence: (5,2+3)",
		"wikitext": "'''''foo'''''",
		"parsed": "<markup.bold.italic>'''''</>foo<markup.bold.italic>'''''</>"
	},
	{
		"desc": "Italics and bold: 5-quote opening sequence: (5,3)",
		"wikitext": "'''''foo'''",
		"parsed": "<markup.bold.italic>'''''</>foo<markup.bold>'''</>"
	},
	{
		"desc": "Italics and bold: 5-quote opening sequence: (5,3+2)",
		"wikitext": "'''''foo'''''",
		"parsed": "<markup.bold.italic>'''''</>foo<markup.bold.italic>'''''</>"
	},
	{
		"desc": "Italics and bold: 5-quote opening sequence: (5,4)",
		"wikitext": "'''''foo''''",
		"parsed": "<markup.bold.italic>'''''</>foo'<markup.bold>'''</>"
	},
	{
		"desc": "Italics and bold: 5-quote opening sequence: (5,5)",
		"wikitext": "'''''foo'''''",
		"parsed": "<markup.bold.italic>'''''</>foo<markup.bold.italic>'''''</>"
	},
	{
		"desc": "Italics and bold: 5-quote opening sequence: (5,6)",
		"wikitext": "'''''foo''''''",
		"parsed": "<markup.bold.italic>'''''</>foo'<markup.bold.italic>'''''</>"
	},
	{
		"desc": "Italics and bold: multiple quote sequences: (2,4,2)",
		"wikitext": "''foo''''bar''",
		"parsed": "<markup.italic>''</>foo'<markup.bold>'''</>bar<markup.italic>''</>"
	},
	{
		"desc": "Italics and bold: multiple quote sequences: (2,4,2+3) w/ nowiki",
		"wikitext": "''foo'<nowiki/>'''bar'''''",
		"parsed": "<markup.italic>''</>foo'<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</><markup.bold>'''</>bar<markup.bold.italic>'''''</>"
	},
	{
		"desc": "Italics and bold: multiple quote sequences: (2,4,3)",
		"wikitext": "''foo''''bar'''",
		"parsed": "<markup.italic>''</>foo'<markup.bold>'''</>bar<markup.bold>'''</>"
	},
	{
		"desc": "Italics and bold: multiple quote sequences: (2,4,3+2) w/ nowiki",
		"wikitext": "''foo'<nowiki/>'''bar'''''",
		"parsed": "<markup.italic>''</>foo'<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</><markup.bold>'''</>bar<markup.bold.italic>'''''</>"
	},
	{
		"desc": "Italics and bold: multiple quote sequences: (2,4,4)",
		"wikitext": "''foo''''bar''''",
		"parsed": "<markup.italic>''</>foo'<markup.bold>'''</>bar'<markup.bold>'''</>"
	},
	{
		"desc": "Italics and bold: multiple quote sequences: (2,4,4+2) w/ nowiki",
		"wikitext": "''foo'<nowiki/>'''bar'<nowiki/>'''''",
		"parsed": "<markup.italic>''</>foo'<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</><markup.bold>'''</>bar'<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</><markup.bold.italic>'''''</>"
	},
	{
		"desc": "Italics and bold: multiple quote sequences: (3,4,2)",
		"wikitext": "'''foo''''bar''",
		"parsed": "<markup.bold>'''</>foo'<markup.bold>'''</>bar<markup.italic>''</>"
	},
	{
		"desc": "Italics and bold: multiple quote sequences: (3,4,2-2)",
		"wikitext": "'''foo''''bar",
		"parsed": "<markup.bold>'''</>foo'<markup.bold>'''</>bar"
	},
	{
		"desc": "Italics and bold: multiple quote sequences: (3,4,3)",
		"wikitext": "'''foo''''bar'''",
		"parsed": "<markup.bold>'''</>foo'<markup.bold>'''</>bar<markup.bold>'''</>"
	},
	{
		"desc": "Italics and bold: multiple quote sequences: (3,4,3-3)",
		"wikitext": "'''foo''''bar",
		"parsed": "<markup.bold>'''</>foo'<markup.bold>'''</>bar"
	},
	{
		"desc": "Italics and bold: other quote tests: (2,3,5)",
		"wikitext": "''this is about '''foo's family'''''",
		"parsed": "<markup.italic>''</>this is about <markup.bold>'''</>foo's family<markup.bold.italic>'''''</>"
	},
	{
		"desc": "Italics and bold: other quote tests: (2,(3,3),2)",
		"wikitext": "''this is about '''foo's''' family''",
		"parsed": "<markup.italic>''</>this is about <markup.bold>'''</>foo's<markup.bold>'''</> family<markup.italic>''</>"
	},
	{
		"desc": "Italics and bold: other quote tests: (3,2,3,2)",
		"wikitext": "'''this is about ''foo'''s family''",
		"parsed": "<markup.bold>'''</>this is about <markup.italic>''</>foo<markup.bold>'''</>s family<markup.italic>''</>"
	},
	{
		"desc": "Italics and bold: other quote tests: (3,2,3+2+2,2)",
		"wikitext": "'''this is about ''foo'''''<nowiki/>''s family''",
		"parsed": "<markup.bold>'''</>this is about <markup.italic>''</>foo<markup.bold.italic>'''''</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</><markup.italic>''</>s family<markup.italic>''</>"
	},
	{
		"desc": "Italics and bold: other quote tests: (3,2,3,3)",
		"wikitext": "'''this is about ''foo'''s family'''",
		"parsed": "<markup.bold>'''</>this is about <markup.italic>''</>foo<markup.bold>'''</>s family<markup.bold>'''</>"
	},
	{
		"desc": "Italics and bold: other quote tests: (3,(2,2),3)",
		"wikitext": "'''this is about ''foo's'' family'''",
		"parsed": "<markup.bold>'''</>this is about <markup.italic>''</>foo's<markup.italic>''</> family<markup.bold>'''</>"
	},
	{
		"desc": "Italicized possessive",
		"wikitext": "The ''[[Main Page]]'''s talk page.",
		"parsed": "The <markup.italic>''</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</></><markup.bold>'''</>s talk page."
	},
	{
		"desc": "Quote balancing context should be restricted to td/th cells on the same wikitext line",
		"wikitext": "{|\n!''a!!''b\n|''a||''b\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</><markup.style><markup.italic>''</>a</><keyword.operator>!!</><markup.style><markup.italic>''</>b\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style><markup.italic>''</>a</><keyword.operator>||</><markup.style><markup.italic>''</>b\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Bold conversion test",
		"wikitext": "a b'''c ''d e'''f'' g h'''i ''j",
		"parsed": "a b<markup.bold>'''</>c <markup.italic>''</>d e<markup.bold>'''</>f<markup.italic>''</> g h<markup.bold>'''</>i <markup.italic>''</>j"
	},
	{
		"desc": "redirects"
	},
	{
		"desc": "1. Simple redirect to page",
		"wikitext": "#REDIRECT [[Main Page]]",
		"parsed": "<keyword.control.redirect>#REDIRECT</> <punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</>"
	},
	{
		"desc": "2. Other redirect variants",
		"wikitext": "#REDIRECT [[Main_Page]]",
		"parsed": "<keyword.control.redirect>#REDIRECT</> <punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main_Page</><punctuation.definition.tag.link.internal>]]</>"
	},
	{
		"desc": "3. Other redirect variants",
		"wikitext": "#REDIRECT [[<nowiki>[[Bar]]</nowiki>]]",
		"parsed": "<punctuation.definition.list.begin.markdown>#</>REDIRECT <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>[[Bar]]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "4. Redirect to a templated destination",
		"wikitext": "#REDIRECT [[{{1x|Foo}}bar]]",
		"parsed": "<punctuation.definition.list.begin.markdown>#</>REDIRECT <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>Foo<punctuation.definition.tag.template>}}</>bar<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Empty redirect",
		"wikitext": "#REDIRECT [[]]",
		"parsed": "<punctuation.definition.list.begin.markdown>#</>REDIRECT <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[]]</></>"
	},
	{
		"desc": "Optional colon in #REDIRECT",
		"wikitext": "#REDIRECT:[[Main Page]]",
		"parsed": "<keyword.control.redirect>#REDIRECT</><punctuation.definition.tag.link.internal>:[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</>"
	},
	{
		"desc": "Whitespace in #REDIRECT with optional colon",
		"wikitext": " \n #REDIRECT \n: \n[[Main Page]]",
		"parsed": " \\n #REDIRECT \\n<punctuation.definition.list.begin.markdown>:</> \\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Piped link in #REDIRECT",
		"wikitext": "#REDIRECT [[Main Page|bar]]",
		"parsed": "<keyword.control.redirect>#REDIRECT</> <punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><invalid.deprecated.ineffective>|bar</><punctuation.definition.tag.link.internal>]]</>"
	},
	{
		"desc": "Redirect to category (T104502)",
		"wikitext": "#REDIRECT [[Category:Foo]]",
		"parsed": "<keyword.control.redirect>#REDIRECT</> <punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</>"
	},
	{
		"desc": "Redirect to category with URL encoding (T104502)",
		"wikitext": "#REDIRECT [[Category%3AFoo]]",
		"parsed": "<keyword.control.redirect>#REDIRECT</> <punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Category%3AFoo</><punctuation.definition.tag.link.internal>]]</>"
	},
	{
		"desc": "Redirect to category page",
		"wikitext": "#REDIRECT [[:Category:Foo]]",
		"parsed": "<keyword.control.redirect>#REDIRECT</> <punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>:Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</>"
	},
	{
		"desc": "Redirect to image page (1)",
		"wikitext": "#REDIRECT [[File:Wiki.png]]",
		"parsed": "<keyword.control.redirect>#REDIRECT</> <punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Wiki.png</><punctuation.definition.tag.link.internal>]]</>"
	},
	{
		"desc": "Redirect to image page (2)",
		"wikitext": "#REDIRECT [[Image:Wiki.png]]",
		"parsed": "<keyword.control.redirect>#REDIRECT</> <punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Image:</><entity.other.attribute-name>Wiki.png</><punctuation.definition.tag.link.internal>]]</>"
	},
	{
		"desc": "Redirect to language (1) (T104918)",
		"wikitext": "#REDIRECT [[en:File:Wiki.png]]",
		"parsed": "<keyword.control.redirect>#REDIRECT</> <punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>en:File:Wiki.png</><punctuation.definition.tag.link.internal>]]</>"
	},
	{
		"desc": "Redirect to language (2) (T104918)",
		"wikitext": "#REDIRECT [[:en:File:Wiki.png]]",
		"parsed": "<keyword.control.redirect>#REDIRECT</> <punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>:en:File:Wiki.png</><punctuation.definition.tag.link.internal>]]</>"
	},
	{
		"desc": "Redirect to interwiki (T104918)",
		"wikitext": "#REDIRECT [[meatball:File:Wiki.png]]",
		"parsed": "<keyword.control.redirect>#REDIRECT</> <punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>meatball:File:Wiki.png</><punctuation.definition.tag.link.internal>]]</>"
	},
	{
		"desc": "Redirect syntax under text isn't considered a redirect",
		"wikitext": "some text\n\n#redirect [[Main Page]]",
		"parsed": "some text\\n\\n<keyword.control.redirect>#redirect</> <punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</>"
	},
	{
		"desc": "New redirect",
		"wikitext": "#REDIRECT [[Foo]]\nFoo",
		"parsed": "<keyword.control.redirect>#REDIRECT</> <punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]\\n</>Foo"
	},
	{
		"desc": "Redirect followed by block on the same line",
		"wikitext": "#REDIRECT [[Main Page]]<!-- haha -->==hi==",
		"parsed": "<keyword.control.redirect>#REDIRECT</> <punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</><comment.block.html><punctuation.definition.comment.html>&lt;!--</> haha <punctuation.definition.comment.html>--&gt</></>==hi=="
	},
	{
		"desc": "Redirect followed by horizontal rule on the same line",
		"wikitext": "#REDIRECT [[Main Page]]----",
		"parsed": "<keyword.control.redirect>#REDIRECT</> <punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]</>----"
	},
	{
		"desc": "Redirect followed by a newline",
		"wikitext": "#REDIRECT [[Main Page]]\nA newline",
		"parsed": "<keyword.control.redirect>#REDIRECT</> <punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]\\n</>A newline"
	},
	{
		"desc": "Redirect followed by multiple newlines",
		"wikitext": "#REDIRECT [[Main Page]]\n\n\nA newline",
		"parsed": "<keyword.control.redirect>#REDIRECT</> <punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><punctuation.definition.tag.link.internal>]]\\n\\n\\n</>A newline"
	},
	{
		"desc": "Drop duplicate redirects",
		"wikitext": "#REDIRECT [[Foo]]",
		"parsed": "<keyword.control.redirect>#REDIRECT</> <punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</>"
	},
	{
		"desc": "Redirect containing double quotes and spaces",
		"wikitext": "#REDIRECT [[Cool \"Gator\"]]",
		"parsed": "<keyword.control.redirect>#REDIRECT</> <punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Cool \"Gator\"</><punctuation.definition.tag.link.internal>]]</>"
	},
	{
		"desc": "Broken redirect shouldn't crash parsoid (T332242)",
		"wikitext": "<!-- Not a valid redirect nor a valid parser function -->\n{{#REDIRECT [[]]}}",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</> Not a valid redirect nor a valid parser function <punctuation.definition.comment.html>--&gt\\n</></>{{#REDIRECT <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[]]</></>}}"
	},
	{
		"desc": "stringFunctionTests"
	},
	{
		"desc": "#len",
		"wikitext": "{{#len:}}\n{{#len:0}}\n{{#len:test}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#len</><keyword.operator.function>:</><punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#len</><keyword.operator.function>:</>0<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#len</><keyword.operator.function>:</>test<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "#urldecode",
		"wikitext": "{{#urldecode:}}\n{{#urldecode:foo%20bar}}\n{{#urldecode:%D0%9C%D0%B5%D0%B4%D0%B8%D0%B0%D0%92%D0%B8%D0%BA%D0%B8}}\n{{#urldecode: some unescaped string}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#urldecode</><keyword.operator.function>:</><punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#urldecode</><keyword.operator.function>:</>foo%20bar<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#urldecode</><keyword.operator.function>:</>%D0%9C%D0%B5%D0%B4%D0%B8%D0%B0%D0%92%D0%B8%D0%BA%D0%B8<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#urldecode</><keyword.operator.function>:</> some unescaped string<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "#pos",
		"wikitext": "{{#pos:Å½mrÅ¾lina|Å¾lina}}\n{{#pos:stringstring|str|4}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#pos</><keyword.operator.function>:</>Å½mrÅ¾lina<keyword.operator>|</>Å¾lina<punctuation.definition.tag.function>}}\\n{{</><constant.language.variables.query>#pos</><keyword.operator.function>:</>stringstring<keyword.operator>|</>str<keyword.operator>|</>4<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "#pos with too large offset (T209600)",
		"wikitext": "{{#pos:FooBar|Foo|32}}",
		"parsed": "<punctuation.definition.tag.function>{{</><constant.language.variables.query>#pos</><keyword.operator.function>:</>FooBar<keyword.operator>|</>Foo<keyword.operator>|</>32<punctuation.definition.tag.function>}}</>"
	},
	{
		"desc": "tables"
	},
	{
		"desc": "Tables with multiple newlines after individual lines embedded in links",
		"wikitext": "[[Test|\n{|\n\n|test\n|}]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Test</><keyword.operator>|\\n</><meta.tag.block.table><keyword.operator>{|\\n\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>test\\n</></><keyword.operator>|}</></><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "A table with no data.",
		"wikitext": "{||}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|</><meta.attribute.unrecognized.|}.html><entity.other.attribute-name.html>|}</></></>"
	},
	{
		"desc": "A table with no data (take 2)",
		"wikitext": "{|\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n|}</></>"
	},
	{
		"desc": "A table with no data generated by a <table> markup",
		"wikitext": "<table></table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Parsoid: Don't paragraph-wrap fosterable content even if table syntax is unbalanced",
		"wikitext": "{|\n<td>\n<td>\n</td>\n\n\n\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt\\n</><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt\\n\\n\\n\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "A table with stray table end tags on start tag line (wt2html)",
		"wikitext": "{|style=\"color: red;\"|}\n\n{|style=\"color: red;\" |}\n|foo\n|}\n\n{|style=\"color: red;\"|} id=\"foo\"\n|foo\n|}\n\n{|style=\"color: red;\" |} id=\"foo\"\n|foo\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|</><meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>color: red;</><punctuation.definition.string.end.html><source.css>\"</></></></></><meta.attribute.unrecognized.|}.html><entity.other.attribute-name.html>|}\\n\\n</></><meta.tag.block.table><keyword.operator>{|</><meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>color: red;</><punctuation.definition.string.end.html><source.css>\"</></></></></> <meta.attribute.unrecognized.|}.html><entity.other.attribute-name.html>|}\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>foo\\n</></><keyword.operator>|}\\n\\n{|</><meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>color: red;</><punctuation.definition.string.end.html><source.css>\"</></></></></><meta.attribute.unrecognized.|}.html><entity.other.attribute-name.html>|}</></> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"\\n</></></><meta.tag.block.td><keyword.operator>|</><markup.style>foo\\n</></><keyword.operator>|}\\n\\n{|</><meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>color: red;</><punctuation.definition.string.end.html><source.css>\"</></></></></> <meta.attribute.unrecognized.|}.html><entity.other.attribute-name.html>|}</></> <meta.attribute.id.html><entity.other.attribute-name.html>id</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"\\n</></></><meta.tag.block.td><keyword.operator>|</><markup.style>foo\\n</></><keyword.operator>|}</></></>"
	},
	{
		"desc": "A table with nothing but a caption",
		"wikitext": "{|\n|+caption\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|+</><markup.style>caption\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "A table with caption with default-spaced attributes and a table row",
		"wikitext": "{|\n|+ style=\"color: red;\" |caption1\n|-\n|foo\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|+</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>color: red;</><punctuation.definition.string.end.html><source.css>\"</></></></> </><keyword.operator>|</><markup.style>caption1\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>foo\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "A table with captions with non-default spaced attributes and a table row",
		"wikitext": "{|\n|+style=\"color: red;\"|caption2\n|+ style=\"color: red;\"|caption3\n|-\n|foo\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|+</><meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>color: red;</><punctuation.definition.string.end.html><source.css>\"</></></></></><keyword.operator>|</><markup.style>caption2\\n</><keyword.operator>|+</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>color: red;</><punctuation.definition.string.end.html><source.css>\"</></></></></><keyword.operator>|</><markup.style>caption3\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>foo\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Table td-cell syntax variations",
		"wikitext": "{|\n|foo bar foo|baz\n|foo bar foo||baz\n|style='color:red;'|baz\n|style='color:red;'||baz\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><meta.attribute.unrecognized.foo.html><entity.other.attribute-name.html>foo</></> <meta.attribute.unrecognized.bar.html><entity.other.attribute-name.html>bar</></> <meta.attribute.unrecognized.foo.html><entity.other.attribute-name.html>foo</></><keyword.operator>|</><markup.style>baz\\n</><keyword.operator>|</><markup.style>foo bar foo</><keyword.operator>||</><markup.style>baz\\n</><keyword.operator>|</><meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.single.html><punctuation.definition.string.begin.html>'</><source.css>color:red;</><punctuation.definition.string.end.html><source.css>'</></></></></><keyword.operator>|</><markup.style>baz\\n</><keyword.operator>|</><markup.style>style='color:red;'</><keyword.operator>||</><markup.style>baz\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Simple table",
		"wikitext": "{|\n|1||2\n|-\n|3||4\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>1</><keyword.operator>||</><markup.style>2\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>3</><keyword.operator>||</><markup.style>4\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Simple table but with multiple dashes for row wikitext",
		"wikitext": "{|\n|foo\n|-----\n|bar\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>foo\\n</></><meta.tag.block.table-row><keyword.operator>|-----\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>bar\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Multiplication table",
		"wikitext": "{| border=\"1\" cellpadding=\"2\"\n|+Multiplication table\n|-\n!&times;!!1!!2!!3\n|-\n!1\n|1||2||3\n|-\n!2\n|2||4||6\n|-\n!3\n|3||6||9\n|-\n!4\n|4||8||12\n|-\n!5\n|5||10||15\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|</> <meta.attribute.border.html><invalid.deprecated.entity.other.attribute-name.html>border</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>1<punctuation.definition.string.end.html>\"</></></> <meta.attribute.unrecognized.cellpadding.html><entity.other.attribute-name.html>cellpadding</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>2<punctuation.definition.string.end.html>\"\\n</></></><meta.tag.block.td><keyword.operator>|+</><markup.style>Multiplication table\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.th><keyword.operator>!</><markup.style><constant.character.entity.named.times.html><punctuation.definition.entity.html>&amp;</>times<punctuation.definition.entity.html>;</></></><keyword.operator>!!</><markup.style>1</><keyword.operator>!!</><markup.style>2</><keyword.operator>!!</><markup.style>3\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.th><keyword.operator>!</><markup.style>1\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>1</><keyword.operator>||</><markup.style>2</><keyword.operator>||</><markup.style>3\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.th><keyword.operator>!</><markup.style>2\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>2</><keyword.operator>||</><markup.style>4</><keyword.operator>||</><markup.style>6\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.th><keyword.operator>!</><markup.style>3\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>3</><keyword.operator>||</><markup.style>6</><keyword.operator>||</><markup.style>9\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.th><keyword.operator>!</><markup.style>4\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>4</><keyword.operator>||</><markup.style>8</><keyword.operator>||</><markup.style>12\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.th><keyword.operator>!</><markup.style>5\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>5</><keyword.operator>||</><markup.style>10</><keyword.operator>||</><markup.style>15\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Accept \"||\" in table headings",
		"wikitext": "{|\n!h1||h2\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</><markup.style>h1</><keyword.operator>||</><markup.style>h2\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Accept \"!!\" in table data",
		"wikitext": "{|\n|Foo!!||\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>Foo!!</><keyword.operator>||\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Accept \"||\" in indented table headings",
		"wikitext": ":{|\n!h1||h2\n|}",
		"parsed": "<meta.tag.block.table><punctuation.definition.list.begin.markdown>:</><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</><markup.style>h1</><keyword.operator>||</><markup.style>h2\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Accept \"!!\" in templates",
		"wikitext": "{|\n!a {{1x|b!!c}}\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</><markup.style>a <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>b</><keyword.operator>!!</><markup.style>c}}\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Accept \"!!\" in table headings after newline",
		"wikitext": "{|\n!a\nb!!c\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</><markup.style>a\\n</></>b!!c\\n<keyword.operator>|}</></>"
	},
	{
		"desc": "Accept \"!!\" in table data of mixed wikitext / html syntax",
		"wikitext": "{|\n!a\n<tr><td>b!!c</td></tr>\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</><markup.style>a\\n</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>b!!c<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Accept empty attributes in td/th cells (td/th cells starting with leading ||)",
		"wikitext": "{|\n!|h1\n||a\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!|</><markup.style>h1\\n</></><meta.tag.block.td><keyword.operator>||</><markup.style>a\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Accept \"| !\" at start of line in tables (ignore !-attribute)",
		"wikitext": "{|\n|-\n|!style=\"color:red\"|bar\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><meta.attribute.unrecognized.!style.html><entity.other.attribute-name.html>!style</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>color:red<punctuation.definition.string.end.html>\"</></></><keyword.operator>|</><markup.style>bar\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Allow +/- in 2nd and later cells in a row, in 1st cell when td-attrs are present, or in 1st cell when there is a space between \"|\" and +/- ",
		"wikitext": "{|\n|-\n|style='color:red;'|+1\n|style='color:blue;'|-1\n|-\n|1||2||3\n|1||+2||-3\n|-\n| +1\n| -1\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.single.html><punctuation.definition.string.begin.html>'</><source.css>color:red;</><punctuation.definition.string.end.html><source.css>'</></></></></><keyword.operator>|</><markup.style>+1\\n</><keyword.operator>|</><meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.single.html><punctuation.definition.string.begin.html>'</><source.css>color:blue;</><punctuation.definition.string.end.html><source.css>'</></></></></><keyword.operator>|</><markup.style>-1\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>1</><keyword.operator>||</><markup.style>2</><keyword.operator>||</><markup.style>3\\n</><keyword.operator>|</><markup.style>1</><keyword.operator>||</><markup.style>+2</><keyword.operator>||</><markup.style>-3\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style> +1\\n</><keyword.operator>|</><markup.style> -1\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Table rowspan",
		"wikitext": "{| border=1\n|Cell 1, row 1\n|rowspan=2|Cell 2, row 1 (and 2)\n|Cell 3, row 1\n|-\n|Cell 1, row 2\n|Cell 3, row 2\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|</> <meta.attribute.border.html><invalid.deprecated.entity.other.attribute-name.html>border</><punctuation.separator.key-value.html>=</><string.unquoted.html>1\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>Cell 1, row 1\\n</><keyword.operator>|</><meta.attribute.rowspan.html><entity.other.attribute-name.html>rowspan</><punctuation.separator.key-value.html>=</><string.unquoted.html>2</></><keyword.operator>|</><markup.style>Cell 2, row 1 (and 2)\\n</><keyword.operator>|</><markup.style>Cell 3, row 1\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>Cell 1, row 2\\n</><keyword.operator>|</><markup.style>Cell 3, row 2\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Nested table",
		"wikitext": "{| border=1\n| &alpha;\n|\n{| bgcolor=#ABCDEF border=2\n|nested\n|-\n|table\n|}\n|the original table again\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|</> <meta.attribute.border.html><invalid.deprecated.entity.other.attribute-name.html>border</><punctuation.separator.key-value.html>=</><string.unquoted.html>1\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style> <constant.character.entity.named.alpha.html><punctuation.definition.entity.html>&amp;</>alpha<punctuation.definition.entity.html>;\\n</></></><keyword.operator>|\\n</></><meta.tag.block.table><keyword.operator>{|</> <meta.attribute.bgcolor.html><invalid.deprecated.entity.other.attribute-name.html>bgcolor</><punctuation.separator.key-value.html>=</><string.unquoted.html>#ABCDEF</></> <meta.attribute.border.html><invalid.deprecated.entity.other.attribute-name.html>border</><punctuation.separator.key-value.html>=</><string.unquoted.html>2\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>nested\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>table\\n</></><keyword.operator>|}\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>the original table again\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Invalid attributes in table cell (T3830)",
		"wikitext": "{|\n|Cell:|broken\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><meta.attribute.unrecognized.Cell:.html><entity.other.attribute-name.html>Cell:</></><keyword.operator>|</><markup.style>broken\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Table cell attributes: Pipes protected by nowikis should be treated as a plain character",
		"wikitext": "{|\n|title=\"foo\" |bar\n|title=\"foo<nowiki>|</nowiki>\" |bar\n|title=\"foo<nowiki>|</nowiki>\" bar\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo<punctuation.definition.string.end.html>\"</></> </><keyword.operator>|</><markup.style>bar\\n</><keyword.operator>|</><meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo&lt;nowiki&gt</></><keyword.operator>|</><markup.style><meta.tag.other.nowiki.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>nowiki</></><punctuation.definition.tag.end.html>&gt</></>\" |bar\\n</><keyword.operator>|</><meta.attribute.title.html><entity.other.attribute-name.html>title</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo&lt;nowiki&gt</></><keyword.operator>|</><markup.style><meta.tag.other.nowiki.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>nowiki</></><punctuation.definition.tag.end.html>&gt</></>\" bar\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Table cell attributes: Pipes protected by nested nowikis should be treated as a plain character",
		"wikitext": "{|\n|<code><nowiki>{{ACB|PG}}</nowiki></code>\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style><meta.tag.inline.code.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>code</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>{{ACB|PG}}</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.tag.inline.code.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>code</><punctuation.definition.tag.end.html>&gt\\n</></></></><keyword.operator>|}</></>"
	},
	{
		"desc": "Table security: embedded pipes",
		"wikitext": "{|\n| |[ftp://|x||]\" onmouseover=\"alert(document.cookie)\">test",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</> <keyword.operator>|</><markup.style>[ftp://|x</><keyword.operator>||</><markup.style>]\" onmouseover=\"alert(document.cookie)\"&gttest</></></>"
	},
	{
		"desc": "Element attributes with double ! should not be broken up by <th>",
		"wikitext": "{|\n!hi <div class=\"!!\">ha</div> ho\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</><markup.style>hi <meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</></></></></><keyword.operator>!!</><markup.style>\"&gtha<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></> ho\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "! and || in element attributes should not be parsed as <th>/<td>",
		"wikitext": "{|\n|<div style=\"color: red !important;\" data-contrived=\"put this here ||\">hi</div>\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>color: red !important;</><punctuation.definition.string.end.html><source.css>\"</></></></></> <meta.attribute.data-x.data-contrived.html><entity.other.attribute-name.html>data-contrived</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>put this here </></></></><keyword.operator>||</><markup.style>\"&gthi<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></></></><keyword.operator>|}</></>"
	},
	{
		"desc": "! and || in td attributes should not be parsed as <th>/<td>",
		"wikitext": "{|\n|style=\"color: red !important;\" data-contrived=\"put this here ||\"|foo\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>style=\"color: red !important;\" data-contrived=\"put this here </><keyword.operator>||</><invalid.illegal.character-not-allowed-here.html>\"</><keyword.operator>|</><markup.style>foo\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Invalid text in table attributes should be discarded",
		"wikitext": "{| <span>boo</span> style='border:1px solid black'\n|  <span>boo</span> style='color:blue'  |1\n|<span>boo</span> style='color:blue'|2\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|</> <invalid.illegal.character-not-allowed-here.html>&lt;span</>&gt<meta.attribute.unrecognized.boo.html><entity.other.attribute-name.html>boo</></><invalid.illegal.character-not-allowed-here.html>&lt;/span</>&gt <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.single.html><punctuation.definition.string.begin.html>'</><source.css>border:1px solid black</><punctuation.definition.string.end.html><source.css>'\\n</></></></></><meta.tag.block.td><keyword.operator>|</>  <invalid.illegal.character-not-allowed-here.html>&lt;span</>&gt<meta.attribute.unrecognized.boo.html><entity.other.attribute-name.html>boo</></><invalid.illegal.character-not-allowed-here.html>&lt;/span</>&gt <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.single.html><punctuation.definition.string.begin.html>'</><source.css>color:blue</><punctuation.definition.string.end.html><source.css>'</></></></>  </><keyword.operator>|</><markup.style>1\\n</><keyword.operator>|</><invalid.illegal.character-not-allowed-here.html>&lt;span</>&gt<meta.attribute.unrecognized.boo.html><entity.other.attribute-name.html>boo</></><invalid.illegal.character-not-allowed-here.html>&lt;/span</>&gt <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.single.html><punctuation.definition.string.begin.html>'</><source.css>color:blue</><punctuation.definition.string.end.html><source.css>'</></></></></><keyword.operator>|</><markup.style>2\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Invalid text in table attributes should be preserved by selective serializer",
		"wikitext": "{| <span>boo</span> style='border:1px solid black'\n|  <span>boo</span> style='color:blue'  | 1\n|<span>boo</span> style='color:blue'| 2\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|</> <invalid.illegal.character-not-allowed-here.html>&lt;span</>&gt<meta.attribute.unrecognized.boo.html><entity.other.attribute-name.html>boo</></><invalid.illegal.character-not-allowed-here.html>&lt;/span</>&gt <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.single.html><punctuation.definition.string.begin.html>'</><source.css>border:1px solid black</><punctuation.definition.string.end.html><source.css>'\\n</></></></></><meta.tag.block.td><keyword.operator>|</>  <invalid.illegal.character-not-allowed-here.html>&lt;span</>&gt<meta.attribute.unrecognized.boo.html><entity.other.attribute-name.html>boo</></><invalid.illegal.character-not-allowed-here.html>&lt;/span</>&gt <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.single.html><punctuation.definition.string.begin.html>'</><source.css>color:blue</><punctuation.definition.string.end.html><source.css>'</></></></>  </><keyword.operator>|</><markup.style> 1\\n</><keyword.operator>|</><invalid.illegal.character-not-allowed-here.html>&lt;span</>&gt<meta.attribute.unrecognized.boo.html><entity.other.attribute-name.html>boo</></><invalid.illegal.character-not-allowed-here.html>&lt;/span</>&gt <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.single.html><punctuation.definition.string.begin.html>'</><source.css>color:blue</><punctuation.definition.string.end.html><source.css>'</></></></></><keyword.operator>|</><markup.style> 2\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "1. Template-generated table cell attributes and cell content",
		"wikitext": "{|\n|{{table_attribs}}\n| {{table_attribs}}\n|| {{table_attribs_5}}\n| <!--foo--> <!--bar--> <!--baz--> {{table_attribs}}\n|align=center {{table_attribs}}\n| <!--foo--> align=center <!--bar--> {{table_attribs}}\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table_attribs</><punctuation.definition.tag.template>}}\\n</></><keyword.operator>|</><markup.style> <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table_attribs</><punctuation.definition.tag.template>}}\\n</></><keyword.operator>||</><markup.style> <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table_attribs_5</><punctuation.definition.tag.template>}}\\n</></><keyword.operator>|</><markup.style> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>foo<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>bar<punctuation.definition.comment.html>--&gt</></> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>baz<punctuation.definition.comment.html>--&gt</></> <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table_attribs</><punctuation.definition.tag.template>}}\\n</></><keyword.operator>|</><markup.style>align=center <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table_attribs</><punctuation.definition.tag.template>}}\\n</></><keyword.operator>|</><markup.style> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>foo<punctuation.definition.comment.html>--&gt</></> align=center <comment.block.html><punctuation.definition.comment.html>&lt;!--</>bar<punctuation.definition.comment.html>--&gt</></> <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table_attribs</><punctuation.definition.tag.template>}}\\n</></></><keyword.operator>|}</></>"
	},
	{
		"desc": "2a. Template-generated table cell attributes and cell content",
		"wikitext": "{|\n|{{table_attribs_2}}\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table_attribs_2</><punctuation.definition.tag.template>}}\\n</></></><keyword.operator>|}</></>"
	},
	{
		"desc": "2b: Delete whitespace/comments if found in fosterable position while template-wrapping",
		"wikitext": "<table>\n<tr>\n<td>hi</td>\n{{1x|<td>ho</td>\n<!--comment-->\n<td>hi</td>}}\n<td>ho</td>\n</tr>\n</table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>hi<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt\\n</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>ho<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt\\n</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</>comment<punctuation.definition.comment.html>--&gt\\n</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>hi<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.template>}}\\n</><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>ho<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "3. Template-generated table cell attributes and cell content",
		"wikitext": "{|\n!align=center {{table_header_cells}}\n|-\n|align=center {{table_cells}}\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</><markup.style>align=center <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table_header_cells</><punctuation.definition.tag.template>}}\\n</></></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>align=center <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table_cells</><punctuation.definition.tag.template>}}\\n</></></><keyword.operator>|}</></>"
	},
	{
		"desc": "4. Template-generated table cell attributes and cell content inside a templated table",
		"wikitext": "{{tbl-start}}\n!align=center {{table_header_cells}}\n|-\n|align=center {{table_cells}}\n{{tbl-end}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>tbl-start</><punctuation.definition.tag.template>}}\\n</>!align=center <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table_header_cells</><punctuation.definition.tag.template>}}\\n</>|-\\n|align=center <punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table_cells</><punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>tbl-end</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Table with row followed by newlines and table heading",
		"wikitext": "{|\n|-\n\n!foo\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.table-row><keyword.operator>|-\\n\\n</></><meta.tag.block.th><keyword.operator>!</><markup.style>foo\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Table with empty line following the start tag",
		"wikitext": "{|\n\n|-\n|foo\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n\\n</><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>foo\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Table attributes with empty value",
		"wikitext": "{|\n| style=|hello\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</></><keyword.operator>|</><markup.style>hello\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Wikitext table with a lot of comments",
		"wikitext": "{|\n<!-- c0 -->\n|foo\n<!-- c1 -->\n|-<!-- c2 -->\n<!-- c3 -->\n|<!-- c4 -->\n<!-- c5 -->\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><comment.block.html><punctuation.definition.comment.html>&lt;!--</> c0 <punctuation.definition.comment.html>--&gt\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>foo\\n</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</> c1 <punctuation.definition.comment.html>--&gt\\n</></><meta.tag.block.table-row><keyword.operator>|-</><invalid.illegal.character-not-allowed-here.html>&lt;!--</> <meta.attribute.unrecognized.c2.html><entity.other.attribute-name.html>c2</></> <meta.attribute.unrecognized.--.html><entity.other.attribute-name.html>--</></>&gt\\n</><comment.block.html><punctuation.definition.comment.html>&lt;!--</> c3 <punctuation.definition.comment.html>--&gt\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style><comment.block.html><punctuation.definition.comment.html>&lt;!--</> c4 <punctuation.definition.comment.html>--&gt\\n</></></></><comment.block.html><punctuation.definition.comment.html>&lt;!--</> c5 <punctuation.definition.comment.html>--&gt\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Wikitext table comments represented in parsoid dom",
		"wikitext": "{|<!--c1--><!--c2-->\n|-<!--c3-->\n|x\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|</><invalid.illegal.character-not-allowed-here.html>&lt;!--c1--</>&gt<invalid.illegal.character-not-allowed-here.html>&lt;!--c2--</>&gt\\n<meta.tag.block.table-row><keyword.operator>|-</><invalid.illegal.character-not-allowed-here.html>&lt;!--c3--</>&gt\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>x\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Wikitext table with double-line table cell",
		"wikitext": "{|\n|a\nb\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>a\\n</></>b\\n<keyword.operator>|}</></>"
	},
	{
		"desc": "Table cell with a single comment",
		"wikitext": "{|\n|<!-- c1 -->\n|a\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style><comment.block.html><punctuation.definition.comment.html>&lt;!--</> c1 <punctuation.definition.comment.html>--&gt\\n</></></><keyword.operator>|</><markup.style>a\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Table-cell after a comment-only-empty-line",
		"wikitext": "{|\n|a\n<!--c1-->\n<!--c2-->|b\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>a\\n</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</>c1<punctuation.definition.comment.html>--&gt\\n&lt;!--</>c2<punctuation.definition.comment.html>--&gt</></>|b\\n<keyword.operator>|}</></>"
	},
	{
		"desc": "Build table with {{!}}",
		"wikitext": "{{{!}} class=\"wikitable\"\n!header\n!second header\n{{!}}- style=\"color:red;\"\n{{!}}data{{!}}{{!}} style=\"color:red;\" {{!}}second data\n{{!}}}",
		"parsed": "<meta.tag.block.table><keyword.operator>{{{!}}</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>wikitable<punctuation.definition.string.end.html>\"\\n</></></><meta.tag.block.th><keyword.operator>!</><markup.style>header\\n</><keyword.operator>!</><markup.style>second header\\n</></><meta.tag.block.table-row><keyword.operator>{{!}}-</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>color:red;</><punctuation.definition.string.end.html><source.css>\"\\n</></></></></></><meta.tag.block.td><keyword.operator>{{!}}</><markup.style>data</><keyword.operator>{{!}}{{!}}</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>color:red;</><punctuation.definition.string.end.html><source.css>\"</></></></> </><keyword.operator>{{!}}</><markup.style>second data\\n</></><keyword.operator>{{!}}}</></>"
	},
	{
		"desc": "Build table with pipe as data",
		"wikitext": "{| class=\"wikitable\"\n!header\n!second header\n|- style=\"color:red;\"\n|data|| style=\"color:red;\" |second data\n|-\n| style=\"color:red;\" |data with | || style=\"color:red;\" | second data with |\n|-\n||data with | |||second data with |\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>wikitable<punctuation.definition.string.end.html>\"\\n</></></><meta.tag.block.th><keyword.operator>!</><markup.style>header\\n</><keyword.operator>!</><markup.style>second header\\n</></><meta.tag.block.table-row><keyword.operator>|-</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>color:red;</><punctuation.definition.string.end.html><source.css>\"\\n</></></></></></><meta.tag.block.td><keyword.operator>|</><markup.style>data</><keyword.operator>||</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>color:red;</><punctuation.definition.string.end.html><source.css>\"</></></></> </><keyword.operator>|</><markup.style>second data\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>color:red;</><punctuation.definition.string.end.html><source.css>\"</></></></> </><keyword.operator>|</><markup.style>data with | </><keyword.operator>||</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>color:red;</><punctuation.definition.string.end.html><source.css>\"</></></></> </><keyword.operator>|</><markup.style> second data with |\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>||</><markup.style>data with | </><keyword.operator>|||</><markup.style>second data with |\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Build table with wikilink",
		"wikitext": "{| class=\"wikitable\"\n!header||second header\n|- style=\"color:red;\"\n|data [[Main Page|linktext]]||second data [[Main Page|linktext]]\n|-\n|data||second data [[Main Page|link|text with pipe]]\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>wikitable<punctuation.definition.string.end.html>\"\\n</></></><meta.tag.block.th><keyword.operator>!</><markup.style>header</><keyword.operator>||</><markup.style>second header\\n</></><meta.tag.block.table-row><keyword.operator>|-</> <meta.attribute.style.html><entity.other.attribute-name.html>style</><punctuation.separator.key-value.html>=</><meta.embedded.line.css><string.quoted.double.html><punctuation.definition.string.begin.html>\"</><source.css>color:red;</><punctuation.definition.string.end.html><source.css>\"\\n</></></></></></><meta.tag.block.td><keyword.operator>|</><markup.style>data <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</>linktext<punctuation.definition.tag.link.internal>]]</></></><keyword.operator>||</><markup.style>second data <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</>linktext<punctuation.definition.tag.link.internal>]]\\n</></></></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>data</><keyword.operator>||</><markup.style>second data <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Main Page</><keyword.operator>|</>link|text with pipe<punctuation.definition.tag.link.internal>]]\\n</></></></><keyword.operator>|}</></>"
	},
	{
		"desc": "Wikitext table with html-syntax row",
		"wikitext": "{|\n|-\n<td>foo</td>\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Fostered content in tables: Plain text",
		"wikitext": "{|\n|-\na\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.table-row><keyword.operator>|-\\n</></>a\\n<keyword.operator>|}</></>"
	},
	{
		"desc": "Fostered content in tables: Lists",
		"wikitext": "{|\n|-\n*a\n*b\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.table-row><keyword.operator>|-\\n</></><punctuation.definition.list.begin.markdown>*</>a\\n<punctuation.definition.list.begin.markdown>*</>b\\n<keyword.operator>|}</></>"
	},
	{
		"desc": "Template generated table cell with attributes",
		"wikitext": "{|\n|-\n{{table_attribs_4}} ||a||b\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.table-row><keyword.operator>|-\\n</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table_attribs_4</><punctuation.definition.tag.template>}}</> ||a||b\\n<keyword.operator>|}</></>"
	},
	{
		"desc": "Templated table cell with untemplated attributes: Cell combination tests",
		"wikitext": "{|\n|-\n!class=\"test\"{{table_cell_content|attr=! align=left}} /* th & th combine */\n|-\n|class=\"test\"{{table_cell_content}} /* td & td combine */\n|-\n!class=\"test\"{{table_cell_content}} /* th & td combine */\n|-\n|class=\"test\"{{table_cell_content|attr=! align=left}} /* td & th combine */\n|-\n|class=\"test\"{{table_cell_content|attr=style='color:red;'}}\n|-\n|class=\"test\"{{table_cell_content|cmt=<!--bar-->}}\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.th><keyword.operator>!</><markup.style>class=\"test\"<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table_cell_content</><keyword.operator>|</><entity.other.attribute-name.local-name>attr</><keyword.operator.equal>=</>! align=left<punctuation.definition.tag.template>}}</> /* th &amp; th combine */\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>class=\"test\"<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table_cell_content</><punctuation.definition.tag.template>}}</> /* td &amp; td combine */\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.th><keyword.operator>!</><markup.style>class=\"test\"<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table_cell_content</><punctuation.definition.tag.template>}}</> /* th &amp; td combine */\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>class=\"test\"<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table_cell_content</><keyword.operator>|</><entity.other.attribute-name.local-name>attr</><keyword.operator.equal>=</>! align=left<punctuation.definition.tag.template>}}</> /* td &amp; th combine */\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>class=\"test\"<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table_cell_content</><keyword.operator>|</><entity.other.attribute-name.local-name>attr</><keyword.operator.equal>=</>style='color:red;'<punctuation.definition.tag.template>}}\\n</></></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>class=\"test\"<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table_cell_content</><keyword.operator>|</><entity.other.attribute-name.local-name>cmt</><keyword.operator.equal>=</><comment.block.html><punctuation.definition.comment.html>&lt;!--</>bar<punctuation.definition.comment.html>--&gt</></><punctuation.definition.tag.template>}}\\n</></></><keyword.operator>|}</></>"
	},
	{
		"desc": "T343874: Templated table that has a templated cell with untemplated attributes",
		"wikitext": "{{tbl-start}}\n|-\n|class=\"test\"{{table_cell_content}}\n|-\n|class=\"test\"{{table_cell_content|attr=! align=left}}\n{{tbl-end}}",
		"parsed": "<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>tbl-start</><punctuation.definition.tag.template>}}\\n</>|-\\n|class=\"test\"<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table_cell_content</><punctuation.definition.tag.template>}}\\n</>|-\\n|class=\"test\"<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>table_cell_content</><keyword.operator>|</><entity.other.attribute-name.local-name>attr</><keyword.operator.equal>=</>! align=left<punctuation.definition.tag.template>}}\\n{{</><entity.name.tag.local-name>tbl-end</><punctuation.definition.tag.template>}}</>"
	},
	{
		"desc": "Templated table cell with untemplated attributes: Regression tests",
		"wikitext": "{|\n|class=\"foo\"\n{{1x|1={{!}}bar}}\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>class=\"foo\"\\n</></><punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><entity.other.attribute-name.local-name>1</><keyword.operator.equal>=</><constant.language.variables.metadata>{{!}}</>bar<punctuation.definition.tag.template>}}\\n</><keyword.operator>|}</></>"
	},
	{
		"desc": "Templated table cell with untemplated attributes: Unsupported (standalone mode) Scenarios",
		"wikitext": "{|\n|-\n|class=\"foo\"{{1x|1= {{!}}bar}}\n|-\n|class=\"foo\"{{1x|1=&nbsp;{{!}}bar}}\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>class=\"foo\"<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><entity.other.attribute-name.local-name>1</><keyword.operator.equal>=</> <constant.language.variables.metadata>{{!}}</>bar<punctuation.definition.tag.template>}}\\n</></></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>class=\"foo\"<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><entity.other.attribute-name.local-name>1</><keyword.operator.equal>=</><constant.character.entity.named.nbsp.html><punctuation.definition.entity.html>&amp;</>nbsp<punctuation.definition.entity.html>;</></><constant.language.variables.metadata>{{!}}</>bar<punctuation.definition.tag.template>}}\\n</></></><keyword.operator>|}</></>"
	},
	{
		"desc": "Templated table cell with untemplated attributes: Unsupported Scenario",
		"wikitext": "{|\n|-\n|class=\"foo\"{{1x|1={{!}}title=\"fail\"{{!}}bar}}\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>class=\"foo\"<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</><entity.other.attribute-name.local-name>1</><keyword.operator.equal>=</><constant.language.variables.metadata>{{!}}</>title=\"fail\"<constant.language.variables.metadata>{{!}}</>bar<punctuation.definition.tag.template>}}\\n</></></><keyword.operator>|}</></>"
	},
	{
		"desc": "Parsoid: Round-trip tables directly followed by content (T53219)",
		"wikitext": "{|\n|foo\n|} bar\n\n{|\n|baz\n|}<b>quux</b>",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>foo\\n</></><keyword.operator>|}</></> bar\\n\\n<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>baz\\n</></><keyword.operator>|}</></><meta.tag.inline.b.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></>quux<meta.tag.inline.b.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>b</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Parsoid: Default to a newline after tables in new content (T53219)",
		"wikitext": "{|\n|foo\n|}\nbar\n{|\n|baz\n|}\n'''quux'''",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>foo\\n</></><keyword.operator>|}\\n</></>bar\\n<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>baz\\n</></><keyword.operator>|}\\n</></><markup.bold>'''</>quux<markup.bold>'''</>"
	},
	{
		"desc": "Parsoid: Row-syntax table headings followed by comment & table cells",
		"wikitext": "{|\n!foo||bar\n<!-- foo -->  ||baz||quux\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</><markup.style>foo</><keyword.operator>||</><markup.style>bar\\n</></><comment.block.html><punctuation.definition.comment.html>&lt;!--</> foo <punctuation.definition.comment.html>--&gt</></>  ||baz||quux\\n<keyword.operator>|}</></>"
	},
	{
		"desc": "Parsoid: Recover better from broken table attributes",
		"wikitext": "{| class=\"foo\n| class=\"bar\" |\nfoo\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>foo\\n</></><meta.tag.block.td><keyword.operator>|</> <meta.attribute.class.html><entity.other.attribute-name.html>class</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>bar<punctuation.definition.string.end.html>\"</></> </><keyword.operator>|\\n</></>foo\\n<keyword.operator>|}</></>"
	},
	{
		"desc": "Tables: Digest broken attributes on table and tr tag",
		"wikitext": "{| || |} ++\n|- || || ++ --\n|- > [\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|</> <meta.attribute.unrecognized.||.html><entity.other.attribute-name.html>||</></> <meta.attribute.unrecognized.|}.html><entity.other.attribute-name.html>|}</></> <meta.attribute.unrecognized.++.html><entity.other.attribute-name.html>++\\n</></><meta.tag.block.table-row><keyword.operator>|-</> <meta.attribute.unrecognized.||.html><entity.other.attribute-name.html>||</></> <meta.attribute.unrecognized.||.html><entity.other.attribute-name.html>||</></> <meta.attribute.unrecognized.++.html><entity.other.attribute-name.html>++</></> <meta.attribute.unrecognized.--.html><entity.other.attribute-name.html>--\\n</></><keyword.operator>|-</> &gt <meta.attribute.unrecognized.[.html><entity.other.attribute-name.html>[\\n</></></><keyword.operator>|}</></>"
	},
	{
		"desc": "Table with missing opening <tr> tag",
		"wikitext": "<table>\n<td>foo</td>\n</tr>\n</table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></>foo<meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "1. Generate correct wikitext for tables with thead/tbody/tfoot",
		"wikitext": "{|\n|+Test\n!Month\n!Savings\n|-\n|January\n|$100\n|-\n|February\n|$80\n|-\n|Sum\n|$180\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|+</><markup.style>Test\\n</></><meta.tag.block.th><keyword.operator>!</><markup.style>Month\\n</><keyword.operator>!</><markup.style>Savings\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>January\\n</><keyword.operator>|</><markup.style>$100\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>February\\n</><keyword.operator>|</><markup.style>$80\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>Sum\\n</><keyword.operator>|</><markup.style>$180\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "2. Generate correct wikitext for tables with thead/tbody/tfoot",
		"wikitext": "{|\n!heading\n|-\n|foo\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</><markup.style>heading\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>foo\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Wikitext tables can be nested inside HTML tables",
		"wikitext": "<table>\n<tr><td>\n{|\n|foo\n|}\n</td></tr>\n</table>",
		"parsed": "<meta.tag.structure.table.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.tr.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.td.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>foo\\n</></><keyword.operator>|}\\n</></><meta.tag.structure.td.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>td</><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.tr.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>tr</><punctuation.definition.tag.end.html>&gt\\n</></><meta.tag.structure.table.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>table</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "T319143 - copy-pasting of cells, before",
		"wikitext": "{|\n|[[Eau]]\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Eau</><punctuation.definition.tag.link.internal>]]\\n</></></></><keyword.operator>|}</></>"
	},
	{
		"desc": "T319143 - copy-pasting of cells, after",
		"wikitext": "{|\n|[[Eau]]\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Eau</><punctuation.definition.tag.link.internal>]]\\n</></></></><keyword.operator>|}</></>"
	},
	{
		"desc": "T319143 - copy-pasting of cells, before multiple cells",
		"wikitext": "{|\n|[[Eau]]||[[Abc]]\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Eau</><punctuation.definition.tag.link.internal>]]</></></><keyword.operator>||</><markup.style><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Abc</><punctuation.definition.tag.link.internal>]]\\n</></></></><keyword.operator>|}</></>"
	},
	{
		"desc": "T319143 - copy-pasting of cells, before multiple cells, without \"row\"",
		"wikitext": "{|\n|[[Eau]]||[[Abc]]\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Eau</><punctuation.definition.tag.link.internal>]]</></></><keyword.operator>||</><markup.style><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Abc</><punctuation.definition.tag.link.internal>]]\\n</></></></><keyword.operator>|}</></>"
	},
	{
		"desc": "T319143 - copy-pasting of cells, between multiple cells",
		"wikitext": "{|\n|[[Eau]]||[[Abc]]\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Eau</><punctuation.definition.tag.link.internal>]]</></></><keyword.operator>||</><markup.style><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Abc</><punctuation.definition.tag.link.internal>]]\\n</></></></><keyword.operator>|}</></>"
	},
	{
		"desc": "T319143 - copy-pasting of cells, between multiple cells, without \"row\"",
		"wikitext": "{|\n|[[Eau]]||[[Abc]]\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Eau</><punctuation.definition.tag.link.internal>]]</></></><keyword.operator>||</><markup.style><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Abc</><punctuation.definition.tag.link.internal>]]\\n</></></></><keyword.operator>|}</></>"
	},
	{
		"desc": "T319143 - copy-pasting of cells, after multiple cells",
		"wikitext": "{|\n|[[Eau]]||[[Abc]]\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Eau</><punctuation.definition.tag.link.internal>]]</></></><keyword.operator>||</><markup.style><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Abc</><punctuation.definition.tag.link.internal>]]\\n</></></></><keyword.operator>|}</></>"
	},
	{
		"desc": "T319143 - copy-pasting of cells, after multiple cells, without \"row\"",
		"wikitext": "{|\n|[[Eau]]||[[Abc]]\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Eau</><punctuation.definition.tag.link.internal>]]</></></><keyword.operator>||</><markup.style><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Abc</><punctuation.definition.tag.link.internal>]]\\n</></></></><keyword.operator>|}</></>"
	},
	{
		"desc": "wtEscaping"
	},
	{
		"desc": "Headings: 0. Unnested",
		"wikitext": "<nowiki>=foo=</nowiki>\n\n<nowiki/>=foo=\n<!--cmt-->\n<nowiki>=foo=</nowiki>\n\n=foo''a''<nowiki>=</nowiki>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>=foo=</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>=foo=\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</>cmt<punctuation.definition.comment.html>--&gt\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>=foo=</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n\\n</>=foo<markup.italic>''</>a<markup.italic>''</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>=</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Headings: 1. Nested inside html",
		"wikitext": "= =foo= =\n\n== =foo= ==\n\n=== =foo= ===\n\n=<nowiki>=foo=</nowiki>=\n==<nowiki>=foo=</nowiki>==\n===<nowiki>=foo=</nowiki>===\n====<nowiki>=foo=</nowiki>====\n=====<nowiki>=foo=</nowiki>=====\n======<nowiki>=foo=</nowiki>======",
		"parsed": "<markup.heading>=<string.quoted.other.heading> =foo= </>=\\n\\n==<string.quoted.other.heading> =foo= </>==\\n\\n===<string.quoted.other.heading> =foo= </>===\\n\\n=<string.quoted.other.heading><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>=foo=</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</></>=\\n==<string.quoted.other.heading><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>=foo=</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</></>==\\n===<string.quoted.other.heading><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>=foo=</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</></>===\\n====<string.quoted.other.heading><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>=foo=</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</></>====\\n=====<string.quoted.other.heading><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>=foo=</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</></>=====\\n======<string.quoted.other.heading><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>=foo=</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</></>======</>"
	},
	{
		"desc": "Headings: 2. Outside heading nest on a single line <h1>foo</h1>*bar",
		"wikitext": "= foo =\n<nowiki>*</nowiki>bar\n\n= foo =\n=bar\n\n= foo =\n<nowiki>=bar=</nowiki>",
		"parsed": "<markup.heading>=<string.quoted.other.heading> foo </>=\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>*</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>bar\\n\\n<markup.heading>=<string.quoted.other.heading> foo </>=\\n</>=bar\\n\\n<markup.heading>=<string.quoted.other.heading> foo </>=\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>=bar=</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Headings: 3. Nested inside html with wikitext split by html tags",
		"wikitext": "= ='''bold'''foo= =",
		"parsed": "<markup.heading>=<string.quoted.other.heading> =<markup.bold>'''</>bold<markup.bold>'''</>foo= </>=</>"
	},
	{
		"desc": "Headings: 4a. No escaping needed (testing just h1 and h2)",
		"wikitext": "= =foo =\n\n= foo= =\n\n= =foo= =\n\n= =foo= bar =\n\n== =foo ==\n\n== foo= ==\n\n= = =\n\n= ''=''foo= =",
		"parsed": "<markup.heading>=<string.quoted.other.heading> =foo </>=\\n\\n=<string.quoted.other.heading> foo= </>=\\n\\n=<string.quoted.other.heading> =foo= </>=\\n\\n=<string.quoted.other.heading> =foo= bar </>=\\n\\n==<string.quoted.other.heading> =foo </>==\\n\\n==<string.quoted.other.heading> foo= </>==\\n\\n=<string.quoted.other.heading> = </>=\\n\\n=<string.quoted.other.heading> <markup.italic>''</>=<markup.italic>''</>foo= </>=</>"
	},
	{
		"desc": "Headings: 4b. No escaping needed (inside p-tags)",
		"wikitext": "=foo= x\n=foo= <s></s>",
		"parsed": "=foo= x\\n=foo= <meta.tag.inline.s.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>s</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.s.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>s</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Headings: 4c. Short headings (1)",
		"wikitext": "<nowiki>===</nowiki>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>===</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Headings: 4d. Short headings (2)",
		"wikitext": "=\n==\n===\n====\n=====",
		"parsed": "=\\n==\\n<markup.heading>=<string.quoted.other.heading>=</>=\\n=<string.quoted.other.heading>==</>=\\n==<string.quoted.other.heading>=</>==</>"
	},
	{
		"desc": "Headings: 6a. Heading chars in SOL context (with trailing spaces)",
		"wikitext": "<nowiki>=a=</nowiki>\n\n<nowiki>=a=</nowiki> \n\n<nowiki>=a=</nowiki>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>=a=</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>=a=</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</> \\n\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>=a=</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Headings: 6b. Heading chars in SOL context (with trailing newlines)",
		"wikitext": "<nowiki>=a=</nowiki>\nb\n\n<nowiki>=a=</nowiki> \nb\n\n<nowiki>=a=</nowiki>\t\nb",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>=a=</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n</>b\\n\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>=a=</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</> \\nb\\n\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>=a=</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>\t\\nb"
	},
	{
		"desc": "Headings: 6c. Heading chars in SOL context (leading newline break)",
		"wikitext": "a\n<nowiki>=b=</nowiki>",
		"parsed": "a\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>=b=</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Headings: 6d. Heading chars in SOL context (with interspersed comments)",
		"wikitext": "<!--c0--><nowiki>=a=</nowiki>\n\n<!--c1--><nowiki>=a=</nowiki> <!--c2-->\t <!--c3-->",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</>c0<punctuation.definition.comment.html>--&gt</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>=a=</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n\\n</><comment.block.html><punctuation.definition.comment.html>&lt;!--</>c1<punctuation.definition.comment.html>--&gt</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>=a=</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</> <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c2<punctuation.definition.comment.html>--&gt</></>\t <comment.block.html><punctuation.definition.comment.html>&lt;!--</>c3<punctuation.definition.comment.html>--&gt</></>"
	},
	{
		"desc": "Headings: 6d. Heading chars in SOL context (No escaping needed)",
		"wikitext": "=a=<div>b</div>",
		"parsed": "=a=<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>b<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "Headings: 7. Insert a newline between new content and headings",
		"wikitext": "== NEW ==\nnew\n\n==A==\na",
		"parsed": "<markup.heading>==<string.quoted.other.heading> NEW </>==\\n</>new\\n\\n<markup.heading>==<string.quoted.other.heading>A</>==\\n</>a"
	},
	{
		"desc": "Headings: Used as horizontal rule",
		"wikitext": "===============",
		"parsed": "<markup.heading>======<string.quoted.other.heading>===</>======</>"
	},
	{
		"desc": "Lists: 0. Outside nests",
		"wikitext": "<nowiki>*</nowiki>foo\n\n<nowiki>#</nowiki>foo\n\n<nowiki>;</nowiki>Foo<nowiki>:</nowiki>bar",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>*</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>foo\\n\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>#</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>foo\\n\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>;</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>Foo<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>:</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>bar"
	},
	{
		"desc": "Lists: 1. Nested inside html (No unnecessary escapes)",
		"wikitext": "* *foo\n* #foo\n* :foo\n* ;foo\n*<nowiki>*foo</nowiki>\n*<nowiki>#foo</nowiki>\n*<nowiki>:foo</nowiki>\n*<nowiki>;foo</nowiki>\n\n# *foo\n# #foo\n# :foo\n# ;foo\n#<nowiki>*foo</nowiki>\n#<nowiki>#foo</nowiki>\n#<nowiki>:foo</nowiki>\n#<nowiki>;foo</nowiki>",
		"parsed": "<punctuation.definition.list.begin.markdown>*</> *foo\\n<punctuation.definition.list.begin.markdown>*</> #foo\\n<punctuation.definition.list.begin.markdown>*</> :foo\\n<punctuation.definition.list.begin.markdown>*</> ;foo\\n<punctuation.definition.list.begin.markdown>*</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>*foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.list.begin.markdown>*</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>#foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.list.begin.markdown>*</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>:foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.list.begin.markdown>*</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>;foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.list.begin.markdown>#</> *foo\\n<punctuation.definition.list.begin.markdown>#</> #foo\\n<punctuation.definition.list.begin.markdown>#</> :foo\\n<punctuation.definition.list.begin.markdown>#</> ;foo\\n<punctuation.definition.list.begin.markdown>#</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>*foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.list.begin.markdown>#</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>#foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.list.begin.markdown>#</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>:foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.list.begin.markdown>#</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>;foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Lists: 2. Inside definition lists",
		"wikitext": "; ;foo\n\n; <nowiki>:foo</nowiki>\n\n; <nowiki>:foo</nowiki>\n: bar\n\n: :foo",
		"parsed": "<punctuation.definition.list.begin.markdown>;</> ;foo\\n\\n<punctuation.definition.list.begin.markdown>;</> <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>:foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.list.begin.markdown>;</> <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>:foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.list.begin.markdown>:</> bar\\n\\n<punctuation.definition.list.begin.markdown>:</> :foo"
	},
	{
		"desc": "Lists: 3. Only bullets at start of text in wikitext-generated HTML should be escaped",
		"wikitext": "* *foo*bar\n*<nowiki>*foo</nowiki>''it''*bar",
		"parsed": "<punctuation.definition.list.begin.markdown>*</> *foo*bar\\n<punctuation.definition.list.begin.markdown>*</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>*foo</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><markup.italic>''</>it<markup.italic>''</>*bar"
	},
	{
		"desc": "Lists: 4. No escapes needed",
		"wikitext": "*foo*bar\n\n*''foo''*bar\n\n*[[Foo]]: bar\n\n*[[Foo]]*bar",
		"parsed": "<punctuation.definition.list.begin.markdown>*</>foo*bar\\n\\n<punctuation.definition.list.begin.markdown>*</><markup.italic>''</>foo<markup.italic>''</>*bar\\n\\n<punctuation.definition.list.begin.markdown>*</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></>: bar\\n\\n<punctuation.definition.list.begin.markdown>*</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></>*bar"
	},
	{
		"desc": "Lists: 5. No unnecessary escapes",
		"wikitext": "* bar <span><nowiki>[[foo]]</nowiki></span>\n\n* =bar <span><nowiki>[[foo]]</nowiki></span>\n\n* [[bar <span><nowiki>[[foo]]</nowiki></span>\n\n* ]]bar <span><nowiki>[[foo]]</nowiki></span>\n\n* =bar <span>foo]]</span>=\n\n* <s></s>: a\n\n* ''* foo''",
		"parsed": "<punctuation.definition.list.begin.markdown>*</> bar <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>[[foo]]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n\\n</></><punctuation.definition.list.begin.markdown>*</> =bar <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>[[foo]]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n\\n</></><punctuation.definition.list.begin.markdown>*</> <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>bar </>&lt;span<invalid.deprecated.ineffective>&gt</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>[[foo]]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>&lt;/span<invalid.deprecated.ineffective>&gt\\n\\n</>* <punctuation.definition.tag.link.internal>]]</></>bar <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>[[foo]]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n\\n</></><punctuation.definition.list.begin.markdown>*</> =bar <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>foo]]<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>=\\n\\n<punctuation.definition.list.begin.markdown>*</> <meta.tag.inline.s.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>s</><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.s.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>s</><punctuation.definition.tag.end.html>&gt</></>: a\\n\\n<punctuation.definition.list.begin.markdown>*</> <markup.italic>''</>* foo<markup.italic>''</>"
	},
	{
		"desc": "Lists: 6. Escape bullets in SOL position",
		"wikitext": "<!--cmt--><nowiki>*</nowiki>foo",
		"parsed": "<comment.block.html><punctuation.definition.comment.html>&lt;!--</>cmt<punctuation.definition.comment.html>--&gt</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>*</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>foo"
	},
	{
		"desc": "Lists: 7. Escape bullets in a multi-line context",
		"wikitext": "a\n<nowiki>*</nowiki>b",
		"parsed": "a\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>*</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>b"
	},
	{
		"desc": "Lists: 8. Escape colons only if not present in tags",
		"wikitext": "; <nowiki>a:b</nowiki>''c:d''",
		"parsed": "<punctuation.definition.list.begin.markdown>;</> <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>a:b</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><markup.italic>''</>c:d<markup.italic>''</>"
	},
	{
		"desc": "HRs: 1. Single line",
		"wikitext": "----<nowiki>----</nowiki>\n----=foo=\n----*foo",
		"parsed": "<markup.changed>----</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>----</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n</><markup.changed>----</>=foo=\\n<markup.changed>----</>*foo"
	},
	{
		"desc": "Tables: 1a. Simple example",
		"wikitext": "<nowiki>{|</nowiki>\n|}",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>{|</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n</>|}"
	},
	{
		"desc": "Tables: 1b. No escaping needed",
		"wikitext": "!foo",
		"parsed": "!foo"
	},
	{
		"desc": "Tables: 1c. No escaping needed",
		"wikitext": "|foo",
		"parsed": "|foo"
	},
	{
		"desc": "Tables: 1d. No escaping needed",
		"wikitext": "|}foo",
		"parsed": "|}foo"
	},
	{
		"desc": "Tables: 2a. Nested in td",
		"wikitext": "{|\n|<nowiki>foo|bar</nowiki>\n|-\n|x<div><nowiki>a|b</nowiki></div>\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>foo</><keyword.operator>|</><markup.style>bar<meta.tag.other.nowiki.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>nowiki</></><punctuation.definition.tag.end.html>&gt\\n</></></></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><meta.attribute.unrecognized.x.html><entity.other.attribute-name.html>x</></><invalid.illegal.character-not-allowed-here.html>&lt;div</>&gt<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>a</><keyword.operator>|</><markup.style>b<meta.tag.other.nowiki.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>nowiki</></><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></></></><keyword.operator>|}</></>"
	},
	{
		"desc": "Tables: 2b. Nested in td",
		"wikitext": "{|\n|<nowiki>foo||bar</nowiki>\n|a''<nowiki>b||c</nowiki>''\n|a''<div><nowiki>b||c</nowiki></div>''\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>foo</></><keyword.operator>||</><markup.style>bar<meta.tag.other.nowiki.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>nowiki</></><punctuation.definition.tag.end.html>&gt\\n</></></><keyword.operator>|</><markup.style>a<markup.italic>''</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>b</></><keyword.operator>||</><markup.style>c<meta.tag.other.nowiki.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>nowiki</></><punctuation.definition.tag.end.html>&gt</></><markup.italic>''\\n</></><keyword.operator>|</><markup.style>a<markup.italic>''</><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>b</></><keyword.operator>||</><markup.style>c<meta.tag.other.nowiki.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>nowiki</></><punctuation.definition.tag.end.html>&gt</></><meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></><markup.italic>''\\n</></></><keyword.operator>|}</></>"
	},
	{
		"desc": "Tables: 2c. Nested in td -- no escaping needed",
		"wikitext": "{|\n|foo!!bar\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>foo!!bar\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Tables: 3a. Nested in th",
		"wikitext": "{|\n!foo!bar\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</><markup.style>foo!bar\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Tables: 3b. Nested in th",
		"wikitext": "{|\n!<nowiki>foo!!bar</nowiki>\n!''<nowiki>foo|bar</nowiki>''\n!''<nowiki>foo!!bar</nowiki>''\n!''<span><nowiki>foo!!bar</nowiki></span>''\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</><markup.style><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>foo</></><keyword.operator>!!</><markup.style>bar<meta.tag.other.nowiki.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>nowiki</></><punctuation.definition.tag.end.html>&gt\\n</></></><keyword.operator>!</><invalid.illegal.character-not-allowed-here.html>''&lt;nowiki</>&gt<meta.attribute.unrecognized.foo.html><entity.other.attribute-name.html>foo</></><keyword.operator>|</><markup.style>bar<meta.tag.other.nowiki.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>nowiki</></><punctuation.definition.tag.end.html>&gt</></><markup.italic>''\\n</></><keyword.operator>!</><markup.style><markup.italic>''</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>foo</></><keyword.operator>!!</><markup.style>bar<meta.tag.other.nowiki.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>nowiki</></><punctuation.definition.tag.end.html>&gt</></><markup.italic>''\\n</></><keyword.operator>!</><markup.style><markup.italic>''</><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>foo</></><keyword.operator>!!</><markup.style>bar<meta.tag.other.nowiki.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>nowiki</></><punctuation.definition.tag.end.html>&gt</></><meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><markup.italic>''\\n</></></><keyword.operator>|}</></>"
	},
	{
		"desc": "Tables: 3c. Nested in th",
		"wikitext": "{|\n!<nowiki>foo||bar</nowiki>\n!<nowiki>foo||bar</nowiki>\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</><markup.style><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>foo</></><keyword.operator>||</><markup.style>bar<meta.tag.other.nowiki.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>nowiki</></><punctuation.definition.tag.end.html>&gt\\n</></></><keyword.operator>!</><markup.style><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>foo</></><keyword.operator>||</><markup.style>bar<meta.tag.other.nowiki.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>nowiki</></><punctuation.definition.tag.end.html>&gt\\n</></></></><keyword.operator>|}</></>"
	},
	{
		"desc": "Tables: 4a. Escape -",
		"wikitext": "{|\n!-bar\n|-\n| -bar\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</><markup.style>-bar\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style> -bar\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Tables: 4b. Escape +",
		"wikitext": "{|\n!+bar\n|-\n| +bar\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.th><keyword.operator>!</><markup.style>+bar\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style> +bar\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Tables: 4c. No escaping needed",
		"wikitext": "{|\n|foo-bar\n|foo+bar\n|-\n|''foo''-bar\n|''foo''+bar\n|-\n|foo\nbar|baz\n+bar\n-bar\n|-\n|x\n<div>a|b</div>\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style>foo-bar\\n</><keyword.operator>|</><markup.style>foo+bar\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style><markup.italic>''</>foo<markup.italic>''</>-bar\\n</><keyword.operator>|</><markup.style><markup.italic>''</>foo<markup.italic>''</>+bar\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>foo\\n</></>bar|baz\\n+bar\\n-bar\\n<meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>x\\n</></><meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt</></>a|b<meta.tag.structure.div.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Tables: 4d. No escaping needed",
		"wikitext": "{|\n|[[Foo]]-bar\n||+1\n||-2\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]</></>-bar\\n</><keyword.operator>||</><markup.style>+1\\n</><keyword.operator>||</><markup.style>-2\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Tables: 4e. Escape }",
		"wikitext": "{|\n| }\n|-\n|x||}\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style> }\\n</></><meta.tag.block.table-row><keyword.operator>|-\\n</></><meta.tag.block.td><keyword.operator>|</><markup.style>x</><keyword.operator>||</><markup.style>}\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Tables: 5. Empty table cells should get whitespace to avoid need for nowikis",
		"wikitext": "{|\n| || align=\"center\" | ||\n|}\n\n{|\n|\n| align=\"center\" |\n|\n|}\n\n{|\n| {{!}}{{!}} align=\"center\" | ||\n|}\n\n{|\n! !! align=\"center\" | !!\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style> </><keyword.operator>||</> <meta.attribute.align.html><invalid.deprecated.entity.other.attribute-name.html>align</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>center<punctuation.definition.string.end.html>\"</></> </><keyword.operator>|</><markup.style> </><keyword.operator>||\\n</></><keyword.operator>|}\\n\\n{|\\n</><meta.tag.block.td><keyword.operator>|\\n|</> <meta.attribute.align.html><invalid.deprecated.entity.other.attribute-name.html>align</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>center<punctuation.definition.string.end.html>\"</></> </><keyword.operator>|\\n|\\n</></><keyword.operator>|}\\n\\n{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style> </><keyword.operator>{{!}}{{!}}</> <meta.attribute.align.html><invalid.deprecated.entity.other.attribute-name.html>align</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>center<punctuation.definition.string.end.html>\"</></> </><keyword.operator>|</><markup.style> </><keyword.operator>||\\n</></><keyword.operator>|}\\n\\n{|\\n</><meta.tag.block.th><keyword.operator>!</><markup.style> </><keyword.operator>!!</> <meta.attribute.align.html><invalid.deprecated.entity.other.attribute-name.html>align</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>center<punctuation.definition.string.end.html>\"</></> </><keyword.operator>|</><markup.style> </><keyword.operator>!!\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "T97430: Don't emit empty nowiki pairs around marker meta tags",
		"wikitext": "<nowiki>*</nowiki>This is a long sentence here that will make the nowiki algo split up the nowikis into multiple pairs\n|** Make this another long long long sentence forcing the nowiki algo to split up the nowikis.",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>*</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>This is a long sentence here that will make the nowiki algo split up the nowikis into multiple pairs\\n|** Make this another long long long sentence forcing the nowiki algo to split up the nowikis."
	},
	{
		"desc": "Unclosed xmlish element in table line shouldn't eat end delimiters",
		"wikitext": "{|\n| <foo\n| bar>\n|}",
		"parsed": "<meta.tag.block.table><keyword.operator>{|\\n</><meta.tag.block.td><keyword.operator>|</><markup.style> <meta.tag.other.foo.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>foo\\n</></></></><keyword.operator>|</><markup.style> bar&gt\\n</></><keyword.operator>|}</></>"
	},
	{
		"desc": "Links 1. WikiLinks: No escapes needed",
		"wikitext": "[[Foo|Foo''boo'']]\n[[Foo|[Foobar]]]\n[[Foo|x [Foobar] x]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</>Foo<markup.italic>''</>boo<markup.italic>''</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Foo</><keyword.operator>|</>[Foobar<punctuation.definition.tag.link.internal>]]</></>]\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</>x [Foobar] x<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Links 2. WikiLinks: Escapes needed",
		"wikitext": "[[Foo|<nowiki>Foobar]</nowiki>]]\n[[Foo|x <nowiki>[http://google.com g]</nowiki> x]]\n[[Foo|<nowiki>[[Bar]]</nowiki>]]\n[[Foo|<nowiki>x [[Bar]] x</nowiki>]]\n[[Foo||Bar]]\n[[Foo|<nowiki>]]bar</nowiki>]]\n[[Foo|<nowiki>[[bar</nowiki>]]\n[[Foo|<nowiki>x [[ y</nowiki>]]\n[[Foo|<nowiki>x ]] y</nowiki>]]\n[[Foo|<nowiki>x ]] y [[ z</nowiki>]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>Foobar]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Foo</><keyword.operator>|</>x <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>[http://google.com g]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</> x<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Foo</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>[[Bar]]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Foo</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>x [[Bar]] x</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Foo</><keyword.operator>|</>|Bar<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Foo</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>]]bar</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Foo</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>[[bar</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Foo</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>x [[ y</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Foo</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>x ]] y</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Foo</><keyword.operator>|</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>x ]] y [[ z</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Links 3. WikiLinks: No escapes needed",
		"wikitext": "[[Foo|[Foobar]]\n[[Foo|foo|bar]]",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>Foo</><keyword.operator>|</>[Foobar<punctuation.definition.tag.link.internal>]]\\n[[</><entity.other.attribute-name>Foo</><keyword.operator>|</>foo|bar<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "Links 4. ExtLinks: Escapes needed",
		"wikitext": "[http://google.com <nowiki>[google]</nowiki>]\n[http://google.com <nowiki>google]</nowiki>]\n[http://google.com <nowiki>goog] le</nowiki>]\n\n<nowiki>[http://google.com]</nowiki>\n\n<nowiki>[http://google.com google]</nowiki>\n\n[http://google.com<nowiki>]</nowiki>\n\n[{{1x|http://google.com}}<nowiki>]</nowiki>",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://google.com</><string.other.link.external.title> <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>[google</></><punctuation.definition.tag.link.external>]</><meta.tag.other.nowiki.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>nowiki</></><punctuation.definition.tag.end.html>&gt</></>]\\n<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://google.com</><string.other.link.external.title> <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>google</></><punctuation.definition.tag.link.external>]</><meta.tag.other.nowiki.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>nowiki</></><punctuation.definition.tag.end.html>&gt</></>]\\n<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://google.com</><string.other.link.external.title> <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>goog</></><punctuation.definition.tag.link.external>]</> le<meta.tag.other.nowiki.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>nowiki</></><punctuation.definition.tag.end.html>&gt</></>]\\n\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>[http://google.com]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>[http://google.com google]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://google.com</><string.other.link.external.title><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</></><punctuation.definition.tag.link.external>]</><meta.tag.other.nowiki.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html><invalid.illegal.unrecognized-tag.html>nowiki</></><punctuation.definition.tag.end.html>&gt\\n\\n</></>[<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|</>http://google.com<punctuation.definition.tag.template>}}</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Links 5. ExtLinks: No escapes needed",
		"wikitext": "[http://google.com [google]\n\n[[http://google.com]]",
		"parsed": "<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://google.com</><string.other.link.external.title> [google</><punctuation.definition.tag.link.external>]\\n\\n</>[<punctuation.definition.tag.link.external>[</><entity.name.tag.url>http://google.com</><punctuation.definition.tag.link.external>]</>]"
	},
	{
		"desc": "Links 6. Add <nowiki/>s between text-nodes and url-links when required (T66300)",
		"wikitext": "x<nowiki/>http://example.com<nowiki/>y\nhttp://example.com<nowiki/>?x\nhttp://example.com<nowiki/>&x\nhttp://example.com<nowiki/>'x\nhttp://example.com<nowiki/>,x\nhttp://example.com<nowiki/>.x\nhttp://example.com<nowiki/>;x\nhttp://example.com<nowiki/>:x\nhttp://example.com<nowiki/>;x\nhttp://example.com<nowiki/>!x\nhttp://example.com<nowiki/>=x\nhttp://example.com<nowiki/>(x)\nhttp://example.com(x<nowiki/>)",
		"parsed": "x<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>http://example.com<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>y\\nhttp://example.com<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>?x\\nhttp://example.com<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>&amp;x\\nhttp://example.com<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>'x\\nhttp://example.com<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>,x\\nhttp://example.com<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>.x\\nhttp://example.com<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>;x\\nhttp://example.com<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>:x\\nhttp://example.com<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>;x\\nhttp://example.com<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>!x\\nhttp://example.com<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>=x\\nhttp://example.com<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>(x)\\nhttp://example.com(x<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>)"
	},
	{
		"desc": "Links 7a. Don't add spurious <nowiki/>s between text-nodes and url-links (T66300)",
		"wikitext": "x\nhttp://example.com\ny\n\"http://example.com\"\n(http://example.com)\n(http://example.com) foo\nhttp://example.com,\nhttp://example.com, foo",
		"parsed": "x\\nhttp://example.com\\ny\\n\"http://example.com\"\\n(http://example.com)\\n(http://example.com) foo\\nhttp://example.com,\\nhttp://example.com, foo"
	},
	{
		"desc": "Links 7b. Don't add spurious <nowiki/>s between text-nodes and url-links (T66300)",
		"wikitext": "http://example.com.,;:!?\\\n-http://example.com:",
		"parsed": "http://example.com.,;:!?\\\\n-http://example.com:"
	},
	{
		"desc": "Links 8. Add <nowiki/>s between text-nodes and RFC-links when required (T66300)",
		"wikitext": "RFC 123<nowiki/>4\nRFC 123<nowiki/>y\nX<nowiki/>RFC 123<nowiki/>y",
		"parsed": "<constant.language.variables.rfc>RFC 123</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>4\\n<constant.language.variables.rfc>RFC 123</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>y\\nX<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</><constant.language.variables.rfc>RFC 123</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>y"
	},
	{
		"desc": "Links 9. Don't add spurious <nowiki/>s between text-nodes and RFC-links (T66300)",
		"wikitext": "RFC 123?foo\nRFC 123&foo\n-RFC 123-",
		"parsed": "<constant.language.variables.rfc>RFC 123</>?foo\\n<constant.language.variables.rfc>RFC 123</>&amp;foo\\n-<constant.language.variables.rfc>RFC 123</>-"
	},
	{
		"desc": "Links 10. Add <nowiki/>s between text-nodes and PMID-links when required (T66300)",
		"wikitext": "PMID 123<nowiki/>4\nPMID 123<nowiki/>y\nX<nowiki/>PMID 123<nowiki/>y",
		"parsed": "<constant.language.variables.pmid>PMID 123</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>4\\n<constant.language.variables.pmid>PMID 123</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>y\\nX<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</><constant.language.variables.pmid>PMID 123</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>y"
	},
	{
		"desc": "Links 11. Don't add spurious <nowiki/>s between text-nodes and PMID-links (T66300)",
		"wikitext": "PMID 123?foo\nPMID 123&foo\n-PMID 123-",
		"parsed": "<constant.language.variables.pmid>PMID 123</>?foo\\n<constant.language.variables.pmid>PMID 123</>&amp;foo\\n-<constant.language.variables.pmid>PMID 123</>-"
	},
	{
		"desc": "Links 12. Add <nowiki/>s between text-nodes and ISBN-links when required (T66300)",
		"wikitext": "ISBN 1234567890<nowiki/>1\nISBN 1234567890<nowiki/>x\na<nowiki/>ISBN 1234567890<nowiki/>b",
		"parsed": "<constant.language.variables.isbn>ISBN 1234567890</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>1\\n<constant.language.variables.isbn>ISBN 1234567890</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>x\\na<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</><constant.language.variables.isbn>ISBN 1234567890</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>b"
	},
	{
		"desc": "Links 13. Don't add spurious <nowiki/>s between text-nodes and ISBN-links (T66300)",
		"wikitext": "-ISBN 1234567890's",
		"parsed": "-<constant.language.variables.isbn>ISBN 1234567890</>'s"
	},
	{
		"desc": "Links 14. Protect link-like plain text. (Parsoid bug T78425)",
		"wikitext": "this is not a link: <nowiki>http://example.com</nowiki>",
		"parsed": "this is not a link: <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>http://example.com</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "1a. Quotes inside <b> and <i>",
		"wikitext": "''<nowiki/>'foo'''\n''<nowiki>''foo''</nowiki>''\n''<nowiki>'''foo'''</nowiki>''\n''foo''<nowiki/>'s\n'''<nowiki/>'foo''''\n'''<nowiki>''foo''</nowiki>'''\n'''<nowiki>'''foo'''</nowiki>'''\n'''foo'<nowiki/>''bar'<nowiki/>''baz'''\n'''foo'''<nowiki/>'s\n'''foo''\n''foo''<nowiki/>'\n''foo'''<nowiki/>'\n'''foo''<nowiki/>'\n''''foo'''\n'''foo'''<nowiki/>'\n''''foo'''<nowiki/>'\n''fools'<span> errand</span>''\n''<span>fool</span>'s errand''\n'<nowiki/>''foo'' bar '''baz''\na|!*#-:;+-~[]{}b'''x''",
		"parsed": "<markup.italic>''</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>'foo<markup.bold>'''\\n</><markup.italic>''</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>''foo''</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><markup.italic>''\\n''</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>'''foo'''</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><markup.italic>''\\n''</>foo<markup.italic>''</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>'s\\n<markup.bold>'''</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>'foo'<markup.bold>'''\\n'''</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>''foo''</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><markup.bold>'''\\n'''</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>'''foo'''</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><markup.bold>'''\\n'''</>foo'<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</><markup.italic>''</>bar'<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</><markup.italic>''</>baz<markup.bold>'''\\n'''</>foo<markup.bold>'''</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>'s\\n<markup.bold>'''</>foo<markup.italic>''\\n''</>foo<markup.italic>''</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>'\\n<markup.italic>''</>foo<markup.bold>'''</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>'\\n<markup.bold>'''</>foo<markup.italic>''</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>'\\n'<markup.bold>'''</>foo<markup.bold>'''\\n'''</>foo<markup.bold>'''</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>'\\n'<markup.bold>'''</>foo<markup.bold>'''</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>'\\n<markup.italic>''</>fools'<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></> errand<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><markup.italic>''\\n''</><meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>fool<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>'s errand<markup.italic>''\\n</>'<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</><markup.italic>''</>foo<markup.italic>''</> bar <markup.bold>'''</>baz<markup.italic>''\\n</>a|!*#-:;+-~[]{}b<markup.bold>'''</>x<markup.italic>''</>"
	},
	{
		"desc": "2. Link fragments separated by <i> and <b> tags",
		"wikitext": "[[''foo''<nowiki>hello]]</nowiki>\n\n[['''foo'''<nowiki>hello]]</nowiki>",
		"parsed": "<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>''foo''</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>hello]]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n\\n</><invalid.deprecated.ineffective>[[</>'''foo'''<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>hello]]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</></>"
	},
	{
		"desc": "3. Link fragments inside <i> and <b>",
		"wikitext": "''[[foo''<nowiki>]]</nowiki>\n\n'''[[foo'''<nowiki>]]</nowiki>",
		"parsed": "<markup.italic>''</><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>foo''</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>]]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n\\n</>'''<invalid.deprecated.ineffective>[[</>foo'''<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>]]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</></>"
	},
	{
		"desc": "4. No escaping needed",
		"wikitext": "'<span>''bar''</span>'\n'<span>'''bar'''</span>'\n'a:b'foo",
		"parsed": "'<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><markup.italic>''</>bar<markup.italic>''</><meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>'\\n'<meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><markup.bold>'''</>bar<markup.bold>'''</><meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>'\\n'a:b'foo"
	},
	{
		"desc": "1. No unnecessary escapes",
		"wikitext": "bar <span><nowiki>[[foo]]</nowiki></span>\n\n=bar <span><nowiki>[[foo]]</nowiki></span>\n\n[[bar <span><nowiki>[[foo]]</nowiki></span>\n\n]]bar <span><nowiki>[[foo]]</nowiki></span>\n\n=bar <span>foo]]</span><nowiki>=</nowiki>",
		"parsed": "bar <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>[[foo]]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n\\n</></>=bar <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>[[foo]]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n\\n</></><string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.other.attribute-name>bar </>&lt;span<invalid.deprecated.ineffective>&gt</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>[[foo]]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>&lt;/span<invalid.deprecated.ineffective>&gt\\n\\n</><punctuation.definition.tag.link.internal>]]</></>bar <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>[[foo]]</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n\\n</></>=bar <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>foo]]<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>=</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "1. Leading whitespace in SOL context should be stripped",
		"wikitext": "a\n\na\n\n\ta(tab)\n\na\n<!--cmt-->\na\n\na\nb\n\na\n\tb\n\na\n\t b",
		"parsed": "a\\n\\na\\n\\n\ta(tab)\\n\\na\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</>cmt<punctuation.definition.comment.html>--&gt\\n</></>a\\n\\na\\nb\\n\\na\\n\tb\\n\\na\\n\t b"
	},
	{
		"desc": "3. Leading whitespace in indent-pre suppressing contexts should not be escaped",
		"wikitext": "<blockquote>\n a\n <span>b</span>\n c\n</blockquote>",
		"parsed": "<meta.tag.structure.blockquote.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt\\n</></> a\\n <meta.tag.inline.span.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt</></>b<meta.tag.inline.span.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>span</><punctuation.definition.tag.end.html>&gt\\n</></> c\\n<meta.tag.structure.blockquote.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>blockquote</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "4. Leading whitespace in indent-pre suppressing contexts should not be escaped",
		"wikitext": " [[File:Foobar.jpg|thumb|caption]]",
		"parsed": " <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>File:</><entity.other.attribute-name>Foobar.jpg</><keyword.operator>|</><entity.other.attribute-name.localname>thumb</><keyword.operator>|</>caption<punctuation.definition.tag.link.internal>]]</></>"
	},
	{
		"desc": "5. Nowiki escaping should account for indent-pres",
		"wikitext": " ==foo==",
		"parsed": " ==foo=="
	},
	{
		"desc": "T95794: nowiki escaping should account for leading space at start-of-line in an indent-pre block",
		"wikitext": " * foo\n * bar",
		"parsed": " * foo\\n * bar"
	},
	{
		"desc": "Whitespace scrubbing in SOL position should account for SOL-sensitive wikitext markup",
		"wikitext": "foo\n\n%foo\n\n<nowiki/>*foo\n\n<nowiki/>#foo\n\n<nowiki/>=foo=\n\n[[Category:Foo]]\n<nowiki/>*foo\n\n [[Category:Foo]]\n<nowiki>*</nowiki>foo\n\n<nowiki/><!--boo-->*foo\n\n<!--boo--><nowiki/>*foo\n\n<!--a--><!--b--><!--c--><!--d--><!--e-->foo\n\n<!--a--><nowiki/><!--b--><!--c--><!--d--><!--e-->*foo",
		"parsed": "foo\\n\\n%foo\\n\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>*foo\\n\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>#foo\\n\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>=foo=\\n\\n<string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>*foo\\n\\n <string.quoted.internal-link><punctuation.definition.tag.link.internal>[[</><entity.name.tag.namespace>Category:</><entity.other.attribute-name>Foo</><punctuation.definition.tag.link.internal>]]\\n</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>*</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>foo\\n\\n<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</><comment.block.html><punctuation.definition.comment.html>&lt;!--</>boo<punctuation.definition.comment.html>--&gt</></>*foo\\n\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</>boo<punctuation.definition.comment.html>--&gt</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</>*foo\\n\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</>a<punctuation.definition.comment.html>--&gt&lt;!--</>b<punctuation.definition.comment.html>--&gt&lt;!--</>c<punctuation.definition.comment.html>--&gt&lt;!--</>d<punctuation.definition.comment.html>--&gt&lt;!--</>e<punctuation.definition.comment.html>--&gt</></>foo\\n\\n<comment.block.html><punctuation.definition.comment.html>&lt;!--</>a<punctuation.definition.comment.html>--&gt</></><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>/&gt</><comment.block.html><punctuation.definition.comment.html>&lt;!--</>b<punctuation.definition.comment.html>--&gt&lt;!--</>c<punctuation.definition.comment.html>--&gt&lt;!--</>d<punctuation.definition.comment.html>--&gt&lt;!--</>e<punctuation.definition.comment.html>--&gt</></>*foo"
	},
	{
		"desc": "1. Valid behavior switches should be escaped",
		"wikitext": "<nowiki>__TOC__</nowiki>\n''<nowiki>__TOC__</nowiki>''",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>__TOC__</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n</><markup.italic>''</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>__TOC__</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><markup.italic>''</>"
	},
	{
		"desc": "2. Invalid behavior switches should not be escaped",
		"wikitext": "__TOO__\n__|__",
		"parsed": "__TOO__\\n__|__"
	},
	{
		"desc": "Behavior switches should be SOL-transparent",
		"wikitext": " __TOC__\n\n <!-- this one's bogus -->\n __TOO__\n\n __TOC__ foo\n\n__TOC__\n bar",
		"parsed": " <constant.language.behavior>__TOC__\\n\\n</> <comment.block.html><punctuation.definition.comment.html>&lt;!--</> this one's bogus <punctuation.definition.comment.html>--&gt\\n</></> __TOO__\\n\\n <constant.language.behavior>__TOC__</> foo\\n\\n<constant.language.behavior>__TOC__\\n</> bar"
	},
	{
		"desc": "During serialization, normalize output when given a SOL-transparent prefix",
		"wikitext": "x\n\n__NOTOC__y\n\n__NOTOC__z\n\n__notoc__p",
		"parsed": "x\\n\\n<constant.language.behavior>__NOTOC__</>y\\n\\n<constant.language.behavior>__NOTOC__</>z\\n\\n<constant.language.behavior>__notoc__</>p"
	},
	{
		"desc": "1. a tags",
		"wikitext": "<a href=\"http://google.com\">google</a>",
		"parsed": "<meta.tag.inline.a.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>a</> <meta.attribute.href.html><entity.other.attribute-name.html>href</><punctuation.separator.key-value.html>=</><string.quoted.double.html><punctuation.definition.string.begin.html>\"</>http://google.com<punctuation.definition.string.end.html>\"</></></><punctuation.definition.tag.end.html>&gt</></>google<meta.tag.inline.a.end.html><punctuation.definition.tag.begin.html>&lt;/</><entity.name.tag.html>a</><punctuation.definition.tag.end.html>&gt</></>"
	},
	{
		"desc": "2. other tags",
		"wikitext": "* <nowiki><div>foo</div></nowiki>\n* <nowiki><div style=\"color:red\">foo</div></nowiki>\n* <nowiki><td></nowiki>",
		"parsed": "<punctuation.definition.list.begin.markdown>*</> <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>&lt;div&gtfoo&lt;/div&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.list.begin.markdown>*</> <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>&lt;div style=\"color:red\"&gtfoo&lt;/div&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n</><punctuation.definition.list.begin.markdown>*</> <punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>&lt;td&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "3. multi-line html tag",
		"wikitext": "<nowiki><div\n>foo</div\n></nowiki>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>&lt;div\\n&gtfoo&lt;/div\\n&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "4. extension tags",
		"wikitext": "<nowiki><ref>foo</ref></nowiki>\n\n<nowiki><ref>bar</nowiki>\n\nbaz<nowiki></ref></nowiki>",
		"parsed": "<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>&lt;ref&gtfoo&lt;/ref&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n\\n</><punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>&lt;ref&gtbar</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt\\n\\n</>baz<punctuation.definition.tag.begin>&lt;</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</><meta.embedded.block.plaintext>&lt;/ref&gt</><punctuation.definition.tag.begin>&lt;/</><entity.name.tag>nowiki</><punctuation.definition.tag.end>&gt</>"
	},
	{
		"desc": "Parsoid: newline inducing block nodes don't suppress <nowiki>",
		"wikitext": "a\n\n= foo =",
		"parsed": "a\\n\\n<markup.heading>=<string.quoted.other.heading> foo </>=</>"
	},
	{
		"desc": "Escaping nowikis",
		"wikitext": "&lt;nowiki&gt;foo&lt;/nowiki&gt;",
		"parsed": "<constant.character.entity.named.lt.html><punctuation.definition.entity.html>&amp;</>lt<punctuation.definition.entity.html>;</></>nowiki<constant.character.entity.named.gt.html><punctuation.definition.entity.html>&amp;</>gt<punctuation.definition.entity.html>;</></>foo<constant.character.entity.named.lt.html><punctuation.definition.entity.html>&amp;</>lt<punctuation.definition.entity.html>;</></>/nowiki<constant.character.entity.named.gt.html><punctuation.definition.entity.html>&amp;</>gt<punctuation.definition.entity.html>;</></>"
	},
	{
		"desc": "(T54035) Nowiki-escaping should not get tripped by \" :\" in text",
		"wikitext": "foo's bar :",
		"parsed": "foo's bar :"
	},
	{
		"desc": "Ensure that when a leading-whitespace-containing string is emitted on a newline, it is correctly escaped",
		"wikitext": "<div>\nABC\n{{1x|\n{{{!}}\n{{!}} a\n{{!}}}}} b",
		"parsed": "<meta.tag.structure.div.start.html><punctuation.definition.tag.begin.html>&lt;</><entity.name.tag.html>div</><punctuation.definition.tag.end.html>&gt\\n</></>ABC\\n<punctuation.definition.tag.template>{{</><entity.name.tag.local-name>1x</><keyword.operator>|\\n</><meta.tag.block.table><keyword.operator>{{{!}}\\n</><meta.tag.block.td><keyword.operator>{{!}}</><markup.style> a\\n</></><keyword.operator>{{!}}}</></><punctuation.definition.tag.template>}}</> b"
	}
]
